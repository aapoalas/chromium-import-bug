{
    "/entries/rx.js": "dmFyIHQgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ID8gd2luZG93IDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIGdsb2JhbCA/IGdsb2JhbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmID8gc2VsZiA6IHt9OyBmdW5jdGlvbiBlKHQsIGUsIHIpIHsgcmV0dXJuIHQociA9IHsgcGF0aDogZSwgZXhwb3J0czoge30sIHJlcXVpcmU6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHRocm93IG5ldyBFcnJvcigiRHluYW1pYyByZXF1aXJlcyBhcmUgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgYnkgQHJvbGx1cC9wbHVnaW4tY29tbW9uanMiKSB9KG51bGwgPT0gZSAmJiByLnBhdGgpIH0gfSwgci5leHBvcnRzKSwgci5leHBvcnRzIH0gdmFyIHIgPSAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ICYmIHdpbmRvdywgbiA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBzZWxmICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBXb3JrZXJHbG9iYWxTY29wZSAmJiBzZWxmIGluc3RhbmNlb2YgV29ya2VyR2xvYmFsU2NvcGUgJiYgc2VsZiwgaSA9IHIgfHwgdm9pZCAwICE9PSB0ICYmIHQgfHwgbiwgbyA9IGk7ICFmdW5jdGlvbiAoKSB7IGlmICghaSkgdGhyb3cgbmV3IEVycm9yKCJSeEpTIGNvdWxkIG5vdCBmaW5kIGFueSBnbG9iYWwgY29udGV4dCAod2luZG93LCBzZWxmLCBnbG9iYWwpIikgfSgpOyB2YXIgcyA9IHsgcm9vdDogbyB9OyB2YXIgYyA9IHsgaXNGdW5jdGlvbjogZnVuY3Rpb24gKHQpIHsgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgfSB9LCB1ID0geyBpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ICYmICJudW1iZXIiID09IHR5cGVvZiB0Lmxlbmd0aCB9IH07IHZhciBhLCBoID0geyBpc09iamVjdDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIG51bGwgIT0gdCAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdCB9IH0sIGwgPSB7IGVycm9yT2JqZWN0OiB7IGU6IHt9IH0gfTsgZnVuY3Rpb24gcCgpIHsgdHJ5IHsgcmV0dXJuIGEuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9IGNhdGNoICh0KSB7IHJldHVybiBsLmVycm9yT2JqZWN0LmUgPSB0LCBsLmVycm9yT2JqZWN0IH0gfSB2YXIgZiA9IHsgdHJ5Q2F0Y2g6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBhID0gdCwgcCB9IH0sIGIgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgZCA9IHsgVW5zdWJzY3JpcHRpb25FcnJvcjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzKSwgdGhpcy5lcnJvcnMgPSBlOyB2YXIgciA9IEVycm9yLmNhbGwodGhpcywgZSA/IGUubGVuZ3RoICsgIiBlcnJvcnMgb2NjdXJyZWQgZHVyaW5nIHVuc3Vic2NyaXB0aW9uOlxuICAiICsgZS5tYXAoKGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlICsgMSArICIpICIgKyB0LnRvU3RyaW5nKCkgfSkpLmpvaW4oIlxuICAiKSA6ICIiKTsgdGhpcy5uYW1lID0gci5uYW1lID0gIlVuc3Vic2NyaXB0aW9uRXJyb3IiLCB0aGlzLnN0YWNrID0gci5zdGFjaywgdGhpcy5tZXNzYWdlID0gci5tZXNzYWdlOyB9IHJldHVybiBiKGUsIHQpLCBlIH0oRXJyb3IpIH07IGZ1bmN0aW9uIHkodCkgeyByZXR1cm4gdC5yZWR1Y2UoKGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB0LmNvbmNhdChlIGluc3RhbmNlb2YgZC5VbnN1YnNjcmlwdGlvbkVycm9yID8gZS5lcnJvcnMgOiBlKSB9KSwgW10pIH0gdmFyIHYgPSB7IFN1YnNjcmlwdGlvbjogZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5jbG9zZWQgPSAhMSwgdGhpcy5fcGFyZW50ID0gbnVsbCwgdGhpcy5fcGFyZW50cyA9IG51bGwsIHRoaXMuX3N1YnNjcmlwdGlvbnMgPSBudWxsLCB0ICYmICh0aGlzLl91bnN1YnNjcmliZSA9IHQpOyB9IHJldHVybiB0LnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQsIGUgPSAhMTsgaWYgKCF0aGlzLmNsb3NlZCkgeyB2YXIgciA9IHRoaXMsIG4gPSByLl9wYXJlbnQsIGkgPSByLl9wYXJlbnRzLCBvID0gci5fdW5zdWJzY3JpYmUsIHMgPSByLl9zdWJzY3JpcHRpb25zOyB0aGlzLmNsb3NlZCA9ICEwLCB0aGlzLl9wYXJlbnQgPSBudWxsLCB0aGlzLl9wYXJlbnRzID0gbnVsbCwgdGhpcy5fc3Vic2NyaXB0aW9ucyA9IG51bGw7IGZvciAodmFyIGEgPSAtMSwgcCA9IGkgPyBpLmxlbmd0aCA6IDA7IG47KW4ucmVtb3ZlKHRoaXMpLCBuID0gKythIDwgcCAmJiBpW2FdIHx8IG51bGw7IGlmIChjLmlzRnVuY3Rpb24obykpIGYudHJ5Q2F0Y2gobykuY2FsbCh0aGlzKSA9PT0gbC5lcnJvck9iamVjdCAmJiAoZSA9ICEwLCB0ID0gdCB8fCAobC5lcnJvck9iamVjdC5lIGluc3RhbmNlb2YgZC5VbnN1YnNjcmlwdGlvbkVycm9yID8geShsLmVycm9yT2JqZWN0LmUuZXJyb3JzKSA6IFtsLmVycm9yT2JqZWN0LmVdKSk7IGlmICh1LmlzQXJyYXkocykpIGZvciAoYSA9IC0xLCBwID0gcy5sZW5ndGg7ICsrYSA8IHA7KSB7IHZhciBiID0gc1thXTsgaWYgKGguaXNPYmplY3QoYikpIGlmIChmLnRyeUNhdGNoKGIudW5zdWJzY3JpYmUpLmNhbGwoYikgPT09IGwuZXJyb3JPYmplY3QpIHsgZSA9ICEwLCB0ID0gdCB8fCBbXTsgdmFyIHYgPSBsLmVycm9yT2JqZWN0LmU7IHYgaW5zdGFuY2VvZiBkLlVuc3Vic2NyaXB0aW9uRXJyb3IgPyB0ID0gdC5jb25jYXQoeSh2LmVycm9ycykpIDogdC5wdXNoKHYpOyB9IH0gaWYgKGUpIHRocm93IG5ldyBkLlVuc3Vic2NyaXB0aW9uRXJyb3IodCkgfSB9LCB0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoZSkgeyBpZiAoIWUgfHwgZSA9PT0gdC5FTVBUWSkgcmV0dXJuIHQuRU1QVFk7IGlmIChlID09PSB0aGlzKSByZXR1cm4gdGhpczsgdmFyIHIgPSBlOyBzd2l0Y2ggKHR5cGVvZiBlKSB7IGNhc2UgImZ1bmN0aW9uIjogciA9IG5ldyB0KGUpOyBjYXNlICJvYmplY3QiOiBpZiAoci5jbG9zZWQgfHwgImZ1bmN0aW9uIiAhPSB0eXBlb2Ygci51bnN1YnNjcmliZSkgcmV0dXJuIHI7IGlmICh0aGlzLmNsb3NlZCkgcmV0dXJuIHIudW5zdWJzY3JpYmUoKSwgcjsgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHIuX2FkZFBhcmVudCkgeyB2YXIgbiA9IHI7IChyID0gbmV3IHQpLl9zdWJzY3JpcHRpb25zID0gW25dOyB9IGJyZWFrOyBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoInVucmVjb2duaXplZCB0ZWFyZG93biAiICsgZSArICIgYWRkZWQgdG8gU3Vic2NyaXB0aW9uLiIpIH1yZXR1cm4gKHRoaXMuX3N1YnNjcmlwdGlvbnMgfHwgKHRoaXMuX3N1YnNjcmlwdGlvbnMgPSBbXSkpLnB1c2gociksIHIuX2FkZFBhcmVudCh0aGlzKSwgciB9LCB0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuX3N1YnNjcmlwdGlvbnM7IGlmIChlKSB7IHZhciByID0gZS5pbmRleE9mKHQpOyAtMSAhPT0gciAmJiBlLnNwbGljZShyLCAxKTsgfSB9LCB0LnByb3RvdHlwZS5fYWRkUGFyZW50ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLl9wYXJlbnQsIHIgPSB0aGlzLl9wYXJlbnRzOyBlICYmIGUgIT09IHQgPyByID8gLTEgPT09IHIuaW5kZXhPZih0KSAmJiByLnB1c2godCkgOiB0aGlzLl9wYXJlbnRzID0gW3RdIDogdGhpcy5fcGFyZW50ID0gdDsgfSwgdC5FTVBUWSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmNsb3NlZCA9ICEwLCB0IH0obmV3IHQpLCB0IH0oKSB9LCBtID0geyBjbG9zZWQ6ICEwLCBuZXh0OiBmdW5jdGlvbiAodCkgeyB9LCBlcnJvcjogZnVuY3Rpb24gKHQpIHsgdGhyb3cgdCB9LCBjb21wbGV0ZTogZnVuY3Rpb24gKCkgeyB9IH0sIHcgPSBlKChmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHMucm9vdC5TeW1ib2w7IGUucnhTdWJzY3JpYmVyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgciAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiByLmZvciA/IHIuZm9yKCJyeFN1YnNjcmliZXIiKSA6ICJAQHJ4U3Vic2NyaWJlciIsIGUuJCRyeFN1YnNjcmliZXIgPSBlLnJ4U3Vic2NyaWJlcjsgfSkpLCBfID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIHggPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgc3dpdGNoICh0LmNhbGwodGhpcyksIHRoaXMuc3luY0Vycm9yVmFsdWUgPSBudWxsLCB0aGlzLnN5bmNFcnJvclRocm93biA9ICExLCB0aGlzLnN5bmNFcnJvclRocm93YWJsZSA9ICExLCB0aGlzLmlzU3RvcHBlZCA9ICExLCBhcmd1bWVudHMubGVuZ3RoKSB7IGNhc2UgMDogdGhpcy5kZXN0aW5hdGlvbiA9IG07IGJyZWFrOyBjYXNlIDE6IGlmICghZSkgeyB0aGlzLmRlc3RpbmF0aW9uID0gbTsgYnJlYWsgfSBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGUpIHsgaWYgKGcoZSkpIHsgdmFyIGkgPSBlW3cucnhTdWJzY3JpYmVyXSgpOyB0aGlzLnN5bmNFcnJvclRocm93YWJsZSA9IGkuc3luY0Vycm9yVGhyb3dhYmxlLCB0aGlzLmRlc3RpbmF0aW9uID0gaSwgaS5hZGQodGhpcyk7IH0gZWxzZSB0aGlzLnN5bmNFcnJvclRocm93YWJsZSA9ICEwLCB0aGlzLmRlc3RpbmF0aW9uID0gbmV3IFModGhpcywgZSk7IGJyZWFrIH0gZGVmYXVsdDogdGhpcy5zeW5jRXJyb3JUaHJvd2FibGUgPSAhMCwgdGhpcy5kZXN0aW5hdGlvbiA9IG5ldyBTKHRoaXMsIGUsIHIsIG4pOyB9IH0gcmV0dXJuIF8oZSwgdCksIGUucHJvdG90eXBlW3cucnhTdWJzY3JpYmVyXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMgfSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgciwgbikgeyB2YXIgaSA9IG5ldyBlKHQsIHIsIG4pOyByZXR1cm4gaS5zeW5jRXJyb3JUaHJvd2FibGUgPSAhMSwgaSB9LCBlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5pc1N0b3BwZWQgfHwgdGhpcy5fbmV4dCh0KTsgfSwgZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmlzU3RvcHBlZCB8fCAodGhpcy5pc1N0b3BwZWQgPSAhMCwgdGhpcy5fZXJyb3IodCkpOyB9LCBlLnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5pc1N0b3BwZWQgfHwgKHRoaXMuaXNTdG9wcGVkID0gITAsIHRoaXMuX2NvbXBsZXRlKCkpOyB9LCBlLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5jbG9zZWQgfHwgKHRoaXMuaXNTdG9wcGVkID0gITAsIHQucHJvdG90eXBlLnVuc3Vic2NyaWJlLmNhbGwodGhpcykpOyB9LCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuZGVzdGluYXRpb24ubmV4dCh0KTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KSwgdGhpcy51bnN1YnNjcmliZSgpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKSwgdGhpcy51bnN1YnNjcmliZSgpOyB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmVBbmRSZWN5Y2xlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuX3BhcmVudCwgZSA9IHRoaXMuX3BhcmVudHM7IHJldHVybiB0aGlzLl9wYXJlbnQgPSBudWxsLCB0aGlzLl9wYXJlbnRzID0gbnVsbCwgdGhpcy51bnN1YnNjcmliZSgpLCB0aGlzLmNsb3NlZCA9ICExLCB0aGlzLmlzU3RvcHBlZCA9ICExLCB0aGlzLl9wYXJlbnQgPSB0LCB0aGlzLl9wYXJlbnRzID0gZSwgdGhpcyB9LCBlIH0odi5TdWJzY3JpcHRpb24pLCBPID0geCwgUyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB2YXIgbzsgdC5jYWxsKHRoaXMpLCB0aGlzLl9wYXJlbnRTdWJzY3JpYmVyID0gZTsgdmFyIHMgPSB0aGlzOyBjLmlzRnVuY3Rpb24ocikgPyBvID0gciA6IHIgJiYgKG8gPSByLm5leHQsIG4gPSByLmVycm9yLCBpID0gci5jb21wbGV0ZSwgciAhPT0gbSAmJiAocyA9IE9iamVjdC5jcmVhdGUociksIGMuaXNGdW5jdGlvbihzLnVuc3Vic2NyaWJlKSAmJiB0aGlzLmFkZChzLnVuc3Vic2NyaWJlLmJpbmQocykpLCBzLnVuc3Vic2NyaWJlID0gdGhpcy51bnN1YnNjcmliZS5iaW5kKHRoaXMpKSksIHRoaXMuX2NvbnRleHQgPSBzLCB0aGlzLl9uZXh0ID0gbywgdGhpcy5fZXJyb3IgPSBuLCB0aGlzLl9jb21wbGV0ZSA9IGk7IH0gcmV0dXJuIF8oZSwgdCksIGUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodCkgeyBpZiAoIXRoaXMuaXNTdG9wcGVkICYmIHRoaXMuX25leHQpIHsgdmFyIGUgPSB0aGlzLl9wYXJlbnRTdWJzY3JpYmVyOyBlLnN5bmNFcnJvclRocm93YWJsZSA/IHRoaXMuX190cnlPclNldEVycm9yKGUsIHRoaXMuX25leHQsIHQpICYmIHRoaXMudW5zdWJzY3JpYmUoKSA6IHRoaXMuX190cnlPclVuc3ViKHRoaXMuX25leHQsIHQpOyB9IH0sIGUucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKHQpIHsgaWYgKCF0aGlzLmlzU3RvcHBlZCkgeyB2YXIgZSA9IHRoaXMuX3BhcmVudFN1YnNjcmliZXI7IGlmICh0aGlzLl9lcnJvcikgZS5zeW5jRXJyb3JUaHJvd2FibGUgPyAodGhpcy5fX3RyeU9yU2V0RXJyb3IoZSwgdGhpcy5fZXJyb3IsIHQpLCB0aGlzLnVuc3Vic2NyaWJlKCkpIDogKHRoaXMuX190cnlPclVuc3ViKHRoaXMuX2Vycm9yLCB0KSwgdGhpcy51bnN1YnNjcmliZSgpKTsgZWxzZSB7IGlmICghZS5zeW5jRXJyb3JUaHJvd2FibGUpIHRocm93IHRoaXMudW5zdWJzY3JpYmUoKSwgdDsgZS5zeW5jRXJyb3JWYWx1ZSA9IHQsIGUuc3luY0Vycm9yVGhyb3duID0gITAsIHRoaXMudW5zdWJzY3JpYmUoKTsgfSB9IH0sIGUucHJvdG90eXBlLmNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXM7IGlmICghdGhpcy5pc1N0b3BwZWQpIHsgdmFyIGUgPSB0aGlzLl9wYXJlbnRTdWJzY3JpYmVyOyBpZiAodGhpcy5fY29tcGxldGUpIHsgdmFyIHIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0Ll9jb21wbGV0ZS5jYWxsKHQuX2NvbnRleHQpIH07IGUuc3luY0Vycm9yVGhyb3dhYmxlID8gKHRoaXMuX190cnlPclNldEVycm9yKGUsIHIpLCB0aGlzLnVuc3Vic2NyaWJlKCkpIDogKHRoaXMuX190cnlPclVuc3ViKHIpLCB0aGlzLnVuc3Vic2NyaWJlKCkpOyB9IGVsc2UgdGhpcy51bnN1YnNjcmliZSgpOyB9IH0sIGUucHJvdG90eXBlLl9fdHJ5T3JVbnN1YiA9IGZ1bmN0aW9uICh0LCBlKSB7IHRyeSB7IHQuY2FsbCh0aGlzLl9jb250ZXh0LCBlKTsgfSBjYXRjaCAodCkgeyB0aHJvdyB0aGlzLnVuc3Vic2NyaWJlKCksIHQgfSB9LCBlLnByb3RvdHlwZS5fX3RyeU9yU2V0RXJyb3IgPSBmdW5jdGlvbiAodCwgZSwgcikgeyB0cnkgeyBlLmNhbGwodGhpcy5fY29udGV4dCwgcik7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIHQuc3luY0Vycm9yVmFsdWUgPSBlLCB0LnN5bmNFcnJvclRocm93biA9ICEwLCAhMCB9IHJldHVybiAhMSB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5fcGFyZW50U3Vic2NyaWJlcjsgdGhpcy5fY29udGV4dCA9IG51bGwsIHRoaXMuX3BhcmVudFN1YnNjcmliZXIgPSBudWxsLCB0LnVuc3Vic2NyaWJlKCk7IH0sIGUgfSh4KTsgZnVuY3Rpb24gZyh0KSB7IHJldHVybiB0IGluc3RhbmNlb2YgeCB8fCAic3luY0Vycm9yVGhyb3dhYmxlIiBpbiB0ICYmIHRbdy5yeFN1YnNjcmliZXJdIH0gdmFyIFQgPSB7IFN1YnNjcmliZXI6IE8gfTsgdmFyIGogPSB7IHRvU3Vic2NyaWJlcjogZnVuY3Rpb24gKHQsIGUsIHIpIHsgaWYgKHQpIHsgaWYgKHQgaW5zdGFuY2VvZiBULlN1YnNjcmliZXIpIHJldHVybiB0OyBpZiAodFt3LnJ4U3Vic2NyaWJlcl0pIHJldHVybiB0W3cucnhTdWJzY3JpYmVyXSgpIH0gcmV0dXJuIHQgfHwgZSB8fCByID8gbmV3IFQuU3Vic2NyaWJlcih0LCBlLCByKSA6IG5ldyBULlN1YnNjcmliZXIobSkgfSB9LCBFID0gZSgoZnVuY3Rpb24gKHQsIGUpIHsgZnVuY3Rpb24gcih0KSB7IHZhciBlLCByID0gdC5TeW1ib2w7IHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiByID8gci5vYnNlcnZhYmxlID8gZSA9IHIub2JzZXJ2YWJsZSA6IChlID0gcigib2JzZXJ2YWJsZSIpLCByLm9ic2VydmFibGUgPSBlKSA6IGUgPSAiQEBvYnNlcnZhYmxlIiwgZSB9IGUuZ2V0U3ltYm9sT2JzZXJ2YWJsZSA9IHIsIGUub2JzZXJ2YWJsZSA9IHIocy5yb290KSwgZS4kJG9ic2VydmFibGUgPSBlLm9ic2VydmFibGU7IH0pKTsgdmFyIEkgPSB7IG5vb3A6IGZ1bmN0aW9uICgpIHsgfSB9OyBmdW5jdGlvbiBBKHQpIHsgcmV0dXJuIHQgPyAxID09PSB0Lmxlbmd0aCA/IHRbMF0gOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5yZWR1Y2UoKGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlKHQpIH0pLCBlKSB9IDogSS5ub29wIH0gdmFyIEMgPSB7IHBpcGU6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgcmV0dXJuIEEodCkgfSwgcGlwZUZyb21BcnJheTogQSB9LCBOID0geyBPYnNlcnZhYmxlOiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLl9pc1NjYWxhciA9ICExLCB0ICYmICh0aGlzLl9zdWJzY3JpYmUgPSB0KTsgfSByZXR1cm4gdC5wcm90b3R5cGUubGlmdCA9IGZ1bmN0aW9uIChlKSB7IHZhciByID0gbmV3IHQ7IHJldHVybiByLnNvdXJjZSA9IHRoaXMsIHIub3BlcmF0b3IgPSBlLCByIH0sIHQucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7IHZhciBuID0gdGhpcy5vcGVyYXRvciwgaSA9IGoudG9TdWJzY3JpYmVyKHQsIGUsIHIpOyBpZiAobiA/IG4uY2FsbChpLCB0aGlzLnNvdXJjZSkgOiBpLmFkZCh0aGlzLnNvdXJjZSB8fCAhaS5zeW5jRXJyb3JUaHJvd2FibGUgPyB0aGlzLl9zdWJzY3JpYmUoaSkgOiB0aGlzLl90cnlTdWJzY3JpYmUoaSkpLCBpLnN5bmNFcnJvclRocm93YWJsZSAmJiAoaS5zeW5jRXJyb3JUaHJvd2FibGUgPSAhMSwgaS5zeW5jRXJyb3JUaHJvd24pKSB0aHJvdyBpLnN5bmNFcnJvclZhbHVlOyByZXR1cm4gaSB9LCB0LnByb3RvdHlwZS5fdHJ5U3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdHJ5IHsgcmV0dXJuIHRoaXMuX3N1YnNjcmliZSh0KSB9IGNhdGNoIChlKSB7IHQuc3luY0Vycm9yVGhyb3duID0gITAsIHQuc3luY0Vycm9yVmFsdWUgPSBlLCB0LmVycm9yKGUpOyB9IH0sIHQucHJvdG90eXBlLmZvckVhY2ggPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHRoaXM7IGlmIChlIHx8IChzLnJvb3QuUnggJiYgcy5yb290LlJ4LmNvbmZpZyAmJiBzLnJvb3QuUnguY29uZmlnLlByb21pc2UgPyBlID0gcy5yb290LlJ4LmNvbmZpZy5Qcm9taXNlIDogcy5yb290LlByb21pc2UgJiYgKGUgPSBzLnJvb3QuUHJvbWlzZSkpLCAhZSkgdGhyb3cgbmV3IEVycm9yKCJubyBQcm9taXNlIGltcGwgZm91bmQiKTsgcmV0dXJuIG5ldyBlKChmdW5jdGlvbiAoZSwgbikgeyB2YXIgaTsgaSA9IHIuc3Vic2NyaWJlKChmdW5jdGlvbiAoZSkgeyBpZiAoaSkgdHJ5IHsgdChlKTsgfSBjYXRjaCAodCkgeyBuKHQpLCBpLnVuc3Vic2NyaWJlKCk7IH0gZWxzZSB0KGUpOyB9KSwgbiwgZSk7IH0pKSB9LCB0LnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMuc291cmNlLnN1YnNjcmliZSh0KSB9LCB0LnByb3RvdHlwZVtFLm9ic2VydmFibGVdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcyB9LCB0LnByb3RvdHlwZS5waXBlID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gMCA9PT0gdC5sZW5ndGggPyB0aGlzIDogQy5waXBlRnJvbUFycmF5KHQpKHRoaXMpIH0sIHQucHJvdG90eXBlLnRvUHJvbWlzZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpczsgaWYgKHQgfHwgKHMucm9vdC5SeCAmJiBzLnJvb3QuUnguY29uZmlnICYmIHMucm9vdC5SeC5jb25maWcuUHJvbWlzZSA/IHQgPSBzLnJvb3QuUnguY29uZmlnLlByb21pc2UgOiBzLnJvb3QuUHJvbWlzZSAmJiAodCA9IHMucm9vdC5Qcm9taXNlKSksICF0KSB0aHJvdyBuZXcgRXJyb3IoIm5vIFByb21pc2UgaW1wbCBmb3VuZCIpOyByZXR1cm4gbmV3IHQoKGZ1bmN0aW9uICh0LCByKSB7IHZhciBuOyBlLnN1YnNjcmliZSgoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIG4gPSB0IH0pLCAoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHIodCkgfSksIChmdW5jdGlvbiAoKSB7IHJldHVybiB0KG4pIH0pKTsgfSkpIH0sIHQuY3JlYXRlID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG5ldyB0KGUpIH0sIHQgfSgpIH0sIFAgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgayA9IHsgT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoKSB7IHZhciBlID0gdC5jYWxsKHRoaXMsICJvYmplY3QgdW5zdWJzY3JpYmVkIik7IHRoaXMubmFtZSA9IGUubmFtZSA9ICJPYmplY3RVbnN1YnNjcmliZWRFcnJvciIsIHRoaXMuc3RhY2sgPSBlLnN0YWNrLCB0aGlzLm1lc3NhZ2UgPSBlLm1lc3NhZ2U7IH0gcmV0dXJuIFAoZSwgdCksIGUgfShFcnJvcikgfSwgViA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBGID0geyBTdWJqZWN0U3Vic2NyaXB0aW9uOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLnN1YmplY3QgPSBlLCB0aGlzLnN1YnNjcmliZXIgPSByLCB0aGlzLmNsb3NlZCA9ICExOyB9IHJldHVybiBWKGUsIHQpLCBlLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgaWYgKCF0aGlzLmNsb3NlZCkgeyB0aGlzLmNsb3NlZCA9ICEwOyB2YXIgdCA9IHRoaXMuc3ViamVjdCwgZSA9IHQub2JzZXJ2ZXJzOyBpZiAodGhpcy5zdWJqZWN0ID0gbnVsbCwgZSAmJiAwICE9PSBlLmxlbmd0aCAmJiAhdC5pc1N0b3BwZWQgJiYgIXQuY2xvc2VkKSB7IHZhciByID0gZS5pbmRleE9mKHRoaXMuc3Vic2NyaWJlcik7IC0xICE9PSByICYmIGUuc3BsaWNlKHIsIDEpOyB9IH0gfSwgZSB9KHYuU3Vic2NyaXB0aW9uKSB9LCBSID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIE0gPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmRlc3RpbmF0aW9uID0gZTsgfSByZXR1cm4gUihlLCB0KSwgZSB9KFQuU3Vic2NyaWJlciksIFcgPSBNLCBxID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLm9ic2VydmVycyA9IFtdLCB0aGlzLmNsb3NlZCA9ICExLCB0aGlzLmlzU3RvcHBlZCA9ICExLCB0aGlzLmhhc0Vycm9yID0gITEsIHRoaXMudGhyb3duRXJyb3IgPSBudWxsOyB9IHJldHVybiBSKGUsIHQpLCBlLnByb3RvdHlwZVt3LnJ4U3Vic2NyaWJlcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgTSh0aGlzKSB9LCBlLnByb3RvdHlwZS5saWZ0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSBuZXcgVSh0aGlzLCB0aGlzKTsgcmV0dXJuIGUub3BlcmF0b3IgPSB0LCBlIH0sIGUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodCkgeyBpZiAodGhpcy5jbG9zZWQpIHRocm93IG5ldyBrLk9iamVjdFVuc3Vic2NyaWJlZEVycm9yOyBpZiAoIXRoaXMuaXNTdG9wcGVkKSBmb3IgKHZhciBlID0gdGhpcy5vYnNlcnZlcnMsIHIgPSBlLmxlbmd0aCwgbiA9IGUuc2xpY2UoKSwgaSA9IDA7IGkgPCByOyBpKyspbltpXS5uZXh0KHQpOyB9LCBlLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uICh0KSB7IGlmICh0aGlzLmNsb3NlZCkgdGhyb3cgbmV3IGsuT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I7IHRoaXMuaGFzRXJyb3IgPSAhMCwgdGhpcy50aHJvd25FcnJvciA9IHQsIHRoaXMuaXNTdG9wcGVkID0gITA7IGZvciAodmFyIGUgPSB0aGlzLm9ic2VydmVycywgciA9IGUubGVuZ3RoLCBuID0gZS5zbGljZSgpLCBpID0gMDsgaSA8IHI7IGkrKyluW2ldLmVycm9yKHQpOyB0aGlzLm9ic2VydmVycy5sZW5ndGggPSAwOyB9LCBlLnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuY2xvc2VkKSB0aHJvdyBuZXcgay5PYmplY3RVbnN1YnNjcmliZWRFcnJvcjsgdGhpcy5pc1N0b3BwZWQgPSAhMDsgZm9yICh2YXIgdCA9IHRoaXMub2JzZXJ2ZXJzLCBlID0gdC5sZW5ndGgsIHIgPSB0LnNsaWNlKCksIG4gPSAwOyBuIDwgZTsgbisrKXJbbl0uY29tcGxldGUoKTsgdGhpcy5vYnNlcnZlcnMubGVuZ3RoID0gMDsgfSwgZS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaXNTdG9wcGVkID0gITAsIHRoaXMuY2xvc2VkID0gITAsIHRoaXMub2JzZXJ2ZXJzID0gbnVsbDsgfSwgZS5wcm90b3R5cGUuX3RyeVN1YnNjcmliZSA9IGZ1bmN0aW9uIChlKSB7IGlmICh0aGlzLmNsb3NlZCkgdGhyb3cgbmV3IGsuT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I7IHJldHVybiB0LnByb3RvdHlwZS5fdHJ5U3Vic2NyaWJlLmNhbGwodGhpcywgZSkgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IGlmICh0aGlzLmNsb3NlZCkgdGhyb3cgbmV3IGsuT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I7IHJldHVybiB0aGlzLmhhc0Vycm9yID8gKHQuZXJyb3IodGhpcy50aHJvd25FcnJvciksIHYuU3Vic2NyaXB0aW9uLkVNUFRZKSA6IHRoaXMuaXNTdG9wcGVkID8gKHQuY29tcGxldGUoKSwgdi5TdWJzY3JpcHRpb24uRU1QVFkpIDogKHRoaXMub2JzZXJ2ZXJzLnB1c2godCksIG5ldyBGLlN1YmplY3RTdWJzY3JpcHRpb24odGhpcywgdCkpIH0sIGUucHJvdG90eXBlLmFzT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBuZXcgTi5PYnNlcnZhYmxlOyByZXR1cm4gdC5zb3VyY2UgPSB0aGlzLCB0IH0sIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIG5ldyBVKHQsIGUpIH0sIGUgfShOLk9ic2VydmFibGUpLCBMID0gcSwgVSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMuZGVzdGluYXRpb24gPSBlLCB0aGlzLnNvdXJjZSA9IHI7IH0gcmV0dXJuIFIoZSwgdCksIGUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuZGVzdGluYXRpb247IGUgJiYgZS5uZXh0ICYmIGUubmV4dCh0KTsgfSwgZS5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuZGVzdGluYXRpb247IGUgJiYgZS5lcnJvciAmJiB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmRlc3RpbmF0aW9uOyB0ICYmIHQuY29tcGxldGUgJiYgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMuc291cmNlID8gdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKHQpIDogdi5TdWJzY3JpcHRpb24uRU1QVFkgfSwgZSB9KHEpLCB6ID0geyBTdWJqZWN0U3Vic2NyaWJlcjogVywgU3ViamVjdDogTCwgQW5vbnltb3VzU3ViamVjdDogVSB9LCBCID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIEQgPSB7IEFzeW5jU3ViamVjdDogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0aGlzLnZhbHVlID0gbnVsbCwgdGhpcy5oYXNOZXh0ID0gITEsIHRoaXMuaGFzQ29tcGxldGVkID0gITE7IH0gcmV0dXJuIEIoZSwgdCksIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdGhpcy5oYXNFcnJvciA/IChlLmVycm9yKHRoaXMudGhyb3duRXJyb3IpLCB2LlN1YnNjcmlwdGlvbi5FTVBUWSkgOiB0aGlzLmhhc0NvbXBsZXRlZCAmJiB0aGlzLmhhc05leHQgPyAoZS5uZXh0KHRoaXMudmFsdWUpLCBlLmNvbXBsZXRlKCksIHYuU3Vic2NyaXB0aW9uLkVNUFRZKSA6IHQucHJvdG90eXBlLl9zdWJzY3JpYmUuY2FsbCh0aGlzLCBlKSB9LCBlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5oYXNDb21wbGV0ZWQgfHwgKHRoaXMudmFsdWUgPSB0LCB0aGlzLmhhc05leHQgPSAhMCk7IH0sIGUucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5oYXNDb21wbGV0ZWQgfHwgdC5wcm90b3R5cGUuZXJyb3IuY2FsbCh0aGlzLCBlKTsgfSwgZS5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaGFzQ29tcGxldGVkID0gITAsIHRoaXMuaGFzTmV4dCAmJiB0LnByb3RvdHlwZS5uZXh0LmNhbGwodGhpcywgdGhpcy52YWx1ZSksIHQucHJvdG90eXBlLmNvbXBsZXRlLmNhbGwodGhpcyk7IH0sIGUgfSh6LlN1YmplY3QpIH0sIFkgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgZnVuY3Rpb24gSCh0KSB7IHZhciBlID0gdC52YWx1ZSwgciA9IHQuc3ViamVjdDsgci5uZXh0KGUpLCByLmNvbXBsZXRlKCk7IH0gZnVuY3Rpb24gWCh0KSB7IHZhciBlID0gdC5lcnI7IHQuc3ViamVjdC5lcnJvcihlKTsgfSB2YXIgRyA9IHsgYmluZENhbGxiYWNrOiB7IEJvdW5kQ2FsbGJhY2tPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmNhbGxiYWNrRnVuYyA9IGUsIHRoaXMuc2VsZWN0b3IgPSByLCB0aGlzLmFyZ3MgPSBuLCB0aGlzLmNvbnRleHQgPSBpLCB0aGlzLnNjaGVkdWxlciA9IG87IH0gcmV0dXJuIFkoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IHZvaWQgMCksIGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgaSA9IFtdLCBvID0gMDsgbyA8IGFyZ3VtZW50cy5sZW5ndGg7IG8rKylpW28gLSAwXSA9IGFyZ3VtZW50c1tvXTsgcmV0dXJuIG5ldyBlKHQsIHIsIGksIHRoaXMsIG4pIH0gfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gdGhpcy5jYWxsYmFja0Z1bmMsIG4gPSB0aGlzLmFyZ3MsIGkgPSB0aGlzLnNjaGVkdWxlciwgbyA9IHRoaXMuc3ViamVjdDsgaWYgKGkpIHJldHVybiBpLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIDAsIHsgc291cmNlOiB0aGlzLCBzdWJzY3JpYmVyOiB0LCBjb250ZXh0OiB0aGlzLmNvbnRleHQgfSk7IGlmICghbykgeyBvID0gdGhpcy5zdWJqZWN0ID0gbmV3IEQuQXN5bmNTdWJqZWN0OyB2YXIgcyA9IGZ1bmN0aW9uIHQoKSB7IGZvciAodmFyIGUgPSBbXSwgciA9IDA7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspZVtyIC0gMF0gPSBhcmd1bWVudHNbcl07IHZhciBuID0gdC5zb3VyY2UsIGkgPSBuLnNlbGVjdG9yLCBvID0gbi5zdWJqZWN0OyBpZiAoaSkgeyB2YXIgcyA9IGYudHJ5Q2F0Y2goaSkuYXBwbHkodGhpcywgZSk7IHMgPT09IGwuZXJyb3JPYmplY3QgPyBvLmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiAoby5uZXh0KHMpLCBvLmNvbXBsZXRlKCkpOyB9IGVsc2Ugby5uZXh0KGUubGVuZ3RoIDw9IDEgPyBlWzBdIDogZSksIG8uY29tcGxldGUoKTsgfTsgcy5zb3VyY2UgPSB0aGlzLCBmLnRyeUNhdGNoKHIpLmFwcGx5KHRoaXMuY29udGV4dCwgbi5jb25jYXQocykpID09PSBsLmVycm9yT2JqZWN0ICYmIG8uZXJyb3IobC5lcnJvck9iamVjdC5lKTsgfSByZXR1cm4gby5zdWJzY3JpYmUodCkgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcywgciA9IHQuc291cmNlLCBuID0gdC5zdWJzY3JpYmVyLCBpID0gdC5jb250ZXh0LCBvID0gci5jYWxsYmFja0Z1bmMsIHMgPSByLmFyZ3MsIGMgPSByLnNjaGVkdWxlciwgdSA9IHIuc3ViamVjdDsgaWYgKCF1KSB7IHUgPSByLnN1YmplY3QgPSBuZXcgRC5Bc3luY1N1YmplY3Q7IHZhciBhID0gZnVuY3Rpb24gdCgpIHsgZm9yICh2YXIgciA9IFtdLCBuID0gMDsgbiA8IGFyZ3VtZW50cy5sZW5ndGg7IG4rKylyW24gLSAwXSA9IGFyZ3VtZW50c1tuXTsgdmFyIGkgPSB0LnNvdXJjZSwgbyA9IGkuc2VsZWN0b3IsIHMgPSBpLnN1YmplY3Q7IGlmIChvKSB7IHZhciB1ID0gZi50cnlDYXRjaChvKS5hcHBseSh0aGlzLCByKTsgdSA9PT0gbC5lcnJvck9iamVjdCA/IGUuYWRkKGMuc2NoZWR1bGUoWCwgMCwgeyBlcnI6IGwuZXJyb3JPYmplY3QuZSwgc3ViamVjdDogcyB9KSkgOiBlLmFkZChjLnNjaGVkdWxlKEgsIDAsIHsgdmFsdWU6IHUsIHN1YmplY3Q6IHMgfSkpOyB9IGVsc2UgeyB2YXIgYSA9IHIubGVuZ3RoIDw9IDEgPyByWzBdIDogcjsgZS5hZGQoYy5zY2hlZHVsZShILCAwLCB7IHZhbHVlOiBhLCBzdWJqZWN0OiBzIH0pKTsgfSB9OyBhLnNvdXJjZSA9IHIsIGYudHJ5Q2F0Y2gobykuYXBwbHkoaSwgcy5jb25jYXQoYSkpID09PSBsLmVycm9yT2JqZWN0ICYmIHUuZXJyb3IobC5lcnJvck9iamVjdC5lKTsgfSBlLmFkZCh1LnN1YnNjcmliZShuKSk7IH0sIGUgfShOLk9ic2VydmFibGUpIH0uQm91bmRDYWxsYmFja09ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5iaW5kQ2FsbGJhY2sgPSBHLmJpbmRDYWxsYmFjazsgdmFyIEogPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgZnVuY3Rpb24gSyh0KSB7IHZhciBlID0gdGhpcywgciA9IHQuc291cmNlLCBuID0gdC5zdWJzY3JpYmVyLCBpID0gdC5jb250ZXh0LCBvID0gciwgcyA9IG8uY2FsbGJhY2tGdW5jLCBjID0gby5hcmdzLCB1ID0gby5zY2hlZHVsZXIsIGEgPSByLnN1YmplY3Q7IGlmICghYSkgeyBhID0gci5zdWJqZWN0ID0gbmV3IEQuQXN5bmNTdWJqZWN0OyB2YXIgaCA9IGZ1bmN0aW9uIHQoKSB7IGZvciAodmFyIHIgPSBbXSwgbiA9IDA7IG4gPCBhcmd1bWVudHMubGVuZ3RoOyBuKyspcltuIC0gMF0gPSBhcmd1bWVudHNbbl07IHZhciBpID0gdC5zb3VyY2UsIG8gPSBpLnNlbGVjdG9yLCBzID0gaS5zdWJqZWN0LCBjID0gci5zaGlmdCgpOyBpZiAoYykgZS5hZGQodS5zY2hlZHVsZShRLCAwLCB7IGVycjogYywgc3ViamVjdDogcyB9KSk7IGVsc2UgaWYgKG8pIHsgdmFyIGEgPSBmLnRyeUNhdGNoKG8pLmFwcGx5KHRoaXMsIHIpOyBhID09PSBsLmVycm9yT2JqZWN0ID8gZS5hZGQodS5zY2hlZHVsZShRLCAwLCB7IGVycjogbC5lcnJvck9iamVjdC5lLCBzdWJqZWN0OiBzIH0pKSA6IGUuYWRkKHUuc2NoZWR1bGUoJCwgMCwgeyB2YWx1ZTogYSwgc3ViamVjdDogcyB9KSk7IH0gZWxzZSB7IHZhciBoID0gci5sZW5ndGggPD0gMSA/IHJbMF0gOiByOyBlLmFkZCh1LnNjaGVkdWxlKCQsIDAsIHsgdmFsdWU6IGgsIHN1YmplY3Q6IHMgfSkpOyB9IH07IGguc291cmNlID0gciwgZi50cnlDYXRjaChzKS5hcHBseShpLCBjLmNvbmNhdChoKSkgPT09IGwuZXJyb3JPYmplY3QgJiYgZS5hZGQodS5zY2hlZHVsZShRLCAwLCB7IGVycjogbC5lcnJvck9iamVjdC5lLCBzdWJqZWN0OiBhIH0pKTsgfSBlLmFkZChhLnN1YnNjcmliZShuKSk7IH0gZnVuY3Rpb24gJCh0KSB7IHZhciBlID0gdC52YWx1ZSwgciA9IHQuc3ViamVjdDsgci5uZXh0KGUpLCByLmNvbXBsZXRlKCk7IH0gZnVuY3Rpb24gUSh0KSB7IHZhciBlID0gdC5lcnI7IHQuc3ViamVjdC5lcnJvcihlKTsgfSB2YXIgWiA9IHsgYmluZE5vZGVDYWxsYmFjazogeyBCb3VuZE5vZGVDYWxsYmFja09ic2VydmFibGU6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSwgbykgeyB0LmNhbGwodGhpcyksIHRoaXMuY2FsbGJhY2tGdW5jID0gZSwgdGhpcy5zZWxlY3RvciA9IHIsIHRoaXMuYXJncyA9IG4sIHRoaXMuY29udGV4dCA9IGksIHRoaXMuc2NoZWR1bGVyID0gbzsgfSByZXR1cm4gSihlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgciwgbikgeyByZXR1cm4gdm9pZCAwID09PSByICYmIChyID0gdm9pZCAwKSwgZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBpID0gW10sIG8gPSAwOyBvIDwgYXJndW1lbnRzLmxlbmd0aDsgbysrKWlbbyAtIDBdID0gYXJndW1lbnRzW29dOyByZXR1cm4gbmV3IGUodCwgciwgaSwgdGhpcywgbikgfSB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmNhbGxiYWNrRnVuYywgciA9IHRoaXMuYXJncywgbiA9IHRoaXMuc2NoZWR1bGVyLCBpID0gdGhpcy5zdWJqZWN0OyBpZiAobikgcmV0dXJuIG4uc2NoZWR1bGUoSywgMCwgeyBzb3VyY2U6IHRoaXMsIHN1YnNjcmliZXI6IHQsIGNvbnRleHQ6IHRoaXMuY29udGV4dCB9KTsgaWYgKCFpKSB7IGkgPSB0aGlzLnN1YmplY3QgPSBuZXcgRC5Bc3luY1N1YmplY3Q7IHZhciBvID0gZnVuY3Rpb24gdCgpIHsgZm9yICh2YXIgZSA9IFtdLCByID0gMDsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKyllW3IgLSAwXSA9IGFyZ3VtZW50c1tyXTsgdmFyIG4gPSB0LnNvdXJjZSwgaSA9IG4uc2VsZWN0b3IsIG8gPSBuLnN1YmplY3QsIHMgPSBlLnNoaWZ0KCk7IGlmIChzKSBvLmVycm9yKHMpOyBlbHNlIGlmIChpKSB7IHZhciBjID0gZi50cnlDYXRjaChpKS5hcHBseSh0aGlzLCBlKTsgYyA9PT0gbC5lcnJvck9iamVjdCA/IG8uZXJyb3IobC5lcnJvck9iamVjdC5lKSA6IChvLm5leHQoYyksIG8uY29tcGxldGUoKSk7IH0gZWxzZSBvLm5leHQoZS5sZW5ndGggPD0gMSA/IGVbMF0gOiBlKSwgby5jb21wbGV0ZSgpOyB9OyBvLnNvdXJjZSA9IHRoaXMsIGYudHJ5Q2F0Y2goZSkuYXBwbHkodGhpcy5jb250ZXh0LCByLmNvbmNhdChvKSkgPT09IGwuZXJyb3JPYmplY3QgJiYgaS5lcnJvcihsLmVycm9yT2JqZWN0LmUpOyB9IHJldHVybiBpLnN1YnNjcmliZSh0KSB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LkJvdW5kTm9kZUNhbGxiYWNrT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmJpbmROb2RlQ2FsbGJhY2sgPSBaLmJpbmROb2RlQ2FsbGJhY2s7IHZhciB0dCA9IHsgaXNTY2hlZHVsZXI6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQuc2NoZWR1bGUgfSB9LCBldCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBydCA9IHsgU2NhbGFyT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzKSwgdGhpcy52YWx1ZSA9IGUsIHRoaXMuc2NoZWR1bGVyID0gciwgdGhpcy5faXNTY2FsYXIgPSAhMCwgciAmJiAodGhpcy5faXNTY2FsYXIgPSAhMSk7IH0gcmV0dXJuIGV0KGUsIHQpLCBlLmNyZWF0ZSA9IGZ1bmN0aW9uICh0LCByKSB7IHJldHVybiBuZXcgZSh0LCByKSB9LCBlLmRpc3BhdGNoID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0LmRvbmUsIHIgPSB0LnZhbHVlLCBuID0gdC5zdWJzY3JpYmVyOyBlID8gbi5jb21wbGV0ZSgpIDogKG4ubmV4dChyKSwgbi5jbG9zZWQgfHwgKHQuZG9uZSA9ICEwLCB0aGlzLnNjaGVkdWxlKHQpKSk7IH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgciA9IHRoaXMudmFsdWUsIG4gPSB0aGlzLnNjaGVkdWxlcjsgaWYgKG4pIHJldHVybiBuLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIDAsIHsgZG9uZTogITEsIHZhbHVlOiByLCBzdWJzY3JpYmVyOiB0IH0pOyB0Lm5leHQociksIHQuY2xvc2VkIHx8IHQuY29tcGxldGUoKTsgfSwgZSB9KE4uT2JzZXJ2YWJsZSkgfSwgbnQgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgaXQgPSB7IEVtcHR5T2JzZXJ2YWJsZTogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzKSwgdGhpcy5zY2hlZHVsZXIgPSBlOyB9IHJldHVybiBudChlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IGUodCkgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHQuc3Vic2NyaWJlci5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0aGlzLnNjaGVkdWxlcjsgaWYgKHIpIHJldHVybiByLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIDAsIHsgc3Vic2NyaWJlcjogdCB9KTsgdC5jb21wbGV0ZSgpOyB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LCBvdCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBzdCA9IHsgQXJyYXlPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmFycmF5ID0gZSwgdGhpcy5zY2hlZHVsZXIgPSByLCByIHx8IDEgIT09IGUubGVuZ3RoIHx8ICh0aGlzLl9pc1NjYWxhciA9ICEwLCB0aGlzLnZhbHVlID0gZVswXSk7IH0gcmV0dXJuIG90KGUsIHQpLCBlLmNyZWF0ZSA9IGZ1bmN0aW9uICh0LCByKSB7IHJldHVybiBuZXcgZSh0LCByKSB9LCBlLm9mID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIHIgPSAwOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKXRbciAtIDBdID0gYXJndW1lbnRzW3JdOyB2YXIgbiA9IHRbdC5sZW5ndGggLSAxXTsgdHQuaXNTY2hlZHVsZXIobikgPyB0LnBvcCgpIDogbiA9IG51bGw7IHZhciBpID0gdC5sZW5ndGg7IHJldHVybiBpID4gMSA/IG5ldyBlKHQsIG4pIDogMSA9PT0gaSA/IG5ldyBydC5TY2FsYXJPYnNlcnZhYmxlKHRbMF0sIG4pIDogbmV3IGl0LkVtcHR5T2JzZXJ2YWJsZShuKSB9LCBlLmRpc3BhdGNoID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0LmFycmF5LCByID0gdC5pbmRleCwgbiA9IHQuY291bnQsIGkgPSB0LnN1YnNjcmliZXI7IHIgPj0gbiA/IGkuY29tcGxldGUoKSA6IChpLm5leHQoZVtyXSksIGkuY2xvc2VkIHx8ICh0LmluZGV4ID0gciArIDEsIHRoaXMuc2NoZWR1bGUodCkpKTsgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gdGhpcy5hcnJheSwgbiA9IHIubGVuZ3RoLCBpID0gdGhpcy5zY2hlZHVsZXI7IGlmIChpKSByZXR1cm4gaS5zY2hlZHVsZShlLmRpc3BhdGNoLCAwLCB7IGFycmF5OiByLCBpbmRleDogMCwgY291bnQ6IG4sIHN1YnNjcmliZXI6IHQgfSk7IGZvciAodmFyIG8gPSAwOyBvIDwgbiAmJiAhdC5jbG9zZWQ7IG8rKyl0Lm5leHQocltvXSk7IHQuY29tcGxldGUoKTsgfSwgZSB9KE4uT2JzZXJ2YWJsZSkgfSwgY3QgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgdXQgPSB7IE91dGVyU3Vic2NyaWJlcjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBjdChlLCB0KSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMuZGVzdGluYXRpb24ubmV4dChlKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgeyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZSB9KFQuU3Vic2NyaWJlcikgfSwgYXQgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCAmJiAibnVtYmVyIiA9PSB0eXBlb2YgdC5sZW5ndGggfTsgdmFyIGh0ID0geyBpc1Byb21pc2U6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQuc3Vic2NyaWJlICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQudGhlbiB9IH0sIGx0ID0gZSgoZnVuY3Rpb24gKHQsIGUpIHsgZnVuY3Rpb24gcih0KSB7IHZhciBlID0gdC5TeW1ib2w7IGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiBlKSByZXR1cm4gZS5pdGVyYXRvciB8fCAoZS5pdGVyYXRvciA9IGUoIml0ZXJhdG9yIHBvbHlmaWxsIikpLCBlLml0ZXJhdG9yOyB2YXIgciA9IHQuU2V0OyBpZiAociAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiAobmV3IHIpWyJAQGl0ZXJhdG9yIl0pIHJldHVybiAiQEBpdGVyYXRvciI7IHZhciBuID0gdC5NYXA7IGlmIChuKSBmb3IgKHZhciBpID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobi5wcm90b3R5cGUpLCBvID0gMDsgbyA8IGkubGVuZ3RoOyArK28pIHsgdmFyIHMgPSBpW29dOyBpZiAoImVudHJpZXMiICE9PSBzICYmICJzaXplIiAhPT0gcyAmJiBuLnByb3RvdHlwZVtzXSA9PT0gbi5wcm90b3R5cGUuZW50cmllcykgcmV0dXJuIHMgfSByZXR1cm4gIkBAaXRlcmF0b3IiIH0gZS5zeW1ib2xJdGVyYXRvclBvbnlmaWxsID0gciwgZS5pdGVyYXRvciA9IHIocy5yb290KSwgZS4kJGl0ZXJhdG9yID0gZS5pdGVyYXRvcjsgfSkpLCBwdCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBmdCA9IHsgSW5uZXJTdWJzY3JpYmVyOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMpLCB0aGlzLnBhcmVudCA9IGUsIHRoaXMub3V0ZXJWYWx1ZSA9IHIsIHRoaXMub3V0ZXJJbmRleCA9IG4sIHRoaXMuaW5kZXggPSAwOyB9IHJldHVybiBwdChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnBhcmVudC5ub3RpZnlOZXh0KHRoaXMub3V0ZXJWYWx1ZSwgdCwgdGhpcy5vdXRlckluZGV4LCB0aGlzLmluZGV4KyssIHRoaXMpOyB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnBhcmVudC5ub3RpZnlFcnJvcih0LCB0aGlzKSwgdGhpcy51bnN1YnNjcmliZSgpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMucGFyZW50Lm5vdGlmeUNvbXBsZXRlKHRoaXMpLCB0aGlzLnVuc3Vic2NyaWJlKCk7IH0sIGUgfShULlN1YnNjcmliZXIpIH07IHZhciBidCA9IHsgc3Vic2NyaWJlVG9SZXN1bHQ6IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHZhciBpID0gbmV3IGZ0LklubmVyU3Vic2NyaWJlcih0LCByLCBuKTsgaWYgKGkuY2xvc2VkKSByZXR1cm4gbnVsbDsgaWYgKGUgaW5zdGFuY2VvZiBOLk9ic2VydmFibGUpIHJldHVybiBlLl9pc1NjYWxhciA/IChpLm5leHQoZS52YWx1ZSksIGkuY29tcGxldGUoKSwgbnVsbCkgOiAoaS5zeW5jRXJyb3JUaHJvd2FibGUgPSAhMCwgZS5zdWJzY3JpYmUoaSkpOyBpZiAoYXQoZSkpIHsgZm9yICh2YXIgbyA9IDAsIGMgPSBlLmxlbmd0aDsgbyA8IGMgJiYgIWkuY2xvc2VkOyBvKyspaS5uZXh0KGVbb10pOyBpLmNsb3NlZCB8fCBpLmNvbXBsZXRlKCk7IH0gZWxzZSB7IGlmIChodC5pc1Byb21pc2UoZSkpIHJldHVybiBlLnRoZW4oKGZ1bmN0aW9uICh0KSB7IGkuY2xvc2VkIHx8IChpLm5leHQodCksIGkuY29tcGxldGUoKSk7IH0pLCAoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGkuZXJyb3IodCkgfSkpLnRoZW4obnVsbCwgKGZ1bmN0aW9uICh0KSB7IHMucm9vdC5zZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHRocm93IHQgfSkpOyB9KSksIGk7IGlmIChlICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGVbbHQuaXRlcmF0b3JdKSBmb3IgKHZhciB1ID0gZVtsdC5pdGVyYXRvcl0oKTsgOykgeyB2YXIgYSA9IHUubmV4dCgpOyBpZiAoYS5kb25lKSB7IGkuY29tcGxldGUoKTsgYnJlYWsgfSBpZiAoaS5uZXh0KGEudmFsdWUpLCBpLmNsb3NlZCkgYnJlYWsgfSBlbHNlIGlmIChlICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIGVbRS5vYnNlcnZhYmxlXSkgeyB2YXIgbCA9IGVbRS5vYnNlcnZhYmxlXSgpOyBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgbC5zdWJzY3JpYmUpIHJldHVybiBsLnN1YnNjcmliZShuZXcgZnQuSW5uZXJTdWJzY3JpYmVyKHQsIHIsIG4pKTsgaS5lcnJvcihuZXcgVHlwZUVycm9yKCJQcm92aWRlZCBvYmplY3QgZG9lcyBub3QgY29ycmVjdGx5IGltcGxlbWVudCBTeW1ib2wub2JzZXJ2YWJsZSIpKTsgfSBlbHNlIHsgdmFyIHAgPSAiWW91IHByb3ZpZGVkICIgKyAoaC5pc09iamVjdChlKSA/ICJhbiBpbnZhbGlkIG9iamVjdCIgOiAiJyIgKyBlICsgIiciKSArICIgd2hlcmUgYSBzdHJlYW0gd2FzIGV4cGVjdGVkLiBZb3UgY2FuIHByb3ZpZGUgYW4gT2JzZXJ2YWJsZSwgUHJvbWlzZSwgQXJyYXksIG9yIEl0ZXJhYmxlLiI7IGkuZXJyb3IobmV3IFR5cGVFcnJvcihwKSk7IH0gfSByZXR1cm4gbnVsbCB9IH0sIGR0ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIHl0ID0ge307IHZhciB2dCA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgdmFyIHIgPSBudWxsOyByZXR1cm4gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdFt0Lmxlbmd0aCAtIDFdICYmIChyID0gdC5wb3AoKSksIDEgPT09IHQubGVuZ3RoICYmIHUuaXNBcnJheSh0WzBdKSAmJiAodCA9IHRbMF0uc2xpY2UoKSksIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQuY2FsbChuZXcgc3QuQXJyYXlPYnNlcnZhYmxlKFtlXS5jb25jYXQodCkpLCBuZXcgbXQocikpIH0gfSwgbXQgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLnByb2plY3QgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBfdCh0LCB0aGlzLnByb2plY3QpKSB9LCB0IH0oKSwgd3QgPSBtdCwgX3QgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByb2plY3QgPSByLCB0aGlzLmFjdGl2ZSA9IDAsIHRoaXMudmFsdWVzID0gW10sIHRoaXMub2JzZXJ2YWJsZXMgPSBbXTsgfSByZXR1cm4gZHQoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy52YWx1ZXMucHVzaCh5dCksIHRoaXMub2JzZXJ2YWJsZXMucHVzaCh0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMub2JzZXJ2YWJsZXMsIGUgPSB0Lmxlbmd0aDsgaWYgKDAgPT09IGUpIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgZWxzZSB7IHRoaXMuYWN0aXZlID0gZSwgdGhpcy50b1Jlc3BvbmQgPSBlOyBmb3IgKHZhciByID0gMDsgciA8IGU7IHIrKykgeyB2YXIgbiA9IHRbcl07IHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIG4sIG4sIHIpKTsgfSB9IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgMCA9PSAodGhpcy5hY3RpdmUgLT0gMSkgJiYgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdmFyIG8gPSB0aGlzLnZhbHVlcywgcyA9IG9bcl0sIGMgPSB0aGlzLnRvUmVzcG9uZCA/IHMgPT09IHl0ID8gLS10aGlzLnRvUmVzcG9uZCA6IHRoaXMudG9SZXNwb25kIDogMDsgb1tyXSA9IGUsIDAgPT09IGMgJiYgKHRoaXMucHJvamVjdCA/IHRoaXMuX3RyeVByb2plY3QobykgOiB0aGlzLmRlc3RpbmF0aW9uLm5leHQoby5zbGljZSgpKSk7IH0sIGUucHJvdG90eXBlLl90cnlQcm9qZWN0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGU7IHRyeSB7IGUgPSB0aGlzLnByb2plY3QuYXBwbHkodGhpcywgdCk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KSB9IHRoaXMuZGVzdGluYXRpb24ubmV4dChlKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIHh0ID0geyBjb21iaW5lTGF0ZXN0OiB2dCwgQ29tYmluZUxhdGVzdE9wZXJhdG9yOiB3dCwgQ29tYmluZUxhdGVzdFN1YnNjcmliZXI6IF90IH07IHZhciBPdCA9IHsgY29tYmluZUxhdGVzdDogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyB2YXIgciA9IG51bGwsIG4gPSBudWxsOyByZXR1cm4gdHQuaXNTY2hlZHVsZXIodFt0Lmxlbmd0aCAtIDFdKSAmJiAobiA9IHQucG9wKCkpLCAiZnVuY3Rpb24iID09IHR5cGVvZiB0W3QubGVuZ3RoIC0gMV0gJiYgKHIgPSB0LnBvcCgpKSwgMSA9PT0gdC5sZW5ndGggJiYgdS5pc0FycmF5KHRbMF0pICYmICh0ID0gdFswXSksIG5ldyBzdC5BcnJheU9ic2VydmFibGUodCwgbikubGlmdChuZXcgeHQuQ29tYmluZUxhdGVzdE9wZXJhdG9yKHIpKSB9IH07IE4uT2JzZXJ2YWJsZS5jb21iaW5lTGF0ZXN0ID0gT3QuY29tYmluZUxhdGVzdDsgdmFyIFN0ID0geyBvZjogc3QuQXJyYXlPYnNlcnZhYmxlLm9mIH0sIGd0ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IGZ1bmN0aW9uIFR0KHQpIHsgdmFyIGUgPSB0LnZhbHVlLCByID0gdC5zdWJzY3JpYmVyOyByLmNsb3NlZCB8fCAoci5uZXh0KGUpLCByLmNvbXBsZXRlKCkpOyB9IGZ1bmN0aW9uIGp0KHQpIHsgdmFyIGUgPSB0LmVyciwgciA9IHQuc3Vic2NyaWJlcjsgci5jbG9zZWQgfHwgci5lcnJvcihlKTsgfSB2YXIgRXQgPSB7IFByb21pc2VPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLnByb21pc2UgPSBlLCB0aGlzLnNjaGVkdWxlciA9IHI7IH0gcmV0dXJuIGd0KGUsIHQpLCBlLmNyZWF0ZSA9IGZ1bmN0aW9uICh0LCByKSB7IHJldHVybiBuZXcgZSh0LCByKSB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLCByID0gdGhpcy5wcm9taXNlLCBuID0gdGhpcy5zY2hlZHVsZXI7IGlmIChudWxsID09IG4pIHRoaXMuX2lzU2NhbGFyID8gdC5jbG9zZWQgfHwgKHQubmV4dCh0aGlzLnZhbHVlKSwgdC5jb21wbGV0ZSgpKSA6IHIudGhlbigoZnVuY3Rpb24gKHIpIHsgZS52YWx1ZSA9IHIsIGUuX2lzU2NhbGFyID0gITAsIHQuY2xvc2VkIHx8ICh0Lm5leHQociksIHQuY29tcGxldGUoKSk7IH0pLCAoZnVuY3Rpb24gKGUpIHsgdC5jbG9zZWQgfHwgdC5lcnJvcihlKTsgfSkpLnRoZW4obnVsbCwgKGZ1bmN0aW9uICh0KSB7IHMucm9vdC5zZXRUaW1lb3V0KChmdW5jdGlvbiAoKSB7IHRocm93IHQgfSkpOyB9KSk7IGVsc2UgaWYgKHRoaXMuX2lzU2NhbGFyKSB7IGlmICghdC5jbG9zZWQpIHJldHVybiBuLnNjaGVkdWxlKFR0LCAwLCB7IHZhbHVlOiB0aGlzLnZhbHVlLCBzdWJzY3JpYmVyOiB0IH0pIH0gZWxzZSByLnRoZW4oKGZ1bmN0aW9uIChyKSB7IGUudmFsdWUgPSByLCBlLl9pc1NjYWxhciA9ICEwLCB0LmNsb3NlZCB8fCB0LmFkZChuLnNjaGVkdWxlKFR0LCAwLCB7IHZhbHVlOiByLCBzdWJzY3JpYmVyOiB0IH0pKTsgfSksIChmdW5jdGlvbiAoZSkgeyB0LmNsb3NlZCB8fCB0LmFkZChuLnNjaGVkdWxlKGp0LCAwLCB7IGVycjogZSwgc3Vic2NyaWJlcjogdCB9KSk7IH0pKS50aGVuKG51bGwsIChmdW5jdGlvbiAodCkgeyBzLnJvb3Quc2V0VGltZW91dCgoZnVuY3Rpb24gKCkgeyB0aHJvdyB0IH0pKTsgfSkpOyB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LCBJdCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBBdCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyBpZiAodC5jYWxsKHRoaXMpLCB0aGlzLnNjaGVkdWxlciA9IHIsIG51bGwgPT0gZSkgdGhyb3cgbmV3IEVycm9yKCJpdGVyYXRvciBjYW5ub3QgYmUgbnVsbC4iKTsgdGhpcy5pdGVyYXRvciA9IFB0KGUpOyB9IHJldHVybiBJdChlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgcikgeyByZXR1cm4gbmV3IGUodCwgcikgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5pbmRleCwgciA9IHQuaGFzRXJyb3IsIG4gPSB0Lml0ZXJhdG9yLCBpID0gdC5zdWJzY3JpYmVyOyBpZiAocikgaS5lcnJvcih0LmVycm9yKTsgZWxzZSB7IHZhciBvID0gbi5uZXh0KCk7IG8uZG9uZSA/IGkuY29tcGxldGUoKSA6IChpLm5leHQoby52YWx1ZSksIHQuaW5kZXggPSBlICsgMSwgaS5jbG9zZWQgPyAiZnVuY3Rpb24iID09IHR5cGVvZiBuLnJldHVybiAmJiBuLnJldHVybigpIDogdGhpcy5zY2hlZHVsZSh0KSk7IH0gfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gdGhpcy5pdGVyYXRvciwgbiA9IHRoaXMuc2NoZWR1bGVyOyBpZiAobikgcmV0dXJuIG4uc2NoZWR1bGUoZS5kaXNwYXRjaCwgMCwgeyBpbmRleDogMCwgaXRlcmF0b3I6IHIsIHN1YnNjcmliZXI6IHQgfSk7IGZvciAoOyA7KSB7IHZhciBpID0gci5uZXh0KCk7IGlmIChpLmRvbmUpIHsgdC5jb21wbGV0ZSgpOyBicmVhayB9IGlmICh0Lm5leHQoaS52YWx1ZSksIHQuY2xvc2VkKSB7ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHIucmV0dXJuICYmIHIucmV0dXJuKCk7IGJyZWFrIH0gfSB9LCBlIH0oTi5PYnNlcnZhYmxlKSwgQ3QgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgcikgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSAwKSwgdm9pZCAwID09PSByICYmIChyID0gdC5sZW5ndGgpLCB0aGlzLnN0ciA9IHQsIHRoaXMuaWR4ID0gZSwgdGhpcy5sZW4gPSByOyB9IHJldHVybiB0LnByb3RvdHlwZVtsdC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzIH0sIHQucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmlkeCA8IHRoaXMubGVuID8geyBkb25lOiAhMSwgdmFsdWU6IHRoaXMuc3RyLmNoYXJBdCh0aGlzLmlkeCsrKSB9IDogeyBkb25lOiAhMCwgdmFsdWU6IHZvaWQgMCB9IH0sIHQgfSgpLCBOdCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlLCByKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9ICt0Lmxlbmd0aDsgaWYgKGlzTmFOKGUpKSByZXR1cm4gMDsgaWYgKDAgPT09IGUgfHwgKHIgPSBlLCAibnVtYmVyIiAhPSB0eXBlb2YgciB8fCAhcy5yb290LmlzRmluaXRlKHIpKSkgcmV0dXJuIGU7IHZhciByOyBpZiAoKGUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9ICt0OyBpZiAoMCA9PT0gZSkgcmV0dXJuIGU7IGlmIChpc05hTihlKSkgcmV0dXJuIGU7IHJldHVybiBlIDwgMCA/IC0xIDogMSB9KGUpICogTWF0aC5mbG9vcihNYXRoLmFicyhlKSkpIDw9IDApIHJldHVybiAwOyBpZiAoZSA+IGt0KSByZXR1cm4ga3Q7IHJldHVybiBlIH0odCkpLCB0aGlzLmFyciA9IHQsIHRoaXMuaWR4ID0gZSwgdGhpcy5sZW4gPSByOyB9IHJldHVybiB0LnByb3RvdHlwZVtsdC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzIH0sIHQucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmlkeCA8IHRoaXMubGVuID8geyBkb25lOiAhMSwgdmFsdWU6IHRoaXMuYXJyW3RoaXMuaWR4KytdIH0gOiB7IGRvbmU6ICEwLCB2YWx1ZTogdm9pZCAwIH0gfSwgdCB9KCk7IGZ1bmN0aW9uIFB0KHQpIHsgdmFyIGUgPSB0W2x0Lml0ZXJhdG9yXTsgaWYgKCFlICYmICJzdHJpbmciID09IHR5cGVvZiB0KSByZXR1cm4gbmV3IEN0KHQpOyBpZiAoIWUgJiYgdm9pZCAwICE9PSB0Lmxlbmd0aCkgcmV0dXJuIG5ldyBOdCh0KTsgaWYgKCFlKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJvYmplY3QgaXMgbm90IGl0ZXJhYmxlIik7IHJldHVybiB0W2x0Lml0ZXJhdG9yXSgpIH0gdmFyIGt0ID0gTWF0aC5wb3coMiwgNTMpIC0gMTsgdmFyIFZ0ID0geyBJdGVyYXRvck9ic2VydmFibGU6IEF0IH0sIEZ0ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIFJ0ID0geyBBcnJheUxpa2VPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmFycmF5TGlrZSA9IGUsIHRoaXMuc2NoZWR1bGVyID0gciwgciB8fCAxICE9PSBlLmxlbmd0aCB8fCAodGhpcy5faXNTY2FsYXIgPSAhMCwgdGhpcy52YWx1ZSA9IGVbMF0pOyB9IHJldHVybiBGdChlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgcikgeyB2YXIgbiA9IHQubGVuZ3RoOyByZXR1cm4gMCA9PT0gbiA/IG5ldyBpdC5FbXB0eU9ic2VydmFibGUgOiAxID09PSBuID8gbmV3IHJ0LlNjYWxhck9ic2VydmFibGUodFswXSwgcikgOiBuZXcgZSh0LCByKSB9LCBlLmRpc3BhdGNoID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0LmFycmF5TGlrZSwgciA9IHQuaW5kZXgsIG4gPSB0Lmxlbmd0aCwgaSA9IHQuc3Vic2NyaWJlcjsgaS5jbG9zZWQgfHwgKHIgPj0gbiA/IGkuY29tcGxldGUoKSA6IChpLm5leHQoZVtyXSksIHQuaW5kZXggPSByICsgMSwgdGhpcy5zY2hlZHVsZSh0KSkpOyB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0aGlzLmFycmF5TGlrZSwgbiA9IHRoaXMuc2NoZWR1bGVyLCBpID0gci5sZW5ndGg7IGlmIChuKSByZXR1cm4gbi5zY2hlZHVsZShlLmRpc3BhdGNoLCAwLCB7IGFycmF5TGlrZTogciwgaW5kZXg6IDAsIGxlbmd0aDogaSwgc3Vic2NyaWJlcjogdCB9KTsgZm9yICh2YXIgbyA9IDA7IG8gPCBpICYmICF0LmNsb3NlZDsgbysrKXQubmV4dChyW29dKTsgdC5jb21wbGV0ZSgpOyB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LCBNdCA9IHsgTm90aWZpY2F0aW9uOiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgcikgeyB0aGlzLmtpbmQgPSB0LCB0aGlzLnZhbHVlID0gZSwgdGhpcy5lcnJvciA9IHIsIHRoaXMuaGFzVmFsdWUgPSAiTiIgPT09IHQ7IH0gcmV0dXJuIHQucHJvdG90eXBlLm9ic2VydmUgPSBmdW5jdGlvbiAodCkgeyBzd2l0Y2ggKHRoaXMua2luZCkgeyBjYXNlICJOIjogcmV0dXJuIHQubmV4dCAmJiB0Lm5leHQodGhpcy52YWx1ZSk7IGNhc2UgIkUiOiByZXR1cm4gdC5lcnJvciAmJiB0LmVycm9yKHRoaXMuZXJyb3IpOyBjYXNlICJDIjogcmV0dXJuIHQuY29tcGxldGUgJiYgdC5jb21wbGV0ZSgpIH0gfSwgdC5wcm90b3R5cGUuZG8gPSBmdW5jdGlvbiAodCwgZSwgcikgeyBzd2l0Y2ggKHRoaXMua2luZCkgeyBjYXNlICJOIjogcmV0dXJuIHQgJiYgdCh0aGlzLnZhbHVlKTsgY2FzZSAiRSI6IHJldHVybiBlICYmIGUodGhpcy5lcnJvcik7IGNhc2UgIkMiOiByZXR1cm4gciAmJiByKCkgfSB9LCB0LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0Lm5leHQgPyB0aGlzLm9ic2VydmUodCkgOiB0aGlzLmRvKHQsIGUsIHIpIH0sIHQucHJvdG90eXBlLnRvT2JzZXJ2YWJsZSA9IGZ1bmN0aW9uICgpIHsgc3dpdGNoICh0aGlzLmtpbmQpIHsgY2FzZSAiTiI6IHJldHVybiBOLk9ic2VydmFibGUub2YodGhpcy52YWx1ZSk7IGNhc2UgIkUiOiByZXR1cm4gTi5PYnNlcnZhYmxlLnRocm93KHRoaXMuZXJyb3IpOyBjYXNlICJDIjogcmV0dXJuIE4uT2JzZXJ2YWJsZS5lbXB0eSgpIH10aHJvdyBuZXcgRXJyb3IoInVuZXhwZWN0ZWQgbm90aWZpY2F0aW9uIGtpbmQgdmFsdWUiKSB9LCB0LmNyZWF0ZU5leHQgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdm9pZCAwICE9PSBlID8gbmV3IHQoIk4iLCBlKSA6IHQudW5kZWZpbmVkVmFsdWVOb3RpZmljYXRpb24gfSwgdC5jcmVhdGVFcnJvciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgdCgiRSIsIHZvaWQgMCwgZSkgfSwgdC5jcmVhdGVDb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHQuY29tcGxldGVOb3RpZmljYXRpb24gfSwgdC5jb21wbGV0ZU5vdGlmaWNhdGlvbiA9IG5ldyB0KCJDIiksIHQudW5kZWZpbmVkVmFsdWVOb3RpZmljYXRpb24gPSBuZXcgdCgiTiIsIHZvaWQgMCksIHQgfSgpIH0sIFd0ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBxdCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSAwKSwgZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgTHQodCwgZSkpIH0gfSwgTHQgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSkgeyB2b2lkIDAgPT09IGUgJiYgKGUgPSAwKSwgdGhpcy5zY2hlZHVsZXIgPSB0LCB0aGlzLmRlbGF5ID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgenQodCwgdGhpcy5zY2hlZHVsZXIsIHRoaXMuZGVsYXkpKSB9LCB0IH0oKSwgVXQgPSBMdCwgenQgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdm9pZCAwID09PSBuICYmIChuID0gMCksIHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5zY2hlZHVsZXIgPSByLCB0aGlzLmRlbGF5ID0gbjsgfSByZXR1cm4gV3QoZSwgdCksIGUuZGlzcGF0Y2ggPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHQubm90aWZpY2F0aW9uLCByID0gdC5kZXN0aW5hdGlvbjsgZS5vYnNlcnZlKHIpLCB0aGlzLnVuc3Vic2NyaWJlKCk7IH0sIGUucHJvdG90eXBlLnNjaGVkdWxlTWVzc2FnZSA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuYWRkKHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIHRoaXMuZGVsYXksIG5ldyBCdCh0LCB0aGlzLmRlc3RpbmF0aW9uKSkpOyB9LCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuc2NoZWR1bGVNZXNzYWdlKE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVOZXh0KHQpKTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5zY2hlZHVsZU1lc3NhZ2UoTXQuTm90aWZpY2F0aW9uLmNyZWF0ZUVycm9yKHQpKTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNjaGVkdWxlTWVzc2FnZShNdC5Ob3RpZmljYXRpb24uY3JlYXRlQ29tcGxldGUoKSk7IH0sIGUgfShULlN1YnNjcmliZXIpLCBCdCA9IGZ1bmN0aW9uICh0LCBlKSB7IHRoaXMubm90aWZpY2F0aW9uID0gdCwgdGhpcy5kZXN0aW5hdGlvbiA9IGU7IH0sIER0ID0geyBvYnNlcnZlT246IHF0LCBPYnNlcnZlT25PcGVyYXRvcjogVXQsIE9ic2VydmVPblN1YnNjcmliZXI6IHp0LCBPYnNlcnZlT25NZXNzYWdlOiBCdCB9LCBZdCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBIdCA9IHsgRnJvbU9ic2VydmFibGU6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgbnVsbCksIHRoaXMuaXNoID0gZSwgdGhpcy5zY2hlZHVsZXIgPSByOyB9IHJldHVybiBZdChlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgcikgeyBpZiAobnVsbCAhPSB0KSB7IGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiB0W0Uub2JzZXJ2YWJsZV0pIHJldHVybiB0IGluc3RhbmNlb2YgTi5PYnNlcnZhYmxlICYmICFyID8gdCA6IG5ldyBlKHQsIHIpOyBpZiAodS5pc0FycmF5KHQpKSByZXR1cm4gbmV3IHN0LkFycmF5T2JzZXJ2YWJsZSh0LCByKTsgaWYgKGh0LmlzUHJvbWlzZSh0KSkgcmV0dXJuIG5ldyBFdC5Qcm9taXNlT2JzZXJ2YWJsZSh0LCByKTsgaWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHRbbHQuaXRlcmF0b3JdIHx8ICJzdHJpbmciID09IHR5cGVvZiB0KSByZXR1cm4gbmV3IFZ0Lkl0ZXJhdG9yT2JzZXJ2YWJsZSh0LCByKTsgaWYgKGF0KHQpKSByZXR1cm4gbmV3IFJ0LkFycmF5TGlrZU9ic2VydmFibGUodCwgcikgfSB0aHJvdyBuZXcgVHlwZUVycm9yKChudWxsICE9PSB0ICYmIHR5cGVvZiB0IHx8IHQpICsgIiBpcyBub3Qgb2JzZXJ2YWJsZSIpIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuaXNoLCByID0gdGhpcy5zY2hlZHVsZXI7IHJldHVybiBudWxsID09IHIgPyBlW0Uub2JzZXJ2YWJsZV0oKS5zdWJzY3JpYmUodCkgOiBlW0Uub2JzZXJ2YWJsZV0oKS5zdWJzY3JpYmUobmV3IER0Lk9ic2VydmVPblN1YnNjcmliZXIodCwgciwgMCkpIH0sIGUgfShOLk9ic2VydmFibGUpIH0sIFh0ID0geyBmcm9tOiBIdC5Gcm9tT2JzZXJ2YWJsZS5jcmVhdGUgfSwgR3QgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEp0ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIGZ1bmN0aW9uIChuKSB7IHJldHVybiAibnVtYmVyIiA9PSB0eXBlb2YgZSAmJiAociA9IGUsIGUgPSBudWxsKSwgbi5saWZ0KG5ldyBLdCh0LCBlLCByKSkgfSB9LCBLdCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlLCByKSB7IHZvaWQgMCA9PT0gciAmJiAociA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIHRoaXMucHJvamVjdCA9IHQsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBlLCB0aGlzLmNvbmN1cnJlbnQgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBRdCh0LCB0aGlzLnByb2plY3QsIHRoaXMucmVzdWx0U2VsZWN0b3IsIHRoaXMuY29uY3VycmVudCkpIH0sIHQgfSgpLCAkdCA9IEt0LCBRdCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB2b2lkIDAgPT09IGkgJiYgKGkgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCB0LmNhbGwodGhpcywgZSksIHRoaXMucHJvamVjdCA9IHIsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBuLCB0aGlzLmNvbmN1cnJlbnQgPSBpLCB0aGlzLmhhc0NvbXBsZXRlZCA9ICExLCB0aGlzLmJ1ZmZlciA9IFtdLCB0aGlzLmFjdGl2ZSA9IDAsIHRoaXMuaW5kZXggPSAwOyB9IHJldHVybiBHdChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmFjdGl2ZSA8IHRoaXMuY29uY3VycmVudCA/IHRoaXMuX3RyeU5leHQodCkgOiB0aGlzLmJ1ZmZlci5wdXNoKHQpOyB9LCBlLnByb3RvdHlwZS5fdHJ5TmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlLCByID0gdGhpcy5pbmRleCsrOyB0cnkgeyBlID0gdGhpcy5wcm9qZWN0KHQsIHIpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCkgfSB0aGlzLmFjdGl2ZSsrLCB0aGlzLl9pbm5lclN1YihlLCB0LCByKTsgfSwgZS5wcm90b3R5cGUuX2lubmVyU3ViID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgdGhpcy5hZGQoYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgdCwgZSwgcikpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaGFzQ29tcGxldGVkID0gITAsIDAgPT09IHRoaXMuYWN0aXZlICYmIDAgPT09IHRoaXMuYnVmZmVyLmxlbmd0aCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB0aGlzLnJlc3VsdFNlbGVjdG9yID8gdGhpcy5fbm90aWZ5UmVzdWx0U2VsZWN0b3IodCwgZSwgciwgbikgOiB0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSk7IH0sIGUucHJvdG90eXBlLl9ub3RpZnlSZXN1bHRTZWxlY3RvciA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHZhciBpOyB0cnkgeyBpID0gdGhpcy5yZXN1bHRTZWxlY3Rvcih0LCBlLCByLCBuKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGkpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5idWZmZXI7IHRoaXMucmVtb3ZlKHQpLCB0aGlzLmFjdGl2ZS0tLCBlLmxlbmd0aCA+IDAgPyB0aGlzLl9uZXh0KGUuc2hpZnQoKSkgOiAwID09PSB0aGlzLmFjdGl2ZSAmJiB0aGlzLmhhc0NvbXBsZXRlZCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBadCA9IHsgbWVyZ2VNYXA6IEp0LCBNZXJnZU1hcE9wZXJhdG9yOiAkdCwgTWVyZ2VNYXBTdWJzY3JpYmVyOiBRdCB9OyB2YXIgdGUgPSB7IGlkZW50aXR5OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCB9IH07IHZhciBlZSA9IHsgbWVyZ2VBbGw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB2b2lkIDAgPT09IHQgJiYgKHQgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCBadC5tZXJnZU1hcCh0ZS5pZGVudGl0eSwgbnVsbCwgdCkgfSB9OyB2YXIgcmUgPSB7IGNvbmNhdEFsbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gZWUubWVyZ2VBbGwoMSkgfSB9OyB2YXIgbmUgPSB7IGNvbmNhdDogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gMSA9PT0gdC5sZW5ndGggfHwgMiA9PT0gdC5sZW5ndGggJiYgdHQuaXNTY2hlZHVsZXIodFsxXSkgPyBYdC5mcm9tKHRbMF0pIDogcmUuY29uY2F0QWxsKCkoU3Qub2YuYXBwbHkodm9pZCAwLCB0KSkgfSB9OyBOLk9ic2VydmFibGUuY29uY2F0ID0gbmUuY29uY2F0OyB2YXIgaWUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgb2UgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLm9ic2VydmFibGVGYWN0b3J5ID0gZTsgfSByZXR1cm4gaWUoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIG5ldyBlKHQpIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IHNlKHQsIHRoaXMub2JzZXJ2YWJsZUZhY3RvcnkpIH0sIGUgfShOLk9ic2VydmFibGUpLCBzZSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuZmFjdG9yeSA9IHIsIHRoaXMudHJ5RGVmZXIoKTsgfSByZXR1cm4gaWUoZSwgdCksIGUucHJvdG90eXBlLnRyeURlZmVyID0gZnVuY3Rpb24gKCkgeyB0cnkgeyB0aGlzLl9jYWxsRmFjdG9yeSgpOyB9IGNhdGNoICh0KSB7IHRoaXMuX2Vycm9yKHQpOyB9IH0sIGUucHJvdG90eXBlLl9jYWxsRmFjdG9yeSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmZhY3RvcnkoKTsgdCAmJiB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCB0KSk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBjZSA9IHsgZGVmZXI6IHsgRGVmZXJPYnNlcnZhYmxlOiBvZSB9LkRlZmVyT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmRlZmVyID0gY2UuZGVmZXI7IHZhciB1ZSA9IHsgZW1wdHk6IGl0LkVtcHR5T2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmVtcHR5ID0gdWUuZW1wdHk7IHZhciBhZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBoZSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMuc291cmNlcyA9IGUsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSByOyB9IHJldHVybiBhZShlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgciA9IDA7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspdFtyIC0gMF0gPSBhcmd1bWVudHNbcl07IGlmIChudWxsID09PSB0IHx8IDAgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBuZXcgaXQuRW1wdHlPYnNlcnZhYmxlOyB2YXIgbiA9IG51bGw7IHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiB0W3QubGVuZ3RoIC0gMV0gJiYgKG4gPSB0LnBvcCgpKSwgMSA9PT0gdC5sZW5ndGggJiYgdS5pc0FycmF5KHRbMF0pICYmICh0ID0gdFswXSksIDAgPT09IHQubGVuZ3RoID8gbmV3IGl0LkVtcHR5T2JzZXJ2YWJsZSA6IG5ldyBlKHQsIG4pIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IGxlKHQsIHRoaXMuc291cmNlcywgdGhpcy5yZXN1bHRTZWxlY3RvcikgfSwgZSB9KE4uT2JzZXJ2YWJsZSksIGxlID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5zb3VyY2VzID0gciwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IG4sIHRoaXMuY29tcGxldGVkID0gMCwgdGhpcy5oYXZlVmFsdWVzID0gMDsgdmFyIGkgPSByLmxlbmd0aDsgdGhpcy50b3RhbCA9IGksIHRoaXMudmFsdWVzID0gbmV3IEFycmF5KGkpOyBmb3IgKHZhciBvID0gMDsgbyA8IGk7IG8rKykgeyB2YXIgcyA9IHJbb10sIGMgPSBidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCBzLCBudWxsLCBvKTsgYyAmJiAoYy5vdXRlckluZGV4ID0gbywgdGhpcy5hZGQoYykpOyB9IH0gcmV0dXJuIGFlKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy52YWx1ZXNbcl0gPSBlLCBpLl9oYXNWYWx1ZSB8fCAoaS5faGFzVmFsdWUgPSAhMCwgdGhpcy5oYXZlVmFsdWVzKyspOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5kZXN0aW5hdGlvbiwgciA9IHRoaXMsIG4gPSByLmhhdmVWYWx1ZXMsIGkgPSByLnJlc3VsdFNlbGVjdG9yLCBvID0gci52YWx1ZXMsIHMgPSBvLmxlbmd0aDsgaWYgKHQuX2hhc1ZhbHVlKSB7IGlmICh0aGlzLmNvbXBsZXRlZCsrLCB0aGlzLmNvbXBsZXRlZCA9PT0gcykgeyBpZiAobiA9PT0gcykgeyB2YXIgYyA9IGkgPyBpLmFwcGx5KHRoaXMsIG8pIDogbzsgZS5uZXh0KGMpOyB9IGUuY29tcGxldGUoKTsgfSB9IGVsc2UgZS5jb21wbGV0ZSgpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgcGUgPSB7IGZvcmtKb2luOiB7IEZvcmtKb2luT2JzZXJ2YWJsZTogaGUgfS5Gb3JrSm9pbk9ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5mb3JrSm9pbiA9IHBlLmZvcmtKb2luLCBOLk9ic2VydmFibGUuZnJvbSA9IFh0LmZyb207IHZhciBmZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBiZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7IHZhciBkZSA9IHsgZnJvbUV2ZW50OiB7IEZyb21FdmVudE9ic2VydmFibGU6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB0LmNhbGwodGhpcyksIHRoaXMuc291cmNlT2JqID0gZSwgdGhpcy5ldmVudE5hbWUgPSByLCB0aGlzLnNlbGVjdG9yID0gbiwgdGhpcy5vcHRpb25zID0gaTsgfSByZXR1cm4gZmUoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4sIGkpIHsgcmV0dXJuIGMuaXNGdW5jdGlvbihuKSAmJiAoaSA9IG4sIG4gPSB2b2lkIDApLCBuZXcgZSh0LCByLCBpLCBuKSB9LCBlLnNldHVwU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24gKHQsIHIsIG4sIGksIG8pIHsgdmFyIHM7IGlmIChmdW5jdGlvbiAodCkgeyByZXR1cm4gISF0ICYmICJbb2JqZWN0IE5vZGVMaXN0XSIgPT09IGJlLmNhbGwodCkgfSh0KSB8fCBmdW5jdGlvbiAodCkgeyByZXR1cm4gISF0ICYmICJbb2JqZWN0IEhUTUxDb2xsZWN0aW9uXSIgPT09IGJlLmNhbGwodCkgfSh0KSkgZm9yICh2YXIgYyA9IDAsIHUgPSB0Lmxlbmd0aDsgYyA8IHU7IGMrKyllLnNldHVwU3Vic2NyaXB0aW9uKHRbY10sIHIsIG4sIGksIG8pOyBlbHNlIGlmIChmdW5jdGlvbiAodCkgeyByZXR1cm4gISF0ICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQuYWRkRXZlbnRMaXN0ZW5lciAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIgfSh0KSkgeyB2YXIgYSA9IHQ7IHQuYWRkRXZlbnRMaXN0ZW5lcihyLCBuLCBvKSwgcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihyLCBuLCBvKSB9OyB9IGVsc2UgaWYgKGZ1bmN0aW9uICh0KSB7IHJldHVybiAhIXQgJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdC5vbiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0Lm9mZiB9KHQpKSB7IHZhciBoID0gdDsgdC5vbihyLCBuKSwgcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGgub2ZmKHIsIG4pIH07IH0gZWxzZSB7IGlmICghZnVuY3Rpb24gKHQpIHsgcmV0dXJuICEhdCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LmFkZExpc3RlbmVyICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQucmVtb3ZlTGlzdGVuZXIgfSh0KSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBldmVudCB0YXJnZXQiKTsgdmFyIGwgPSB0OyB0LmFkZExpc3RlbmVyKHIsIG4pLCBzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbC5yZW1vdmVMaXN0ZW5lcihyLCBuKSB9OyB9IGkuYWRkKG5ldyB2LlN1YnNjcmlwdGlvbihzKSk7IH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgciA9IHRoaXMuc291cmNlT2JqLCBuID0gdGhpcy5ldmVudE5hbWUsIGkgPSB0aGlzLm9wdGlvbnMsIG8gPSB0aGlzLnNlbGVjdG9yLCBzID0gbyA/IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IFtdLCByID0gMDsgciA8IGFyZ3VtZW50cy5sZW5ndGg7IHIrKyllW3IgLSAwXSA9IGFyZ3VtZW50c1tyXTsgdmFyIG4gPSBmLnRyeUNhdGNoKG8pLmFwcGx5KHZvaWQgMCwgZSk7IG4gPT09IGwuZXJyb3JPYmplY3QgPyB0LmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiB0Lm5leHQobik7IH0gOiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5uZXh0KGUpIH07IGUuc2V0dXBTdWJzY3JpcHRpb24ociwgbiwgcywgdCwgaSk7IH0sIGUgfShOLk9ic2VydmFibGUpIH0uRnJvbUV2ZW50T2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmZyb21FdmVudCA9IGRlLmZyb21FdmVudDsgdmFyIHllID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIHZlID0geyBmcm9tRXZlbnRQYXR0ZXJuOiB7IEZyb21FdmVudFBhdHRlcm5PYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmFkZEhhbmRsZXIgPSBlLCB0aGlzLnJlbW92ZUhhbmRsZXIgPSByLCB0aGlzLnNlbGVjdG9yID0gbjsgfSByZXR1cm4geWUoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgcmV0dXJuIG5ldyBlKHQsIHIsIG4pIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMsIHIgPSB0aGlzLnJlbW92ZUhhbmRsZXIsIG4gPSB0aGlzLnNlbGVjdG9yID8gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciByID0gW10sIG4gPSAwOyBuIDwgYXJndW1lbnRzLmxlbmd0aDsgbisrKXJbbiAtIDBdID0gYXJndW1lbnRzW25dOyBlLl9jYWxsU2VsZWN0b3IodCwgcik7IH0gOiBmdW5jdGlvbiAoZSkgeyB0Lm5leHQoZSk7IH0sIGkgPSB0aGlzLl9jYWxsQWRkSGFuZGxlcihuLCB0KTsgYy5pc0Z1bmN0aW9uKHIpICYmIHQuYWRkKG5ldyB2LlN1YnNjcmlwdGlvbigoZnVuY3Rpb24gKCkgeyByKG4sIGkpOyB9KSkpOyB9LCBlLnByb3RvdHlwZS5fY2FsbFNlbGVjdG9yID0gZnVuY3Rpb24gKHQsIGUpIHsgdHJ5IHsgdmFyIHIgPSB0aGlzLnNlbGVjdG9yLmFwcGx5KHRoaXMsIGUpOyB0Lm5leHQocik7IH0gY2F0Y2ggKGUpIHsgdC5lcnJvcihlKTsgfSB9LCBlLnByb3RvdHlwZS5fY2FsbEFkZEhhbmRsZXIgPSBmdW5jdGlvbiAodCwgZSkgeyB0cnkgeyByZXR1cm4gdGhpcy5hZGRIYW5kbGVyKHQpIHx8IG51bGwgfSBjYXRjaCAodCkgeyBlLmVycm9yKHQpOyB9IH0sIGUgfShOLk9ic2VydmFibGUpIH0uRnJvbUV2ZW50UGF0dGVybk9ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5mcm9tRXZlbnRQYXR0ZXJuID0gdmUuZnJvbUV2ZW50UGF0dGVybjsgdmFyIG1lID0geyBmcm9tUHJvbWlzZTogRXQuUHJvbWlzZU9ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5mcm9tUHJvbWlzZSA9IG1lLmZyb21Qcm9taXNlOyB2YXIgd2UgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgX2UgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCB9LCB4ZSA9IHsgZ2VuZXJhdGU6IHsgR2VuZXJhdGVPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmluaXRpYWxTdGF0ZSA9IGUsIHRoaXMuY29uZGl0aW9uID0gciwgdGhpcy5pdGVyYXRlID0gbiwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGksIHRoaXMuc2NoZWR1bGVyID0gbzsgfSByZXR1cm4gd2UoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4sIGksIG8pIHsgcmV0dXJuIDEgPT0gYXJndW1lbnRzLmxlbmd0aCA/IG5ldyBlKHQuaW5pdGlhbFN0YXRlLCB0LmNvbmRpdGlvbiwgdC5pdGVyYXRlLCB0LnJlc3VsdFNlbGVjdG9yIHx8IF9lLCB0LnNjaGVkdWxlcikgOiB2b2lkIDAgPT09IGkgfHwgdHQuaXNTY2hlZHVsZXIoaSkgPyBuZXcgZSh0LCByLCBuLCBfZSwgaSkgOiBuZXcgZSh0LCByLCBuLCBpLCBvKSB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0aGlzLmluaXRpYWxTdGF0ZTsgaWYgKHRoaXMuc2NoZWR1bGVyKSByZXR1cm4gdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoZS5kaXNwYXRjaCwgMCwgeyBzdWJzY3JpYmVyOiB0LCBpdGVyYXRlOiB0aGlzLml0ZXJhdGUsIGNvbmRpdGlvbjogdGhpcy5jb25kaXRpb24sIHJlc3VsdFNlbGVjdG9yOiB0aGlzLnJlc3VsdFNlbGVjdG9yLCBzdGF0ZTogciB9KTsgZm9yICh2YXIgbiA9IHRoaXMsIGkgPSBuLmNvbmRpdGlvbiwgbyA9IG4ucmVzdWx0U2VsZWN0b3IsIHMgPSBuLml0ZXJhdGU7IDspIHsgaWYgKGkpIHsgdmFyIGMgPSB2b2lkIDA7IHRyeSB7IGMgPSBpKHIpOyB9IGNhdGNoIChlKSB7IHJldHVybiB2b2lkIHQuZXJyb3IoZSkgfSBpZiAoIWMpIHsgdC5jb21wbGV0ZSgpOyBicmVhayB9IH0gdmFyIHUgPSB2b2lkIDA7IHRyeSB7IHUgPSBvKHIpOyB9IGNhdGNoIChlKSB7IHJldHVybiB2b2lkIHQuZXJyb3IoZSkgfSBpZiAodC5uZXh0KHUpLCB0LmNsb3NlZCkgYnJlYWs7IHRyeSB7IHIgPSBzKHIpOyB9IGNhdGNoIChlKSB7IHJldHVybiB2b2lkIHQuZXJyb3IoZSkgfSB9IH0sIGUuZGlzcGF0Y2ggPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHQuc3Vic2NyaWJlciwgciA9IHQuY29uZGl0aW9uOyBpZiAoIWUuY2xvc2VkKSB7IGlmICh0Lm5lZWRJdGVyYXRlKSB0cnkgeyB0LnN0YXRlID0gdC5pdGVyYXRlKHQuc3RhdGUpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIGUuZXJyb3IodCkgfSBlbHNlIHQubmVlZEl0ZXJhdGUgPSAhMDsgaWYgKHIpIHsgdmFyIG4gPSB2b2lkIDA7IHRyeSB7IG4gPSByKHQuc3RhdGUpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIGUuZXJyb3IodCkgfSBpZiAoIW4pIHJldHVybiB2b2lkIGUuY29tcGxldGUoKTsgaWYgKGUuY2xvc2VkKSByZXR1cm4gfSB2YXIgaTsgdHJ5IHsgaSA9IHQucmVzdWx0U2VsZWN0b3IodC5zdGF0ZSk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgZS5lcnJvcih0KSB9IGlmICghZS5jbG9zZWQgJiYgKGUubmV4dChpKSwgIWUuY2xvc2VkKSkgcmV0dXJuIHRoaXMuc2NoZWR1bGUodCkgfSB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LkdlbmVyYXRlT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmdlbmVyYXRlID0geGUuZ2VuZXJhdGU7IHZhciBPZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBTZSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcyksIHRoaXMuY29uZGl0aW9uID0gZSwgdGhpcy50aGVuU291cmNlID0gciwgdGhpcy5lbHNlU291cmNlID0gbjsgfSByZXR1cm4gT2UoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgcmV0dXJuIG5ldyBlKHQsIHIsIG4pIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMsIHIgPSBlLmNvbmRpdGlvbiwgbiA9IGUudGhlblNvdXJjZSwgaSA9IGUuZWxzZVNvdXJjZTsgcmV0dXJuIG5ldyBnZSh0LCByLCBuLCBpKSB9LCBlIH0oTi5PYnNlcnZhYmxlKSwgZ2UgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGkpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmNvbmRpdGlvbiA9IHIsIHRoaXMudGhlblNvdXJjZSA9IG4sIHRoaXMuZWxzZVNvdXJjZSA9IGksIHRoaXMudHJ5SWYoKTsgfSByZXR1cm4gT2UoZSwgdCksIGUucHJvdG90eXBlLnRyeUlmID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMsIGUgPSB0LmNvbmRpdGlvbiwgciA9IHQudGhlblNvdXJjZSwgbiA9IHQuZWxzZVNvdXJjZTsgdHJ5IHsgdmFyIGkgPSBlKCkgPyByIDogbjsgaSA/IHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIGkpKSA6IHRoaXMuX2NvbXBsZXRlKCk7IH0gY2F0Y2ggKHQpIHsgdGhpcy5fZXJyb3IodCk7IH0gfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIFRlID0geyBfaWY6IHsgSWZPYnNlcnZhYmxlOiBTZSB9LklmT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmlmID0gVGUuX2lmOyB2YXIgamUgPSB7IGlzTnVtZXJpYzogZnVuY3Rpb24gKHQpIHsgcmV0dXJuICF1LmlzQXJyYXkodCkgJiYgdCAtIHBhcnNlRmxvYXQodCkgKyAxID49IDAgfSB9LCBFZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBJZSA9IHsgQWN0aW9uOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpOyB9IHJldHVybiBFZShlLCB0KSwgZS5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdGhpcyB9LCBlIH0odi5TdWJzY3JpcHRpb24pIH0sIEFlID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIENlID0geyBBc3luY0FjdGlvbjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlLCByKSwgdGhpcy5zY2hlZHVsZXIgPSBlLCB0aGlzLnBlbmRpbmcgPSAhMSwgdGhpcy53b3JrID0gcjsgfSByZXR1cm4gQWUoZSwgdCksIGUucHJvdG90eXBlLnNjaGVkdWxlID0gZnVuY3Rpb24gKHQsIGUpIHsgaWYgKHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCB0aGlzLmNsb3NlZCkgcmV0dXJuIHRoaXM7IHRoaXMuc3RhdGUgPSB0LCB0aGlzLnBlbmRpbmcgPSAhMDsgdmFyIHIgPSB0aGlzLmlkLCBuID0gdGhpcy5zY2hlZHVsZXI7IHJldHVybiBudWxsICE9IHIgJiYgKHRoaXMuaWQgPSB0aGlzLnJlY3ljbGVBc3luY0lkKG4sIHIsIGUpKSwgdGhpcy5kZWxheSA9IGUsIHRoaXMuaWQgPSB0aGlzLmlkIHx8IHRoaXMucmVxdWVzdEFzeW5jSWQobiwgdGhpcy5pZCwgZSksIHRoaXMgfSwgZS5wcm90b3R5cGUucmVxdWVzdEFzeW5jSWQgPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gdm9pZCAwID09PSByICYmIChyID0gMCksIHMucm9vdC5zZXRJbnRlcnZhbCh0LmZsdXNoLmJpbmQodCwgdGhpcyksIHIpIH0sIGUucHJvdG90eXBlLnJlY3ljbGVBc3luY0lkID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgaWYgKHZvaWQgMCA9PT0gciAmJiAociA9IDApLCBudWxsICE9PSByICYmIHRoaXMuZGVsYXkgPT09IHIgJiYgITEgPT09IHRoaXMucGVuZGluZykgcmV0dXJuIGU7IHMucm9vdC5jbGVhckludGVydmFsKGUpOyB9LCBlLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gKHQsIGUpIHsgaWYgKHRoaXMuY2xvc2VkKSByZXR1cm4gbmV3IEVycm9yKCJleGVjdXRpbmcgYSBjYW5jZWxsZWQgYWN0aW9uIik7IHRoaXMucGVuZGluZyA9ICExOyB2YXIgciA9IHRoaXMuX2V4ZWN1dGUodCwgZSk7IGlmIChyKSByZXR1cm4gcjsgITEgPT09IHRoaXMucGVuZGluZyAmJiBudWxsICE9IHRoaXMuaWQgJiYgKHRoaXMuaWQgPSB0aGlzLnJlY3ljbGVBc3luY0lkKHRoaXMuc2NoZWR1bGVyLCB0aGlzLmlkLCBudWxsKSk7IH0sIGUucHJvdG90eXBlLl9leGVjdXRlID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHIgPSAhMSwgbiA9IHZvaWQgMDsgdHJ5IHsgdGhpcy53b3JrKHQpOyB9IGNhdGNoICh0KSB7IHIgPSAhMCwgbiA9ICEhdCAmJiB0IHx8IG5ldyBFcnJvcih0KTsgfSBpZiAocikgcmV0dXJuIHRoaXMudW5zdWJzY3JpYmUoKSwgbiB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5pZCwgZSA9IHRoaXMuc2NoZWR1bGVyLCByID0gZS5hY3Rpb25zLCBuID0gci5pbmRleE9mKHRoaXMpOyB0aGlzLndvcmsgPSBudWxsLCB0aGlzLnN0YXRlID0gbnVsbCwgdGhpcy5wZW5kaW5nID0gITEsIHRoaXMuc2NoZWR1bGVyID0gbnVsbCwgLTEgIT09IG4gJiYgci5zcGxpY2UobiwgMSksIG51bGwgIT0gdCAmJiAodGhpcy5pZCA9IHRoaXMucmVjeWNsZUFzeW5jSWQoZSwgdCwgbnVsbCkpLCB0aGlzLmRlbGF5ID0gbnVsbDsgfSwgZSB9KEllLkFjdGlvbikgfSwgTmUgPSB7IFNjaGVkdWxlcjogZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KGUsIHIpIHsgdm9pZCAwID09PSByICYmIChyID0gdC5ub3cpLCB0aGlzLlNjaGVkdWxlckFjdGlvbiA9IGUsIHRoaXMubm93ID0gcjsgfSByZXR1cm4gdC5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gMCksIG5ldyB0aGlzLlNjaGVkdWxlckFjdGlvbih0aGlzLCB0KS5zY2hlZHVsZShyLCBlKSB9LCB0Lm5vdyA9IERhdGUubm93ID8gRGF0ZS5ub3cgOiBmdW5jdGlvbiAoKSB7IHJldHVybiArbmV3IERhdGUgfSwgdCB9KCkgfSwgUGUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwga2UgPSB7IEFzeW5jU2NoZWR1bGVyOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKCkgeyB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuYWN0aW9ucyA9IFtdLCB0aGlzLmFjdGl2ZSA9ICExLCB0aGlzLnNjaGVkdWxlZCA9IHZvaWQgMDsgfSByZXR1cm4gUGUoZSwgdCksIGUucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmFjdGlvbnM7IGlmICh0aGlzLmFjdGl2ZSkgZS5wdXNoKHQpOyBlbHNlIHsgdmFyIHI7IHRoaXMuYWN0aXZlID0gITA7IGRvIHsgaWYgKHIgPSB0LmV4ZWN1dGUodC5zdGF0ZSwgdC5kZWxheSkpIGJyZWFrIH0gd2hpbGUgKHQgPSBlLnNoaWZ0KCkpOyBpZiAodGhpcy5hY3RpdmUgPSAhMSwgcikgeyBmb3IgKDsgdCA9IGUuc2hpZnQoKTspdC51bnN1YnNjcmliZSgpOyB0aHJvdyByIH0gfSB9LCBlIH0oTmUuU2NoZWR1bGVyKSB9LCBWZSA9IHsgYXN5bmM6IG5ldyBrZS5Bc3luY1NjaGVkdWxlcihDZS5Bc3luY0FjdGlvbikgfSwgRmUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgUmUgPSB7IGludGVydmFsOiB7IEludGVydmFsT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBWZS5hc3luYyksIHQuY2FsbCh0aGlzKSwgdGhpcy5wZXJpb2QgPSBlLCB0aGlzLnNjaGVkdWxlciA9IHIsICghamUuaXNOdW1lcmljKGUpIHx8IGUgPCAwKSAmJiAodGhpcy5wZXJpb2QgPSAwKSwgciAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiByLnNjaGVkdWxlIHx8ICh0aGlzLnNjaGVkdWxlciA9IFZlLmFzeW5jKTsgfSByZXR1cm4gRmUoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gdCAmJiAodCA9IDApLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBWZS5hc3luYyksIG5ldyBlKHQsIHIpIH0sIGUuZGlzcGF0Y2ggPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHQuaW5kZXgsIHIgPSB0LnN1YnNjcmliZXIsIG4gPSB0LnBlcmlvZDsgci5uZXh0KGUpLCByLmNsb3NlZCB8fCAodC5pbmRleCArPSAxLCB0aGlzLnNjaGVkdWxlKHQsIG4pKTsgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gdGhpcy5wZXJpb2QsIG4gPSB0aGlzLnNjaGVkdWxlcjsgdC5hZGQobi5zY2hlZHVsZShlLmRpc3BhdGNoLCByLCB7IGluZGV4OiAwLCBzdWJzY3JpYmVyOiB0LCBwZXJpb2Q6IHIgfSkpOyB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LkludGVydmFsT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLmludGVydmFsID0gUmUuaW50ZXJ2YWw7IHZhciBNZSA9IHsgbWVyZ2U6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgdmFyIHIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIG4gPSBudWxsLCBpID0gdFt0Lmxlbmd0aCAtIDFdOyByZXR1cm4gdHQuaXNTY2hlZHVsZXIoaSkgPyAobiA9IHQucG9wKCksIHQubGVuZ3RoID4gMSAmJiAibnVtYmVyIiA9PSB0eXBlb2YgdFt0Lmxlbmd0aCAtIDFdICYmIChyID0gdC5wb3AoKSkpIDogIm51bWJlciIgPT0gdHlwZW9mIGkgJiYgKHIgPSB0LnBvcCgpKSwgbnVsbCA9PT0gbiAmJiAxID09PSB0Lmxlbmd0aCAmJiB0WzBdIGluc3RhbmNlb2YgTi5PYnNlcnZhYmxlID8gdFswXSA6IGVlLm1lcmdlQWxsKHIpKG5ldyBzdC5BcnJheU9ic2VydmFibGUodCwgbikpIH0gfTsgTi5PYnNlcnZhYmxlLm1lcmdlID0gTWUubWVyZ2U7IHZhciBXZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgcWUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspdFtlIC0gMF0gPSBhcmd1bWVudHNbZV07IGlmICgxID09PSB0Lmxlbmd0aCkgeyBpZiAoIXUuaXNBcnJheSh0WzBdKSkgcmV0dXJuIHRbMF07IHQgPSB0WzBdOyB9IHJldHVybiBuZXcgc3QuQXJyYXlPYnNlcnZhYmxlKHQpLmxpZnQobmV3IExlKSB9LCBMZSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCgpIHsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgemUodCkpIH0sIHQgfSgpLCBVZSA9IExlLCB6ZSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSkgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuaGFzRmlyc3QgPSAhMSwgdGhpcy5vYnNlcnZhYmxlcyA9IFtdLCB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTsgfSByZXR1cm4gV2UoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5vYnNlcnZhYmxlcy5wdXNoKHQpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5vYnNlcnZhYmxlcywgZSA9IHQubGVuZ3RoOyBpZiAoMCA9PT0gZSkgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyBlbHNlIHsgZm9yICh2YXIgciA9IDA7IHIgPCBlICYmICF0aGlzLmhhc0ZpcnN0OyByKyspIHsgdmFyIG4gPSB0W3JdLCBpID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgbiwgbiwgcik7IHRoaXMuc3Vic2NyaXB0aW9ucyAmJiB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChpKSwgdGhpcy5hZGQoaSk7IH0gdGhpcy5vYnNlcnZhYmxlcyA9IG51bGw7IH0gfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IGlmICghdGhpcy5oYXNGaXJzdCkgeyB0aGlzLmhhc0ZpcnN0ID0gITA7IGZvciAodmFyIG8gPSAwOyBvIDwgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aDsgbysrKWlmIChvICE9PSByKSB7IHZhciBzID0gdGhpcy5zdWJzY3JpcHRpb25zW29dOyBzLnVuc3Vic2NyaWJlKCksIHRoaXMucmVtb3ZlKHMpOyB9IHRoaXMuc3Vic2NyaXB0aW9ucyA9IG51bGw7IH0gdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgQmUgPSB7IHJhY2U6IHFlLCBSYWNlT3BlcmF0b3I6IFVlLCBSYWNlU3Vic2NyaWJlcjogemUgfTsgTi5PYnNlcnZhYmxlLnJhY2UgPSBCZS5yYWNlOyB2YXIgRGUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgWWUgPSB7IG5ldmVyOiB7IE5ldmVyT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5jYWxsKHRoaXMpOyB9IHJldHVybiBEZShlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgZSB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgSS5ub29wKCk7IH0sIGUgfShOLk9ic2VydmFibGUpIH0uTmV2ZXJPYnNlcnZhYmxlLmNyZWF0ZSB9OyBOLk9ic2VydmFibGUubmV2ZXIgPSBZZS5uZXZlciwgTi5PYnNlcnZhYmxlLm9mID0gU3Qub2Y7IHZhciBIZSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgWGUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspdFtlIC0gMF0gPSBhcmd1bWVudHNbZV07IHJldHVybiAxID09PSB0Lmxlbmd0aCAmJiB1LmlzQXJyYXkodFswXSkgJiYgKHQgPSB0WzBdKSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgSmUodCkpIH0gfTsgdmFyIEdlID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyB2YXIgciA9IG51bGw7IHJldHVybiAxID09PSB0Lmxlbmd0aCAmJiB1LmlzQXJyYXkodFswXSkgJiYgKHQgPSB0WzBdKSwgciA9IHQuc2hpZnQoKSwgbmV3IEh0LkZyb21PYnNlcnZhYmxlKHIsIG51bGwpLmxpZnQobmV3IEplKHQpKSB9LCBKZSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMubmV4dFNvdXJjZXMgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBLZSh0LCB0aGlzLm5leHRTb3VyY2VzKSkgfSwgdCB9KCksIEtlID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5kZXN0aW5hdGlvbiA9IGUsIHRoaXMubmV4dFNvdXJjZXMgPSByOyB9IHJldHVybiBIZShlLCB0KSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgeyB0aGlzLnN1YnNjcmliZVRvTmV4dFNvdXJjZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuc3Vic2NyaWJlVG9OZXh0U291cmNlKCk7IH0sIGUucHJvdG90eXBlLl9lcnJvciA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuc3Vic2NyaWJlVG9OZXh0U291cmNlKCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5zdWJzY3JpYmVUb05leHRTb3VyY2UoKTsgfSwgZS5wcm90b3R5cGUuc3Vic2NyaWJlVG9OZXh0U291cmNlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMubmV4dFNvdXJjZXMuc2hpZnQoKTsgdCA/IHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHQpKSA6IHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksICRlID0geyBvbkVycm9yUmVzdW1lTmV4dDogWGUsIG9uRXJyb3JSZXN1bWVOZXh0U3RhdGljOiBHZSB9LCBRZSA9IHsgb25FcnJvclJlc3VtZU5leHQ6ICRlLm9uRXJyb3JSZXN1bWVOZXh0U3RhdGljIH07IE4uT2JzZXJ2YWJsZS5vbkVycm9yUmVzdW1lTmV4dCA9IFFlLm9uRXJyb3JSZXN1bWVOZXh0OyB2YXIgWmUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgZnVuY3Rpb24gdHIodCkgeyB2YXIgZSA9IHQub2JqLCByID0gdC5rZXlzLCBuID0gdC5sZW5ndGgsIGkgPSB0LmluZGV4LCBvID0gdC5zdWJzY3JpYmVyOyBpZiAoaSAhPT0gbikgeyB2YXIgcyA9IHJbaV07IG8ubmV4dChbcywgZVtzXV0pLCB0LmluZGV4ID0gaSArIDEsIHRoaXMuc2NoZWR1bGUodCk7IH0gZWxzZSBvLmNvbXBsZXRlKCk7IH0gdmFyIGVyID0geyBwYWlyczogeyBQYWlyc09ic2VydmFibGU6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMub2JqID0gZSwgdGhpcy5zY2hlZHVsZXIgPSByLCB0aGlzLmtleXMgPSBPYmplY3Qua2V5cyhlKTsgfSByZXR1cm4gWmUoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIpIHsgcmV0dXJuIG5ldyBlKHQsIHIpIH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMua2V5cywgciA9IHRoaXMuc2NoZWR1bGVyLCBuID0gZS5sZW5ndGg7IGlmIChyKSByZXR1cm4gci5zY2hlZHVsZSh0ciwgMCwgeyBvYmo6IHRoaXMub2JqLCBrZXlzOiBlLCBsZW5ndGg6IG4sIGluZGV4OiAwLCBzdWJzY3JpYmVyOiB0IH0pOyBmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgeyB2YXIgbyA9IGVbaV07IHQubmV4dChbbywgdGhpcy5vYmpbb11dKTsgfSB0LmNvbXBsZXRlKCk7IH0sIGUgfShOLk9ic2VydmFibGUpIH0uUGFpcnNPYnNlcnZhYmxlLmNyZWF0ZSB9OyBOLk9ic2VydmFibGUucGFpcnMgPSBlci5wYWlyczsgdmFyIHJyID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIG5yID0geyByYW5nZTogeyBSYW5nZU9ic2VydmFibGU6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcyksIHRoaXMuc3RhcnQgPSBlLCB0aGlzLl9jb3VudCA9IHIsIHRoaXMuc2NoZWR1bGVyID0gbjsgfSByZXR1cm4gcnIoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgcmV0dXJuIHZvaWQgMCA9PT0gdCAmJiAodCA9IDApLCB2b2lkIDAgPT09IHIgJiYgKHIgPSAwKSwgbmV3IGUodCwgciwgbikgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5zdGFydCwgciA9IHQuaW5kZXgsIG4gPSB0LmNvdW50LCBpID0gdC5zdWJzY3JpYmVyOyByID49IG4gPyBpLmNvbXBsZXRlKCkgOiAoaS5uZXh0KGUpLCBpLmNsb3NlZCB8fCAodC5pbmRleCA9IHIgKyAxLCB0LnN0YXJ0ID0gZSArIDEsIHRoaXMuc2NoZWR1bGUodCkpKTsgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gMCwgbiA9IHRoaXMuc3RhcnQsIGkgPSB0aGlzLl9jb3VudCwgbyA9IHRoaXMuc2NoZWR1bGVyOyBpZiAobykgcmV0dXJuIG8uc2NoZWR1bGUoZS5kaXNwYXRjaCwgMCwgeyBpbmRleDogciwgY291bnQ6IGksIHN0YXJ0OiBuLCBzdWJzY3JpYmVyOiB0IH0pOyBmb3IgKDsgOykgeyBpZiAocisrID49IGkpIHsgdC5jb21wbGV0ZSgpOyBicmVhayB9IGlmICh0Lm5leHQobisrKSwgdC5jbG9zZWQpIGJyZWFrIH0gfSwgZSB9KE4uT2JzZXJ2YWJsZSkgfS5SYW5nZU9ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5yYW5nZSA9IG5yLnJhbmdlOyB2YXIgaXIgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgb3IgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLnJlc291cmNlRmFjdG9yeSA9IGUsIHRoaXMub2JzZXJ2YWJsZUZhY3RvcnkgPSByOyB9IHJldHVybiBpcihlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgcikgeyByZXR1cm4gbmV3IGUodCwgcikgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlLCByID0gdGhpcy5yZXNvdXJjZUZhY3RvcnksIG4gPSB0aGlzLm9ic2VydmFibGVGYWN0b3J5OyB0cnkgeyByZXR1cm4gZSA9IHIoKSwgbmV3IHNyKHQsIGUsIG4pIH0gY2F0Y2ggKGUpIHsgdC5lcnJvcihlKTsgfSB9LCBlIH0oTi5PYnNlcnZhYmxlKSwgc3IgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnJlc291cmNlID0gciwgdGhpcy5vYnNlcnZhYmxlRmFjdG9yeSA9IG4sIGUuYWRkKHIpLCB0aGlzLnRyeVVzZSgpOyB9IHJldHVybiBpcihlLCB0KSwgZS5wcm90b3R5cGUudHJ5VXNlID0gZnVuY3Rpb24gKCkgeyB0cnkgeyB2YXIgdCA9IHRoaXMub2JzZXJ2YWJsZUZhY3RvcnkuY2FsbCh0aGlzLCB0aGlzLnJlc291cmNlKTsgdCAmJiB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCB0KSk7IH0gY2F0Y2ggKHQpIHsgdGhpcy5fZXJyb3IodCk7IH0gfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIGNyID0geyB1c2luZzogeyBVc2luZ09ic2VydmFibGU6IG9yIH0uVXNpbmdPYnNlcnZhYmxlLmNyZWF0ZSB9OyBOLk9ic2VydmFibGUudXNpbmcgPSBjci51c2luZzsgdmFyIHVyID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIGFyID0geyBfdGhyb3c6IHsgRXJyb3JPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmVycm9yID0gZSwgdGhpcy5zY2hlZHVsZXIgPSByOyB9IHJldHVybiB1cihlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgcikgeyByZXR1cm4gbmV3IGUodCwgcikgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5lcnJvcjsgdC5zdWJzY3JpYmVyLmVycm9yKGUpOyB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0aGlzLmVycm9yLCBuID0gdGhpcy5zY2hlZHVsZXI7IGlmICh0LnN5bmNFcnJvclRocm93YWJsZSA9ICEwLCBuKSByZXR1cm4gbi5zY2hlZHVsZShlLmRpc3BhdGNoLCAwLCB7IGVycm9yOiByLCBzdWJzY3JpYmVyOiB0IH0pOyB0LmVycm9yKHIpOyB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LkVycm9yT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLnRocm93ID0gYXIuX3Rocm93OyB2YXIgaHIgPSB7IGlzRGF0ZTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQgaW5zdGFuY2VvZiBEYXRlICYmICFpc05hTigrdCkgfSB9LCBsciA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBwciA9IHsgdGltZXI6IHsgVGltZXJPYnNlcnZhYmxlOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdm9pZCAwID09PSBlICYmIChlID0gMCksIHQuY2FsbCh0aGlzKSwgdGhpcy5wZXJpb2QgPSAtMSwgdGhpcy5kdWVUaW1lID0gMCwgamUuaXNOdW1lcmljKHIpID8gdGhpcy5wZXJpb2QgPSBOdW1iZXIocikgPCAxID8gMSA6IE51bWJlcihyKSA6IHR0LmlzU2NoZWR1bGVyKHIpICYmIChuID0gciksIHR0LmlzU2NoZWR1bGVyKG4pIHx8IChuID0gVmUuYXN5bmMpLCB0aGlzLnNjaGVkdWxlciA9IG4sIHRoaXMuZHVlVGltZSA9IGhyLmlzRGF0ZShlKSA/ICtlIC0gdGhpcy5zY2hlZHVsZXIubm93KCkgOiBlOyB9IHJldHVybiBscihlLCB0KSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCwgciwgbikgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gMCksIG5ldyBlKHQsIHIsIG4pIH0sIGUuZGlzcGF0Y2ggPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHQuaW5kZXgsIHIgPSB0LnBlcmlvZCwgbiA9IHQuc3Vic2NyaWJlcjsgaWYgKG4ubmV4dChlKSwgIW4uY2xvc2VkKSB7IGlmICgtMSA9PT0gcikgcmV0dXJuIG4uY29tcGxldGUoKTsgdC5pbmRleCA9IGUgKyAxLCB0aGlzLnNjaGVkdWxlKHQsIHIpOyB9IH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgciA9IHRoaXMsIG4gPSByLnBlcmlvZCwgaSA9IHIuZHVlVGltZTsgcmV0dXJuIHIuc2NoZWR1bGVyLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIGksIHsgaW5kZXg6IDAsIHBlcmlvZDogbiwgc3Vic2NyaWJlcjogdCB9KSB9LCBlIH0oTi5PYnNlcnZhYmxlKSB9LlRpbWVyT2JzZXJ2YWJsZS5jcmVhdGUgfTsgTi5PYnNlcnZhYmxlLnRpbWVyID0gcHIudGltZXI7IHZhciBmciA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgYnIgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspdFtlIC0gMF0gPSBhcmd1bWVudHNbZV07IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0LmNhbGwoZHIuYXBwbHkodm9pZCAwLCBbZV0uY29uY2F0KHQpKSkgfSB9OyBmdW5jdGlvbiBkcigpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgdmFyIHIgPSB0W3QubGVuZ3RoIC0gMV07IHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiByICYmIHQucG9wKCksIG5ldyBzdC5BcnJheU9ic2VydmFibGUodCkubGlmdChuZXcgdnIocikpIH0gdmFyIHlyID0gZHIsIHZyID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5wcm9qZWN0ID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgd3IodCwgdGhpcy5wcm9qZWN0KSkgfSwgdCB9KCksIG1yID0gdnIsIHdyID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHZvaWQgMCA9PT0gbiAmJiAobiA9IE9iamVjdC5jcmVhdGUobnVsbCkpLCB0LmNhbGwodGhpcywgZSksIHRoaXMuaXRlcmF0b3JzID0gW10sIHRoaXMuYWN0aXZlID0gMCwgdGhpcy5wcm9qZWN0ID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgciA/IHIgOiBudWxsLCB0aGlzLnZhbHVlcyA9IG47IH0gcmV0dXJuIGZyKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5pdGVyYXRvcnM7IHUuaXNBcnJheSh0KSA/IGUucHVzaChuZXcgT3IodCkpIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgdFtsdC5pdGVyYXRvcl0gPyBlLnB1c2gobmV3IHhyKHRbbHQuaXRlcmF0b3JdKCkpKSA6IGUucHVzaChuZXcgU3IodGhpcy5kZXN0aW5hdGlvbiwgdGhpcywgdCkpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5pdGVyYXRvcnMsIGUgPSB0Lmxlbmd0aDsgaWYgKDAgIT09IGUpIHsgdGhpcy5hY3RpdmUgPSBlOyBmb3IgKHZhciByID0gMDsgciA8IGU7IHIrKykgeyB2YXIgbiA9IHRbcl07IG4uc3RpbGxVbnN1YnNjcmliZWQgPyB0aGlzLmFkZChuLnN1YnNjcmliZShuLCByKSkgOiB0aGlzLmFjdGl2ZS0tOyB9IH0gZWxzZSB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUluYWN0aXZlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmFjdGl2ZS0tLCAwID09PSB0aGlzLmFjdGl2ZSAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLmNoZWNrSXRlcmF0b3JzID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gdGhpcy5pdGVyYXRvcnMsIGUgPSB0Lmxlbmd0aCwgciA9IHRoaXMuZGVzdGluYXRpb24sIG4gPSAwOyBuIDwgZTsgbisrKSB7IGlmICgiZnVuY3Rpb24iID09IHR5cGVvZiAocyA9IHRbbl0pLmhhc1ZhbHVlICYmICFzLmhhc1ZhbHVlKCkpIHJldHVybiB9IHZhciBpID0gITEsIG8gPSBbXTsgZm9yIChuID0gMDsgbiA8IGU7IG4rKykgeyB2YXIgcywgYyA9IChzID0gdFtuXSkubmV4dCgpOyBpZiAocy5oYXNDb21wbGV0ZWQoKSAmJiAoaSA9ICEwKSwgYy5kb25lKSByZXR1cm4gdm9pZCByLmNvbXBsZXRlKCk7IG8ucHVzaChjLnZhbHVlKTsgfSB0aGlzLnByb2plY3QgPyB0aGlzLl90cnlQcm9qZWN0KG8pIDogci5uZXh0KG8pLCBpICYmIHIuY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX3RyeVByb2plY3QgPSBmdW5jdGlvbiAodCkgeyB2YXIgZTsgdHJ5IHsgZSA9IHRoaXMucHJvamVjdC5hcHBseSh0aGlzLCB0KTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgX3IgPSB3ciwgeHIgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLml0ZXJhdG9yID0gdCwgdGhpcy5uZXh0UmVzdWx0ID0gdC5uZXh0KCk7IH0gcmV0dXJuIHQucHJvdG90eXBlLmhhc1ZhbHVlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gITAgfSwgdC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLm5leHRSZXN1bHQ7IHJldHVybiB0aGlzLm5leHRSZXN1bHQgPSB0aGlzLml0ZXJhdG9yLm5leHQoKSwgdCB9LCB0LnByb3RvdHlwZS5oYXNDb21wbGV0ZWQgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5uZXh0UmVzdWx0OyByZXR1cm4gdCAmJiB0LmRvbmUgfSwgdCB9KCksIE9yID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5hcnJheSA9IHQsIHRoaXMuaW5kZXggPSAwLCB0aGlzLmxlbmd0aCA9IDAsIHRoaXMubGVuZ3RoID0gdC5sZW5ndGg7IH0gcmV0dXJuIHQucHJvdG90eXBlW2x0Lml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMgfSwgdC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5pbmRleCsrLCByID0gdGhpcy5hcnJheTsgcmV0dXJuIGUgPCB0aGlzLmxlbmd0aCA/IHsgdmFsdWU6IHJbZV0sIGRvbmU6ICExIH0gOiB7IHZhbHVlOiBudWxsLCBkb25lOiAhMCB9IH0sIHQucHJvdG90eXBlLmhhc1ZhbHVlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5hcnJheS5sZW5ndGggPiB0aGlzLmluZGV4IH0sIHQucHJvdG90eXBlLmhhc0NvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYXJyYXkubGVuZ3RoID09PSB0aGlzLmluZGV4IH0sIHQgfSgpLCBTciA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMucGFyZW50ID0gciwgdGhpcy5vYnNlcnZhYmxlID0gbiwgdGhpcy5zdGlsbFVuc3Vic2NyaWJlZCA9ICEwLCB0aGlzLmJ1ZmZlciA9IFtdLCB0aGlzLmlzQ29tcGxldGUgPSAhMTsgfSByZXR1cm4gZnIoZSwgdCksIGUucHJvdG90eXBlW2x0Lml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMgfSwgZS5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmJ1ZmZlcjsgcmV0dXJuIDAgPT09IHQubGVuZ3RoICYmIHRoaXMuaXNDb21wbGV0ZSA/IHsgdmFsdWU6IG51bGwsIGRvbmU6ICEwIH0gOiB7IHZhbHVlOiB0LnNoaWZ0KCksIGRvbmU6ICExIH0gfSwgZS5wcm90b3R5cGUuaGFzVmFsdWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmJ1ZmZlci5sZW5ndGggPiAwIH0sIGUucHJvdG90eXBlLmhhc0NvbXBsZXRlZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDAgPT09IHRoaXMuYnVmZmVyLmxlbmd0aCAmJiB0aGlzLmlzQ29tcGxldGUgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuYnVmZmVyLmxlbmd0aCA+IDAgPyAodGhpcy5pc0NvbXBsZXRlID0gITAsIHRoaXMucGFyZW50Lm5vdGlmeUluYWN0aXZlKCkpIDogdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5idWZmZXIucHVzaChlKSwgdGhpcy5wYXJlbnQuY2hlY2tJdGVyYXRvcnMoKTsgfSwgZS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHRoaXMub2JzZXJ2YWJsZSwgdGhpcywgZSkgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIGdyID0geyB6aXA6IGJyLCB6aXBTdGF0aWM6IHlyLCBaaXBPcGVyYXRvcjogbXIsIFppcFN1YnNjcmliZXI6IF9yIH0sIFRyID0geyB6aXA6IGdyLnppcFN0YXRpYyB9OyBOLk9ic2VydmFibGUuemlwID0gVHIuemlwOyB2YXIganIgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEVyID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0KSB0aHJvdyBuZXcgVHlwZUVycm9yKCJhcmd1bWVudCBpcyBub3QgYSBmdW5jdGlvbi4gQXJlIHlvdSBsb29raW5nIGZvciBgbWFwVG8oKWA/Iik7IHJldHVybiByLmxpZnQobmV3IElyKHQsIGUpKSB9IH0sIElyID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5wcm9qZWN0ID0gdCwgdGhpcy50aGlzQXJnID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgQ3IodCwgdGhpcy5wcm9qZWN0LCB0aGlzLnRoaXNBcmcpKSB9LCB0IH0oKSwgQXIgPSBJciwgQ3IgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByb2plY3QgPSByLCB0aGlzLmNvdW50ID0gMCwgdGhpcy50aGlzQXJnID0gbiB8fCB0aGlzOyB9IHJldHVybiBqcihlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZTsgdHJ5IHsgZSA9IHRoaXMucHJvamVjdC5jYWxsKHRoaXMudGhpc0FyZywgdCwgdGhpcy5jb3VudCsrKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgTnIgPSB7IG1hcDogRXIsIE1hcE9wZXJhdG9yOiBBciB9LCBQciA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyBmdW5jdGlvbiBrcigpIHsgaWYgKHMucm9vdC5YTUxIdHRwUmVxdWVzdCkgcmV0dXJuIG5ldyBzLnJvb3QuWE1MSHR0cFJlcXVlc3Q7IGlmIChzLnJvb3QuWERvbWFpblJlcXVlc3QpIHJldHVybiBuZXcgcy5yb290LlhEb21haW5SZXF1ZXN0OyB0aHJvdyBuZXcgRXJyb3IoIkNPUlMgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXIiKSB9IGZ1bmN0aW9uIFZyKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IG51bGwpLCBuZXcgWHIoeyBtZXRob2Q6ICJHRVQiLCB1cmw6IHQsIGhlYWRlcnM6IGUgfSkgfSB2YXIgRnIgPSBWcjsgZnVuY3Rpb24gUnIodCwgZSwgcikgeyByZXR1cm4gbmV3IFhyKHsgbWV0aG9kOiAiUE9TVCIsIHVybDogdCwgYm9keTogZSwgaGVhZGVyczogciB9KSB9IHZhciBNciA9IFJyOyBmdW5jdGlvbiBXcih0LCBlKSB7IHJldHVybiBuZXcgWHIoeyBtZXRob2Q6ICJERUxFVEUiLCB1cmw6IHQsIGhlYWRlcnM6IGUgfSkgfSB2YXIgcXIgPSBXcjsgZnVuY3Rpb24gTHIodCwgZSwgcikgeyByZXR1cm4gbmV3IFhyKHsgbWV0aG9kOiAiUFVUIiwgdXJsOiB0LCBib2R5OiBlLCBoZWFkZXJzOiByIH0pIH0gdmFyIFVyID0gTHI7IGZ1bmN0aW9uIHpyKHQsIGUsIHIpIHsgcmV0dXJuIG5ldyBYcih7IG1ldGhvZDogIlBBVENIIiwgdXJsOiB0LCBib2R5OiBlLCBoZWFkZXJzOiByIH0pIH0gdmFyIEJyID0genIsIERyID0gTnIubWFwKChmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdC5yZXNwb25zZSB9KSk7IGZ1bmN0aW9uIFlyKHQsIGUpIHsgcmV0dXJuIERyKG5ldyBYcih7IG1ldGhvZDogIkdFVCIsIHVybDogdCwgcmVzcG9uc2VUeXBlOiAianNvbiIsIGhlYWRlcnM6IGUgfSkpIH0gdmFyIEhyID0gWXIsIFhyID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzKTsgdmFyIHIgPSB7IGFzeW5jOiAhMCwgY3JlYXRlWEhSOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmNyb3NzRG9tYWluID8ga3IuY2FsbCh0aGlzKSA6IGZ1bmN0aW9uICgpIHsgaWYgKHMucm9vdC5YTUxIdHRwUmVxdWVzdCkgcmV0dXJuIG5ldyBzLnJvb3QuWE1MSHR0cFJlcXVlc3Q7IHZhciB0ID0gdm9pZCAwOyB0cnkgeyBmb3IgKHZhciBlID0gWyJNc3htbDIuWE1MSFRUUCIsICJNaWNyb3NvZnQuWE1MSFRUUCIsICJNc3htbDIuWE1MSFRUUC40LjAiXSwgciA9IDA7IHIgPCAzOyByKyspdHJ5IHsgaWYgKHQgPSBlW3JdLCBuZXcgcy5yb290LkFjdGl2ZVhPYmplY3QodCkpIGJyZWFrIH0gY2F0Y2ggKHQpIHsgfSByZXR1cm4gbmV3IHMucm9vdC5BY3RpdmVYT2JqZWN0KHQpIH0gY2F0Y2ggKHQpIHsgdGhyb3cgbmV3IEVycm9yKCJYTUxIdHRwUmVxdWVzdCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3NlciIpIH0gfSgpIH0sIGNyb3NzRG9tYWluOiAhMSwgd2l0aENyZWRlbnRpYWxzOiAhMSwgaGVhZGVyczoge30sIG1ldGhvZDogIkdFVCIsIHJlc3BvbnNlVHlwZTogImpzb24iLCB0aW1lb3V0OiAwIH07IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSkgci51cmwgPSBlOyBlbHNlIGZvciAodmFyIG4gaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShuKSAmJiAocltuXSA9IGVbbl0pOyB0aGlzLnJlcXVlc3QgPSByOyB9IHZhciByOyByZXR1cm4gUHIoZSwgdCksIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IEpyKHQsIHRoaXMucmVxdWVzdCkgfSwgZS5jcmVhdGUgPSAoKHIgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IGUodCkgfSkuZ2V0ID0gVnIsIHIucG9zdCA9IFJyLCByLmRlbGV0ZSA9IFdyLCByLnB1dCA9IExyLCByLnBhdGNoID0genIsIHIuZ2V0SlNPTiA9IFlyLCByKSwgZSB9KE4uT2JzZXJ2YWJsZSksIEdyID0gWHIsIEpyID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5yZXF1ZXN0ID0gciwgdGhpcy5kb25lID0gITE7IHZhciBuID0gci5oZWFkZXJzID0gci5oZWFkZXJzIHx8IHt9OyByLmNyb3NzRG9tYWluIHx8IG5bIlgtUmVxdWVzdGVkLVdpdGgiXSB8fCAoblsiWC1SZXF1ZXN0ZWQtV2l0aCJdID0gIlhNTEh0dHBSZXF1ZXN0IiksICJDb250ZW50LVR5cGUiIGluIG4gfHwgcy5yb290LkZvcm1EYXRhICYmIHIuYm9keSBpbnN0YW5jZW9mIHMucm9vdC5Gb3JtRGF0YSB8fCB2b2lkIDAgPT09IHIuYm9keSB8fCAoblsiQ29udGVudC1UeXBlIl0gPSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiksIHIuYm9keSA9IHRoaXMuc2VyaWFsaXplQm9keShyLmJvZHksIHIuaGVhZGVyc1siQ29udGVudC1UeXBlIl0pLCB0aGlzLnNlbmQoKTsgfSByZXR1cm4gUHIoZSwgdCksIGUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmRvbmUgPSAhMDsgdmFyIGUgPSB0aGlzLCByID0gZS54aHIsIG4gPSBlLnJlcXVlc3QsIGkgPSBlLmRlc3RpbmF0aW9uLCBvID0gbmV3ICRyKHQsIHIsIG4pOyBpLm5leHQobyk7IH0sIGUucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5yZXF1ZXN0LCBlID0gdGhpcy5yZXF1ZXN0LCByID0gZS51c2VyLCBuID0gZS5tZXRob2QsIGkgPSBlLnVybCwgbyA9IGUuYXN5bmMsIHMgPSBlLnBhc3N3b3JkLCBjID0gZS5oZWFkZXJzLCB1ID0gZS5ib2R5LCBhID0gdC5jcmVhdGVYSFIsIGggPSBmLnRyeUNhdGNoKGEpLmNhbGwodCk7IGlmIChoID09PSBsLmVycm9yT2JqZWN0KSB0aGlzLmVycm9yKGwuZXJyb3JPYmplY3QuZSk7IGVsc2UgeyB0aGlzLnhociA9IGgsIHRoaXMuc2V0dXBFdmVudHMoaCwgdCk7IGlmICgociA/IGYudHJ5Q2F0Y2goaC5vcGVuKS5jYWxsKGgsIG4sIGksIG8sIHIsIHMpIDogZi50cnlDYXRjaChoLm9wZW4pLmNhbGwoaCwgbiwgaSwgbykpID09PSBsLmVycm9yT2JqZWN0KSByZXR1cm4gdGhpcy5lcnJvcihsLmVycm9yT2JqZWN0LmUpLCBudWxsOyBpZiAobyAmJiAoaC50aW1lb3V0ID0gdC50aW1lb3V0LCBoLnJlc3BvbnNlVHlwZSA9IHQucmVzcG9uc2VUeXBlKSwgIndpdGhDcmVkZW50aWFscyIgaW4gaCAmJiAoaC53aXRoQ3JlZGVudGlhbHMgPSAhIXQud2l0aENyZWRlbnRpYWxzKSwgdGhpcy5zZXRIZWFkZXJzKGgsIGMpLCAodSA/IGYudHJ5Q2F0Y2goaC5zZW5kKS5jYWxsKGgsIHUpIDogZi50cnlDYXRjaChoLnNlbmQpLmNhbGwoaCkpID09PSBsLmVycm9yT2JqZWN0KSByZXR1cm4gdGhpcy5lcnJvcihsLmVycm9yT2JqZWN0LmUpLCBudWxsIH0gcmV0dXJuIGggfSwgZS5wcm90b3R5cGUuc2VyaWFsaXplQm9keSA9IGZ1bmN0aW9uICh0LCBlKSB7IGlmICghdCB8fCAic3RyaW5nIiA9PSB0eXBlb2YgdCkgcmV0dXJuIHQ7IGlmIChzLnJvb3QuRm9ybURhdGEgJiYgdCBpbnN0YW5jZW9mIHMucm9vdC5Gb3JtRGF0YSkgcmV0dXJuIHQ7IGlmIChlKSB7IHZhciByID0gZS5pbmRleE9mKCI7Iik7IC0xICE9PSByICYmIChlID0gZS5zdWJzdHJpbmcoMCwgcikpOyB9IHN3aXRjaCAoZSkgeyBjYXNlICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOiByZXR1cm4gT2JqZWN0LmtleXModCkubWFwKChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KGUpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHRbZV0pIH0pKS5qb2luKCImIik7IGNhc2UgImFwcGxpY2F0aW9uL2pzb24iOiByZXR1cm4gSlNPTi5zdHJpbmdpZnkodCk7IGRlZmF1bHQ6IHJldHVybiB0IH0gfSwgZS5wcm90b3R5cGUuc2V0SGVhZGVycyA9IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiB0LnNldFJlcXVlc3RIZWFkZXIociwgZVtyXSk7IH0sIGUucHJvdG90eXBlLnNldHVwRXZlbnRzID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHIgPSBlLnByb2dyZXNzU3Vic2NyaWJlcjsgZnVuY3Rpb24gbih0KSB7IHZhciBlID0gbiwgciA9IGUuc3Vic2NyaWJlciwgaSA9IGUucHJvZ3Jlc3NTdWJzY3JpYmVyLCBvID0gZS5yZXF1ZXN0OyBpICYmIGkuZXJyb3IodCksIHIuZXJyb3IobmV3IHJuKHRoaXMsIG8pKTsgfSBpZiAodC5vbnRpbWVvdXQgPSBuLCBuLnJlcXVlc3QgPSBlLCBuLnN1YnNjcmliZXIgPSB0aGlzLCBuLnByb2dyZXNzU3Vic2NyaWJlciA9IHIsIHQudXBsb2FkICYmICJ3aXRoQ3JlZGVudGlhbHMiIGluIHQpIHsgdmFyIGksIG87IGlmIChyKSBpID0gZnVuY3Rpb24gKHQpIHsgaS5wcm9ncmVzc1N1YnNjcmliZXIubmV4dCh0KTsgfSwgcy5yb290LlhEb21haW5SZXF1ZXN0ID8gdC5vbnByb2dyZXNzID0gaSA6IHQudXBsb2FkLm9ucHJvZ3Jlc3MgPSBpLCBpLnByb2dyZXNzU3Vic2NyaWJlciA9IHI7IG8gPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IG8sIHIgPSBlLnByb2dyZXNzU3Vic2NyaWJlciwgbiA9IGUuc3Vic2NyaWJlciwgaSA9IGUucmVxdWVzdDsgciAmJiByLmVycm9yKHQpLCBuLmVycm9yKG5ldyBacigiYWpheCBlcnJvciIsIHRoaXMsIGkpKTsgfSwgdC5vbmVycm9yID0gbywgby5yZXF1ZXN0ID0gZSwgby5zdWJzY3JpYmVyID0gdGhpcywgby5wcm9ncmVzc1N1YnNjcmliZXIgPSByOyB9IGZ1bmN0aW9uIGModCkgeyB2YXIgZSA9IGMsIHIgPSBlLnN1YnNjcmliZXIsIG4gPSBlLnByb2dyZXNzU3Vic2NyaWJlciwgaSA9IGUucmVxdWVzdDsgaWYgKDQgPT09IHRoaXMucmVhZHlTdGF0ZSkgeyB2YXIgbyA9IDEyMjMgPT09IHRoaXMuc3RhdHVzID8gMjA0IDogdGhpcy5zdGF0dXMsIHMgPSAidGV4dCIgPT09IHRoaXMucmVzcG9uc2VUeXBlID8gdGhpcy5yZXNwb25zZSB8fCB0aGlzLnJlc3BvbnNlVGV4dCA6IHRoaXMucmVzcG9uc2U7IDAgPT09IG8gJiYgKG8gPSBzID8gMjAwIDogMCksIDIwMCA8PSBvICYmIG8gPCAzMDAgPyAobiAmJiBuLmNvbXBsZXRlKCksIHIubmV4dCh0KSwgci5jb21wbGV0ZSgpKSA6IChuICYmIG4uZXJyb3IodCksIHIuZXJyb3IobmV3IFpyKCJhamF4IGVycm9yICIgKyBvLCB0aGlzLCBpKSkpOyB9IH0gdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjLCBjLnN1YnNjcmliZXIgPSB0aGlzLCBjLnByb2dyZXNzU3Vic2NyaWJlciA9IHIsIGMucmVxdWVzdCA9IGU7IH0sIGUucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuZG9uZSwgciA9IHRoaXMueGhyOyAhZSAmJiByICYmIDQgIT09IHIucmVhZHlTdGF0ZSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiByLmFib3J0ICYmIHIuYWJvcnQoKSwgdC5wcm90b3R5cGUudW5zdWJzY3JpYmUuY2FsbCh0aGlzKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIEtyID0gSnIsICRyID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgdGhpcy5vcmlnaW5hbEV2ZW50ID0gdCwgdGhpcy54aHIgPSBlLCB0aGlzLnJlcXVlc3QgPSByLCB0aGlzLnN0YXR1cyA9IGUuc3RhdHVzLCB0aGlzLnJlc3BvbnNlVHlwZSA9IGUucmVzcG9uc2VUeXBlIHx8IHIucmVzcG9uc2VUeXBlLCB0aGlzLnJlc3BvbnNlID0gZW4odGhpcy5yZXNwb25zZVR5cGUsIGUpOyB9LCBRciA9ICRyLCBaciA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMubWVzc2FnZSA9IGUsIHRoaXMueGhyID0gciwgdGhpcy5yZXF1ZXN0ID0gbiwgdGhpcy5zdGF0dXMgPSByLnN0YXR1cywgdGhpcy5yZXNwb25zZVR5cGUgPSByLnJlc3BvbnNlVHlwZSB8fCBuLnJlc3BvbnNlVHlwZSwgdGhpcy5yZXNwb25zZSA9IGVuKHRoaXMucmVzcG9uc2VUeXBlLCByKTsgfSByZXR1cm4gUHIoZSwgdCksIGUgfShFcnJvciksIHRuID0gWnI7IGZ1bmN0aW9uIGVuKHQsIGUpIHsgc3dpdGNoICh0KSB7IGNhc2UgImpzb24iOiByZXR1cm4gInJlc3BvbnNlIiBpbiBlID8gZS5yZXNwb25zZVR5cGUgPyBlLnJlc3BvbnNlIDogSlNPTi5wYXJzZShlLnJlc3BvbnNlIHx8IGUucmVzcG9uc2VUZXh0IHx8ICJudWxsIikgOiBKU09OLnBhcnNlKGUucmVzcG9uc2VUZXh0IHx8ICJudWxsIik7IGNhc2UgInhtbCI6IHJldHVybiBlLnJlc3BvbnNlWE1MOyBjYXNlICJ0ZXh0IjogZGVmYXVsdDogcmV0dXJuICJyZXNwb25zZSIgaW4gZSA/IGUucmVzcG9uc2UgOiBlLnJlc3BvbnNlVGV4dCB9IH0gdmFyIHJuID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCAiYWpheCB0aW1lb3V0IiwgZSwgcik7IH0gcmV0dXJuIFByKGUsIHQpLCBlIH0oWnIpLCBubiA9IHsgYWpheEdldDogRnIsIGFqYXhQb3N0OiBNciwgYWpheERlbGV0ZTogcXIsIGFqYXhQdXQ6IFVyLCBhamF4UGF0Y2g6IEJyLCBhamF4R2V0SlNPTjogSHIsIEFqYXhPYnNlcnZhYmxlOiBHciwgQWpheFN1YnNjcmliZXI6IEtyLCBBamF4UmVzcG9uc2U6IFFyLCBBamF4RXJyb3I6IHRuLCBBamF4VGltZW91dEVycm9yOiBybiB9LCBvbiA9IHsgYWpheDogbm4uQWpheE9ic2VydmFibGUuY3JlYXRlIH07IE4uT2JzZXJ2YWJsZS5hamF4ID0gb24uYWpheDsgdmFyIHNuID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIGNuID0geyBRdWV1ZUFjdGlvbjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlLCByKSwgdGhpcy5zY2hlZHVsZXIgPSBlLCB0aGlzLndvcmsgPSByOyB9IHJldHVybiBzbihlLCB0KSwgZS5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAoZSwgcikgeyByZXR1cm4gdm9pZCAwID09PSByICYmIChyID0gMCksIHIgPiAwID8gdC5wcm90b3R5cGUuc2NoZWR1bGUuY2FsbCh0aGlzLCBlLCByKSA6ICh0aGlzLmRlbGF5ID0gciwgdGhpcy5zdGF0ZSA9IGUsIHRoaXMuc2NoZWR1bGVyLmZsdXNoKHRoaXMpLCB0aGlzKSB9LCBlLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gKGUsIHIpIHsgcmV0dXJuIHIgPiAwIHx8IHRoaXMuY2xvc2VkID8gdC5wcm90b3R5cGUuZXhlY3V0ZS5jYWxsKHRoaXMsIGUsIHIpIDogdGhpcy5fZXhlY3V0ZShlLCByKSB9LCBlLnByb3RvdHlwZS5yZXF1ZXN0QXN5bmNJZCA9IGZ1bmN0aW9uIChlLCByLCBuKSB7IHJldHVybiB2b2lkIDAgPT09IG4gJiYgKG4gPSAwKSwgbnVsbCAhPT0gbiAmJiBuID4gMCB8fCBudWxsID09PSBuICYmIHRoaXMuZGVsYXkgPiAwID8gdC5wcm90b3R5cGUucmVxdWVzdEFzeW5jSWQuY2FsbCh0aGlzLCBlLCByLCBuKSA6IGUuZmx1c2godGhpcykgfSwgZSB9KENlLkFzeW5jQWN0aW9uKSB9LCB1biA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBhbiA9IHsgcXVldWU6IG5ldyAoeyBRdWV1ZVNjaGVkdWxlcjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiB1bihlLCB0KSwgZSB9KGtlLkFzeW5jU2NoZWR1bGVyKSB9LlF1ZXVlU2NoZWR1bGVyKShjbi5RdWV1ZUFjdGlvbikgfSwgaG4gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgbG4gPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdm9pZCAwID09PSBlICYmIChlID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgdm9pZCAwID09PSByICYmIChyID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgdC5jYWxsKHRoaXMpLCB0aGlzLnNjaGVkdWxlciA9IG4sIHRoaXMuX2V2ZW50cyA9IFtdLCB0aGlzLl9idWZmZXJTaXplID0gZSA8IDEgPyAxIDogZSwgdGhpcy5fd2luZG93VGltZSA9IHIgPCAxID8gMSA6IHI7IH0gcmV0dXJuIGhuKGUsIHQpLCBlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSB0aGlzLl9nZXROb3coKTsgdGhpcy5fZXZlbnRzLnB1c2gobmV3IHBuKHIsIGUpKSwgdGhpcy5fdHJpbUJ1ZmZlclRoZW5HZXRFdmVudHMoKSwgdC5wcm90b3R5cGUubmV4dC5jYWxsKHRoaXMsIGUpOyB9LCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUsIHIgPSB0aGlzLl90cmltQnVmZmVyVGhlbkdldEV2ZW50cygpLCBuID0gdGhpcy5zY2hlZHVsZXI7IGlmICh0aGlzLmNsb3NlZCkgdGhyb3cgbmV3IGsuT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I7IHRoaXMuaGFzRXJyb3IgfHwgdGhpcy5pc1N0b3BwZWQgPyBlID0gdi5TdWJzY3JpcHRpb24uRU1QVFkgOiAodGhpcy5vYnNlcnZlcnMucHVzaCh0KSwgZSA9IG5ldyBGLlN1YmplY3RTdWJzY3JpcHRpb24odGhpcywgdCkpLCBuICYmIHQuYWRkKHQgPSBuZXcgRHQuT2JzZXJ2ZU9uU3Vic2NyaWJlcih0LCBuKSk7IGZvciAodmFyIGkgPSByLmxlbmd0aCwgbyA9IDA7IG8gPCBpICYmICF0LmNsb3NlZDsgbysrKXQubmV4dChyW29dLnZhbHVlKTsgcmV0dXJuIHRoaXMuaGFzRXJyb3IgPyB0LmVycm9yKHRoaXMudGhyb3duRXJyb3IpIDogdGhpcy5pc1N0b3BwZWQgJiYgdC5jb21wbGV0ZSgpLCBlIH0sIGUucHJvdG90eXBlLl9nZXROb3cgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAodGhpcy5zY2hlZHVsZXIgfHwgYW4ucXVldWUpLm5vdygpIH0sIGUucHJvdG90eXBlLl90cmltQnVmZmVyVGhlbkdldEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IHRoaXMuX2dldE5vdygpLCBlID0gdGhpcy5fYnVmZmVyU2l6ZSwgciA9IHRoaXMuX3dpbmRvd1RpbWUsIG4gPSB0aGlzLl9ldmVudHMsIGkgPSBuLmxlbmd0aCwgbyA9IDA7IG8gPCBpICYmICEodCAtIG5bb10udGltZSA8IHIpOylvKys7IHJldHVybiBpID4gZSAmJiAobyA9IE1hdGgubWF4KG8sIGkgLSBlKSksIG8gPiAwICYmIG4uc3BsaWNlKDAsIG8pLCBuIH0sIGUgfSh6LlN1YmplY3QpLCBwbiA9IGZ1bmN0aW9uICh0LCBlKSB7IHRoaXMudGltZSA9IHQsIHRoaXMudmFsdWUgPSBlOyB9LCBmbiA9IHsgUmVwbGF5U3ViamVjdDogbG4gfTsgZnVuY3Rpb24gYm4odCkgeyBmb3IgKHZhciBlID0gW10sIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKWVbciAtIDFdID0gYXJndW1lbnRzW3JdOyBmb3IgKHZhciBuID0gZS5sZW5ndGgsIGkgPSAwOyBpIDwgbjsgaSsrKSB7IHZhciBvID0gZVtpXTsgZm9yICh2YXIgcyBpbiBvKSBvLmhhc093blByb3BlcnR5KHMpICYmICh0W3NdID0gb1tzXSk7IH0gcmV0dXJuIHQgfSBmdW5jdGlvbiBkbih0KSB7IHJldHVybiB0Lk9iamVjdC5hc3NpZ24gfHwgYm4gfSB2YXIgeW4gPSB7IGFzc2lnbkltcGw6IGJuLCBnZXRBc3NpZ246IGRuLCBhc3NpZ246IGRuKHMucm9vdCkgfSwgdm4gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgbW4gPSB7IHdlYlNvY2tldDogeyBXZWJTb2NrZXRTdWJqZWN0OiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgaWYgKGUgaW5zdGFuY2VvZiBOLk9ic2VydmFibGUpIHQuY2FsbCh0aGlzLCByLCBlKTsgZWxzZSB7IGlmICh0LmNhbGwodGhpcyksIHRoaXMuV2ViU29ja2V0Q3RvciA9IHMucm9vdC5XZWJTb2NrZXQsIHRoaXMuX291dHB1dCA9IG5ldyB6LlN1YmplY3QsICJzdHJpbmciID09IHR5cGVvZiBlID8gdGhpcy51cmwgPSBlIDogeW4uYXNzaWduKHRoaXMsIGUpLCAhdGhpcy5XZWJTb2NrZXRDdG9yKSB0aHJvdyBuZXcgRXJyb3IoIm5vIFdlYlNvY2tldCBjb25zdHJ1Y3RvciBjYW4gYmUgZm91bmQiKTsgdGhpcy5kZXN0aW5hdGlvbiA9IG5ldyBmbi5SZXBsYXlTdWJqZWN0OyB9IH0gcmV0dXJuIHZuKGUsIHQpLCBlLnByb3RvdHlwZS5yZXN1bHRTZWxlY3RvciA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBKU09OLnBhcnNlKHQuZGF0YSkgfSwgZS5jcmVhdGUgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gbmV3IGUodCkgfSwgZS5wcm90b3R5cGUubGlmdCA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gbmV3IGUodGhpcywgdGhpcy5kZXN0aW5hdGlvbik7IHJldHVybiByLm9wZXJhdG9yID0gdCwgciB9LCBlLnByb3RvdHlwZS5fcmVzZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5zb2NrZXQgPSBudWxsLCB0aGlzLnNvdXJjZSB8fCAodGhpcy5kZXN0aW5hdGlvbiA9IG5ldyBmbi5SZXBsYXlTdWJqZWN0KSwgdGhpcy5fb3V0cHV0ID0gbmV3IHouU3ViamVjdDsgfSwgZS5wcm90b3R5cGUubXVsdGlwbGV4ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgdmFyIG4gPSB0aGlzOyByZXR1cm4gbmV3IE4uT2JzZXJ2YWJsZSgoZnVuY3Rpb24gKGkpIHsgdmFyIG8gPSBmLnRyeUNhdGNoKHQpKCk7IG8gPT09IGwuZXJyb3JPYmplY3QgPyBpLmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiBuLm5leHQobyk7IHZhciBzID0gbi5zdWJzY3JpYmUoKGZ1bmN0aW9uICh0KSB7IHZhciBlID0gZi50cnlDYXRjaChyKSh0KTsgZSA9PT0gbC5lcnJvck9iamVjdCA/IGkuZXJyb3IobC5lcnJvck9iamVjdC5lKSA6IGUgJiYgaS5uZXh0KHQpOyB9KSwgKGZ1bmN0aW9uICh0KSB7IHJldHVybiBpLmVycm9yKHQpIH0pLCAoZnVuY3Rpb24gKCkgeyByZXR1cm4gaS5jb21wbGV0ZSgpIH0pKTsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBmLnRyeUNhdGNoKGUpKCk7IHQgPT09IGwuZXJyb3JPYmplY3QgPyBpLmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiBuLm5leHQodCksIHMudW5zdWJzY3JpYmUoKTsgfSB9KSkgfSwgZS5wcm90b3R5cGUuX2Nvbm5lY3RTb2NrZXQgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgZSA9IHRoaXMuV2ViU29ja2V0Q3RvciwgciA9IHRoaXMuX291dHB1dCwgbiA9IG51bGw7IHRyeSB7IG4gPSB0aGlzLnByb3RvY29sID8gbmV3IGUodGhpcy51cmwsIHRoaXMucHJvdG9jb2wpIDogbmV3IGUodGhpcy51cmwpLCB0aGlzLnNvY2tldCA9IG4sIHRoaXMuYmluYXJ5VHlwZSAmJiAodGhpcy5zb2NrZXQuYmluYXJ5VHlwZSA9IHRoaXMuYmluYXJ5VHlwZSk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgci5lcnJvcih0KSB9IHZhciBpID0gbmV3IHYuU3Vic2NyaXB0aW9uKChmdW5jdGlvbiAoKSB7IHQuc29ja2V0ID0gbnVsbCwgbiAmJiAxID09PSBuLnJlYWR5U3RhdGUgJiYgbi5jbG9zZSgpOyB9KSk7IG4ub25vcGVuID0gZnVuY3Rpb24gKGUpIHsgdmFyIG8gPSB0Lm9wZW5PYnNlcnZlcjsgbyAmJiBvLm5leHQoZSk7IHZhciBzID0gdC5kZXN0aW5hdGlvbjsgdC5kZXN0aW5hdGlvbiA9IFQuU3Vic2NyaWJlci5jcmVhdGUoKGZ1bmN0aW9uICh0KSB7IHJldHVybiAxID09PSBuLnJlYWR5U3RhdGUgJiYgbi5zZW5kKHQpIH0pLCAoZnVuY3Rpb24gKGUpIHsgdmFyIGkgPSB0LmNsb3NpbmdPYnNlcnZlcjsgaSAmJiBpLm5leHQodm9pZCAwKSwgZSAmJiBlLmNvZGUgPyBuLmNsb3NlKGUuY29kZSwgZS5yZWFzb24pIDogci5lcnJvcihuZXcgVHlwZUVycm9yKCJXZWJTb2NrZXRTdWJqZWN0LmVycm9yIG11c3QgYmUgY2FsbGVkIHdpdGggYW4gb2JqZWN0IHdpdGggYW4gZXJyb3IgY29kZSwgYW5kIGFuIG9wdGlvbmFsIHJlYXNvbjogeyBjb2RlOiBudW1iZXIsIHJlYXNvbjogc3RyaW5nIH0iKSksIHQuX3Jlc2V0U3RhdGUoKTsgfSksIChmdW5jdGlvbiAoKSB7IHZhciBlID0gdC5jbG9zaW5nT2JzZXJ2ZXI7IGUgJiYgZS5uZXh0KHZvaWQgMCksIG4uY2xvc2UoKSwgdC5fcmVzZXRTdGF0ZSgpOyB9KSksIHMgJiYgcyBpbnN0YW5jZW9mIGZuLlJlcGxheVN1YmplY3QgJiYgaS5hZGQocy5zdWJzY3JpYmUodC5kZXN0aW5hdGlvbikpOyB9LCBuLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB0Ll9yZXNldFN0YXRlKCksIHIuZXJyb3IoZSk7IH0sIG4ub25jbG9zZSA9IGZ1bmN0aW9uIChlKSB7IHQuX3Jlc2V0U3RhdGUoKTsgdmFyIG4gPSB0LmNsb3NlT2JzZXJ2ZXI7IG4gJiYgbi5uZXh0KGUpLCBlLndhc0NsZWFuID8gci5jb21wbGV0ZSgpIDogci5lcnJvcihlKTsgfSwgbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgeyB2YXIgbiA9IGYudHJ5Q2F0Y2godC5yZXN1bHRTZWxlY3RvcikoZSk7IG4gPT09IGwuZXJyb3JPYmplY3QgPyByLmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiByLm5leHQobik7IH07IH0sIGUucHJvdG90eXBlLl9zdWJzY3JpYmUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMsIHIgPSB0aGlzLnNvdXJjZTsgaWYgKHIpIHJldHVybiByLnN1YnNjcmliZSh0KTsgdGhpcy5zb2NrZXQgfHwgdGhpcy5fY29ubmVjdFNvY2tldCgpOyB2YXIgbiA9IG5ldyB2LlN1YnNjcmlwdGlvbjsgcmV0dXJuIG4uYWRkKHRoaXMuX291dHB1dC5zdWJzY3JpYmUodCkpLCBuLmFkZCgoZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGUuc29ja2V0OyAwID09PSBlLl9vdXRwdXQub2JzZXJ2ZXJzLmxlbmd0aCAmJiAodCAmJiAxID09PSB0LnJlYWR5U3RhdGUgJiYgdC5jbG9zZSgpLCBlLl9yZXNldFN0YXRlKCkpOyB9KSksIG4gfSwgZS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5zb3VyY2UsIHIgPSB0aGlzLnNvY2tldDsgciAmJiAxID09PSByLnJlYWR5U3RhdGUgJiYgKHIuY2xvc2UoKSwgdGhpcy5fcmVzZXRTdGF0ZSgpKSwgdC5wcm90b3R5cGUudW5zdWJzY3JpYmUuY2FsbCh0aGlzKSwgZSB8fCAodGhpcy5kZXN0aW5hdGlvbiA9IG5ldyBmbi5SZXBsYXlTdWJqZWN0KTsgfSwgZSB9KHouQW5vbnltb3VzU3ViamVjdCkgfS5XZWJTb2NrZXRTdWJqZWN0LmNyZWF0ZSB9OyBOLk9ic2VydmFibGUud2ViU29ja2V0ID0gbW4ud2ViU29ja2V0OyB2YXIgd24gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIF9uID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IHhuKHQpKSB9IH0sIHhuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5jbG9zaW5nTm90aWZpZXIgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBPbih0LCB0aGlzLmNsb3NpbmdOb3RpZmllcikpIH0sIHQgfSgpLCBPbiA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYnVmZmVyID0gW10sIHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHIpKTsgfSByZXR1cm4gd24oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5idWZmZXIucHVzaCh0KTsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHZhciBvID0gdGhpcy5idWZmZXI7IHRoaXMuYnVmZmVyID0gW10sIHRoaXMuZGVzdGluYXRpb24ubmV4dChvKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIFNuID0geyBidWZmZXI6IF9uIH07IHZhciBnbiA9IHsgYnVmZmVyOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gU24uYnVmZmVyKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5idWZmZXIgPSBnbi5idWZmZXI7IHZhciBUbiA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgam4gPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gbnVsbCksIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IEVuKHQsIGUpKSB9IH0sIEVuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5idWZmZXJTaXplID0gdCwgdGhpcy5zdGFydEJ1ZmZlckV2ZXJ5ID0gZSwgdGhpcy5zdWJzY3JpYmVyQ2xhc3MgPSBlICYmIHQgIT09IGUgPyBBbiA6IEluOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyB0aGlzLnN1YnNjcmliZXJDbGFzcyh0LCB0aGlzLmJ1ZmZlclNpemUsIHRoaXMuc3RhcnRCdWZmZXJFdmVyeSkpIH0sIHQgfSgpLCBJbiA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYnVmZmVyU2l6ZSA9IHIsIHRoaXMuYnVmZmVyID0gW107IH0gcmV0dXJuIFRuKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5idWZmZXI7IGUucHVzaCh0KSwgZS5sZW5ndGggPT0gdGhpcy5idWZmZXJTaXplICYmICh0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSksIHRoaXMuYnVmZmVyID0gW10pOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5idWZmZXI7IGUubGVuZ3RoID4gMCAmJiB0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSksIHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgQW4gPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmJ1ZmZlclNpemUgPSByLCB0aGlzLnN0YXJ0QnVmZmVyRXZlcnkgPSBuLCB0aGlzLmJ1ZmZlcnMgPSBbXSwgdGhpcy5jb3VudCA9IDA7IH0gcmV0dXJuIFRuKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcywgciA9IGUuYnVmZmVyU2l6ZSwgbiA9IGUuc3RhcnRCdWZmZXJFdmVyeSwgaSA9IGUuYnVmZmVycywgbyA9IGUuY291bnQ7IHRoaXMuY291bnQrKywgbyAlIG4gPT0gMCAmJiBpLnB1c2goW10pOyBmb3IgKHZhciBzID0gaS5sZW5ndGg7IHMtLTspIHsgdmFyIGMgPSBpW3NdOyBjLnB1c2godCksIGMubGVuZ3RoID09PSByICYmIChpLnNwbGljZShzLCAxKSwgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGMpKTsgfSB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IGZvciAodmFyIGUgPSB0aGlzLmJ1ZmZlcnMsIHIgPSB0aGlzLmRlc3RpbmF0aW9uOyBlLmxlbmd0aCA+IDA7KSB7IHZhciBuID0gZS5zaGlmdCgpOyBuLmxlbmd0aCA+IDAgJiYgci5uZXh0KG4pOyB9IHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgQ24gPSB7IGJ1ZmZlckNvdW50OiBqbiB9OyB2YXIgTm4gPSB7IGJ1ZmZlckNvdW50OiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gbnVsbCksIENuLmJ1ZmZlckNvdW50KHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5idWZmZXJDb3VudCA9IE5uLmJ1ZmZlckNvdW50OyB2YXIgUG4gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIGtuID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gVmUuYXN5bmM7IHR0LmlzU2NoZWR1bGVyKGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0pICYmIChyID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSwgZS0tKTsgdmFyIG4gPSBudWxsOyBlID49IDIgJiYgKG4gPSBhcmd1bWVudHNbMV0pOyB2YXIgaSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsgcmV0dXJuIGUgPj0gMyAmJiAoaSA9IGFyZ3VtZW50c1syXSksIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IFZuKHQsIG4sIGksIHIpKSB9IH0sIFZuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy5idWZmZXJUaW1lU3BhbiA9IHQsIHRoaXMuYnVmZmVyQ3JlYXRpb25JbnRlcnZhbCA9IGUsIHRoaXMubWF4QnVmZmVyU2l6ZSA9IHIsIHRoaXMuc2NoZWR1bGVyID0gbjsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgUm4odCwgdGhpcy5idWZmZXJUaW1lU3BhbiwgdGhpcy5idWZmZXJDcmVhdGlvbkludGVydmFsLCB0aGlzLm1heEJ1ZmZlclNpemUsIHRoaXMuc2NoZWR1bGVyKSkgfSwgdCB9KCksIEZuID0gZnVuY3Rpb24gKCkgeyB0aGlzLmJ1ZmZlciA9IFtdOyB9LCBSbiA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSwgbykgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYnVmZmVyVGltZVNwYW4gPSByLCB0aGlzLmJ1ZmZlckNyZWF0aW9uSW50ZXJ2YWwgPSBuLCB0aGlzLm1heEJ1ZmZlclNpemUgPSBpLCB0aGlzLnNjaGVkdWxlciA9IG8sIHRoaXMuY29udGV4dHMgPSBbXTsgdmFyIHMgPSB0aGlzLm9wZW5Db250ZXh0KCk7IGlmICh0aGlzLnRpbWVzcGFuT25seSA9IG51bGwgPT0gbiB8fCBuIDwgMCwgdGhpcy50aW1lc3Bhbk9ubHkpIHsgdmFyIGMgPSB7IHN1YnNjcmliZXI6IHRoaXMsIGNvbnRleHQ6IHMsIGJ1ZmZlclRpbWVTcGFuOiByIH07IHRoaXMuYWRkKHMuY2xvc2VBY3Rpb24gPSBvLnNjaGVkdWxlKE1uLCByLCBjKSk7IH0gZWxzZSB7IHZhciB1ID0geyBzdWJzY3JpYmVyOiB0aGlzLCBjb250ZXh0OiBzIH0sIGEgPSB7IGJ1ZmZlclRpbWVTcGFuOiByLCBidWZmZXJDcmVhdGlvbkludGVydmFsOiBuLCBzdWJzY3JpYmVyOiB0aGlzLCBzY2hlZHVsZXI6IG8gfTsgdGhpcy5hZGQocy5jbG9zZUFjdGlvbiA9IG8uc2NoZWR1bGUocW4sIHIsIHUpKSwgdGhpcy5hZGQoby5zY2hlZHVsZShXbiwgbiwgYSkpOyB9IH0gcmV0dXJuIFBuKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IGZvciAodmFyIGUsIHIgPSB0aGlzLmNvbnRleHRzLCBuID0gci5sZW5ndGgsIGkgPSAwOyBpIDwgbjsgaSsrKSB7IHZhciBvID0gcltpXSwgcyA9IG8uYnVmZmVyOyBzLnB1c2godCksIHMubGVuZ3RoID09IHRoaXMubWF4QnVmZmVyU2l6ZSAmJiAoZSA9IG8pOyB9IGUgJiYgdGhpcy5vbkJ1ZmZlckZ1bGwoZSk7IH0sIGUucHJvdG90eXBlLl9lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuY29udGV4dHMubGVuZ3RoID0gMCwgdC5wcm90b3R5cGUuX2Vycm9yLmNhbGwodGhpcywgZSk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IHRoaXMuY29udGV4dHMsIHIgPSB0aGlzLmRlc3RpbmF0aW9uOyBlLmxlbmd0aCA+IDA7KSB7IHZhciBuID0gZS5zaGlmdCgpOyByLm5leHQobi5idWZmZXIpOyB9IHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuY29udGV4dHMgPSBudWxsOyB9LCBlLnByb3RvdHlwZS5vbkJ1ZmZlckZ1bGwgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmNsb3NlQ29udGV4dCh0KTsgdmFyIGUgPSB0LmNsb3NlQWN0aW9uOyBpZiAoZS51bnN1YnNjcmliZSgpLCB0aGlzLnJlbW92ZShlKSwgIXRoaXMuY2xvc2VkICYmIHRoaXMudGltZXNwYW5Pbmx5KSB7IHQgPSB0aGlzLm9wZW5Db250ZXh0KCk7IHZhciByID0gdGhpcy5idWZmZXJUaW1lU3BhbiwgbiA9IHsgc3Vic2NyaWJlcjogdGhpcywgY29udGV4dDogdCwgYnVmZmVyVGltZVNwYW46IHIgfTsgdGhpcy5hZGQodC5jbG9zZUFjdGlvbiA9IHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKE1uLCByLCBuKSk7IH0gfSwgZS5wcm90b3R5cGUub3BlbkNvbnRleHQgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gbmV3IEZuOyByZXR1cm4gdGhpcy5jb250ZXh0cy5wdXNoKHQpLCB0IH0sIGUucHJvdG90eXBlLmNsb3NlQ29udGV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuZGVzdGluYXRpb24ubmV4dCh0LmJ1ZmZlcik7IHZhciBlID0gdGhpcy5jb250ZXh0czsgKGUgPyBlLmluZGV4T2YodCkgOiAtMSkgPj0gMCAmJiBlLnNwbGljZShlLmluZGV4T2YodCksIDEpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKTsgZnVuY3Rpb24gTW4odCkgeyB2YXIgZSA9IHQuc3Vic2NyaWJlciwgciA9IHQuY29udGV4dDsgciAmJiBlLmNsb3NlQ29udGV4dChyKSwgZS5jbG9zZWQgfHwgKHQuY29udGV4dCA9IGUub3BlbkNvbnRleHQoKSwgdC5jb250ZXh0LmNsb3NlQWN0aW9uID0gdGhpcy5zY2hlZHVsZSh0LCB0LmJ1ZmZlclRpbWVTcGFuKSk7IH0gZnVuY3Rpb24gV24odCkgeyB2YXIgZSA9IHQuYnVmZmVyQ3JlYXRpb25JbnRlcnZhbCwgciA9IHQuYnVmZmVyVGltZVNwYW4sIG4gPSB0LnN1YnNjcmliZXIsIGkgPSB0LnNjaGVkdWxlciwgbyA9IG4ub3BlbkNvbnRleHQoKTsgbi5jbG9zZWQgfHwgKG4uYWRkKG8uY2xvc2VBY3Rpb24gPSBpLnNjaGVkdWxlKHFuLCByLCB7IHN1YnNjcmliZXI6IG4sIGNvbnRleHQ6IG8gfSkpLCB0aGlzLnNjaGVkdWxlKHQsIGUpKTsgfSBmdW5jdGlvbiBxbih0KSB7IHZhciBlID0gdC5zdWJzY3JpYmVyLCByID0gdC5jb250ZXh0OyBlLmNsb3NlQ29udGV4dChyKTsgfSB2YXIgTG4gPSB7IGJ1ZmZlclRpbWU6IGtuIH07IHZhciBVbiA9IHsgYnVmZmVyVGltZTogZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gVmUuYXN5bmM7IHR0LmlzU2NoZWR1bGVyKGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0pICYmIChyID0gYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSwgZS0tKTsgdmFyIG4gPSBudWxsOyBlID49IDIgJiYgKG4gPSBhcmd1bWVudHNbMV0pOyB2YXIgaSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsgcmV0dXJuIGUgPj0gMyAmJiAoaSA9IGFyZ3VtZW50c1syXSksIExuLmJ1ZmZlclRpbWUodCwgbiwgaSwgcikodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmJ1ZmZlclRpbWUgPSBVbi5idWZmZXJUaW1lOyB2YXIgem4gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEJuID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IERuKHQsIGUpKSB9IH0sIERuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5vcGVuaW5ncyA9IHQsIHRoaXMuY2xvc2luZ1NlbGVjdG9yID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgWW4odCwgdGhpcy5vcGVuaW5ncywgdGhpcy5jbG9zaW5nU2VsZWN0b3IpKSB9LCB0IH0oKSwgWW4gPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLm9wZW5pbmdzID0gciwgdGhpcy5jbG9zaW5nU2VsZWN0b3IgPSBuLCB0aGlzLmNvbnRleHRzID0gW10sIHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHIpKTsgfSByZXR1cm4gem4oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgZm9yICh2YXIgZSA9IHRoaXMuY29udGV4dHMsIHIgPSBlLmxlbmd0aCwgbiA9IDA7IG4gPCByOyBuKyspZVtuXS5idWZmZXIucHVzaCh0KTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKGUpIHsgZm9yICh2YXIgciA9IHRoaXMuY29udGV4dHM7IHIubGVuZ3RoID4gMDspIHsgdmFyIG4gPSByLnNoaWZ0KCk7IG4uc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCksIG4uYnVmZmVyID0gbnVsbCwgbi5zdWJzY3JpcHRpb24gPSBudWxsOyB9IHRoaXMuY29udGV4dHMgPSBudWxsLCB0LnByb3RvdHlwZS5fZXJyb3IuY2FsbCh0aGlzLCBlKTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciBlID0gdGhpcy5jb250ZXh0czsgZS5sZW5ndGggPiAwOykgeyB2YXIgciA9IGUuc2hpZnQoKTsgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHIuYnVmZmVyKSwgci5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKSwgci5idWZmZXIgPSBudWxsLCByLnN1YnNjcmlwdGlvbiA9IG51bGw7IH0gdGhpcy5jb250ZXh0cyA9IG51bGwsIHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdCA/IHRoaXMuY2xvc2VCdWZmZXIodCkgOiB0aGlzLm9wZW5CdWZmZXIoZSk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5jbG9zZUJ1ZmZlcih0LmNvbnRleHQpOyB9LCBlLnByb3RvdHlwZS5vcGVuQnVmZmVyID0gZnVuY3Rpb24gKHQpIHsgdHJ5IHsgdmFyIGUgPSB0aGlzLmNsb3NpbmdTZWxlY3Rvci5jYWxsKHRoaXMsIHQpOyBlICYmIHRoaXMudHJ5U3Vic2NyaWJlKGUpOyB9IGNhdGNoICh0KSB7IHRoaXMuX2Vycm9yKHQpOyB9IH0sIGUucHJvdG90eXBlLmNsb3NlQnVmZmVyID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmNvbnRleHRzOyBpZiAoZSAmJiB0KSB7IHZhciByID0gdC5idWZmZXIsIG4gPSB0LnN1YnNjcmlwdGlvbjsgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHIpLCBlLnNwbGljZShlLmluZGV4T2YodCksIDEpLCB0aGlzLnJlbW92ZShuKSwgbi51bnN1YnNjcmliZSgpOyB9IH0sIGUucHJvdG90eXBlLnRyeVN1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5jb250ZXh0cywgciA9IG5ldyB2LlN1YnNjcmlwdGlvbiwgbiA9IHsgYnVmZmVyOiBbXSwgc3Vic2NyaXB0aW9uOiByIH07IGUucHVzaChuKTsgdmFyIGkgPSBidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCB0LCBuKTsgIWkgfHwgaS5jbG9zZWQgPyB0aGlzLmNsb3NlQnVmZmVyKG4pIDogKGkuY29udGV4dCA9IG4sIHRoaXMuYWRkKGkpLCByLmFkZChpKSk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBIbiA9IHsgYnVmZmVyVG9nZ2xlOiBCbiB9OyB2YXIgWG4gPSB7IGJ1ZmZlclRvZ2dsZTogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIEhuLmJ1ZmZlclRvZ2dsZSh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuYnVmZmVyVG9nZ2xlID0gWG4uYnVmZmVyVG9nZ2xlOyB2YXIgR24gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEpuID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IEtuKHQpKSB9IH0sIEtuID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5jbG9zaW5nU2VsZWN0b3IgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyAkbih0LCB0aGlzLmNsb3NpbmdTZWxlY3RvcikpIH0sIHQgfSgpLCAkbiA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuY2xvc2luZ1NlbGVjdG9yID0gciwgdGhpcy5zdWJzY3JpYmluZyA9ICExLCB0aGlzLm9wZW5CdWZmZXIoKTsgfSByZXR1cm4gR24oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5idWZmZXIucHVzaCh0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuYnVmZmVyOyBlICYmIHRoaXMuZGVzdGluYXRpb24ubmV4dChlKSwgdC5wcm90b3R5cGUuX2NvbXBsZXRlLmNhbGwodGhpcyk7IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5idWZmZXIgPSBudWxsLCB0aGlzLnN1YnNjcmliaW5nID0gITE7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB0aGlzLm9wZW5CdWZmZXIoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuc3Vic2NyaWJpbmcgPyB0aGlzLmNvbXBsZXRlKCkgOiB0aGlzLm9wZW5CdWZmZXIoKTsgfSwgZS5wcm90b3R5cGUub3BlbkJ1ZmZlciA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmNsb3NpbmdTdWJzY3JpcHRpb247IHQgJiYgKHRoaXMucmVtb3ZlKHQpLCB0LnVuc3Vic2NyaWJlKCkpOyB2YXIgZSA9IHRoaXMuYnVmZmVyOyB0aGlzLmJ1ZmZlciAmJiB0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSksIHRoaXMuYnVmZmVyID0gW107IHZhciByID0gZi50cnlDYXRjaCh0aGlzLmNsb3NpbmdTZWxlY3RvcikoKTsgciA9PT0gbC5lcnJvck9iamVjdCA/IHRoaXMuZXJyb3IobC5lcnJvck9iamVjdC5lKSA6ICh0ID0gbmV3IHYuU3Vic2NyaXB0aW9uLCB0aGlzLmNsb3NpbmdTdWJzY3JpcHRpb24gPSB0LCB0aGlzLmFkZCh0KSwgdGhpcy5zdWJzY3JpYmluZyA9ICEwLCB0LmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCByKSksIHRoaXMuc3Vic2NyaWJpbmcgPSAhMSk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBRbiA9IHsgYnVmZmVyV2hlbjogSm4gfTsgdmFyIFpuID0geyBidWZmZXJXaGVuOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gUW4uYnVmZmVyV2hlbih0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuYnVmZmVyV2hlbiA9IFpuLmJ1ZmZlcldoZW47IHZhciB0aSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgZWkgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSBuZXcgcmkodCksIG4gPSBlLmxpZnQocik7IHJldHVybiByLmNhdWdodCA9IG4gfSB9LCByaSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMuc2VsZWN0b3IgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBuaSh0LCB0aGlzLnNlbGVjdG9yLCB0aGlzLmNhdWdodCkpIH0sIHQgfSgpLCBuaSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuc2VsZWN0b3IgPSByLCB0aGlzLmNhdWdodCA9IG47IH0gcmV0dXJuIHRpKGUsIHQpLCBlLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlKSB7IGlmICghdGhpcy5pc1N0b3BwZWQpIHsgdmFyIHIgPSB2b2lkIDA7IHRyeSB7IHIgPSB0aGlzLnNlbGVjdG9yKGUsIHRoaXMuY2F1Z2h0KTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gdm9pZCB0LnByb3RvdHlwZS5lcnJvci5jYWxsKHRoaXMsIGUpIH0gdGhpcy5fdW5zdWJzY3JpYmVBbmRSZWN5Y2xlKCksIHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHIpKTsgfSB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgaWkgPSB7IGNhdGNoRXJyb3I6IGVpIH07IHZhciBvaSA9IHsgX2NhdGNoOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gaWkuY2F0Y2hFcnJvcih0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuY2F0Y2ggPSBvaS5fY2F0Y2gsIE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuX2NhdGNoID0gb2kuX2NhdGNoOyB2YXIgc2kgPSB7IGNvbWJpbmVBbGw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyB4dC5Db21iaW5lTGF0ZXN0T3BlcmF0b3IodCkpIH0gfSB9OyB2YXIgY2kgPSB7IGNvbWJpbmVBbGw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBzaS5jb21iaW5lQWxsKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5jb21iaW5lQWxsID0gY2kuY29tYmluZUFsbDsgdmFyIHVpID0geyBjb21iaW5lTGF0ZXN0OiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspdFtlIC0gMF0gPSBhcmd1bWVudHNbZV07IHJldHVybiB4dC5jb21iaW5lTGF0ZXN0LmFwcGx5KHZvaWQgMCwgdCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmNvbWJpbmVMYXRlc3QgPSB1aS5jb21iaW5lTGF0ZXN0OyB2YXIgYWkgPSB7IGNvbmNhdFN0YXRpYzogbmUuY29uY2F0LCBjb25jYXQ6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQuY2FsbChuZS5jb25jYXQuYXBwbHkodm9pZCAwLCBbZV0uY29uY2F0KHQpKSkgfSB9IH07IHZhciBoaSA9IHsgY29uY2F0U3RhdGljOiBuZS5jb25jYXQsIGNvbmNhdDogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gYWkuY29uY2F0LmFwcGx5KHZvaWQgMCwgdCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmNvbmNhdCA9IGhpLmNvbmNhdDsgdmFyIGxpID0geyBjb25jYXRBbGw6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlLmNvbmNhdEFsbCgpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5jb25jYXRBbGwgPSBsaS5jb25jYXRBbGw7IHZhciBwaSA9IHsgY29uY2F0TWFwOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gWnQubWVyZ2VNYXAodCwgZSwgMSkgfSB9OyB2YXIgZmkgPSB7IGNvbmNhdE1hcDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHBpLmNvbmNhdE1hcCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuY29uY2F0TWFwID0gZmkuY29uY2F0TWFwOyB2YXIgYmkgPSB7IGNvbmNhdE1hcFRvOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gcGkuY29uY2F0TWFwKChmdW5jdGlvbiAoKSB7IHJldHVybiB0IH0pLCBlKSB9IH07IHZhciBkaSA9IHsgY29uY2F0TWFwVG86IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBiaS5jb25jYXRNYXBUbyh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuY29uY2F0TWFwVG8gPSBkaS5jb25jYXRNYXBUbzsgdmFyIHlpID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciB2aSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBtaSh0LCBlKSkgfSB9LCBtaSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMucHJlZGljYXRlID0gdCwgdGhpcy5zb3VyY2UgPSBlOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyB3aSh0LCB0aGlzLnByZWRpY2F0ZSwgdGhpcy5zb3VyY2UpKSB9LCB0IH0oKSwgd2kgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMuc291cmNlID0gbiwgdGhpcy5jb3VudCA9IDAsIHRoaXMuaW5kZXggPSAwOyB9IHJldHVybiB5aShlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnByZWRpY2F0ZSA/IHRoaXMuX3RyeVByZWRpY2F0ZSh0KSA6IHRoaXMuY291bnQrKzsgfSwgZS5wcm90b3R5cGUuX3RyeVByZWRpY2F0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlOyB0cnkgeyBlID0gdGhpcy5wcmVkaWNhdGUodCwgdGhpcy5pbmRleCsrLCB0aGlzLnNvdXJjZSk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KSB9IGUgJiYgdGhpcy5jb3VudCsrOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZGVzdGluYXRpb24ubmV4dCh0aGlzLmNvdW50KSwgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgX2kgPSB7IGNvdW50OiB2aSB9OyB2YXIgeGkgPSB7IGNvdW50OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gX2kuY291bnQodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmNvdW50ID0geGkuY291bnQ7IHZhciBPaSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgU2kgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5saWZ0KG5ldyBnaSkgfSB9LCBnaSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCgpIHsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgVGkodCkpIH0sIHQgfSgpLCBUaSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSkgeyB0LmNhbGwodGhpcywgZSk7IH0gcmV0dXJuIE9pKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHQub2JzZXJ2ZSh0aGlzLmRlc3RpbmF0aW9uKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIGppID0geyBkZW1hdGVyaWFsaXplOiBTaSB9OyB2YXIgRWkgPSB7IGRlbWF0ZXJpYWxpemU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGppLmRlbWF0ZXJpYWxpemUoKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZGVtYXRlcmlhbGl6ZSA9IEVpLmRlbWF0ZXJpYWxpemU7IHZhciBJaSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgQWkgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgQ2kodCkpIH0gfSwgQ2kgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBOaSh0LCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IpKSB9LCB0IH0oKSwgTmkgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSByLCB0aGlzLmhhc1ZhbHVlID0gITEsIHRoaXMuZHVyYXRpb25TdWJzY3JpcHRpb24gPSBudWxsOyB9IHJldHVybiBJaShlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0cnkgeyB2YXIgZSA9IHRoaXMuZHVyYXRpb25TZWxlY3Rvci5jYWxsKHRoaXMsIHQpOyBlICYmIHRoaXMuX3RyeU5leHQodCwgZSk7IH0gY2F0Y2ggKHQpIHsgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KTsgfSB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZW1pdFZhbHVlKCksIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX3RyeU5leHQgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHRoaXMuZHVyYXRpb25TdWJzY3JpcHRpb247IHRoaXMudmFsdWUgPSB0LCB0aGlzLmhhc1ZhbHVlID0gITAsIHIgJiYgKHIudW5zdWJzY3JpYmUoKSwgdGhpcy5yZW1vdmUocikpLCAociA9IGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIGUpKS5jbG9zZWQgfHwgdGhpcy5hZGQodGhpcy5kdXJhdGlvblN1YnNjcmlwdGlvbiA9IHIpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5lbWl0VmFsdWUoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZW1pdFZhbHVlKCk7IH0sIGUucHJvdG90eXBlLmVtaXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuaGFzVmFsdWUpIHsgdmFyIGUgPSB0aGlzLnZhbHVlLCByID0gdGhpcy5kdXJhdGlvblN1YnNjcmlwdGlvbjsgciAmJiAodGhpcy5kdXJhdGlvblN1YnNjcmlwdGlvbiA9IG51bGwsIHIudW5zdWJzY3JpYmUoKSwgdGhpcy5yZW1vdmUocikpLCB0aGlzLnZhbHVlID0gbnVsbCwgdGhpcy5oYXNWYWx1ZSA9ICExLCB0LnByb3RvdHlwZS5fbmV4dC5jYWxsKHRoaXMsIGUpOyB9IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBQaSA9IHsgZGVib3VuY2U6IEFpIH07IHZhciBraSA9IHsgZGVib3VuY2U6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBQaS5kZWJvdW5jZSh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZGVib3VuY2UgPSBraS5kZWJvdW5jZTsgdmFyIFZpID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBGaSA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBWZS5hc3luYyksIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IFJpKHQsIGUpKSB9IH0sIFJpID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5kdWVUaW1lID0gdCwgdGhpcy5zY2hlZHVsZXIgPSBlOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBNaSh0LCB0aGlzLmR1ZVRpbWUsIHRoaXMuc2NoZWR1bGVyKSkgfSwgdCB9KCksIE1pID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5kdWVUaW1lID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuLCB0aGlzLmRlYm91bmNlZFN1YnNjcmlwdGlvbiA9IG51bGwsIHRoaXMubGFzdFZhbHVlID0gbnVsbCwgdGhpcy5oYXNWYWx1ZSA9ICExOyB9IHJldHVybiBWaShlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmNsZWFyRGVib3VuY2UoKSwgdGhpcy5sYXN0VmFsdWUgPSB0LCB0aGlzLmhhc1ZhbHVlID0gITAsIHRoaXMuYWRkKHRoaXMuZGVib3VuY2VkU3Vic2NyaXB0aW9uID0gdGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoV2ksIHRoaXMuZHVlVGltZSwgdGhpcykpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZGVib3VuY2VkTmV4dCgpLCB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLmRlYm91bmNlZE5leHQgPSBmdW5jdGlvbiAoKSB7IHRoaXMuY2xlYXJEZWJvdW5jZSgpLCB0aGlzLmhhc1ZhbHVlICYmICh0aGlzLmRlc3RpbmF0aW9uLm5leHQodGhpcy5sYXN0VmFsdWUpLCB0aGlzLmxhc3RWYWx1ZSA9IG51bGwsIHRoaXMuaGFzVmFsdWUgPSAhMSk7IH0sIGUucHJvdG90eXBlLmNsZWFyRGVib3VuY2UgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5kZWJvdW5jZWRTdWJzY3JpcHRpb247IG51bGwgIT09IHQgJiYgKHRoaXMucmVtb3ZlKHQpLCB0LnVuc3Vic2NyaWJlKCksIHRoaXMuZGVib3VuY2VkU3Vic2NyaXB0aW9uID0gbnVsbCk7IH0sIGUgfShULlN1YnNjcmliZXIpOyBmdW5jdGlvbiBXaSh0KSB7IHQuZGVib3VuY2VkTmV4dCgpOyB9IHZhciBxaSA9IHsgZGVib3VuY2VUaW1lOiBGaSB9OyB2YXIgTGkgPSB7IGRlYm91bmNlVGltZTogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFZlLmFzeW5jKSwgcWkuZGVib3VuY2VUaW1lKHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5kZWJvdW5jZVRpbWUgPSBMaS5kZWJvdW5jZVRpbWU7IHZhciBVaSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgemkgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gbnVsbCksIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IEJpKHQpKSB9IH0sIEJpID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5kZWZhdWx0VmFsdWUgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBEaSh0LCB0aGlzLmRlZmF1bHRWYWx1ZSkpIH0sIHQgfSgpLCBEaSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuZGVmYXVsdFZhbHVlID0gciwgdGhpcy5pc0VtcHR5ID0gITA7IH0gcmV0dXJuIFVpKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuaXNFbXB0eSA9ICExLCB0aGlzLmRlc3RpbmF0aW9uLm5leHQodCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5pc0VtcHR5ICYmIHRoaXMuZGVzdGluYXRpb24ubmV4dCh0aGlzLmRlZmF1bHRWYWx1ZSksIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIFlpID0geyBkZWZhdWx0SWZFbXB0eTogemkgfTsgdmFyIEhpID0geyBkZWZhdWx0SWZFbXB0eTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHZvaWQgMCA9PT0gdCAmJiAodCA9IG51bGwpLCBZaS5kZWZhdWx0SWZFbXB0eSh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZGVmYXVsdElmRW1wdHkgPSBIaS5kZWZhdWx0SWZFbXB0eTsgdmFyIFhpID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBHaSA9IGZ1bmN0aW9uICh0LCBlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IFZlLmFzeW5jKTsgdmFyIHIgPSBoci5pc0RhdGUodCkgPyArdCAtIGUubm93KCkgOiBNYXRoLmFicyh0KTsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IEppKHIsIGUpKSB9IH0sIEppID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5kZWxheSA9IHQsIHRoaXMuc2NoZWR1bGVyID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgS2kodCwgdGhpcy5kZWxheSwgdGhpcy5zY2hlZHVsZXIpKSB9LCB0IH0oKSwgS2kgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmRlbGF5ID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuLCB0aGlzLnF1ZXVlID0gW10sIHRoaXMuYWN0aXZlID0gITEsIHRoaXMuZXJyb3JlZCA9ICExOyB9IHJldHVybiBYaShlLCB0KSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IGZvciAodmFyIGUgPSB0LnNvdXJjZSwgciA9IGUucXVldWUsIG4gPSB0LnNjaGVkdWxlciwgaSA9IHQuZGVzdGluYXRpb247IHIubGVuZ3RoID4gMCAmJiByWzBdLnRpbWUgLSBuLm5vdygpIDw9IDA7KXIuc2hpZnQoKS5ub3RpZmljYXRpb24ub2JzZXJ2ZShpKTsgaWYgKHIubGVuZ3RoID4gMCkgeyB2YXIgbyA9IE1hdGgubWF4KDAsIHJbMF0udGltZSAtIG4ubm93KCkpOyB0aGlzLnNjaGVkdWxlKHQsIG8pOyB9IGVsc2UgdGhpcy51bnN1YnNjcmliZSgpLCBlLmFjdGl2ZSA9ICExOyB9LCBlLnByb3RvdHlwZS5fc2NoZWR1bGUgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmFjdGl2ZSA9ICEwLCB0aGlzLmFkZCh0LnNjaGVkdWxlKGUuZGlzcGF0Y2gsIHRoaXMuZGVsYXksIHsgc291cmNlOiB0aGlzLCBkZXN0aW5hdGlvbjogdGhpcy5kZXN0aW5hdGlvbiwgc2NoZWR1bGVyOiB0IH0pKTsgfSwgZS5wcm90b3R5cGUuc2NoZWR1bGVOb3RpZmljYXRpb24gPSBmdW5jdGlvbiAodCkgeyBpZiAoITAgIT09IHRoaXMuZXJyb3JlZCkgeyB2YXIgZSA9IHRoaXMuc2NoZWR1bGVyLCByID0gbmV3ICRpKGUubm93KCkgKyB0aGlzLmRlbGF5LCB0KTsgdGhpcy5xdWV1ZS5wdXNoKHIpLCAhMSA9PT0gdGhpcy5hY3RpdmUgJiYgdGhpcy5fc2NoZWR1bGUoZSk7IH0gfSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnNjaGVkdWxlTm90aWZpY2F0aW9uKE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVOZXh0KHQpKTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5lcnJvcmVkID0gITAsIHRoaXMucXVldWUgPSBbXSwgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNjaGVkdWxlTm90aWZpY2F0aW9uKE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVDb21wbGV0ZSgpKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksICRpID0gZnVuY3Rpb24gKHQsIGUpIHsgdGhpcy50aW1lID0gdCwgdGhpcy5ub3RpZmljYXRpb24gPSBlOyB9LCBRaSA9IHsgZGVsYXk6IEdpIH07IHZhciBaaSA9IHsgZGVsYXk6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBWZS5hc3luYyksIFFpLmRlbGF5KHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5kZWxheSA9IFppLmRlbGF5OyB2YXIgdG8gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIGVvID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUgPyBmdW5jdGlvbiAocikgeyByZXR1cm4gbmV3IGlvKHIsIGUpLmxpZnQobmV3IHJvKHQpKSB9IDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgcm8odCkpIH0gfSwgcm8gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLmRlbGF5RHVyYXRpb25TZWxlY3RvciA9IHQ7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IG5vKHQsIHRoaXMuZGVsYXlEdXJhdGlvblNlbGVjdG9yKSkgfSwgdCB9KCksIG5vID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5kZWxheUR1cmF0aW9uU2VsZWN0b3IgPSByLCB0aGlzLmNvbXBsZXRlZCA9ICExLCB0aGlzLmRlbGF5Tm90aWZpZXJTdWJzY3JpcHRpb25zID0gW10sIHRoaXMudmFsdWVzID0gW107IH0gcmV0dXJuIHRvKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpLCB0aGlzLnJlbW92ZVN1YnNjcmlwdGlvbihpKSwgdGhpcy50cnlDb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlFcnJvciA9IGZ1bmN0aW9uICh0LCBlKSB7IHRoaXMuX2Vycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5yZW1vdmVTdWJzY3JpcHRpb24odCk7IGUgJiYgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpLCB0aGlzLnRyeUNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdHJ5IHsgdmFyIGUgPSB0aGlzLmRlbGF5RHVyYXRpb25TZWxlY3Rvcih0KTsgZSAmJiB0aGlzLnRyeURlbGF5KGUsIHQpOyB9IGNhdGNoICh0KSB7IHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCk7IH0gfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmNvbXBsZXRlZCA9ICEwLCB0aGlzLnRyeUNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLnJlbW92ZVN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uICh0KSB7IHQudW5zdWJzY3JpYmUoKTsgdmFyIGUgPSB0aGlzLmRlbGF5Tm90aWZpZXJTdWJzY3JpcHRpb25zLmluZGV4T2YodCksIHIgPSBudWxsOyByZXR1cm4gLTEgIT09IGUgJiYgKHIgPSB0aGlzLnZhbHVlc1tlXSwgdGhpcy5kZWxheU5vdGlmaWVyU3Vic2NyaXB0aW9ucy5zcGxpY2UoZSwgMSksIHRoaXMudmFsdWVzLnNwbGljZShlLCAxKSksIHIgfSwgZS5wcm90b3R5cGUudHJ5RGVsYXkgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHQsIGUpOyByICYmICFyLmNsb3NlZCAmJiAodGhpcy5hZGQociksIHRoaXMuZGVsYXlOb3RpZmllclN1YnNjcmlwdGlvbnMucHVzaChyKSksIHRoaXMudmFsdWVzLnB1c2goZSk7IH0sIGUucHJvdG90eXBlLnRyeUNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmNvbXBsZXRlZCAmJiAwID09PSB0aGlzLmRlbGF5Tm90aWZpZXJTdWJzY3JpcHRpb25zLmxlbmd0aCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBpbyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMuc291cmNlID0gZSwgdGhpcy5zdWJzY3JpcHRpb25EZWxheSA9IHI7IH0gcmV0dXJuIHRvKGUsIHQpLCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5zdWJzY3JpcHRpb25EZWxheS5zdWJzY3JpYmUobmV3IG9vKHQsIHRoaXMuc291cmNlKSk7IH0sIGUgfShOLk9ic2VydmFibGUpLCBvbyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMucGFyZW50ID0gZSwgdGhpcy5zb3VyY2UgPSByLCB0aGlzLnNvdXJjZVN1YnNjcmliZWQgPSAhMTsgfSByZXR1cm4gdG8oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5zdWJzY3JpYmVUb1NvdXJjZSgpOyB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnVuc3Vic2NyaWJlKCksIHRoaXMucGFyZW50LmVycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuc3Vic2NyaWJlVG9Tb3VyY2UoKTsgfSwgZS5wcm90b3R5cGUuc3Vic2NyaWJlVG9Tb3VyY2UgPSBmdW5jdGlvbiAoKSB7IHRoaXMuc291cmNlU3Vic2NyaWJlZCB8fCAodGhpcy5zb3VyY2VTdWJzY3JpYmVkID0gITAsIHRoaXMudW5zdWJzY3JpYmUoKSwgdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKHRoaXMucGFyZW50KSk7IH0sIGUgfShULlN1YnNjcmliZXIpLCBzbyA9IHsgZGVsYXlXaGVuOiBlbyB9OyB2YXIgY28gPSB7IGRlbGF5V2hlbjogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHNvLmRlbGF5V2hlbih0LCBlKSh0aGlzKSB9IH07IGZ1bmN0aW9uIHVvKCkgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB0aGlzLl92YWx1ZXMgPSBbXTsgfSByZXR1cm4gdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5oYXModCkgfHwgdGhpcy5fdmFsdWVzLnB1c2godCk7IH0sIHQucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiAtMSAhPT0gdGhpcy5fdmFsdWVzLmluZGV4T2YodCkgfSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQucHJvdG90eXBlLCAic2l6ZSIsIHsgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl92YWx1ZXMubGVuZ3RoIH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pLCB0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fdmFsdWVzLmxlbmd0aCA9IDA7IH0sIHQgfSgpIH0gTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5kZWxheVdoZW4gPSBjby5kZWxheVdoZW47IHZhciBhbyA9IHsgbWluaW1hbFNldEltcGw6IHVvLCBTZXQ6IHMucm9vdC5TZXQgfHwgdW8oKSB9LCBobyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgbG8gPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgcG8odCwgZSkpIH0gfSwgcG8gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSkgeyB0aGlzLmtleVNlbGVjdG9yID0gdCwgdGhpcy5mbHVzaGVzID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgZm8odCwgdGhpcy5rZXlTZWxlY3RvciwgdGhpcy5mbHVzaGVzKSkgfSwgdCB9KCksIGZvID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5rZXlTZWxlY3RvciA9IHIsIHRoaXMudmFsdWVzID0gbmV3IGFvLlNldCwgbiAmJiB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCBuKSk7IH0gcmV0dXJuIGhvKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy52YWx1ZXMuY2xlYXIoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgeyB0aGlzLl9lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmtleVNlbGVjdG9yID8gdGhpcy5fdXNlS2V5U2VsZWN0b3IodCkgOiB0aGlzLl9maW5hbGl6ZU5leHQodCwgdCk7IH0sIGUucHJvdG90eXBlLl91c2VLZXlTZWxlY3RvciA9IGZ1bmN0aW9uICh0KSB7IHZhciBlLCByID0gdGhpcy5kZXN0aW5hdGlvbjsgdHJ5IHsgZSA9IHRoaXMua2V5U2VsZWN0b3IodCk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgci5lcnJvcih0KSB9IHRoaXMuX2ZpbmFsaXplTmV4dChlLCB0KTsgfSwgZS5wcm90b3R5cGUuX2ZpbmFsaXplTmV4dCA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByID0gdGhpcy52YWx1ZXM7IHIuaGFzKHQpIHx8IChyLmFkZCh0KSwgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIGJvID0geyBkaXN0aW5jdDogbG8sIERpc3RpbmN0U3Vic2NyaWJlcjogZm8gfTsgdmFyIHlvID0geyBkaXN0aW5jdDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGJvLmRpc3RpbmN0KHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5kaXN0aW5jdCA9IHlvLmRpc3RpbmN0OyB2YXIgdm8gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIG1vID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IHdvKHQsIGUpKSB9IH0sIHdvID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5jb21wYXJlID0gdCwgdGhpcy5rZXlTZWxlY3RvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IF9vKHQsIHRoaXMuY29tcGFyZSwgdGhpcy5rZXlTZWxlY3RvcikpIH0sIHQgfSgpLCBfbyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMua2V5U2VsZWN0b3IgPSBuLCB0aGlzLmhhc0tleSA9ICExLCAiZnVuY3Rpb24iID09IHR5cGVvZiByICYmICh0aGlzLmNvbXBhcmUgPSByKTsgfSByZXR1cm4gdm8oZSwgdCksIGUucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdCA9PT0gZSB9LCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdDsgaWYgKHRoaXMua2V5U2VsZWN0b3IgJiYgKGUgPSBmLnRyeUNhdGNoKHRoaXMua2V5U2VsZWN0b3IpKHQpKSA9PT0gbC5lcnJvck9iamVjdCkgcmV0dXJuIHRoaXMuZGVzdGluYXRpb24uZXJyb3IobC5lcnJvck9iamVjdC5lKTsgdmFyIHIgPSAhMTsgaWYgKHRoaXMuaGFzS2V5KSB7IGlmICgociA9IGYudHJ5Q2F0Y2godGhpcy5jb21wYXJlKSh0aGlzLmtleSwgZSkpID09PSBsLmVycm9yT2JqZWN0KSByZXR1cm4gdGhpcy5kZXN0aW5hdGlvbi5lcnJvcihsLmVycm9yT2JqZWN0LmUpIH0gZWxzZSB0aGlzLmhhc0tleSA9ICEwOyAhMSA9PT0gQm9vbGVhbihyKSAmJiAodGhpcy5rZXkgPSBlLCB0aGlzLmRlc3RpbmF0aW9uLm5leHQodCkpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgeG8gPSB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkOiBtbyB9OyB2YXIgT28gPSB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4geG8uZGlzdGluY3RVbnRpbENoYW5nZWQodCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmRpc3RpbmN0VW50aWxDaGFuZ2VkID0gT28uZGlzdGluY3RVbnRpbENoYW5nZWQ7IHZhciBTbyA9IHsgZGlzdGluY3RVbnRpbEtleUNoYW5nZWQ6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB4by5kaXN0aW5jdFVudGlsQ2hhbmdlZCgoZnVuY3Rpb24gKHIsIG4pIHsgcmV0dXJuIGUgPyBlKHJbdF0sIG5bdF0pIDogclt0XSA9PT0gblt0XSB9KSkgfSB9OyB2YXIgZ28gPSB7IGRpc3RpbmN0VW50aWxLZXlDaGFuZ2VkOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gU28uZGlzdGluY3RVbnRpbEtleUNoYW5nZWQodCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmRpc3RpbmN0VW50aWxLZXlDaGFuZ2VkID0gZ28uZGlzdGluY3RVbnRpbEtleUNoYW5nZWQ7IHZhciBUbyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgam8gPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG4ubGlmdChuZXcgRW8odCwgZSwgcikpIH0gfSwgRW8gPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgcikgeyB0aGlzLm5leHRPck9ic2VydmVyID0gdCwgdGhpcy5lcnJvciA9IGUsIHRoaXMuY29tcGxldGUgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBJbyh0LCB0aGlzLm5leHRPck9ic2VydmVyLCB0aGlzLmVycm9yLCB0aGlzLmNvbXBsZXRlKSkgfSwgdCB9KCksIElvID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuLCBpKSB7IHQuY2FsbCh0aGlzLCBlKTsgdmFyIG8gPSBuZXcgVC5TdWJzY3JpYmVyKHIsIG4sIGkpOyBvLnN5bmNFcnJvclRocm93YWJsZSA9ICEwLCB0aGlzLmFkZChvKSwgdGhpcy5zYWZlU3Vic2NyaWJlciA9IG87IH0gcmV0dXJuIFRvKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5zYWZlU3Vic2NyaWJlcjsgZS5uZXh0KHQpLCBlLnN5bmNFcnJvclRocm93biA/IHRoaXMuZGVzdGluYXRpb24uZXJyb3IoZS5zeW5jRXJyb3JWYWx1ZSkgOiB0aGlzLmRlc3RpbmF0aW9uLm5leHQodCk7IH0sIGUucHJvdG90eXBlLl9lcnJvciA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5zYWZlU3Vic2NyaWJlcjsgZS5lcnJvcih0KSwgZS5zeW5jRXJyb3JUaHJvd24gPyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKGUuc3luY0Vycm9yVmFsdWUpIDogdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuc2FmZVN1YnNjcmliZXI7IHQuY29tcGxldGUoKSwgdC5zeW5jRXJyb3JUaHJvd24gPyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQuc3luY0Vycm9yVmFsdWUpIDogdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgQW8gPSB7IHRhcDogam8gfTsgdmFyIENvID0geyBfZG86IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiBBby50YXAodCwgZSwgcikodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmRvID0gQ28uX2RvLCBOLk9ic2VydmFibGUucHJvdG90eXBlLl9kbyA9IENvLl9kbzsgdmFyIE5vID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBQbyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IGtvKSB9IH0sIGtvID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBWbyh0KSkgfSwgdCB9KCksIFZvID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5oYXNDb21wbGV0ZWQgPSAhMSwgdGhpcy5oYXNTdWJzY3JpcHRpb24gPSAhMTsgfSByZXR1cm4gTm8oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5oYXNTdWJzY3JpcHRpb24gfHwgKHRoaXMuaGFzU3Vic2NyaXB0aW9uID0gITAsIHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHQpKSk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5oYXNDb21wbGV0ZWQgPSAhMCwgdGhpcy5oYXNTdWJzY3JpcHRpb24gfHwgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHRoaXMucmVtb3ZlKHQpLCB0aGlzLmhhc1N1YnNjcmlwdGlvbiA9ICExLCB0aGlzLmhhc0NvbXBsZXRlZCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBGbyA9IHsgZXhoYXVzdDogUG8gfTsgdmFyIFJvID0geyBleGhhdXN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBGby5leGhhdXN0KCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmV4aGF1c3QgPSBSby5leGhhdXN0OyB2YXIgTW8gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIFdvID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IHFvKHQsIGUpKSB9IH0sIHFvID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5wcm9qZWN0ID0gdCwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IExvKHQsIHRoaXMucHJvamVjdCwgdGhpcy5yZXN1bHRTZWxlY3RvcikpIH0sIHQgfSgpLCBMbyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMucHJvamVjdCA9IHIsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBuLCB0aGlzLmhhc1N1YnNjcmlwdGlvbiA9ICExLCB0aGlzLmhhc0NvbXBsZXRlZCA9ICExLCB0aGlzLmluZGV4ID0gMDsgfSByZXR1cm4gTW8oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5oYXNTdWJzY3JpcHRpb24gfHwgdGhpcy50cnlOZXh0KHQpOyB9LCBlLnByb3RvdHlwZS50cnlOZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmluZGV4KyssIHIgPSB0aGlzLmRlc3RpbmF0aW9uOyB0cnkgeyB2YXIgbiA9IHRoaXMucHJvamVjdCh0LCBlKTsgdGhpcy5oYXNTdWJzY3JpcHRpb24gPSAhMCwgdGhpcy5hZGQoYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgbiwgdCwgZSkpOyB9IGNhdGNoICh0KSB7IHIuZXJyb3IodCk7IH0gfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmhhc0NvbXBsZXRlZCA9ICEwLCB0aGlzLmhhc1N1YnNjcmlwdGlvbiB8fCB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB2YXIgbyA9IHRoaXMucmVzdWx0U2VsZWN0b3IsIHMgPSB0aGlzLmRlc3RpbmF0aW9uOyBvID8gdGhpcy50cnlTZWxlY3RSZXN1bHQodCwgZSwgciwgbikgOiBzLm5leHQoZSk7IH0sIGUucHJvdG90eXBlLnRyeVNlbGVjdFJlc3VsdCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHZhciBpID0gdGhpcy5yZXN1bHRTZWxlY3RvciwgbyA9IHRoaXMuZGVzdGluYXRpb247IHRyeSB7IHZhciBzID0gaSh0LCBlLCByLCBuKTsgby5uZXh0KHMpOyB9IGNhdGNoICh0KSB7IG8uZXJyb3IodCk7IH0gfSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHRoaXMucmVtb3ZlKHQpLCB0aGlzLmhhc1N1YnNjcmlwdGlvbiA9ICExLCB0aGlzLmhhc0NvbXBsZXRlZCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBVbyA9IHsgZXhoYXVzdE1hcDogV28gfTsgdmFyIHpvID0geyBleGhhdXN0TWFwOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gVW8uZXhoYXVzdE1hcCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZXhoYXVzdE1hcCA9IHpvLmV4aGF1c3RNYXA7IHZhciBCbyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgRG8gPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSwgdm9pZCAwID09PSByICYmIChyID0gdm9pZCAwKSwgZSA9IChlIHx8IDApIDwgMSA/IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSA6IGUsIGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLmxpZnQobmV3IFlvKHQsIGUsIHIpKSB9IH0sIFlvID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIpIHsgdGhpcy5wcm9qZWN0ID0gdCwgdGhpcy5jb25jdXJyZW50ID0gZSwgdGhpcy5zY2hlZHVsZXIgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBYbyh0LCB0aGlzLnByb2plY3QsIHRoaXMuY29uY3VycmVudCwgdGhpcy5zY2hlZHVsZXIpKSB9LCB0IH0oKSwgSG8gPSBZbywgWG8gPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGkpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByb2plY3QgPSByLCB0aGlzLmNvbmN1cnJlbnQgPSBuLCB0aGlzLnNjaGVkdWxlciA9IGksIHRoaXMuaW5kZXggPSAwLCB0aGlzLmFjdGl2ZSA9IDAsIHRoaXMuaGFzQ29tcGxldGVkID0gITEsIG4gPCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgJiYgKHRoaXMuYnVmZmVyID0gW10pOyB9IHJldHVybiBCbyhlLCB0KSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5zdWJzY3JpYmVyLCByID0gdC5yZXN1bHQsIG4gPSB0LnZhbHVlLCBpID0gdC5pbmRleDsgZS5zdWJzY3JpYmVUb1Byb2plY3Rpb24ociwgbiwgaSk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0aGlzLmRlc3RpbmF0aW9uOyBpZiAoci5jbG9zZWQpIHRoaXMuX2NvbXBsZXRlKCk7IGVsc2UgeyB2YXIgbiA9IHRoaXMuaW5kZXgrKzsgaWYgKHRoaXMuYWN0aXZlIDwgdGhpcy5jb25jdXJyZW50KSB7IHIubmV4dCh0KTsgdmFyIGkgPSBmLnRyeUNhdGNoKHRoaXMucHJvamVjdCkodCwgbik7IGlmIChpID09PSBsLmVycm9yT2JqZWN0KSByLmVycm9yKGwuZXJyb3JPYmplY3QuZSk7IGVsc2UgaWYgKHRoaXMuc2NoZWR1bGVyKSB7IHZhciBvID0geyBzdWJzY3JpYmVyOiB0aGlzLCByZXN1bHQ6IGksIHZhbHVlOiB0LCBpbmRleDogbiB9OyB0aGlzLmFkZCh0aGlzLnNjaGVkdWxlci5zY2hlZHVsZShlLmRpc3BhdGNoLCAwLCBvKSk7IH0gZWxzZSB0aGlzLnN1YnNjcmliZVRvUHJvamVjdGlvbihpLCB0LCBuKTsgfSBlbHNlIHRoaXMuYnVmZmVyLnB1c2godCk7IH0gfSwgZS5wcm90b3R5cGUuc3Vic2NyaWJlVG9Qcm9qZWN0aW9uID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgdGhpcy5hY3RpdmUrKywgdGhpcy5hZGQoYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgdCwgZSwgcikpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaGFzQ29tcGxldGVkID0gITAsIHRoaXMuaGFzQ29tcGxldGVkICYmIDAgPT09IHRoaXMuYWN0aXZlICYmIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMuX25leHQoZSk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmJ1ZmZlcjsgdGhpcy5yZW1vdmUodCksIHRoaXMuYWN0aXZlLS0sIGUgJiYgZS5sZW5ndGggPiAwICYmIHRoaXMuX25leHQoZS5zaGlmdCgpKSwgdGhpcy5oYXNDb21wbGV0ZWQgJiYgMCA9PT0gdGhpcy5hY3RpdmUgJiYgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgR28gPSB7IGV4cGFuZDogRG8sIEV4cGFuZE9wZXJhdG9yOiBIbywgRXhwYW5kU3Vic2NyaWJlcjogWG8gfTsgdmFyIEpvID0geyBleHBhbmQ6IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCB2b2lkIDAgPT09IHIgJiYgKHIgPSB2b2lkIDApLCBlID0gKGUgfHwgMCkgPCAxID8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIDogZSwgR28uZXhwYW5kKHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5leHBhbmQgPSBKby5leHBhbmQ7IHZhciBLbyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCAkbyA9IHsgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3I6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoKSB7IHZhciBlID0gdC5jYWxsKHRoaXMsICJhcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTsgdGhpcy5uYW1lID0gZS5uYW1lID0gIkFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yIiwgdGhpcy5zdGFjayA9IGUuc3RhY2ssIHRoaXMubWVzc2FnZSA9IGUubWVzc2FnZTsgfSByZXR1cm4gS28oZSwgdCksIGUgfShFcnJvcikgfSwgUW8gPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIFpvID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IHRzKHQsIGUpKSB9IH0sIHRzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgaWYgKHRoaXMuaW5kZXggPSB0LCB0aGlzLmRlZmF1bHRWYWx1ZSA9IGUsIHQgPCAwKSB0aHJvdyBuZXcgJG8uQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgZXModCwgdGhpcy5pbmRleCwgdGhpcy5kZWZhdWx0VmFsdWUpKSB9LCB0IH0oKSwgZXMgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmluZGV4ID0gciwgdGhpcy5kZWZhdWx0VmFsdWUgPSBuOyB9IHJldHVybiBRbyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyAwID09IHRoaXMuaW5kZXgtLSAmJiAodGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpLCB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCkpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5kZXN0aW5hdGlvbjsgdGhpcy5pbmRleCA+PSAwICYmICh2b2lkIDAgIT09IHRoaXMuZGVmYXVsdFZhbHVlID8gdC5uZXh0KHRoaXMuZGVmYXVsdFZhbHVlKSA6IHQuZXJyb3IobmV3ICRvLkFyZ3VtZW50T3V0T2ZSYW5nZUVycm9yKSksIHQuY29tcGxldGUoKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHJzID0geyBlbGVtZW50QXQ6IFpvIH07IHZhciBucyA9IHsgZWxlbWVudEF0OiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gcnMuZWxlbWVudEF0KHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5lbGVtZW50QXQgPSBucy5lbGVtZW50QXQ7IHZhciBpcyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgb3MgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgc3ModCwgZSkpIH0gfSwgc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSkgeyB0aGlzLnByZWRpY2F0ZSA9IHQsIHRoaXMudGhpc0FyZyA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IGNzKHQsIHRoaXMucHJlZGljYXRlLCB0aGlzLnRoaXNBcmcpKSB9LCB0IH0oKSwgY3MgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMudGhpc0FyZyA9IG4sIHRoaXMuY291bnQgPSAwOyB9IHJldHVybiBpcyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZTsgdHJ5IHsgZSA9IHRoaXMucHJlZGljYXRlLmNhbGwodGhpcy50aGlzQXJnLCB0LCB0aGlzLmNvdW50KyspOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCkgfSBlICYmIHRoaXMuZGVzdGluYXRpb24ubmV4dCh0KTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHVzID0geyBmaWx0ZXI6IG9zIH07IHZhciBhcyA9IHsgZmlsdGVyOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdXMuZmlsdGVyKHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5maWx0ZXIgPSBhcy5maWx0ZXI7IHZhciBocyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgbHMgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgcHModCkpIH0gfSwgcHMgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLmNhbGxiYWNrID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgZnModCwgdGhpcy5jYWxsYmFjaykpIH0sIHQgfSgpLCBmcyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYWRkKG5ldyB2LlN1YnNjcmlwdGlvbihyKSk7IH0gcmV0dXJuIGhzKGUsIHQpLCBlIH0oVC5TdWJzY3JpYmVyKSwgYnMgPSB7IGZpbmFsaXplOiBscyB9OyB2YXIgZHMgPSB7IF9maW5hbGx5OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gYnMuZmluYWxpemUodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmZpbmFsbHkgPSBkcy5fZmluYWxseSwgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5fZmluYWxseSA9IGRzLl9maW5hbGx5OyB2YXIgeXMgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIHZzID0gZnVuY3Rpb24gKHQsIGUpIHsgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQpIHRocm93IG5ldyBUeXBlRXJyb3IoInByZWRpY2F0ZSBpcyBub3QgYSBmdW5jdGlvbiIpOyByZXR1cm4gZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgbXModCwgciwgITEsIGUpKSB9IH0sIG1zID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy5wcmVkaWNhdGUgPSB0LCB0aGlzLnNvdXJjZSA9IGUsIHRoaXMueWllbGRJbmRleCA9IHIsIHRoaXMudGhpc0FyZyA9IG47IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IF9zKHQsIHRoaXMucHJlZGljYXRlLCB0aGlzLnNvdXJjZSwgdGhpcy55aWVsZEluZGV4LCB0aGlzLnRoaXNBcmcpKSB9LCB0IH0oKSwgd3MgPSBtcywgX3MgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMuc291cmNlID0gbiwgdGhpcy55aWVsZEluZGV4ID0gaSwgdGhpcy50aGlzQXJnID0gbywgdGhpcy5pbmRleCA9IDA7IH0gcmV0dXJuIHlzKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5kZXN0aW5hdGlvbjsgZS5uZXh0KHQpLCBlLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLnByZWRpY2F0ZSwgciA9IHRoaXMudGhpc0FyZywgbiA9IHRoaXMuaW5kZXgrKzsgdHJ5IHsgZS5jYWxsKHIgfHwgdGhpcywgdCwgbiwgdGhpcy5zb3VyY2UpICYmIHRoaXMubm90aWZ5Q29tcGxldGUodGhpcy55aWVsZEluZGV4ID8gbiA6IHQpOyB9IGNhdGNoICh0KSB7IHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCk7IH0gfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLm5vdGlmeUNvbXBsZXRlKHRoaXMueWllbGRJbmRleCA/IC0xIDogdm9pZCAwKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHhzID0geyBmaW5kOiB2cywgRmluZFZhbHVlT3BlcmF0b3I6IHdzLCBGaW5kVmFsdWVTdWJzY3JpYmVyOiBfcyB9OyB2YXIgT3MgPSB7IGZpbmQ6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB4cy5maW5kKHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5maW5kID0gT3MuZmluZDsgdmFyIFNzID0geyBmaW5kSW5kZXg6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAocikgeyByZXR1cm4gci5saWZ0KG5ldyB4cy5GaW5kVmFsdWVPcGVyYXRvcih0LCByLCAhMCwgZSkpIH0gfSB9OyB2YXIgZ3MgPSB7IGZpbmRJbmRleDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIFNzLmZpbmRJbmRleCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZmluZEluZGV4ID0gZ3MuZmluZEluZGV4OyB2YXIgVHMgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwganMgPSB7IEVtcHR5RXJyb3I6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoKSB7IHZhciBlID0gdC5jYWxsKHRoaXMsICJubyBlbGVtZW50cyBpbiBzZXF1ZW5jZSIpOyB0aGlzLm5hbWUgPSBlLm5hbWUgPSAiRW1wdHlFcnJvciIsIHRoaXMuc3RhY2sgPSBlLnN0YWNrLCB0aGlzLm1lc3NhZ2UgPSBlLm1lc3NhZ2U7IH0gcmV0dXJuIFRzKGUsIHQpLCBlIH0oRXJyb3IpIH0sIEVzID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBJcyA9IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiBmdW5jdGlvbiAobikgeyByZXR1cm4gbi5saWZ0KG5ldyBBcyh0LCBlLCByLCBuKSkgfSB9LCBBcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlLCByLCBuKSB7IHRoaXMucHJlZGljYXRlID0gdCwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGUsIHRoaXMuZGVmYXVsdFZhbHVlID0gciwgdGhpcy5zb3VyY2UgPSBuOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBDcyh0LCB0aGlzLnByZWRpY2F0ZSwgdGhpcy5yZXN1bHRTZWxlY3RvciwgdGhpcy5kZWZhdWx0VmFsdWUsIHRoaXMuc291cmNlKSkgfSwgdCB9KCksIENzID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuLCBpLCBvKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5wcmVkaWNhdGUgPSByLCB0aGlzLnJlc3VsdFNlbGVjdG9yID0gbiwgdGhpcy5kZWZhdWx0VmFsdWUgPSBpLCB0aGlzLnNvdXJjZSA9IG8sIHRoaXMuaW5kZXggPSAwLCB0aGlzLmhhc0NvbXBsZXRlZCA9ICExLCB0aGlzLl9lbWl0dGVkID0gITE7IH0gcmV0dXJuIEVzKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5pbmRleCsrOyB0aGlzLnByZWRpY2F0ZSA/IHRoaXMuX3RyeVByZWRpY2F0ZSh0LCBlKSA6IHRoaXMuX2VtaXQodCwgZSk7IH0sIGUucHJvdG90eXBlLl90cnlQcmVkaWNhdGUgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgcjsgdHJ5IHsgciA9IHRoaXMucHJlZGljYXRlKHQsIGUsIHRoaXMuc291cmNlKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gciAmJiB0aGlzLl9lbWl0KHQsIGUpOyB9LCBlLnByb3RvdHlwZS5fZW1pdCA9IGZ1bmN0aW9uICh0LCBlKSB7IHRoaXMucmVzdWx0U2VsZWN0b3IgPyB0aGlzLl90cnlSZXN1bHRTZWxlY3Rvcih0LCBlKSA6IHRoaXMuX2VtaXRGaW5hbCh0KTsgfSwgZS5wcm90b3R5cGUuX3RyeVJlc3VsdFNlbGVjdG9yID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHI7IHRyeSB7IHIgPSB0aGlzLnJlc3VsdFNlbGVjdG9yKHQsIGUpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCkgfSB0aGlzLl9lbWl0RmluYWwocik7IH0sIGUucHJvdG90eXBlLl9lbWl0RmluYWwgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuZGVzdGluYXRpb247IHRoaXMuX2VtaXR0ZWQgfHwgKHRoaXMuX2VtaXR0ZWQgPSAhMCwgZS5uZXh0KHQpLCBlLmNvbXBsZXRlKCksIHRoaXMuaGFzQ29tcGxldGVkID0gITApOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5kZXN0aW5hdGlvbjsgdGhpcy5oYXNDb21wbGV0ZWQgfHwgdm9pZCAwID09PSB0aGlzLmRlZmF1bHRWYWx1ZSA/IHRoaXMuaGFzQ29tcGxldGVkIHx8IHQuZXJyb3IobmV3IGpzLkVtcHR5RXJyb3IpIDogKHQubmV4dCh0aGlzLmRlZmF1bHRWYWx1ZSksIHQuY29tcGxldGUoKSk7IH0sIGUgfShULlN1YnNjcmliZXIpLCBOcyA9IHsgZmlyc3Q6IElzIH07IHZhciBQcyA9IHsgZmlyc3Q6IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiBOcy5maXJzdCh0LCBlLCByKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuZmlyc3QgPSBQcy5maXJzdDsgdmFyIGtzID0geyBNYXBQb2x5ZmlsbDogZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB0aGlzLnNpemUgPSAwLCB0aGlzLl92YWx1ZXMgPSBbXSwgdGhpcy5fa2V5cyA9IFtdOyB9IHJldHVybiB0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuX2tleXMuaW5kZXhPZih0KTsgcmV0dXJuIC0xID09PSBlID8gdm9pZCAwIDogdGhpcy5fdmFsdWVzW2VdIH0sIHQucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByID0gdGhpcy5fa2V5cy5pbmRleE9mKHQpOyByZXR1cm4gLTEgPT09IHIgPyAodGhpcy5fa2V5cy5wdXNoKHQpLCB0aGlzLl92YWx1ZXMucHVzaChlKSwgdGhpcy5zaXplKyspIDogdGhpcy5fdmFsdWVzW3JdID0gZSwgdGhpcyB9LCB0LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuX2tleXMuaW5kZXhPZih0KTsgcmV0dXJuIC0xICE9PSBlICYmICh0aGlzLl92YWx1ZXMuc3BsaWNlKGUsIDEpLCB0aGlzLl9rZXlzLnNwbGljZShlLCAxKSwgdGhpcy5zaXplLS0sICEwKSB9LCB0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsgdGhpcy5fa2V5cy5sZW5ndGggPSAwLCB0aGlzLl92YWx1ZXMubGVuZ3RoID0gMCwgdGhpcy5zaXplID0gMDsgfSwgdC5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgPSAwOyByIDwgdGhpcy5zaXplOyByKyspdC5jYWxsKGUsIHRoaXMuX3ZhbHVlc1tyXSwgdGhpcy5fa2V5c1tyXSk7IH0sIHQgfSgpIH0sIFZzID0geyBNYXA6IHMucm9vdC5NYXAgfHwga3MuTWFwUG9seWZpbGwgfSwgRnMgPSB7IEZhc3RNYXA6IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCgpIHsgdGhpcy52YWx1ZXMgPSB7fTsgfSByZXR1cm4gdC5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMudmFsdWVzW3RdID0gbnVsbCwgITAgfSwgdC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHRoaXMudmFsdWVzW3RdID0gZSwgdGhpcyB9LCB0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdGhpcy52YWx1ZXNbdF0gfSwgdC5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByID0gdGhpcy52YWx1ZXM7IGZvciAodmFyIG4gaW4gcikgci5oYXNPd25Qcm9wZXJ0eShuKSAmJiBudWxsICE9PSByW25dICYmIHQuY2FsbChlLCByW25dLCBuKTsgfSwgdC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7IHRoaXMudmFsdWVzID0ge307IH0sIHQgfSgpIH0sIFJzID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBNcyA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHJldHVybiBmdW5jdGlvbiAoaSkgeyByZXR1cm4gaS5saWZ0KG5ldyBXcyh0LCBlLCByLCBuKSkgfSB9LCBXcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlLCByLCBuKSB7IHRoaXMua2V5U2VsZWN0b3IgPSB0LCB0aGlzLmVsZW1lbnRTZWxlY3RvciA9IGUsIHRoaXMuZHVyYXRpb25TZWxlY3RvciA9IHIsIHRoaXMuc3ViamVjdFNlbGVjdG9yID0gbjsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgcXModCwgdGhpcy5rZXlTZWxlY3RvciwgdGhpcy5lbGVtZW50U2VsZWN0b3IsIHRoaXMuZHVyYXRpb25TZWxlY3RvciwgdGhpcy5zdWJqZWN0U2VsZWN0b3IpKSB9LCB0IH0oKSwgcXMgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmtleVNlbGVjdG9yID0gciwgdGhpcy5lbGVtZW50U2VsZWN0b3IgPSBuLCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSBpLCB0aGlzLnN1YmplY3RTZWxlY3RvciA9IG8sIHRoaXMuZ3JvdXBzID0gbnVsbCwgdGhpcy5hdHRlbXB0ZWRUb1Vuc3Vic2NyaWJlID0gITEsIHRoaXMuY291bnQgPSAwOyB9IHJldHVybiBScyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZTsgdHJ5IHsgZSA9IHRoaXMua2V5U2VsZWN0b3IodCk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgdGhpcy5lcnJvcih0KSB9IHRoaXMuX2dyb3VwKHQsIGUpOyB9LCBlLnByb3RvdHlwZS5fZ3JvdXAgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHRoaXMuZ3JvdXBzOyByIHx8IChyID0gdGhpcy5ncm91cHMgPSAic3RyaW5nIiA9PSB0eXBlb2YgZSA/IG5ldyBGcy5GYXN0TWFwIDogbmV3IFZzLk1hcCk7IHZhciBuLCBpID0gci5nZXQoZSk7IGlmICh0aGlzLmVsZW1lbnRTZWxlY3RvcikgdHJ5IHsgbiA9IHRoaXMuZWxlbWVudFNlbGVjdG9yKHQpOyB9IGNhdGNoICh0KSB7IHRoaXMuZXJyb3IodCk7IH0gZWxzZSBuID0gdDsgaWYgKCFpKSB7IGkgPSB0aGlzLnN1YmplY3RTZWxlY3RvciA/IHRoaXMuc3ViamVjdFNlbGVjdG9yKCkgOiBuZXcgei5TdWJqZWN0LCByLnNldChlLCBpKTsgdmFyIG8gPSBuZXcgVXMoZSwgaSwgdGhpcyk7IGlmICh0aGlzLmRlc3RpbmF0aW9uLm5leHQobyksIHRoaXMuZHVyYXRpb25TZWxlY3RvcikgeyB2YXIgcyA9IHZvaWQgMDsgdHJ5IHsgcyA9IHRoaXMuZHVyYXRpb25TZWxlY3RvcihuZXcgVXMoZSwgaSkpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZXJyb3IodCkgfSB0aGlzLmFkZChzLnN1YnNjcmliZShuZXcgTHMoZSwgaSwgdGhpcykpKTsgfSB9IGkuY2xvc2VkIHx8IGkubmV4dChuKTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmdyb3VwczsgZSAmJiAoZS5mb3JFYWNoKChmdW5jdGlvbiAoZSwgcikgeyBlLmVycm9yKHQpOyB9KSksIGUuY2xlYXIoKSksIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmdyb3VwczsgdCAmJiAodC5mb3JFYWNoKChmdW5jdGlvbiAodCwgZSkgeyB0LmNvbXBsZXRlKCk7IH0pKSwgdC5jbGVhcigpKSwgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5yZW1vdmVHcm91cCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuZ3JvdXBzLmRlbGV0ZSh0KTsgfSwgZS5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuY2xvc2VkIHx8ICh0aGlzLmF0dGVtcHRlZFRvVW5zdWJzY3JpYmUgPSAhMCwgMCA9PT0gdGhpcy5jb3VudCAmJiB0LnByb3RvdHlwZS51bnN1YnNjcmliZS5jYWxsKHRoaXMpKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIExzID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCByKSwgdGhpcy5rZXkgPSBlLCB0aGlzLmdyb3VwID0gciwgdGhpcy5wYXJlbnQgPSBuOyB9IHJldHVybiBScyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLnBhcmVudCwgZSA9IHRoaXMua2V5OyB0aGlzLmtleSA9IHRoaXMucGFyZW50ID0gbnVsbCwgdCAmJiB0LnJlbW92ZUdyb3VwKGUpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgVXMgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMpLCB0aGlzLmtleSA9IGUsIHRoaXMuZ3JvdXBTdWJqZWN0ID0gciwgdGhpcy5yZWZDb3VudFN1YnNjcmlwdGlvbiA9IG47IH0gcmV0dXJuIFJzKGUsIHQpLCBlLnByb3RvdHlwZS5fc3Vic2NyaWJlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSBuZXcgdi5TdWJzY3JpcHRpb24sIHIgPSB0aGlzLnJlZkNvdW50U3Vic2NyaXB0aW9uLCBuID0gdGhpcy5ncm91cFN1YmplY3Q7IHJldHVybiByICYmICFyLmNsb3NlZCAmJiBlLmFkZChuZXcgQnMocikpLCBlLmFkZChuLnN1YnNjcmliZSh0KSksIGUgfSwgZSB9KE4uT2JzZXJ2YWJsZSksIHpzID0gVXMsIEJzID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzKSwgdGhpcy5wYXJlbnQgPSBlLCBlLmNvdW50Kys7IH0gcmV0dXJuIFJzKGUsIHQpLCBlLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLnBhcmVudDsgZS5jbG9zZWQgfHwgdGhpcy5jbG9zZWQgfHwgKHQucHJvdG90eXBlLnVuc3Vic2NyaWJlLmNhbGwodGhpcyksIGUuY291bnQgLT0gMSwgMCA9PT0gZS5jb3VudCAmJiBlLmF0dGVtcHRlZFRvVW5zdWJzY3JpYmUgJiYgZS51bnN1YnNjcmliZSgpKTsgfSwgZSB9KHYuU3Vic2NyaXB0aW9uKSwgRHMgPSB7IGdyb3VwQnk6IE1zLCBHcm91cGVkT2JzZXJ2YWJsZTogenMgfTsgdmFyIFlzID0geyBHcm91cGVkT2JzZXJ2YWJsZTogRHMuR3JvdXBlZE9ic2VydmFibGUsIGdyb3VwQnk6IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHJldHVybiBEcy5ncm91cEJ5KHQsIGUsIHIsIG4pKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5ncm91cEJ5ID0gWXMuZ3JvdXBCeTsgdmFyIEhzID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBYcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IEdzKSB9IH0sIEdzID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBKcyh0KSkgfSwgdCB9KCksIEpzID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBIcyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyBJLm5vb3AoKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIEtzID0geyBpZ25vcmVFbGVtZW50czogWHMgfTsgdmFyICRzID0geyBpZ25vcmVFbGVtZW50czogZnVuY3Rpb24gKCkgeyByZXR1cm4gS3MuaWdub3JlRWxlbWVudHMoKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuaWdub3JlRWxlbWVudHMgPSAkcy5pZ25vcmVFbGVtZW50czsgdmFyIFFzID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBacyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IHRjKSB9IH0sIHRjID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBlYyh0KSkgfSwgdCB9KCksIGVjID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzLCBlKTsgfSByZXR1cm4gUXMoZSwgdCksIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmRlc3RpbmF0aW9uOyBlLm5leHQodCksIGUuY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLm5vdGlmeUNvbXBsZXRlKCExKTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLm5vdGlmeUNvbXBsZXRlKCEwKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHJjID0geyBpc0VtcHR5OiBacyB9OyB2YXIgbmMgPSB7IGlzRW1wdHk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJjLmlzRW1wdHkoKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuaXNFbXB0eSA9IG5jLmlzRW1wdHk7IHZhciBpYyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgb2MgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgc2ModCkpIH0gfSwgc2MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBjYyh0LCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IpKSB9LCB0IH0oKSwgY2MgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSByLCB0aGlzLmhhc1ZhbHVlID0gITE7IH0gcmV0dXJuIGljKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IGlmICh0aGlzLnZhbHVlID0gdCwgdGhpcy5oYXNWYWx1ZSA9ICEwLCAhdGhpcy50aHJvdHRsZWQpIHsgdmFyIGUgPSBmLnRyeUNhdGNoKHRoaXMuZHVyYXRpb25TZWxlY3RvcikodCk7IGlmIChlID09PSBsLmVycm9yT2JqZWN0KSB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKGwuZXJyb3JPYmplY3QuZSk7IGVsc2UgeyB2YXIgciA9IGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIGUpOyByLmNsb3NlZCA/IHRoaXMuY2xlYXJUaHJvdHRsZSgpIDogdGhpcy5hZGQodGhpcy50aHJvdHRsZWQgPSByKTsgfSB9IH0sIGUucHJvdG90eXBlLmNsZWFyVGhyb3R0bGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgZSA9IHQudmFsdWUsIHIgPSB0Lmhhc1ZhbHVlLCBuID0gdC50aHJvdHRsZWQ7IG4gJiYgKHRoaXMucmVtb3ZlKG4pLCB0aGlzLnRocm90dGxlZCA9IG51bGwsIG4udW5zdWJzY3JpYmUoKSksIHIgJiYgKHRoaXMudmFsdWUgPSBudWxsLCB0aGlzLmhhc1ZhbHVlID0gITEsIHRoaXMuZGVzdGluYXRpb24ubmV4dChlKSk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbikgeyB0aGlzLmNsZWFyVGhyb3R0bGUoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuY2xlYXJUaHJvdHRsZSgpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgdWMgPSB7IGF1ZGl0OiBvYyB9OyB2YXIgYWMgPSB7IGF1ZGl0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdWMuYXVkaXQodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmF1ZGl0ID0gYWMuYXVkaXQ7IHZhciBoYyA9IHsgYXVkaXRUaW1lOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gVmUuYXN5bmMpLCB1Yy5hdWRpdCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gcHIudGltZXIodCwgZSkgfSkpIH0gfTsgdmFyIGxjID0geyBhdWRpdFRpbWU6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBWZS5hc3luYyksIGhjLmF1ZGl0VGltZSh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuYXVkaXRUaW1lID0gbGMuYXVkaXRUaW1lOyB2YXIgcGMgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIGZjID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLmxpZnQobmV3IGJjKHQsIGUsIHIsIG4pKSB9IH0sIGJjID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy5wcmVkaWNhdGUgPSB0LCB0aGlzLnJlc3VsdFNlbGVjdG9yID0gZSwgdGhpcy5kZWZhdWx0VmFsdWUgPSByLCB0aGlzLnNvdXJjZSA9IG47IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IGRjKHQsIHRoaXMucHJlZGljYXRlLCB0aGlzLnJlc3VsdFNlbGVjdG9yLCB0aGlzLmRlZmF1bHRWYWx1ZSwgdGhpcy5zb3VyY2UpKSB9LCB0IH0oKSwgZGMgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBuLCB0aGlzLmRlZmF1bHRWYWx1ZSA9IGksIHRoaXMuc291cmNlID0gbywgdGhpcy5oYXNWYWx1ZSA9ICExLCB0aGlzLmluZGV4ID0gMCwgdm9pZCAwICE9PSBpICYmICh0aGlzLmxhc3RWYWx1ZSA9IGksIHRoaXMuaGFzVmFsdWUgPSAhMCk7IH0gcmV0dXJuIHBjKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5pbmRleCsrOyBpZiAodGhpcy5wcmVkaWNhdGUpIHRoaXMuX3RyeVByZWRpY2F0ZSh0LCBlKTsgZWxzZSB7IGlmICh0aGlzLnJlc3VsdFNlbGVjdG9yKSByZXR1cm4gdm9pZCB0aGlzLl90cnlSZXN1bHRTZWxlY3Rvcih0LCBlKTsgdGhpcy5sYXN0VmFsdWUgPSB0LCB0aGlzLmhhc1ZhbHVlID0gITA7IH0gfSwgZS5wcm90b3R5cGUuX3RyeVByZWRpY2F0ZSA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByOyB0cnkgeyByID0gdGhpcy5wcmVkaWNhdGUodCwgZSwgdGhpcy5zb3VyY2UpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCkgfSBpZiAocikgeyBpZiAodGhpcy5yZXN1bHRTZWxlY3RvcikgcmV0dXJuIHZvaWQgdGhpcy5fdHJ5UmVzdWx0U2VsZWN0b3IodCwgZSk7IHRoaXMubGFzdFZhbHVlID0gdCwgdGhpcy5oYXNWYWx1ZSA9ICEwOyB9IH0sIGUucHJvdG90eXBlLl90cnlSZXN1bHRTZWxlY3RvciA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByOyB0cnkgeyByID0gdGhpcy5yZXN1bHRTZWxlY3Rvcih0LCBlKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gdGhpcy5sYXN0VmFsdWUgPSByLCB0aGlzLmhhc1ZhbHVlID0gITA7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmRlc3RpbmF0aW9uOyB0aGlzLmhhc1ZhbHVlID8gKHQubmV4dCh0aGlzLmxhc3RWYWx1ZSksIHQuY29tcGxldGUoKSkgOiB0LmVycm9yKG5ldyBqcy5FbXB0eUVycm9yKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHljID0geyBsYXN0OiBmYyB9OyB2YXIgdmMgPSB7IGxhc3Q6IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiB5Yy5sYXN0KHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5sYXN0ID0gdmMubGFzdDsgdmFyIG1jID0geyBsZXRQcm90bzogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmxldCA9IG1jLmxldFByb3RvLCBOLk9ic2VydmFibGUucHJvdG90eXBlLmxldEJpbmQgPSBtYy5sZXRQcm90bzsgdmFyIHdjID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBfYyA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAocikgeyByZXR1cm4gci5saWZ0KG5ldyB4Yyh0LCBlLCByKSkgfSB9LCB4YyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlLCByKSB7IHRoaXMucHJlZGljYXRlID0gdCwgdGhpcy50aGlzQXJnID0gZSwgdGhpcy5zb3VyY2UgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBPYyh0LCB0aGlzLnByZWRpY2F0ZSwgdGhpcy50aGlzQXJnLCB0aGlzLnNvdXJjZSkpIH0sIHQgfSgpLCBPYyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB0LmNhbGwodGhpcywgZSksIHRoaXMucHJlZGljYXRlID0gciwgdGhpcy50aGlzQXJnID0gbiwgdGhpcy5zb3VyY2UgPSBpLCB0aGlzLmluZGV4ID0gMCwgdGhpcy50aGlzQXJnID0gbiB8fCB0aGlzOyB9IHJldHVybiB3YyhlLCB0KSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLm5leHQodCksIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9ICExOyB0cnkgeyBlID0gdGhpcy5wcmVkaWNhdGUuY2FsbCh0aGlzLnRoaXNBcmcsIHQsIHRoaXMuaW5kZXgrKywgdGhpcy5zb3VyY2UpOyB9IGNhdGNoICh0KSB7IHJldHVybiB2b2lkIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCkgfSBlIHx8IHRoaXMubm90aWZ5Q29tcGxldGUoITEpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMubm90aWZ5Q29tcGxldGUoITApOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgU2MgPSB7IGV2ZXJ5OiBfYyB9OyB2YXIgZ2MgPSB7IGV2ZXJ5OiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gU2MuZXZlcnkodCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLmV2ZXJ5ID0gZ2MuZXZlcnk7IHZhciBUYyA9IHsgbWFwOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gTnIubWFwKHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5tYXAgPSBUYy5tYXA7IHZhciBqYyA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgRWMgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgSWModCkpIH0gfSwgSWMgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLnZhbHVlID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgQWModCwgdGhpcy52YWx1ZSkpIH0sIHQgfSgpLCBBYyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMudmFsdWUgPSByOyB9IHJldHVybiBqYyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLm5leHQodGhpcy52YWx1ZSk7IH0sIGUgfShULlN1YnNjcmliZXIpLCBDYyA9IHsgbWFwVG86IEVjIH07IHZhciBOYyA9IHsgbWFwVG86IGZ1bmN0aW9uICh0KSB7IHJldHVybiBDYy5tYXBUbyh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUubWFwVG8gPSBOYy5tYXBUbzsgdmFyIFBjID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBrYyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IFZjKSB9IH0sIFZjID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBGYyh0KSkgfSwgdCB9KCksIEZjID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzLCBlKTsgfSByZXR1cm4gUGMoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVOZXh0KHQpKTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmRlc3RpbmF0aW9uOyBlLm5leHQoTXQuTm90aWZpY2F0aW9uLmNyZWF0ZUVycm9yKHQpKSwgZS5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5kZXN0aW5hdGlvbjsgdC5uZXh0KE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVDb21wbGV0ZSgpKSwgdC5jb21wbGV0ZSgpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgUmMgPSB7IG1hdGVyaWFsaXplOiBrYyB9OyB2YXIgTWMgPSB7IG1hdGVyaWFsaXplOiBmdW5jdGlvbiAoKSB7IHJldHVybiBSYy5tYXRlcmlhbGl6ZSgpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5tYXRlcmlhbGl6ZSA9IE1jLm1hdGVyaWFsaXplOyB2YXIgV2MgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIHFjID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHIgPSAhMTsgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gMiAmJiAociA9ICEwKSwgZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG4ubGlmdChuZXcgTGModCwgZSwgcikpIH0gfSwgTGMgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgcikgeyB2b2lkIDAgPT09IHIgJiYgKHIgPSAhMSksIHRoaXMuYWNjdW11bGF0b3IgPSB0LCB0aGlzLnNlZWQgPSBlLCB0aGlzLmhhc1NlZWQgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBVYyh0LCB0aGlzLmFjY3VtdWxhdG9yLCB0aGlzLnNlZWQsIHRoaXMuaGFzU2VlZCkpIH0sIHQgfSgpLCBVYyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYWNjdW11bGF0b3IgPSByLCB0aGlzLl9zZWVkID0gbiwgdGhpcy5oYXNTZWVkID0gaSwgdGhpcy5pbmRleCA9IDA7IH0gcmV0dXJuIFdjKGUsIHQpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsICJzZWVkIiwgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX3NlZWQgfSwgc2V0OiBmdW5jdGlvbiAodCkgeyB0aGlzLmhhc1NlZWQgPSAhMCwgdGhpcy5fc2VlZCA9IHQ7IH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IGlmICh0aGlzLmhhc1NlZWQpIHJldHVybiB0aGlzLl90cnlOZXh0KHQpOyB0aGlzLnNlZWQgPSB0LCB0aGlzLmRlc3RpbmF0aW9uLm5leHQodCk7IH0sIGUucHJvdG90eXBlLl90cnlOZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUsIHIgPSB0aGlzLmluZGV4Kys7IHRyeSB7IGUgPSB0aGlzLmFjY3VtdWxhdG9yKHRoaXMuc2VlZCwgdCwgcik7IH0gY2F0Y2ggKHQpIHsgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KTsgfSB0aGlzLnNlZWQgPSBlLCB0aGlzLmRlc3RpbmF0aW9uLm5leHQoZSk7IH0sIGUgfShULlN1YnNjcmliZXIpLCB6YyA9IHsgc2NhbjogcWMgfSwgQmMgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIERjID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiAwID09PSB0ID8gbmV3IGl0LkVtcHR5T2JzZXJ2YWJsZSA6IGUubGlmdChuZXcgWWModCkpIH0gfSwgWWMgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyBpZiAodGhpcy50b3RhbCA9IHQsIHRoaXMudG90YWwgPCAwKSB0aHJvdyBuZXcgJG8uQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgSGModCwgdGhpcy50b3RhbCkpIH0sIHQgfSgpLCBIYyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMudG90YWwgPSByLCB0aGlzLnJpbmcgPSBuZXcgQXJyYXksIHRoaXMuY291bnQgPSAwOyB9IHJldHVybiBCYyhlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMucmluZywgciA9IHRoaXMudG90YWwsIG4gPSB0aGlzLmNvdW50Kys7IGUubGVuZ3RoIDwgciA/IGUucHVzaCh0KSA6IGVbbiAlIHJdID0gdDsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuZGVzdGluYXRpb24sIGUgPSB0aGlzLmNvdW50OyBpZiAoZSA+IDApIGZvciAodmFyIHIgPSB0aGlzLmNvdW50ID49IHRoaXMudG90YWwgPyB0aGlzLnRvdGFsIDogdGhpcy5jb3VudCwgbiA9IHRoaXMucmluZywgaSA9IDA7IGkgPCByOyBpKyspIHsgdmFyIG8gPSBlKysgJSByOyB0Lm5leHQobltvXSk7IH0gdC5jb21wbGV0ZSgpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgWGMgPSB7IHRha2VMYXN0OiBEYyB9OyB2YXIgR2MgPSB7IHJlZHVjZTogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gMiA/IGZ1bmN0aW9uIChyKSB7IHJldHVybiBDLnBpcGUoemMuc2Nhbih0LCBlKSwgWGMudGFrZUxhc3QoMSksIFlpLmRlZmF1bHRJZkVtcHR5KGUpKShyKSB9IDogZnVuY3Rpb24gKGUpIHsgcmV0dXJuIEMucGlwZSh6Yy5zY2FuKChmdW5jdGlvbiAoZSwgciwgbikgeyByZXR1cm4gdChlLCByLCBuICsgMSkgfSkpLCBYYy50YWtlTGFzdCgxKSkoZSkgfSB9IH07IHZhciBKYyA9IHsgbWF4OiBmdW5jdGlvbiAodCkgeyB2YXIgZSA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQgPyBmdW5jdGlvbiAoZSwgcikgeyByZXR1cm4gdChlLCByKSA+IDAgPyBlIDogciB9IDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHQgPiBlID8gdCA6IGUgfTsgcmV0dXJuIEdjLnJlZHVjZShlKSB9IH07IHZhciBLYyA9IHsgbWF4OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gSmMubWF4KHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5tYXggPSBLYy5tYXg7IHZhciAkYyA9IHsgbWVyZ2VTdGF0aWM6IE1lLm1lcmdlLCBtZXJnZTogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdC5jYWxsKE1lLm1lcmdlLmFwcGx5KHZvaWQgMCwgW2VdLmNvbmNhdCh0KSkpIH0gfSB9OyB2YXIgUWMgPSB7IG1lcmdlU3RhdGljOiBNZS5tZXJnZSwgbWVyZ2U6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgcmV0dXJuICRjLm1lcmdlLmFwcGx5KHZvaWQgMCwgdCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLm1lcmdlID0gUWMubWVyZ2U7IHZhciBaYyA9IHsgbWVyZ2VBbGw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB2b2lkIDAgPT09IHQgJiYgKHQgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCBlZS5tZXJnZUFsbCh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUubWVyZ2VBbGwgPSBaYy5tZXJnZUFsbDsgdmFyIHR1ID0geyBtZXJnZU1hcDogZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIFp0Lm1lcmdlTWFwKHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5tZXJnZU1hcCA9IHR1Lm1lcmdlTWFwLCBOLk9ic2VydmFibGUucHJvdG90eXBlLmZsYXRNYXAgPSB0dS5tZXJnZU1hcDsgdmFyIGV1ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBydSA9IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiB2b2lkIDAgPT09IHIgJiYgKHIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCAibnVtYmVyIiA9PSB0eXBlb2YgZSAmJiAociA9IGUsIGUgPSBudWxsKSwgZnVuY3Rpb24gKG4pIHsgcmV0dXJuIG4ubGlmdChuZXcgbnUodCwgZSwgcikpIH0gfSwgbnUgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgcikgeyB2b2lkIDAgPT09IHIgJiYgKHIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCB0aGlzLmlzaCA9IHQsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBlLCB0aGlzLmNvbmN1cnJlbnQgPSByOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBvdSh0LCB0aGlzLmlzaCwgdGhpcy5yZXN1bHRTZWxlY3RvciwgdGhpcy5jb25jdXJyZW50KSkgfSwgdCB9KCksIGl1ID0gbnUsIG91ID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuLCBpKSB7IHZvaWQgMCA9PT0gaSAmJiAoaSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5pc2ggPSByLCB0aGlzLnJlc3VsdFNlbGVjdG9yID0gbiwgdGhpcy5jb25jdXJyZW50ID0gaSwgdGhpcy5oYXNDb21wbGV0ZWQgPSAhMSwgdGhpcy5idWZmZXIgPSBbXSwgdGhpcy5hY3RpdmUgPSAwLCB0aGlzLmluZGV4ID0gMDsgfSByZXR1cm4gZXUoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgaWYgKHRoaXMuYWN0aXZlIDwgdGhpcy5jb25jdXJyZW50KSB7IHZhciBlID0gdGhpcy5yZXN1bHRTZWxlY3RvciwgciA9IHRoaXMuaW5kZXgrKywgbiA9IHRoaXMuaXNoLCBpID0gdGhpcy5kZXN0aW5hdGlvbjsgdGhpcy5hY3RpdmUrKywgdGhpcy5faW5uZXJTdWIobiwgaSwgZSwgdCwgcik7IH0gZWxzZSB0aGlzLmJ1ZmZlci5wdXNoKHQpOyB9LCBlLnByb3RvdHlwZS5faW5uZXJTdWIgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCB0LCBuLCBpKSk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5oYXNDb21wbGV0ZWQgPSAhMCwgMCA9PT0gdGhpcy5hY3RpdmUgJiYgMCA9PT0gdGhpcy5idWZmZXIubGVuZ3RoICYmIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHZhciBvID0gdGhpcy5yZXN1bHRTZWxlY3RvciwgcyA9IHRoaXMuZGVzdGluYXRpb247IG8gPyB0aGlzLnRyeVNlbGVjdFJlc3VsdCh0LCBlLCByLCBuKSA6IHMubmV4dChlKTsgfSwgZS5wcm90b3R5cGUudHJ5U2VsZWN0UmVzdWx0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsgdmFyIGksIG8gPSB0aGlzLnJlc3VsdFNlbGVjdG9yLCBzID0gdGhpcy5kZXN0aW5hdGlvbjsgdHJ5IHsgaSA9IG8odCwgZSwgciwgbik7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgcy5lcnJvcih0KSB9IHMubmV4dChpKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5idWZmZXI7IHRoaXMucmVtb3ZlKHQpLCB0aGlzLmFjdGl2ZS0tLCBlLmxlbmd0aCA+IDAgPyB0aGlzLl9uZXh0KGUuc2hpZnQoKSkgOiAwID09PSB0aGlzLmFjdGl2ZSAmJiB0aGlzLmhhc0NvbXBsZXRlZCAmJiB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBzdSA9IHsgbWVyZ2VNYXBUbzogcnUsIE1lcmdlTWFwVG9PcGVyYXRvcjogaXUsIE1lcmdlTWFwVG9TdWJzY3JpYmVyOiBvdSB9OyB2YXIgY3UgPSB7IG1lcmdlTWFwVG86IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiB2b2lkIDAgPT09IHIgJiYgKHIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCBzdS5tZXJnZU1hcFRvKHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5mbGF0TWFwVG8gPSBjdS5tZXJnZU1hcFRvLCBOLk9ic2VydmFibGUucHJvdG90eXBlLm1lcmdlTWFwVG8gPSBjdS5tZXJnZU1hcFRvOyB2YXIgdXUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIGF1ID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLmxpZnQobmV3IGh1KHQsIGUsIHIpKSB9IH0sIGh1ID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIpIHsgdGhpcy5hY2N1bXVsYXRvciA9IHQsIHRoaXMuc2VlZCA9IGUsIHRoaXMuY29uY3VycmVudCA9IHI7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IHB1KHQsIHRoaXMuYWNjdW11bGF0b3IsIHRoaXMuc2VlZCwgdGhpcy5jb25jdXJyZW50KSkgfSwgdCB9KCksIGx1ID0gaHUsIHB1ID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuLCBpKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5hY2N1bXVsYXRvciA9IHIsIHRoaXMuYWNjID0gbiwgdGhpcy5jb25jdXJyZW50ID0gaSwgdGhpcy5oYXNWYWx1ZSA9ICExLCB0aGlzLmhhc0NvbXBsZXRlZCA9ICExLCB0aGlzLmJ1ZmZlciA9IFtdLCB0aGlzLmFjdGl2ZSA9IDAsIHRoaXMuaW5kZXggPSAwOyB9IHJldHVybiB1dShlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyBpZiAodGhpcy5hY3RpdmUgPCB0aGlzLmNvbmN1cnJlbnQpIHsgdmFyIGUgPSB0aGlzLmluZGV4KyssIHIgPSBmLnRyeUNhdGNoKHRoaXMuYWNjdW11bGF0b3IpKHRoaXMuYWNjLCB0KSwgbiA9IHRoaXMuZGVzdGluYXRpb247IHIgPT09IGwuZXJyb3JPYmplY3QgPyBuLmVycm9yKGwuZXJyb3JPYmplY3QuZSkgOiAodGhpcy5hY3RpdmUrKywgdGhpcy5faW5uZXJTdWIociwgdCwgZSkpOyB9IGVsc2UgdGhpcy5idWZmZXIucHVzaCh0KTsgfSwgZS5wcm90b3R5cGUuX2lubmVyU3ViID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgdGhpcy5hZGQoYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgdCwgZSwgcikpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaGFzQ29tcGxldGVkID0gITAsIDAgPT09IHRoaXMuYWN0aXZlICYmIDAgPT09IHRoaXMuYnVmZmVyLmxlbmd0aCAmJiAoITEgPT09IHRoaXMuaGFzVmFsdWUgJiYgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHRoaXMuYWNjKSwgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHZhciBvID0gdGhpcy5kZXN0aW5hdGlvbjsgdGhpcy5hY2MgPSBlLCB0aGlzLmhhc1ZhbHVlID0gITAsIG8ubmV4dChlKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMuYnVmZmVyOyB0aGlzLnJlbW92ZSh0KSwgdGhpcy5hY3RpdmUtLSwgZS5sZW5ndGggPiAwID8gdGhpcy5fbmV4dChlLnNoaWZ0KCkpIDogMCA9PT0gdGhpcy5hY3RpdmUgJiYgdGhpcy5oYXNDb21wbGV0ZWQgJiYgKCExID09PSB0aGlzLmhhc1ZhbHVlICYmIHRoaXMuZGVzdGluYXRpb24ubmV4dCh0aGlzLmFjYyksIHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKSk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBmdSA9IHsgbWVyZ2VTY2FuOiBhdSwgTWVyZ2VTY2FuT3BlcmF0b3I6IGx1LCBNZXJnZVNjYW5TdWJzY3JpYmVyOiBwdSB9OyB2YXIgYnUgPSB7IG1lcmdlU2NhbjogZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIGZ1Lm1lcmdlU2Nhbih0LCBlLCByKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUubWVyZ2VTY2FuID0gYnUubWVyZ2VTY2FuOyB2YXIgZHUgPSB7IG1pbjogZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ID8gZnVuY3Rpb24gKGUsIHIpIHsgcmV0dXJuIHQoZSwgcikgPCAwID8gZSA6IHIgfSA6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB0IDwgZSA/IHQgOiBlIH07IHJldHVybiBHYy5yZWR1Y2UoZSkgfSB9OyB2YXIgeXUgPSB7IG1pbjogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGR1Lm1pbih0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUubWluID0geXUubWluOyB2YXIgdnUgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIG11ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQubGlmdChuZXcgd3UodCkpIH0gfSwgd3UgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLmNvbm5lY3RhYmxlID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByID0gdGhpcy5jb25uZWN0YWJsZTsgci5fcmVmQ291bnQrKzsgdmFyIG4gPSBuZXcgX3UodCwgciksIGkgPSBlLnN1YnNjcmliZShuKTsgcmV0dXJuIG4uY2xvc2VkIHx8IChuLmNvbm5lY3Rpb24gPSByLmNvbm5lY3QoKSksIGkgfSwgdCB9KCksIF91ID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5jb25uZWN0YWJsZSA9IHI7IH0gcmV0dXJuIHZ1KGUsIHQpLCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5jb25uZWN0YWJsZTsgaWYgKHQpIHsgdGhpcy5jb25uZWN0YWJsZSA9IG51bGw7IHZhciBlID0gdC5fcmVmQ291bnQ7IGlmIChlIDw9IDApIHRoaXMuY29ubmVjdGlvbiA9IG51bGw7IGVsc2UgaWYgKHQuX3JlZkNvdW50ID0gZSAtIDEsIGUgPiAxKSB0aGlzLmNvbm5lY3Rpb24gPSBudWxsOyBlbHNlIHsgdmFyIHIgPSB0aGlzLmNvbm5lY3Rpb24sIG4gPSB0Ll9jb25uZWN0aW9uOyB0aGlzLmNvbm5lY3Rpb24gPSBudWxsLCAhbiB8fCByICYmIG4gIT09IHIgfHwgbi51bnN1YnNjcmliZSgpOyB9IH0gZWxzZSB0aGlzLmNvbm5lY3Rpb24gPSBudWxsOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgeHUgPSB7IHJlZkNvdW50OiBtdSB9LCBPdSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBTdSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMuc291cmNlID0gZSwgdGhpcy5zdWJqZWN0RmFjdG9yeSA9IHIsIHRoaXMuX3JlZkNvdW50ID0gMCwgdGhpcy5faXNDb21wbGV0ZSA9ICExOyB9IHJldHVybiBPdShlLCB0KSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0aGlzLmdldFN1YmplY3QoKS5zdWJzY3JpYmUodCkgfSwgZS5wcm90b3R5cGUuZ2V0U3ViamVjdCA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLl9zdWJqZWN0OyByZXR1cm4gdCAmJiAhdC5pc1N0b3BwZWQgfHwgKHRoaXMuX3N1YmplY3QgPSB0aGlzLnN1YmplY3RGYWN0b3J5KCkpLCB0aGlzLl9zdWJqZWN0IH0sIGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5fY29ubmVjdGlvbjsgcmV0dXJuIHQgfHwgKHRoaXMuX2lzQ29tcGxldGUgPSAhMSwgKHQgPSB0aGlzLl9jb25uZWN0aW9uID0gbmV3IHYuU3Vic2NyaXB0aW9uKS5hZGQodGhpcy5zb3VyY2Uuc3Vic2NyaWJlKG5ldyBFdSh0aGlzLmdldFN1YmplY3QoKSwgdGhpcykpKSwgdC5jbG9zZWQgPyAodGhpcy5fY29ubmVjdGlvbiA9IG51bGwsIHQgPSB2LlN1YnNjcmlwdGlvbi5FTVBUWSkgOiB0aGlzLl9jb25uZWN0aW9uID0gdCksIHQgfSwgZS5wcm90b3R5cGUucmVmQ291bnQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB4dS5yZWZDb3VudCgpKHRoaXMpIH0sIGUgfShOLk9ic2VydmFibGUpLCBndSA9IFN1LCBUdSA9IFN1LnByb3RvdHlwZSwganUgPSB7IG9wZXJhdG9yOiB7IHZhbHVlOiBudWxsIH0sIF9yZWZDb3VudDogeyB2YWx1ZTogMCwgd3JpdGFibGU6ICEwIH0sIF9zdWJqZWN0OiB7IHZhbHVlOiBudWxsLCB3cml0YWJsZTogITAgfSwgX2Nvbm5lY3Rpb246IHsgdmFsdWU6IG51bGwsIHdyaXRhYmxlOiAhMCB9LCBfc3Vic2NyaWJlOiB7IHZhbHVlOiBUdS5fc3Vic2NyaWJlIH0sIF9pc0NvbXBsZXRlOiB7IHZhbHVlOiBUdS5faXNDb21wbGV0ZSwgd3JpdGFibGU6ICEwIH0sIGdldFN1YmplY3Q6IHsgdmFsdWU6IFR1LmdldFN1YmplY3QgfSwgY29ubmVjdDogeyB2YWx1ZTogVHUuY29ubmVjdCB9LCByZWZDb3VudDogeyB2YWx1ZTogVHUucmVmQ291bnQgfSB9LCBFdSA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuY29ubmVjdGFibGUgPSByOyB9IHJldHVybiBPdShlLCB0KSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fdW5zdWJzY3JpYmUoKSwgdC5wcm90b3R5cGUuX2Vycm9yLmNhbGwodGhpcywgZSk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5jb25uZWN0YWJsZS5faXNDb21wbGV0ZSA9ICEwLCB0aGlzLl91bnN1YnNjcmliZSgpLCB0LnByb3RvdHlwZS5fY29tcGxldGUuY2FsbCh0aGlzKTsgfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMuY29ubmVjdGFibGU7IGlmICh0KSB7IHRoaXMuY29ubmVjdGFibGUgPSBudWxsOyB2YXIgZSA9IHQuX2Nvbm5lY3Rpb247IHQuX3JlZkNvdW50ID0gMCwgdC5fc3ViamVjdCA9IG51bGwsIHQuX2Nvbm5lY3Rpb24gPSBudWxsLCBlICYmIGUudW5zdWJzY3JpYmUoKTsgfSB9LCBlIH0oei5TdWJqZWN0U3Vic2NyaWJlciksIEl1ID0gKGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuY29ubmVjdGFibGUgPSByOyB9IE91KGUsIHQpLCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5jb25uZWN0YWJsZTsgaWYgKHQpIHsgdGhpcy5jb25uZWN0YWJsZSA9IG51bGw7IHZhciBlID0gdC5fcmVmQ291bnQ7IGlmIChlIDw9IDApIHRoaXMuY29ubmVjdGlvbiA9IG51bGw7IGVsc2UgaWYgKHQuX3JlZkNvdW50ID0gZSAtIDEsIGUgPiAxKSB0aGlzLmNvbm5lY3Rpb24gPSBudWxsOyBlbHNlIHsgdmFyIHIgPSB0aGlzLmNvbm5lY3Rpb24sIG4gPSB0Ll9jb25uZWN0aW9uOyB0aGlzLmNvbm5lY3Rpb24gPSBudWxsLCAhbiB8fCByICYmIG4gIT09IHIgfHwgbi51bnN1YnNjcmliZSgpOyB9IH0gZWxzZSB0aGlzLmNvbm5lY3Rpb24gPSBudWxsOyB9OyB9KFQuU3Vic2NyaWJlciksIHsgQ29ubmVjdGFibGVPYnNlcnZhYmxlOiBndSwgY29ubmVjdGFibGVPYnNlcnZhYmxlRGVzY3JpcHRvcjoganUgfSk7IHZhciBBdSA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAocikgeyB2YXIgbjsgaWYgKG4gPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0ID8gdCA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHQgfSwgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZSkgcmV0dXJuIHIubGlmdChuZXcgQ3UobiwgZSkpOyB2YXIgaSA9IE9iamVjdC5jcmVhdGUociwgSXUuY29ubmVjdGFibGVPYnNlcnZhYmxlRGVzY3JpcHRvcik7IHJldHVybiBpLnNvdXJjZSA9IHIsIGkuc3ViamVjdEZhY3RvcnkgPSBuLCBpIH0gfSwgQ3UgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSkgeyB0aGlzLnN1YmplY3RGYWN0b3J5ID0gdCwgdGhpcy5zZWxlY3RvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHRoaXMuc2VsZWN0b3IsIG4gPSB0aGlzLnN1YmplY3RGYWN0b3J5KCksIGkgPSByKG4pLnN1YnNjcmliZSh0KTsgcmV0dXJuIGkuYWRkKGUuc3Vic2NyaWJlKG4pKSwgaSB9LCB0IH0oKSwgTnUgPSB7IG11bHRpY2FzdDogQXUsIE11bHRpY2FzdE9wZXJhdG9yOiBDdSB9OyB2YXIgUHUgPSB7IG11bHRpY2FzdDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIE51Lm11bHRpY2FzdCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUubXVsdGljYXN0ID0gUHUubXVsdGljYXN0OyB2YXIga3UgPSB7IG9ic2VydmVPbjogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCBEdC5vYnNlcnZlT24odCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLm9ic2VydmVPbiA9IGt1Lm9ic2VydmVPbjsgdmFyIFZ1ID0geyBvbkVycm9yUmVzdW1lTmV4dDogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gJGUub25FcnJvclJlc3VtZU5leHQuYXBwbHkodm9pZCAwLCB0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUub25FcnJvclJlc3VtZU5leHQgPSBWdS5vbkVycm9yUmVzdW1lTmV4dDsgdmFyIEZ1ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBSdSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IE11KSB9IH0sIE11ID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KCkgeyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBXdSh0KSkgfSwgdCB9KCksIFd1ID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5oYXNQcmV2ID0gITE7IH0gcmV0dXJuIEZ1KGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuaGFzUHJldiA/IHRoaXMuZGVzdGluYXRpb24ubmV4dChbdGhpcy5wcmV2LCB0XSkgOiB0aGlzLmhhc1ByZXYgPSAhMCwgdGhpcy5wcmV2ID0gdDsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHF1ID0geyBwYWlyd2lzZTogUnUgfTsgdmFyIEx1ID0geyBwYWlyd2lzZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gcXUucGFpcndpc2UoKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucGFpcndpc2UgPSBMdS5wYWlyd2lzZTsgdmFyIFV1ID0geyBub3Q6IGZ1bmN0aW9uICh0LCBlKSB7IGZ1bmN0aW9uIHIoKSB7IHJldHVybiAhci5wcmVkLmFwcGx5KHIudGhpc0FyZywgYXJndW1lbnRzKSB9IHJldHVybiByLnByZWQgPSB0LCByLnRoaXNBcmcgPSBlLCByIH0gfTsgdmFyIHp1ID0geyBwYXJ0aXRpb246IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAocikgeyByZXR1cm4gW3VzLmZpbHRlcih0LCBlKShyKSwgdXMuZmlsdGVyKFV1Lm5vdCh0LCBlKSkocildIH0gfSB9OyB2YXIgQnUgPSB7IHBhcnRpdGlvbjogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHp1LnBhcnRpdGlvbih0LCBlKSh0aGlzKSB9IH07IGZ1bmN0aW9uIER1KHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IGZvciAodmFyIG4gPSByLCBpID0gMDsgaSA8IGU7IGkrKykgeyB2YXIgbyA9IG5bdFtpXV07IGlmICh2b2lkIDAgPT09IG8pIHJldHVybjsgbiA9IG87IH0gcmV0dXJuIG4gfSB9IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucGFydGl0aW9uID0gQnUucGFydGl0aW9uOyB2YXIgWXUgPSB7IHBsdWNrOiBmdW5jdGlvbiAoKSB7IGZvciAodmFyIHQgPSBbXSwgZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoOyBlKyspdFtlIC0gMF0gPSBhcmd1bWVudHNbZV07IHZhciByID0gdC5sZW5ndGg7IGlmICgwID09PSByKSB0aHJvdyBuZXcgRXJyb3IoImxpc3Qgb2YgcHJvcGVydGllcyBjYW5ub3QgYmUgZW1wdHkuIik7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gTnIubWFwKER1KHQsIHIpKShlKSB9IH0gfTsgdmFyIEh1ID0geyBwbHVjazogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gWXUucGx1Y2suYXBwbHkodm9pZCAwLCB0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucGx1Y2sgPSBIdS5wbHVjazsgdmFyIFh1ID0geyBwdWJsaXNoOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCA/IE51Lm11bHRpY2FzdCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IHouU3ViamVjdCB9KSwgdCkgOiBOdS5tdWx0aWNhc3QobmV3IHouU3ViamVjdCkgfSB9OyB2YXIgR3UgPSB7IHB1Ymxpc2g6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBYdS5wdWJsaXNoKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5wdWJsaXNoID0gR3UucHVibGlzaDsgdmFyIEp1ID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIEt1ID0geyBCZWhhdmlvclN1YmplY3Q6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSkgeyB0LmNhbGwodGhpcyksIHRoaXMuX3ZhbHVlID0gZTsgfSByZXR1cm4gSnUoZSwgdCksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgInZhbHVlIiwgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKSB9LCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCB9KSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChlKSB7IHZhciByID0gdC5wcm90b3R5cGUuX3N1YnNjcmliZS5jYWxsKHRoaXMsIGUpOyByZXR1cm4gciAmJiAhci5jbG9zZWQgJiYgZS5uZXh0KHRoaXMuX3ZhbHVlKSwgciB9LCBlLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuaGFzRXJyb3IpIHRocm93IHRoaXMudGhyb3duRXJyb3I7IGlmICh0aGlzLmNsb3NlZCkgdGhyb3cgbmV3IGsuT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3I7IHJldHVybiB0aGlzLl92YWx1ZSB9LCBlLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24gKGUpIHsgdC5wcm90b3R5cGUubmV4dC5jYWxsKHRoaXMsIHRoaXMuX3ZhbHVlID0gZSk7IH0sIGUgfSh6LlN1YmplY3QpIH07IHZhciAkdSA9IHsgcHVibGlzaEJlaGF2aW9yOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE51Lm11bHRpY2FzdChuZXcgS3UuQmVoYXZpb3JTdWJqZWN0KHQpKShlKSB9IH0gfTsgdmFyIFF1ID0geyBwdWJsaXNoQmVoYXZpb3I6IGZ1bmN0aW9uICh0KSB7IHJldHVybiAkdS5wdWJsaXNoQmVoYXZpb3IodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnB1Ymxpc2hCZWhhdmlvciA9IFF1LnB1Ymxpc2hCZWhhdmlvcjsgdmFyIFp1ID0geyBwdWJsaXNoUmVwbGF5OiBmdW5jdGlvbiAodCwgZSwgciwgbikgeyByICYmICJmdW5jdGlvbiIgIT0gdHlwZW9mIHIgJiYgKG4gPSByKTsgdmFyIGkgPSAiZnVuY3Rpb24iID09IHR5cGVvZiByID8gciA6IHZvaWQgMCwgbyA9IG5ldyBmbi5SZXBsYXlTdWJqZWN0KHQsIGUsIG4pOyByZXR1cm4gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIE51Lm11bHRpY2FzdCgoZnVuY3Rpb24gKCkgeyByZXR1cm4gbyB9KSwgaSkodCkgfSB9IH07IHZhciB0YSA9IHsgcHVibGlzaFJlcGxheTogZnVuY3Rpb24gKHQsIGUsIHIsIG4pIHsgcmV0dXJuIFp1LnB1Ymxpc2hSZXBsYXkodCwgZSwgciwgbikodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnB1Ymxpc2hSZXBsYXkgPSB0YS5wdWJsaXNoUmVwbGF5OyB2YXIgZWEgPSB7IHB1Ymxpc2hMYXN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAodCkgeyByZXR1cm4gTnUubXVsdGljYXN0KG5ldyBELkFzeW5jU3ViamVjdCkodCkgfSB9IH07IHZhciByYSA9IHsgcHVibGlzaExhc3Q6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGVhLnB1Ymxpc2hMYXN0KCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnB1Ymxpc2hMYXN0ID0gcmEucHVibGlzaExhc3Q7IHZhciBuYSA9IHsgcmFjZTogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIDEgPT09IHQubGVuZ3RoICYmIHUuaXNBcnJheSh0WzBdKSAmJiAodCA9IHRbMF0pLCBlLmxpZnQuY2FsbChCZS5yYWNlLmFwcGx5KHZvaWQgMCwgW2VdLmNvbmNhdCh0KSkpIH0gfSB9OyB2YXIgaWEgPSB7IHJhY2VTdGF0aWM6IEJlLnJhY2UsIHJhY2U6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgcmV0dXJuIG5hLnJhY2UuYXBwbHkodm9pZCAwLCB0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucmFjZSA9IGlhLnJhY2U7IHZhciBvYSA9IHsgcmVkdWNlOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+PSAyID8gR2MucmVkdWNlKHQsIGUpKHRoaXMpIDogR2MucmVkdWNlKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5yZWR1Y2UgPSBvYS5yZWR1Y2U7IHZhciBzYSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgY2EgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gLTEpLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gMCA9PT0gdCA/IG5ldyBpdC5FbXB0eU9ic2VydmFibGUgOiB0IDwgMCA/IGUubGlmdChuZXcgdWEoLTEsIGUpKSA6IGUubGlmdChuZXcgdWEodCAtIDEsIGUpKSB9IH0sIHVhID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5jb3VudCA9IHQsIHRoaXMuc291cmNlID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgYWEodCwgdGhpcy5jb3VudCwgdGhpcy5zb3VyY2UpKSB9LCB0IH0oKSwgYWEgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmNvdW50ID0gciwgdGhpcy5zb3VyY2UgPSBuOyB9IHJldHVybiBzYShlLCB0KSwgZS5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IGlmICghdGhpcy5pc1N0b3BwZWQpIHsgdmFyIGUgPSB0aGlzLnNvdXJjZSwgciA9IHRoaXMuY291bnQ7IGlmICgwID09PSByKSByZXR1cm4gdC5wcm90b3R5cGUuY29tcGxldGUuY2FsbCh0aGlzKTsgciA+IC0xICYmICh0aGlzLmNvdW50ID0gciAtIDEpLCBlLnN1YnNjcmliZSh0aGlzLl91bnN1YnNjcmliZUFuZFJlY3ljbGUoKSk7IH0gfSwgZSB9KFQuU3Vic2NyaWJlciksIGhhID0geyByZXBlYXQ6IGNhIH07IHZhciBsYSA9IHsgcmVwZWF0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gLTEpLCBoYS5yZXBlYXQodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnJlcGVhdCA9IGxhLnJlcGVhdDsgdmFyIHBhID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBmYSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBiYSh0KSkgfSB9LCBiYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMubm90aWZpZXIgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBkYSh0LCB0aGlzLm5vdGlmaWVyLCBlKSkgfSwgdCB9KCksIGRhID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5ub3RpZmllciA9IHIsIHRoaXMuc291cmNlID0gbiwgdGhpcy5zb3VyY2VJc0JlaW5nU3Vic2NyaWJlZFRvID0gITA7IH0gcmV0dXJuIHBhKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5zb3VyY2VJc0JlaW5nU3Vic2NyaWJlZFRvID0gITAsIHRoaXMuc291cmNlLnN1YnNjcmliZSh0aGlzKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoZSkgeyBpZiAoITEgPT09IHRoaXMuc291cmNlSXNCZWluZ1N1YnNjcmliZWRUbykgcmV0dXJuIHQucHJvdG90eXBlLmNvbXBsZXRlLmNhbGwodGhpcykgfSwgZS5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IGlmICh0aGlzLnNvdXJjZUlzQmVpbmdTdWJzY3JpYmVkVG8gPSAhMSwgIXRoaXMuaXNTdG9wcGVkKSB7IGlmICh0aGlzLnJldHJpZXMgfHwgdGhpcy5zdWJzY3JpYmVUb1JldHJpZXMoKSwgIXRoaXMucmV0cmllc1N1YnNjcmlwdGlvbiB8fCB0aGlzLnJldHJpZXNTdWJzY3JpcHRpb24uY2xvc2VkKSByZXR1cm4gdC5wcm90b3R5cGUuY29tcGxldGUuY2FsbCh0aGlzKTsgdGhpcy5fdW5zdWJzY3JpYmVBbmRSZWN5Y2xlKCksIHRoaXMubm90aWZpY2F0aW9ucy5uZXh0KCk7IH0gfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMubm90aWZpY2F0aW9ucywgZSA9IHRoaXMucmV0cmllc1N1YnNjcmlwdGlvbjsgdCAmJiAodC51bnN1YnNjcmliZSgpLCB0aGlzLm5vdGlmaWNhdGlvbnMgPSBudWxsKSwgZSAmJiAoZS51bnN1YnNjcmliZSgpLCB0aGlzLnJldHJpZXNTdWJzY3JpcHRpb24gPSBudWxsKSwgdGhpcy5yZXRyaWVzID0gbnVsbDsgfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlQW5kUmVjeWNsZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLCByID0gZS5ub3RpZmljYXRpb25zLCBuID0gZS5yZXRyaWVzLCBpID0gZS5yZXRyaWVzU3Vic2NyaXB0aW9uOyByZXR1cm4gdGhpcy5ub3RpZmljYXRpb25zID0gbnVsbCwgdGhpcy5yZXRyaWVzID0gbnVsbCwgdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uID0gbnVsbCwgdC5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlQW5kUmVjeWNsZS5jYWxsKHRoaXMpLCB0aGlzLm5vdGlmaWNhdGlvbnMgPSByLCB0aGlzLnJldHJpZXMgPSBuLCB0aGlzLnJldHJpZXNTdWJzY3JpcHRpb24gPSBpLCB0aGlzIH0sIGUucHJvdG90eXBlLnN1YnNjcmliZVRvUmV0cmllcyA9IGZ1bmN0aW9uICgpIHsgdGhpcy5ub3RpZmljYXRpb25zID0gbmV3IHouU3ViamVjdDsgdmFyIGUgPSBmLnRyeUNhdGNoKHRoaXMubm90aWZpZXIpKHRoaXMubm90aWZpY2F0aW9ucyk7IGlmIChlID09PSBsLmVycm9yT2JqZWN0KSByZXR1cm4gdC5wcm90b3R5cGUuY29tcGxldGUuY2FsbCh0aGlzKTsgdGhpcy5yZXRyaWVzID0gZSwgdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgZSk7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCB5YSA9IHsgcmVwZWF0V2hlbjogZmEgfTsgdmFyIHZhID0geyByZXBlYXRXaGVuOiBmdW5jdGlvbiAodCkgeyByZXR1cm4geWEucmVwZWF0V2hlbih0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucmVwZWF0V2hlbiA9IHZhLnJlcGVhdFdoZW47IHZhciBtYSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgd2EgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gLTEpLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBfYSh0LCBlKSkgfSB9LCBfYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMuY291bnQgPSB0LCB0aGlzLnNvdXJjZSA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IHhhKHQsIHRoaXMuY291bnQsIHRoaXMuc291cmNlKSkgfSwgdCB9KCksIHhhID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5jb3VudCA9IHIsIHRoaXMuc291cmNlID0gbjsgfSByZXR1cm4gbWEoZSwgdCksIGUucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgaWYgKCF0aGlzLmlzU3RvcHBlZCkgeyB2YXIgciA9IHRoaXMuc291cmNlLCBuID0gdGhpcy5jb3VudDsgaWYgKDAgPT09IG4pIHJldHVybiB0LnByb3RvdHlwZS5lcnJvci5jYWxsKHRoaXMsIGUpOyBuID4gLTEgJiYgKHRoaXMuY291bnQgPSBuIC0gMSksIHIuc3Vic2NyaWJlKHRoaXMuX3Vuc3Vic2NyaWJlQW5kUmVjeWNsZSgpKTsgfSB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgT2EgPSB7IHJldHJ5OiB3YSB9OyB2YXIgU2EgPSB7IHJldHJ5OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gLTEpLCBPYS5yZXRyeSh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUucmV0cnkgPSBTYS5yZXRyeTsgdmFyIGdhID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBUYSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBqYSh0LCBlKSkgfSB9LCBqYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMubm90aWZpZXIgPSB0LCB0aGlzLnNvdXJjZSA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IEVhKHQsIHRoaXMubm90aWZpZXIsIHRoaXMuc291cmNlKSkgfSwgdCB9KCksIEVhID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5ub3RpZmllciA9IHIsIHRoaXMuc291cmNlID0gbjsgfSByZXR1cm4gZ2EoZSwgdCksIGUucHJvdG90eXBlLmVycm9yID0gZnVuY3Rpb24gKGUpIHsgaWYgKCF0aGlzLmlzU3RvcHBlZCkgeyB2YXIgciA9IHRoaXMuZXJyb3JzLCBuID0gdGhpcy5yZXRyaWVzLCBpID0gdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uOyBpZiAobikgdGhpcy5lcnJvcnMgPSBudWxsLCB0aGlzLnJldHJpZXNTdWJzY3JpcHRpb24gPSBudWxsOyBlbHNlIHsgaWYgKHIgPSBuZXcgei5TdWJqZWN0LCAobiA9IGYudHJ5Q2F0Y2godGhpcy5ub3RpZmllcikocikpID09PSBsLmVycm9yT2JqZWN0KSByZXR1cm4gdC5wcm90b3R5cGUuZXJyb3IuY2FsbCh0aGlzLCBsLmVycm9yT2JqZWN0LmUpOyBpID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgbik7IH0gdGhpcy5fdW5zdWJzY3JpYmVBbmRSZWN5Y2xlKCksIHRoaXMuZXJyb3JzID0gciwgdGhpcy5yZXRyaWVzID0gbiwgdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uID0gaSwgci5uZXh0KGUpOyB9IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmVycm9ycywgZSA9IHRoaXMucmV0cmllc1N1YnNjcmlwdGlvbjsgdCAmJiAodC51bnN1YnNjcmliZSgpLCB0aGlzLmVycm9ycyA9IG51bGwpLCBlICYmIChlLnVuc3Vic2NyaWJlKCksIHRoaXMucmV0cmllc1N1YnNjcmlwdGlvbiA9IG51bGwpLCB0aGlzLnJldHJpZXMgPSBudWxsOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdmFyIG8gPSB0aGlzLCBzID0gby5lcnJvcnMsIGMgPSBvLnJldHJpZXMsIHUgPSBvLnJldHJpZXNTdWJzY3JpcHRpb247IHRoaXMuZXJyb3JzID0gbnVsbCwgdGhpcy5yZXRyaWVzID0gbnVsbCwgdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uID0gbnVsbCwgdGhpcy5fdW5zdWJzY3JpYmVBbmRSZWN5Y2xlKCksIHRoaXMuZXJyb3JzID0gcywgdGhpcy5yZXRyaWVzID0gYywgdGhpcy5yZXRyaWVzU3Vic2NyaXB0aW9uID0gdSwgdGhpcy5zb3VyY2Uuc3Vic2NyaWJlKHRoaXMpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgSWEgPSB7IHJldHJ5V2hlbjogVGEgfTsgdmFyIEFhID0geyByZXRyeVdoZW46IGZ1bmN0aW9uICh0KSB7IHJldHVybiBJYS5yZXRyeVdoZW4odCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnJldHJ5V2hlbiA9IEFhLnJldHJ5V2hlbjsgdmFyIENhID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBOYSA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBQYSh0KSkgfSB9LCBQYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMubm90aWZpZXIgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHIgPSBuZXcga2EodCksIG4gPSBlLnN1YnNjcmliZShyKTsgcmV0dXJuIG4uYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHIsIHRoaXMubm90aWZpZXIpKSwgbiB9LCB0IH0oKSwga2EgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKCkgeyB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuaGFzVmFsdWUgPSAhMTsgfSByZXR1cm4gQ2EoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy52YWx1ZSA9IHQsIHRoaXMuaGFzVmFsdWUgPSAhMDsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMuZW1pdFZhbHVlKCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmVtaXRWYWx1ZSgpOyB9LCBlLnByb3RvdHlwZS5lbWl0VmFsdWUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaGFzVmFsdWUgJiYgKHRoaXMuaGFzVmFsdWUgPSAhMSwgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHRoaXMudmFsdWUpKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIFZhID0geyBzYW1wbGU6IE5hIH07IHZhciBGYSA9IHsgc2FtcGxlOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gVmEuc2FtcGxlKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5zYW1wbGUgPSBGYS5zYW1wbGU7IHZhciBSYSA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgTWEgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gVmUuYXN5bmMpLCBmdW5jdGlvbiAocikgeyByZXR1cm4gci5saWZ0KG5ldyBXYSh0LCBlKSkgfSB9LCBXYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMucGVyaW9kID0gdCwgdGhpcy5zY2hlZHVsZXIgPSBlOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBxYSh0LCB0aGlzLnBlcmlvZCwgdGhpcy5zY2hlZHVsZXIpKSB9LCB0IH0oKSwgcWEgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnBlcmlvZCA9IHIsIHRoaXMuc2NoZWR1bGVyID0gbiwgdGhpcy5oYXNWYWx1ZSA9ICExLCB0aGlzLmFkZChuLnNjaGVkdWxlKExhLCByLCB7IHN1YnNjcmliZXI6IHRoaXMsIHBlcmlvZDogciB9KSk7IH0gcmV0dXJuIFJhKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMubGFzdFZhbHVlID0gdCwgdGhpcy5oYXNWYWx1ZSA9ICEwOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKCkgeyB0aGlzLmhhc1ZhbHVlICYmICh0aGlzLmhhc1ZhbHVlID0gITEsIHRoaXMuZGVzdGluYXRpb24ubmV4dCh0aGlzLmxhc3RWYWx1ZSkpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKTsgZnVuY3Rpb24gTGEodCkgeyB2YXIgZSA9IHQuc3Vic2NyaWJlciwgciA9IHQucGVyaW9kOyBlLm5vdGlmeU5leHQoKSwgdGhpcy5zY2hlZHVsZSh0LCByKTsgfSB2YXIgVWEgPSB7IHNhbXBsZVRpbWU6IE1hIH07IHZhciB6YSA9IHsgc2FtcGxlVGltZTogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFZlLmFzeW5jKSwgVWEuc2FtcGxlVGltZSh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuc2FtcGxlVGltZSA9IHphLnNhbXBsZVRpbWU7IHZhciBCYSA9IHsgc2NhbjogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPj0gMiA/IHpjLnNjYW4odCwgZSkodGhpcykgOiB6Yy5zY2FuKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5zY2FuID0gQmEuc2NhbjsgdmFyIERhID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBZYSA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBmdW5jdGlvbiAocikgeyByZXR1cm4gci5saWZ0KG5ldyBIYSh0LCBlKSkgfSB9LCBIYSA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMuY29tcGFyZVRvID0gdCwgdGhpcy5jb21wYXJvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IEdhKHQsIHRoaXMuY29tcGFyZVRvLCB0aGlzLmNvbXBhcm9yKSkgfSwgdCB9KCksIFhhID0gSGEsIEdhID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5jb21wYXJlVG8gPSByLCB0aGlzLmNvbXBhcm9yID0gbiwgdGhpcy5fYSA9IFtdLCB0aGlzLl9iID0gW10sIHRoaXMuX29uZUNvbXBsZXRlID0gITEsIHRoaXMuYWRkKHIuc3Vic2NyaWJlKG5ldyBLYShlLCB0aGlzKSkpOyB9IHJldHVybiBEYShlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLl9vbmVDb21wbGV0ZSAmJiAwID09PSB0aGlzLl9iLmxlbmd0aCA/IHRoaXMuZW1pdCghMSkgOiAodGhpcy5fYS5wdXNoKHQpLCB0aGlzLmNoZWNrVmFsdWVzKCkpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX29uZUNvbXBsZXRlID8gdGhpcy5lbWl0KDAgPT09IHRoaXMuX2EubGVuZ3RoICYmIDAgPT09IHRoaXMuX2IubGVuZ3RoKSA6IHRoaXMuX29uZUNvbXBsZXRlID0gITA7IH0sIGUucHJvdG90eXBlLmNoZWNrVmFsdWVzID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gdGhpcywgZSA9IHQuX2EsIHIgPSB0Ll9iLCBuID0gdC5jb21wYXJvcjsgZS5sZW5ndGggPiAwICYmIHIubGVuZ3RoID4gMDspIHsgdmFyIGkgPSBlLnNoaWZ0KCksIG8gPSByLnNoaWZ0KCksIHMgPSAhMTsgbiA/IChzID0gZi50cnlDYXRjaChuKShpLCBvKSkgPT09IGwuZXJyb3JPYmplY3QgJiYgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcihsLmVycm9yT2JqZWN0LmUpIDogcyA9IGkgPT09IG8sIHMgfHwgdGhpcy5lbWl0KCExKTsgfSB9LCBlLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmRlc3RpbmF0aW9uOyBlLm5leHQodCksIGUuY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUubmV4dEIgPSBmdW5jdGlvbiAodCkgeyB0aGlzLl9vbmVDb21wbGV0ZSAmJiAwID09PSB0aGlzLl9hLmxlbmd0aCA/IHRoaXMuZW1pdCghMSkgOiAodGhpcy5fYi5wdXNoKHQpLCB0aGlzLmNoZWNrVmFsdWVzKCkpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgSmEgPSBHYSwgS2EgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnBhcmVudCA9IHI7IH0gcmV0dXJuIERhKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHRoaXMucGFyZW50Lm5leHRCKHQpOyB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLnBhcmVudC5lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLnBhcmVudC5fY29tcGxldGUoKTsgfSwgZSB9KFQuU3Vic2NyaWJlciksICRhID0geyBzZXF1ZW5jZUVxdWFsOiBZYSwgU2VxdWVuY2VFcXVhbE9wZXJhdG9yOiBYYSwgU2VxdWVuY2VFcXVhbFN1YnNjcmliZXI6IEphIH07IHZhciBRYSA9IHsgc2VxdWVuY2VFcXVhbDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuICRhLnNlcXVlbmNlRXF1YWwodCwgZSkodGhpcykgfSB9OyBmdW5jdGlvbiBaYSgpIHsgcmV0dXJuIG5ldyB6LlN1YmplY3QgfSBOLk9ic2VydmFibGUucHJvdG90eXBlLnNlcXVlbmNlRXF1YWwgPSBRYS5zZXF1ZW5jZUVxdWFsOyB2YXIgdGggPSB7IHNoYXJlOiBmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbiAodCkgeyByZXR1cm4geHUucmVmQ291bnQoKShOdS5tdWx0aWNhc3QoWmEpKHQpKSB9IH0gfTsgdmFyIGVoID0geyBzaGFyZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGguc2hhcmUoKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuc2hhcmUgPSBlaC5zaGFyZTsgdmFyIHJoID0geyBzaGFyZVJlcGxheTogZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIGZ1bmN0aW9uIChuKSB7IHJldHVybiBuLmxpZnQoZnVuY3Rpb24gKHQsIGUsIHIpIHsgdmFyIG4sIGksIG8gPSAwLCBzID0gITEsIGMgPSAhMTsgcmV0dXJuIGZ1bmN0aW9uICh1KSB7IG8rKywgbiAmJiAhcyB8fCAocyA9ICExLCBuID0gbmV3IGZuLlJlcGxheVN1YmplY3QodCwgZSwgciksIGkgPSB1LnN1YnNjcmliZSh7IG5leHQ6IGZ1bmN0aW9uICh0KSB7IG4ubmV4dCh0KTsgfSwgZXJyb3I6IGZ1bmN0aW9uICh0KSB7IHMgPSAhMCwgbi5lcnJvcih0KTsgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHsgYyA9ICEwLCBuLmNvbXBsZXRlKCk7IH0gfSkpOyB2YXIgYSA9IG4uc3Vic2NyaWJlKHRoaXMpOyByZXR1cm4gZnVuY3Rpb24gKCkgeyBvLS0sIGEudW5zdWJzY3JpYmUoKSwgaSAmJiAwID09PSBvICYmIGMgJiYgaS51bnN1YnNjcmliZSgpOyB9IH0gfSh0LCBlLCByKSkgfSB9IH07IHZhciBuaCA9IHsgc2hhcmVSZXBsYXk6IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiByaC5zaGFyZVJlcGxheSh0LCBlLCByKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuc2hhcmVSZXBsYXkgPSBuaC5zaGFyZVJlcGxheTsgdmFyIGloID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBvaCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBzaCh0LCBlKSkgfSB9LCBzaCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMucHJlZGljYXRlID0gdCwgdGhpcy5zb3VyY2UgPSBlOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBjaCh0LCB0aGlzLnByZWRpY2F0ZSwgdGhpcy5zb3VyY2UpKSB9LCB0IH0oKSwgY2ggPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMuc291cmNlID0gbiwgdGhpcy5zZWVuVmFsdWUgPSAhMSwgdGhpcy5pbmRleCA9IDA7IH0gcmV0dXJuIGloKGUsIHQpLCBlLnByb3RvdHlwZS5hcHBseVNpbmdsZVZhbHVlID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5zZWVuVmFsdWUgPyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKCJTZXF1ZW5jZSBjb250YWlucyBtb3JlIHRoYW4gb25lIGVsZW1lbnQiKSA6ICh0aGlzLnNlZW5WYWx1ZSA9ICEwLCB0aGlzLnNpbmdsZVZhbHVlID0gdCk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmluZGV4Kys7IHRoaXMucHJlZGljYXRlID8gdGhpcy50cnlOZXh0KHQsIGUpIDogdGhpcy5hcHBseVNpbmdsZVZhbHVlKHQpOyB9LCBlLnByb3RvdHlwZS50cnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUpIHsgdHJ5IHsgdGhpcy5wcmVkaWNhdGUodCwgZSwgdGhpcy5zb3VyY2UpICYmIHRoaXMuYXBwbHlTaW5nbGVWYWx1ZSh0KTsgfSBjYXRjaCAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmRlc3RpbmF0aW9uOyB0aGlzLmluZGV4ID4gMCA/ICh0Lm5leHQodGhpcy5zZWVuVmFsdWUgPyB0aGlzLnNpbmdsZVZhbHVlIDogdm9pZCAwKSwgdC5jb21wbGV0ZSgpKSA6IHQuZXJyb3IobmV3IGpzLkVtcHR5RXJyb3IpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgdWggPSB7IHNpbmdsZTogb2ggfTsgdmFyIGFoID0geyBzaW5nbGU6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB1aC5zaW5nbGUodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnNpbmdsZSA9IGFoLnNpbmdsZTsgdmFyIGhoID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBsaCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBwaCh0KSkgfSB9LCBwaCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMudG90YWwgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBmaCh0LCB0aGlzLnRvdGFsKSkgfSwgdCB9KCksIGZoID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy50b3RhbCA9IHIsIHRoaXMuY291bnQgPSAwOyB9IHJldHVybiBoaChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyArK3RoaXMuY291bnQgPiB0aGlzLnRvdGFsICYmIHRoaXMuZGVzdGluYXRpb24ubmV4dCh0KTsgfSwgZSB9KFQuU3Vic2NyaWJlciksIGJoID0geyBza2lwOiBsaCB9OyB2YXIgZGggPSB7IHNraXA6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBiaC5za2lwKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5za2lwID0gZGguc2tpcDsgdmFyIHloID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciB2aCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBtaCh0KSkgfSB9LCBtaCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IGlmICh0aGlzLl9za2lwQ291bnQgPSB0LCB0aGlzLl9za2lwQ291bnQgPCAwKSB0aHJvdyBuZXcgJG8uQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiAwID09PSB0aGlzLl9za2lwQ291bnQgPyBlLnN1YnNjcmliZShuZXcgVC5TdWJzY3JpYmVyKHQpKSA6IGUuc3Vic2NyaWJlKG5ldyB3aCh0LCB0aGlzLl9za2lwQ291bnQpKSB9LCB0IH0oKSwgd2ggPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLl9za2lwQ291bnQgPSByLCB0aGlzLl9jb3VudCA9IDAsIHRoaXMuX3JpbmcgPSBuZXcgQXJyYXkocik7IH0gcmV0dXJuIHloKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5fc2tpcENvdW50LCByID0gdGhpcy5fY291bnQrKzsgaWYgKHIgPCBlKSB0aGlzLl9yaW5nW3JdID0gdDsgZWxzZSB7IHZhciBuID0gciAlIGUsIGkgPSB0aGlzLl9yaW5nLCBvID0gaVtuXTsgaVtuXSA9IHQsIHRoaXMuZGVzdGluYXRpb24ubmV4dChvKTsgfSB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgX2ggPSB7IHNraXBMYXN0OiB2aCB9OyB2YXIgeGggPSB7IHNraXBMYXN0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gX2guc2tpcExhc3QodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnNraXBMYXN0ID0geGguc2tpcExhc3Q7IHZhciBPaCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgU2ggPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgZ2godCkpIH0gfSwgZ2ggPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLm5vdGlmaWVyID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgVGgodCwgdGhpcy5ub3RpZmllcikpIH0sIHQgfSgpLCBUaCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuaGFzVmFsdWUgPSAhMSwgdGhpcy5pc0lubmVyU3RvcHBlZCA9ICExLCB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCByKSk7IH0gcmV0dXJuIE9oKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuaGFzVmFsdWUgJiYgdC5wcm90b3R5cGUuX25leHQuY2FsbCh0aGlzLCBlKTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmlzSW5uZXJTdG9wcGVkID8gdC5wcm90b3R5cGUuX2NvbXBsZXRlLmNhbGwodGhpcykgOiB0aGlzLnVuc3Vic2NyaWJlKCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB0aGlzLmhhc1ZhbHVlID0gITA7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmlzSW5uZXJTdG9wcGVkID0gITAsIHRoaXMuaXNTdG9wcGVkICYmIHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgamggPSB7IHNraXBVbnRpbDogU2ggfTsgdmFyIEVoID0geyBza2lwVW50aWw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBqaC5za2lwVW50aWwodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnNraXBVbnRpbCA9IEVoLnNraXBVbnRpbDsgdmFyIEloID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBBaCA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBDaCh0KSkgfSB9LCBDaCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IHRoaXMucHJlZGljYXRlID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgTmgodCwgdGhpcy5wcmVkaWNhdGUpKSB9LCB0IH0oKSwgTmggPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLnByZWRpY2F0ZSA9IHIsIHRoaXMuc2tpcHBpbmcgPSAhMCwgdGhpcy5pbmRleCA9IDA7IH0gcmV0dXJuIEloKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5kZXN0aW5hdGlvbjsgdGhpcy5za2lwcGluZyAmJiB0aGlzLnRyeUNhbGxQcmVkaWNhdGUodCksIHRoaXMuc2tpcHBpbmcgfHwgZS5uZXh0KHQpOyB9LCBlLnByb3RvdHlwZS50cnlDYWxsUHJlZGljYXRlID0gZnVuY3Rpb24gKHQpIHsgdHJ5IHsgdmFyIGUgPSB0aGlzLnByZWRpY2F0ZSh0LCB0aGlzLmluZGV4KyspOyB0aGlzLnNraXBwaW5nID0gQm9vbGVhbihlKTsgfSBjYXRjaCAodCkgeyB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpOyB9IH0sIGUgfShULlN1YnNjcmliZXIpLCBQaCA9IHsgc2tpcFdoaWxlOiBBaCB9OyB2YXIga2ggPSB7IHNraXBXaGlsZTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIFBoLnNraXBXaGlsZSh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuc2tpcFdoaWxlID0ga2guc2tpcFdoaWxlOyB2YXIgVmggPSB7IHN0YXJ0V2l0aDogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSB0W3QubGVuZ3RoIC0gMV07IHR0LmlzU2NoZWR1bGVyKHIpID8gdC5wb3AoKSA6IHIgPSBudWxsOyB2YXIgbiA9IHQubGVuZ3RoOyByZXR1cm4gMSA9PT0gbiA/IG5lLmNvbmNhdChuZXcgcnQuU2NhbGFyT2JzZXJ2YWJsZSh0WzBdLCByKSwgZSkgOiBuID4gMSA/IG5lLmNvbmNhdChuZXcgc3QuQXJyYXlPYnNlcnZhYmxlKHQsIHIpLCBlKSA6IG5lLmNvbmNhdChuZXcgaXQuRW1wdHlPYnNlcnZhYmxlKHIpLCBlKSB9IH0gfTsgdmFyIEZoID0geyBzdGFydFdpdGg6IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IFtdLCBlID0gMDsgZSA8IGFyZ3VtZW50cy5sZW5ndGg7IGUrKyl0W2UgLSAwXSA9IGFyZ3VtZW50c1tlXTsgcmV0dXJuIFZoLnN0YXJ0V2l0aC5hcHBseSh2b2lkIDAsIHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5zdGFydFdpdGggPSBGaC5zdGFydFdpdGg7IHZhciBSaCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IGlmICh0aGlzLnJvb3QgPSB0LCB0LnNldEltbWVkaWF0ZSAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0LnNldEltbWVkaWF0ZSkgdGhpcy5zZXRJbW1lZGlhdGUgPSB0LnNldEltbWVkaWF0ZS5iaW5kKHQpLCB0aGlzLmNsZWFySW1tZWRpYXRlID0gdC5jbGVhckltbWVkaWF0ZS5iaW5kKHQpOyBlbHNlIHsgdGhpcy5uZXh0SGFuZGxlID0gMSwgdGhpcy50YXNrc0J5SGFuZGxlID0ge30sIHRoaXMuY3VycmVudGx5UnVubmluZ0FUYXNrID0gITEsIHRoaXMuY2FuVXNlUHJvY2Vzc05leHRUaWNrKCkgPyB0aGlzLnNldEltbWVkaWF0ZSA9IHRoaXMuY3JlYXRlUHJvY2Vzc05leHRUaWNrU2V0SW1tZWRpYXRlKCkgOiB0aGlzLmNhblVzZVBvc3RNZXNzYWdlKCkgPyB0aGlzLnNldEltbWVkaWF0ZSA9IHRoaXMuY3JlYXRlUG9zdE1lc3NhZ2VTZXRJbW1lZGlhdGUoKSA6IHRoaXMuY2FuVXNlTWVzc2FnZUNoYW5uZWwoKSA/IHRoaXMuc2V0SW1tZWRpYXRlID0gdGhpcy5jcmVhdGVNZXNzYWdlQ2hhbm5lbFNldEltbWVkaWF0ZSgpIDogdGhpcy5jYW5Vc2VSZWFkeVN0YXRlQ2hhbmdlKCkgPyB0aGlzLnNldEltbWVkaWF0ZSA9IHRoaXMuY3JlYXRlUmVhZHlTdGF0ZUNoYW5nZVNldEltbWVkaWF0ZSgpIDogdGhpcy5zZXRJbW1lZGlhdGUgPSB0aGlzLmNyZWF0ZVNldFRpbWVvdXRTZXRJbW1lZGlhdGUoKTsgdmFyIGUgPSBmdW5jdGlvbiB0KGUpIHsgZGVsZXRlIHQuaW5zdGFuY2UudGFza3NCeUhhbmRsZVtlXTsgfTsgZS5pbnN0YW5jZSA9IHRoaXMsIHRoaXMuY2xlYXJJbW1lZGlhdGUgPSBlOyB9IH0gcmV0dXJuIHQucHJvdG90eXBlLmlkZW50aWZ5ID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMucm9vdC5PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodCkgfSwgdC5wcm90b3R5cGUuY2FuVXNlUHJvY2Vzc05leHRUaWNrID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gIltvYmplY3QgcHJvY2Vzc10iID09PSB0aGlzLmlkZW50aWZ5KHRoaXMucm9vdC5wcm9jZXNzKSB9LCB0LnByb3RvdHlwZS5jYW5Vc2VNZXNzYWdlQ2hhbm5lbCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEJvb2xlYW4odGhpcy5yb290Lk1lc3NhZ2VDaGFubmVsKSB9LCB0LnByb3RvdHlwZS5jYW5Vc2VSZWFkeVN0YXRlQ2hhbmdlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMucm9vdC5kb2N1bWVudDsgcmV0dXJuIEJvb2xlYW4odCAmJiAib25yZWFkeXN0YXRlY2hhbmdlIiBpbiB0LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpKSB9LCB0LnByb3RvdHlwZS5jYW5Vc2VQb3N0TWVzc2FnZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLnJvb3Q7IGlmICh0LnBvc3RNZXNzYWdlICYmICF0LmltcG9ydFNjcmlwdHMpIHsgdmFyIGUgPSAhMCwgciA9IHQub25tZXNzYWdlOyByZXR1cm4gdC5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7IGUgPSAhMTsgfSwgdC5wb3N0TWVzc2FnZSgiIiwgIioiKSwgdC5vbm1lc3NhZ2UgPSByLCBlIH0gcmV0dXJuICExIH0sIHQucHJvdG90eXBlLnBhcnRpYWxseUFwcGxpZWQgPSBmdW5jdGlvbiAodCkgeyBmb3IgKHZhciBlID0gW10sIHIgPSAxOyByIDwgYXJndW1lbnRzLmxlbmd0aDsgcisrKWVbciAtIDFdID0gYXJndW1lbnRzW3JdOyB2YXIgbiA9IGZ1bmN0aW9uIHQoKSB7IHZhciBlID0gdC5oYW5kbGVyLCByID0gdC5hcmdzOyAiZnVuY3Rpb24iID09IHR5cGVvZiBlID8gZS5hcHBseSh2b2lkIDAsIHIpIDogbmV3IEZ1bmN0aW9uKCIiICsgZSkoKTsgfTsgcmV0dXJuIG4uaGFuZGxlciA9IHQsIG4uYXJncyA9IGUsIG4gfSwgdC5wcm90b3R5cGUuYWRkRnJvbVNldEltbWVkaWF0ZUFyZ3VtZW50cyA9IGZ1bmN0aW9uICh0KSB7IHJldHVybiB0aGlzLnRhc2tzQnlIYW5kbGVbdGhpcy5uZXh0SGFuZGxlXSA9IHRoaXMucGFydGlhbGx5QXBwbGllZC5hcHBseSh2b2lkIDAsIHQpLCB0aGlzLm5leHRIYW5kbGUrKyB9LCB0LnByb3RvdHlwZS5jcmVhdGVQcm9jZXNzTmV4dFRpY2tTZXRJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gZnVuY3Rpb24gdCgpIHsgdmFyIGUgPSB0Lmluc3RhbmNlLCByID0gZS5hZGRGcm9tU2V0SW1tZWRpYXRlQXJndW1lbnRzKGFyZ3VtZW50cyk7IHJldHVybiBlLnJvb3QucHJvY2Vzcy5uZXh0VGljayhlLnBhcnRpYWxseUFwcGxpZWQoZS5ydW5JZlByZXNlbnQsIHIpKSwgciB9OyByZXR1cm4gdC5pbnN0YW5jZSA9IHRoaXMsIHQgfSwgdC5wcm90b3R5cGUuY3JlYXRlUG9zdE1lc3NhZ2VTZXRJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcy5yb290LCBlID0gInNldEltbWVkaWF0ZSQiICsgdC5NYXRoLnJhbmRvbSgpICsgIiQiLCByID0gZnVuY3Rpb24gcihuKSB7IHZhciBpID0gci5pbnN0YW5jZTsgbi5zb3VyY2UgPT09IHQgJiYgInN0cmluZyIgPT0gdHlwZW9mIG4uZGF0YSAmJiAwID09PSBuLmRhdGEuaW5kZXhPZihlKSAmJiBpLnJ1bklmUHJlc2VudCgrbi5kYXRhLnNsaWNlKGUubGVuZ3RoKSk7IH07IHIuaW5zdGFuY2UgPSB0aGlzLCB0LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCByLCAhMSk7IHZhciBuID0gZnVuY3Rpb24gdCgpIHsgdmFyIGUgPSB0LCByID0gZS5tZXNzYWdlUHJlZml4LCBuID0gZS5pbnN0YW5jZSwgaSA9IG4uYWRkRnJvbVNldEltbWVkaWF0ZUFyZ3VtZW50cyhhcmd1bWVudHMpOyByZXR1cm4gbi5yb290LnBvc3RNZXNzYWdlKHIgKyBpLCAiKiIpLCBpIH07IHJldHVybiBuLmluc3RhbmNlID0gdGhpcywgbi5tZXNzYWdlUHJlZml4ID0gZSwgbiB9LCB0LnByb3RvdHlwZS5ydW5JZlByZXNlbnQgPSBmdW5jdGlvbiAodCkgeyBpZiAodGhpcy5jdXJyZW50bHlSdW5uaW5nQVRhc2spIHRoaXMucm9vdC5zZXRUaW1lb3V0KHRoaXMucGFydGlhbGx5QXBwbGllZCh0aGlzLnJ1bklmUHJlc2VudCwgdCksIDApOyBlbHNlIHsgdmFyIGUgPSB0aGlzLnRhc2tzQnlIYW5kbGVbdF07IGlmIChlKSB7IHRoaXMuY3VycmVudGx5UnVubmluZ0FUYXNrID0gITA7IHRyeSB7IGUoKTsgfSBmaW5hbGx5IHsgdGhpcy5jbGVhckltbWVkaWF0ZSh0KSwgdGhpcy5jdXJyZW50bHlSdW5uaW5nQVRhc2sgPSAhMTsgfSB9IH0gfSwgdC5wcm90b3R5cGUuY3JlYXRlTWVzc2FnZUNoYW5uZWxTZXRJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgZSA9IG5ldyB0aGlzLnJvb3QuTWVzc2FnZUNoYW5uZWw7IGUucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsgdmFyIHIgPSBlLmRhdGE7IHQucnVuSWZQcmVzZW50KHIpOyB9OyB2YXIgciA9IGZ1bmN0aW9uIHQoKSB7IHZhciBlID0gdCwgciA9IGUuY2hhbm5lbCwgbiA9IGUuaW5zdGFuY2UsIGkgPSBuLmFkZEZyb21TZXRJbW1lZGlhdGVBcmd1bWVudHMoYXJndW1lbnRzKTsgcmV0dXJuIHIucG9ydDIucG9zdE1lc3NhZ2UoaSksIGkgfTsgcmV0dXJuIHIuY2hhbm5lbCA9IGUsIHIuaW5zdGFuY2UgPSB0aGlzLCByIH0sIHQucHJvdG90eXBlLmNyZWF0ZVJlYWR5U3RhdGVDaGFuZ2VTZXRJbW1lZGlhdGUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gZnVuY3Rpb24gdCgpIHsgdmFyIGUgPSB0Lmluc3RhbmNlLCByID0gZS5yb290LCBuID0gci5kb2N1bWVudCwgaSA9IG4uZG9jdW1lbnRFbGVtZW50LCBvID0gZS5hZGRGcm9tU2V0SW1tZWRpYXRlQXJndW1lbnRzKGFyZ3VtZW50cyksIHMgPSBuLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOyByZXR1cm4gcy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7IGUucnVuSWZQcmVzZW50KG8pLCBzLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwsIGkucmVtb3ZlQ2hpbGQocyksIHMgPSBudWxsOyB9LCBpLmFwcGVuZENoaWxkKHMpLCBvIH07IHJldHVybiB0Lmluc3RhbmNlID0gdGhpcywgdCB9LCB0LnByb3RvdHlwZS5jcmVhdGVTZXRUaW1lb3V0U2V0SW1tZWRpYXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IGZ1bmN0aW9uIHQoKSB7IHZhciBlID0gdC5pbnN0YW5jZSwgciA9IGUuYWRkRnJvbVNldEltbWVkaWF0ZUFyZ3VtZW50cyhhcmd1bWVudHMpOyByZXR1cm4gZS5yb290LnNldFRpbWVvdXQoZS5wYXJ0aWFsbHlBcHBsaWVkKGUucnVuSWZQcmVzZW50LCByKSwgMCksIHIgfTsgcmV0dXJuIHQuaW5zdGFuY2UgPSB0aGlzLCB0IH0sIHQgfSgpLCBNaCA9IHsgSW1tZWRpYXRlRGVmaW5pdGlvbjogUmgsIEltbWVkaWF0ZTogbmV3IFJoKHMucm9vdCkgfSwgV2ggPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgcWggPSB7IEFzYXBBY3Rpb246IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSwgciksIHRoaXMuc2NoZWR1bGVyID0gZSwgdGhpcy53b3JrID0gcjsgfSByZXR1cm4gV2goZSwgdCksIGUucHJvdG90eXBlLnJlcXVlc3RBc3luY0lkID0gZnVuY3Rpb24gKGUsIHIsIG4pIHsgcmV0dXJuIHZvaWQgMCA9PT0gbiAmJiAobiA9IDApLCBudWxsICE9PSBuICYmIG4gPiAwID8gdC5wcm90b3R5cGUucmVxdWVzdEFzeW5jSWQuY2FsbCh0aGlzLCBlLCByLCBuKSA6IChlLmFjdGlvbnMucHVzaCh0aGlzKSwgZS5zY2hlZHVsZWQgfHwgKGUuc2NoZWR1bGVkID0gTWguSW1tZWRpYXRlLnNldEltbWVkaWF0ZShlLmZsdXNoLmJpbmQoZSwgbnVsbCkpKSkgfSwgZS5wcm90b3R5cGUucmVjeWNsZUFzeW5jSWQgPSBmdW5jdGlvbiAoZSwgciwgbikgeyBpZiAodm9pZCAwID09PSBuICYmIChuID0gMCksIG51bGwgIT09IG4gJiYgbiA+IDAgfHwgbnVsbCA9PT0gbiAmJiB0aGlzLmRlbGF5ID4gMCkgcmV0dXJuIHQucHJvdG90eXBlLnJlY3ljbGVBc3luY0lkLmNhbGwodGhpcywgZSwgciwgbik7IDAgPT09IGUuYWN0aW9ucy5sZW5ndGggJiYgKE1oLkltbWVkaWF0ZS5jbGVhckltbWVkaWF0ZShyKSwgZS5zY2hlZHVsZWQgPSB2b2lkIDApOyB9LCBlIH0oQ2UuQXN5bmNBY3Rpb24pIH0sIExoID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIFVoID0geyBhc2FwOiBuZXcgKHsgQXNhcFNjaGVkdWxlcjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZSgpIHsgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9IHJldHVybiBMaChlLCB0KSwgZS5wcm90b3R5cGUuZmx1c2ggPSBmdW5jdGlvbiAodCkgeyB0aGlzLmFjdGl2ZSA9ICEwLCB0aGlzLnNjaGVkdWxlZCA9IHZvaWQgMDsgdmFyIGUsIHIgPSB0aGlzLmFjdGlvbnMsIG4gPSAtMSwgaSA9IHIubGVuZ3RoOyB0ID0gdCB8fCByLnNoaWZ0KCk7IGRvIHsgaWYgKGUgPSB0LmV4ZWN1dGUodC5zdGF0ZSwgdC5kZWxheSkpIGJyZWFrIH0gd2hpbGUgKCsrbiA8IGkgJiYgKHQgPSByLnNoaWZ0KCkpKTsgaWYgKHRoaXMuYWN0aXZlID0gITEsIGUpIHsgZm9yICg7ICsrbiA8IGkgJiYgKHQgPSByLnNoaWZ0KCkpOyl0LnVuc3Vic2NyaWJlKCk7IHRocm93IGUgfSB9LCBlIH0oa2UuQXN5bmNTY2hlZHVsZXIpIH0uQXNhcFNjaGVkdWxlcikocWguQXNhcEFjdGlvbikgfSwgemggPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgQmggPSB7IFN1YnNjcmliZU9uT2JzZXJ2YWJsZTogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHZvaWQgMCA9PT0gciAmJiAociA9IDApLCB2b2lkIDAgPT09IG4gJiYgKG4gPSBVaC5hc2FwKSwgdC5jYWxsKHRoaXMpLCB0aGlzLnNvdXJjZSA9IGUsIHRoaXMuZGVsYXlUaW1lID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuLCAoIWplLmlzTnVtZXJpYyhyKSB8fCByIDwgMCkgJiYgKHRoaXMuZGVsYXlUaW1lID0gMCksIG4gJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2Ygbi5zY2hlZHVsZSB8fCAodGhpcy5zY2hlZHVsZXIgPSBVaC5hc2FwKTsgfSByZXR1cm4gemgoZSwgdCksIGUuY3JlYXRlID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IDApLCB2b2lkIDAgPT09IG4gJiYgKG4gPSBVaC5hc2FwKSwgbmV3IGUodCwgciwgbikgfSwgZS5kaXNwYXRjaCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5zb3VyY2UsIHIgPSB0LnN1YnNjcmliZXI7IHJldHVybiB0aGlzLmFkZChlLnN1YnNjcmliZShyKSkgfSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uICh0KSB7IHZhciByID0gdGhpcy5kZWxheVRpbWUsIG4gPSB0aGlzLnNvdXJjZTsgcmV0dXJuIHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKGUuZGlzcGF0Y2gsIHIsIHsgc291cmNlOiBuLCBzdWJzY3JpYmVyOiB0IH0pIH0sIGUgfShOLk9ic2VydmFibGUpIH07IHZhciBEaCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSAwKSwgZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgWWgodCwgZSkpIH0gfSwgWWggPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSkgeyB0aGlzLnNjaGVkdWxlciA9IHQsIHRoaXMuZGVsYXkgPSBlOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIG5ldyBCaC5TdWJzY3JpYmVPbk9ic2VydmFibGUoZSwgdGhpcy5kZWxheSwgdGhpcy5zY2hlZHVsZXIpLnN1YnNjcmliZSh0KSB9LCB0IH0oKSwgSGggPSB7IHN1YnNjcmliZU9uOiBEaCB9OyB2YXIgWGggPSB7IHN1YnNjcmliZU9uOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gMCksIEhoLnN1YnNjcmliZU9uKHQsIGUpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5zdWJzY3JpYmVPbiA9IFhoLnN1YnNjcmliZU9uOyB2YXIgR2ggPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEpoID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IEtoKHQsIGUpKSB9IH0sIEtoID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5wcm9qZWN0ID0gdCwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3ICRoKHQsIHRoaXMucHJvamVjdCwgdGhpcy5yZXN1bHRTZWxlY3RvcikpIH0sIHQgfSgpLCAkaCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMucHJvamVjdCA9IHIsIHRoaXMucmVzdWx0U2VsZWN0b3IgPSBuLCB0aGlzLmluZGV4ID0gMDsgfSByZXR1cm4gR2goZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUsIHIgPSB0aGlzLmluZGV4Kys7IHRyeSB7IGUgPSB0aGlzLnByb2plY3QodCwgcik7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KSB9IHRoaXMuX2lubmVyU3ViKGUsIHQsIHIpOyB9LCBlLnByb3RvdHlwZS5faW5uZXJTdWIgPSBmdW5jdGlvbiAodCwgZSwgcikgeyB2YXIgbiA9IHRoaXMuaW5uZXJTdWJzY3JpcHRpb247IG4gJiYgbi51bnN1YnNjcmliZSgpLCB0aGlzLmFkZCh0aGlzLmlubmVyU3Vic2NyaXB0aW9uID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgdCwgZSwgcikpOyB9LCBlLnByb3RvdHlwZS5fY29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHZhciBlID0gdGhpcy5pbm5lclN1YnNjcmlwdGlvbjsgZSAmJiAhZS5jbG9zZWQgfHwgdC5wcm90b3R5cGUuX2NvbXBsZXRlLmNhbGwodGhpcyk7IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy5pbm5lclN1YnNjcmlwdGlvbiA9IG51bGw7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5yZW1vdmUoZSksIHRoaXMuaW5uZXJTdWJzY3JpcHRpb24gPSBudWxsLCB0aGlzLmlzU3RvcHBlZCAmJiB0LnByb3RvdHlwZS5fY29tcGxldGUuY2FsbCh0aGlzKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMucmVzdWx0U2VsZWN0b3IgPyB0aGlzLl90cnlOb3RpZnlOZXh0KHQsIGUsIHIsIG4pIDogdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpOyB9LCBlLnByb3RvdHlwZS5fdHJ5Tm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IHZhciBpOyB0cnkgeyBpID0gdGhpcy5yZXN1bHRTZWxlY3Rvcih0LCBlLCByLCBuKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCB0aGlzLmRlc3RpbmF0aW9uLmVycm9yKHQpIH0gdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGkpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgUWggPSB7IHN3aXRjaE1hcDogSmggfTsgdmFyIFpoID0geyBzd2l0Y2hBbGw6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFFoLnN3aXRjaE1hcCh0ZS5pZGVudGl0eSkgfSB9OyB2YXIgdGwgPSB7IF9zd2l0Y2g6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFpoLnN3aXRjaEFsbCgpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS5zd2l0Y2ggPSB0bC5fc3dpdGNoLCBOLk9ic2VydmFibGUucHJvdG90eXBlLl9zd2l0Y2ggPSB0bC5fc3dpdGNoOyB2YXIgZWwgPSB7IHN3aXRjaE1hcDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIFFoLnN3aXRjaE1hcCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUuc3dpdGNoTWFwID0gZWwuc3dpdGNoTWFwOyB2YXIgcmwgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIG5sID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IGlsKHQsIGUpKSB9IH0sIGlsID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5vYnNlcnZhYmxlID0gdCwgdGhpcy5yZXN1bHRTZWxlY3RvciA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IG9sKHQsIHRoaXMub2JzZXJ2YWJsZSwgdGhpcy5yZXN1bHRTZWxlY3RvcikpIH0sIHQgfSgpLCBvbCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuaW5uZXIgPSByLCB0aGlzLnJlc3VsdFNlbGVjdG9yID0gbiwgdGhpcy5pbmRleCA9IDA7IH0gcmV0dXJuIHJsKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5pbm5lclN1YnNjcmlwdGlvbjsgZSAmJiBlLnVuc3Vic2NyaWJlKCksIHRoaXMuYWRkKHRoaXMuaW5uZXJTdWJzY3JpcHRpb24gPSBidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCB0aGlzLmlubmVyLCB0LCB0aGlzLmluZGV4KyspKTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHRoaXMuaW5uZXJTdWJzY3JpcHRpb247IGUgJiYgIWUuY2xvc2VkIHx8IHQucHJvdG90eXBlLl9jb21wbGV0ZS5jYWxsKHRoaXMpOyB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuaW5uZXJTdWJzY3JpcHRpb24gPSBudWxsOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMucmVtb3ZlKGUpLCB0aGlzLmlubmVyU3Vic2NyaXB0aW9uID0gbnVsbCwgdGhpcy5pc1N0b3BwZWQgJiYgdC5wcm90b3R5cGUuX2NvbXBsZXRlLmNhbGwodGhpcyk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB2YXIgbyA9IHRoaXMucmVzdWx0U2VsZWN0b3IsIHMgPSB0aGlzLmRlc3RpbmF0aW9uOyBvID8gdGhpcy50cnlSZXN1bHRTZWxlY3Rvcih0LCBlLCByLCBuKSA6IHMubmV4dChlKTsgfSwgZS5wcm90b3R5cGUudHJ5UmVzdWx0U2VsZWN0b3IgPSBmdW5jdGlvbiAodCwgZSwgciwgbikgeyB2YXIgaSwgbyA9IHRoaXMucmVzdWx0U2VsZWN0b3IsIHMgPSB0aGlzLmRlc3RpbmF0aW9uOyB0cnkgeyBpID0gbyh0LCBlLCByLCBuKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCBzLmVycm9yKHQpIH0gcy5uZXh0KGkpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgc2wgPSB7IHN3aXRjaE1hcFRvOiBubCB9OyB2YXIgY2wgPSB7IHN3aXRjaE1hcFRvOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gc2wuc3dpdGNoTWFwVG8odCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnN3aXRjaE1hcFRvID0gY2wuc3dpdGNoTWFwVG87IHZhciB1bCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgYWwgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIDAgPT09IHQgPyBuZXcgaXQuRW1wdHlPYnNlcnZhYmxlIDogZS5saWZ0KG5ldyBobCh0KSkgfSB9LCBobCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0KSB7IGlmICh0aGlzLnRvdGFsID0gdCwgdGhpcy50b3RhbCA8IDApIHRocm93IG5ldyAkby5Bcmd1bWVudE91dE9mUmFuZ2VFcnJvciB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBsbCh0LCB0aGlzLnRvdGFsKSkgfSwgdCB9KCksIGxsID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy50b3RhbCA9IHIsIHRoaXMuY291bnQgPSAwOyB9IHJldHVybiB1bChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMudG90YWwsIHIgPSArK3RoaXMuY291bnQ7IHIgPD0gZSAmJiAodGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpLCByID09PSBlICYmICh0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCksIHRoaXMudW5zdWJzY3JpYmUoKSkpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgcGwgPSB7IHRha2U6IGFsIH07IHZhciBmbCA9IHsgdGFrZTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHBsLnRha2UodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRha2UgPSBmbC50YWtlOyB2YXIgYmwgPSB7IHRha2VMYXN0OiBmdW5jdGlvbiAodCkgeyByZXR1cm4gWGMudGFrZUxhc3QodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRha2VMYXN0ID0gYmwudGFrZUxhc3Q7IHZhciBkbCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgeWwgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgdmwodCkpIH0gfSwgdmwgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLm5vdGlmaWVyID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgbWwodCwgdGhpcy5ub3RpZmllcikpIH0sIHQgfSgpLCBtbCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMubm90aWZpZXIgPSByLCB0aGlzLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0aGlzLCByKSk7IH0gcmV0dXJuIGRsKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5jb21wbGV0ZSgpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlDb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIHdsID0geyB0YWtlVW50aWw6IHlsIH07IHZhciBfbCA9IHsgdGFrZVVudGlsOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gd2wudGFrZVVudGlsKHQpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS50YWtlVW50aWwgPSBfbC50YWtlVW50aWw7IHZhciB4bCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgT2wgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUubGlmdChuZXcgU2wodCkpIH0gfSwgU2wgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLnByZWRpY2F0ZSA9IHQ7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IGdsKHQsIHRoaXMucHJlZGljYXRlKSkgfSwgdCB9KCksIGdsID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5wcmVkaWNhdGUgPSByLCB0aGlzLmluZGV4ID0gMDsgfSByZXR1cm4geGwoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUsIHIgPSB0aGlzLmRlc3RpbmF0aW9uOyB0cnkgeyBlID0gdGhpcy5wcmVkaWNhdGUodCwgdGhpcy5pbmRleCsrKTsgfSBjYXRjaCAodCkgeyByZXR1cm4gdm9pZCByLmVycm9yKHQpIH0gdGhpcy5uZXh0T3JDb21wbGV0ZSh0LCBlKTsgfSwgZS5wcm90b3R5cGUubmV4dE9yQ29tcGxldGUgPSBmdW5jdGlvbiAodCwgZSkgeyB2YXIgciA9IHRoaXMuZGVzdGluYXRpb247IEJvb2xlYW4oZSkgPyByLm5leHQodCkgOiByLmNvbXBsZXRlKCk7IH0sIGUgfShULlN1YnNjcmliZXIpLCBUbCA9IHsgdGFrZVdoaWxlOiBPbCB9OyB2YXIgamwgPSB7IHRha2VXaGlsZTogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIFRsLnRha2VXaGlsZSh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUudGFrZVdoaWxlID0gamwudGFrZVdoaWxlOyB2YXIgRWwgPSBlKChmdW5jdGlvbiAoZSwgcikgeyB2YXIgbiA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyByLmRlZmF1bHRUaHJvdHRsZUNvbmZpZyA9IHsgbGVhZGluZzogITAsIHRyYWlsaW5nOiAhMSB9LCByLnRocm90dGxlID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHIuZGVmYXVsdFRocm90dGxlQ29uZmlnKSwgZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIubGlmdChuZXcgaSh0LCBlLmxlYWRpbmcsIGUudHJhaWxpbmcpKSB9IH07IHZhciBpID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIpIHsgdGhpcy5kdXJhdGlvblNlbGVjdG9yID0gdCwgdGhpcy5sZWFkaW5nID0gZSwgdGhpcy50cmFpbGluZyA9IHI7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IG8odCwgdGhpcy5kdXJhdGlvblNlbGVjdG9yLCB0aGlzLmxlYWRpbmcsIHRoaXMudHJhaWxpbmcpKSB9LCB0IH0oKSwgbyA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSkgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuZGVzdGluYXRpb24gPSBlLCB0aGlzLmR1cmF0aW9uU2VsZWN0b3IgPSByLCB0aGlzLl9sZWFkaW5nID0gbiwgdGhpcy5fdHJhaWxpbmcgPSBpLCB0aGlzLl9oYXNUcmFpbGluZ1ZhbHVlID0gITE7IH0gcmV0dXJuIG4oZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgaWYgKHRoaXMudGhyb3R0bGVkKSB0aGlzLl90cmFpbGluZyAmJiAodGhpcy5faGFzVHJhaWxpbmdWYWx1ZSA9ICEwLCB0aGlzLl90cmFpbGluZ1ZhbHVlID0gdCk7IGVsc2UgeyB2YXIgZSA9IHRoaXMudHJ5RHVyYXRpb25TZWxlY3Rvcih0KTsgZSAmJiB0aGlzLmFkZCh0aGlzLnRocm90dGxlZCA9IGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIGUpKSwgdGhpcy5fbGVhZGluZyAmJiAodGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpLCB0aGlzLl90cmFpbGluZyAmJiAodGhpcy5faGFzVHJhaWxpbmdWYWx1ZSA9ICEwLCB0aGlzLl90cmFpbGluZ1ZhbHVlID0gdCkpOyB9IH0sIGUucHJvdG90eXBlLnRyeUR1cmF0aW9uU2VsZWN0b3IgPSBmdW5jdGlvbiAodCkgeyB0cnkgeyByZXR1cm4gdGhpcy5kdXJhdGlvblNlbGVjdG9yKHQpIH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCksIG51bGwgfSB9LCBlLnByb3RvdHlwZS5fdW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7IHZhciB0ID0gdGhpcywgZSA9IHQudGhyb3R0bGVkOyB0Ll90cmFpbGluZ1ZhbHVlLCB0Ll9oYXNUcmFpbGluZ1ZhbHVlLCB0Ll90cmFpbGluZzsgdGhpcy5fdHJhaWxpbmdWYWx1ZSA9IG51bGwsIHRoaXMuX2hhc1RyYWlsaW5nVmFsdWUgPSAhMSwgZSAmJiAodGhpcy5yZW1vdmUoZSksIHRoaXMudGhyb3R0bGVkID0gbnVsbCwgZS51bnN1YnNjcmliZSgpKTsgfSwgZS5wcm90b3R5cGUuX3NlbmRUcmFpbGluZyA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLCBlID0gdC5kZXN0aW5hdGlvbiwgciA9IHQudGhyb3R0bGVkLCBuID0gdC5fdHJhaWxpbmcsIGkgPSB0Ll90cmFpbGluZ1ZhbHVlLCBvID0gdC5faGFzVHJhaWxpbmdWYWx1ZTsgciAmJiBuICYmIG8gJiYgKGUubmV4dChpKSwgdGhpcy5fdHJhaWxpbmdWYWx1ZSA9IG51bGwsIHRoaXMuX2hhc1RyYWlsaW5nVmFsdWUgPSAhMSk7IH0sIGUucHJvdG90eXBlLm5vdGlmeU5leHQgPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgaSkgeyB0aGlzLl9zZW5kVHJhaWxpbmcoKSwgdGhpcy5fdW5zdWJzY3JpYmUoKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IHRoaXMuX3NlbmRUcmFpbGluZygpLCB0aGlzLl91bnN1YnNjcmliZSgpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKTsgfSkpOyB2YXIgSWwgPSB7IHRocm90dGxlOiBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gRWwuZGVmYXVsdFRocm90dGxlQ29uZmlnKSwgRWwudGhyb3R0bGUodCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRocm90dGxlID0gSWwudGhyb3R0bGU7IHZhciBBbCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgQ2wgPSBmdW5jdGlvbiAodCwgZSwgcikgeyByZXR1cm4gdm9pZCAwID09PSBlICYmIChlID0gVmUuYXN5bmMpLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBFbC5kZWZhdWx0VGhyb3R0bGVDb25maWcpLCBmdW5jdGlvbiAobikgeyByZXR1cm4gbi5saWZ0KG5ldyBObCh0LCBlLCByLmxlYWRpbmcsIHIudHJhaWxpbmcpKSB9IH0sIE5sID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy5kdXJhdGlvbiA9IHQsIHRoaXMuc2NoZWR1bGVyID0gZSwgdGhpcy5sZWFkaW5nID0gciwgdGhpcy50cmFpbGluZyA9IG47IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IFBsKHQsIHRoaXMuZHVyYXRpb24sIHRoaXMuc2NoZWR1bGVyLCB0aGlzLmxlYWRpbmcsIHRoaXMudHJhaWxpbmcpKSB9LCB0IH0oKSwgUGwgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmR1cmF0aW9uID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuLCB0aGlzLmxlYWRpbmcgPSBpLCB0aGlzLnRyYWlsaW5nID0gbywgdGhpcy5faGFzVHJhaWxpbmdWYWx1ZSA9ICExLCB0aGlzLl90cmFpbGluZ1ZhbHVlID0gbnVsbDsgfSByZXR1cm4gQWwoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy50aHJvdHRsZWQgPyB0aGlzLnRyYWlsaW5nICYmICh0aGlzLl90cmFpbGluZ1ZhbHVlID0gdCwgdGhpcy5faGFzVHJhaWxpbmdWYWx1ZSA9ICEwKSA6ICh0aGlzLmFkZCh0aGlzLnRocm90dGxlZCA9IHRoaXMuc2NoZWR1bGVyLnNjaGVkdWxlKGtsLCB0aGlzLmR1cmF0aW9uLCB7IHN1YnNjcmliZXI6IHRoaXMgfSkpLCB0aGlzLmxlYWRpbmcgJiYgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpKTsgfSwgZS5wcm90b3R5cGUuY2xlYXJUaHJvdHRsZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLnRocm90dGxlZDsgdCAmJiAodGhpcy50cmFpbGluZyAmJiB0aGlzLl9oYXNUcmFpbGluZ1ZhbHVlICYmICh0aGlzLmRlc3RpbmF0aW9uLm5leHQodGhpcy5fdHJhaWxpbmdWYWx1ZSksIHRoaXMuX3RyYWlsaW5nVmFsdWUgPSBudWxsLCB0aGlzLl9oYXNUcmFpbGluZ1ZhbHVlID0gITEpLCB0LnVuc3Vic2NyaWJlKCksIHRoaXMucmVtb3ZlKHQpLCB0aGlzLnRocm90dGxlZCA9IG51bGwpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKTsgZnVuY3Rpb24ga2wodCkgeyB0LnN1YnNjcmliZXIuY2xlYXJUaHJvdHRsZSgpOyB9IHZhciBWbCA9IHsgdGhyb3R0bGVUaW1lOiBDbCB9OyB2YXIgRmwgPSB7IHRocm90dGxlVGltZTogZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IFZlLmFzeW5jKSwgdm9pZCAwID09PSByICYmIChyID0gRWwuZGVmYXVsdFRocm90dGxlQ29uZmlnKSwgVmwudGhyb3R0bGVUaW1lKHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS50aHJvdHRsZVRpbWUgPSBGbC50aHJvdHRsZVRpbWU7IHZhciBSbCA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9OyB2YXIgTWwgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gVmUuYXN5bmMpLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5saWZ0KG5ldyBMbCh0KSkgfSB9LCBXbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHRoaXMudmFsdWUgPSB0LCB0aGlzLmludGVydmFsID0gZTsgfSwgcWwgPSBXbCwgTGwgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCkgeyB0aGlzLnNjaGVkdWxlciA9IHQ7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IFVsKHQsIHRoaXMuc2NoZWR1bGVyKSkgfSwgdCB9KCksIFVsID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5zY2hlZHVsZXIgPSByLCB0aGlzLmxhc3RUaW1lID0gMCwgdGhpcy5sYXN0VGltZSA9IHIubm93KCk7IH0gcmV0dXJuIFJsKGUsIHQpLCBlLnByb3RvdHlwZS5fbmV4dCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdGhpcy5zY2hlZHVsZXIubm93KCksIHIgPSBlIC0gdGhpcy5sYXN0VGltZTsgdGhpcy5sYXN0VGltZSA9IGUsIHRoaXMuZGVzdGluYXRpb24ubmV4dChuZXcgV2wodCwgcikpOyB9LCBlIH0oVC5TdWJzY3JpYmVyKSwgemwgPSB7IHRpbWVJbnRlcnZhbDogTWwsIFRpbWVJbnRlcnZhbDogcWwgfTsgdmFyIEJsID0geyBUaW1lSW50ZXJ2YWw6IHpsLlRpbWVJbnRlcnZhbCwgdGltZUludGVydmFsOiBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gVmUuYXN5bmMpLCB6bC50aW1lSW50ZXJ2YWwodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRpbWVJbnRlcnZhbCA9IEJsLnRpbWVJbnRlcnZhbDsgdmFyIERsID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIFlsID0geyBUaW1lb3V0RXJyb3I6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoKSB7IHZhciBlID0gdC5jYWxsKHRoaXMsICJUaW1lb3V0IGhhcyBvY2N1cnJlZCIpOyB0aGlzLm5hbWUgPSBlLm5hbWUgPSAiVGltZW91dEVycm9yIiwgdGhpcy5zdGFjayA9IGUuc3RhY2ssIHRoaXMubWVzc2FnZSA9IGUubWVzc2FnZTsgfSByZXR1cm4gRGwoZSwgdCksIGUgfShFcnJvcikgfSwgSGwgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIFhsID0gZnVuY3Rpb24gKHQsIGUpIHsgdm9pZCAwID09PSBlICYmIChlID0gVmUuYXN5bmMpOyB2YXIgciA9IGhyLmlzRGF0ZSh0KSwgbiA9IHIgPyArdCAtIGUubm93KCkgOiBNYXRoLmFicyh0KTsgcmV0dXJuIGZ1bmN0aW9uICh0KSB7IHJldHVybiB0LmxpZnQobmV3IEdsKG4sIHIsIGUsIG5ldyBZbC5UaW1lb3V0RXJyb3IpKSB9IH0sIEdsID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy53YWl0Rm9yID0gdCwgdGhpcy5hYnNvbHV0ZVRpbWVvdXQgPSBlLCB0aGlzLnNjaGVkdWxlciA9IHIsIHRoaXMuZXJyb3JJbnN0YW5jZSA9IG47IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IEpsKHQsIHRoaXMuYWJzb2x1dGVUaW1lb3V0LCB0aGlzLndhaXRGb3IsIHRoaXMuc2NoZWR1bGVyLCB0aGlzLmVycm9ySW5zdGFuY2UpKSB9LCB0IH0oKSwgSmwgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmFic29sdXRlVGltZW91dCA9IHIsIHRoaXMud2FpdEZvciA9IG4sIHRoaXMuc2NoZWR1bGVyID0gaSwgdGhpcy5lcnJvckluc3RhbmNlID0gbywgdGhpcy5hY3Rpb24gPSBudWxsLCB0aGlzLnNjaGVkdWxlVGltZW91dCgpOyB9IHJldHVybiBIbChlLCB0KSwgZS5kaXNwYXRjaFRpbWVvdXQgPSBmdW5jdGlvbiAodCkgeyB0LmVycm9yKHQuZXJyb3JJbnN0YW5jZSk7IH0sIGUucHJvdG90eXBlLnNjaGVkdWxlVGltZW91dCA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmFjdGlvbjsgdCA/IHRoaXMuYWN0aW9uID0gdC5zY2hlZHVsZSh0aGlzLCB0aGlzLndhaXRGb3IpIDogdGhpcy5hZGQodGhpcy5hY3Rpb24gPSB0aGlzLnNjaGVkdWxlci5zY2hlZHVsZShlLmRpc3BhdGNoVGltZW91dCwgdGhpcy53YWl0Rm9yLCB0aGlzKSk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5hYnNvbHV0ZVRpbWVvdXQgfHwgdGhpcy5zY2hlZHVsZVRpbWVvdXQoKSwgdC5wcm90b3R5cGUuX25leHQuY2FsbCh0aGlzLCBlKTsgfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmFjdGlvbiA9IG51bGwsIHRoaXMuc2NoZWR1bGVyID0gbnVsbCwgdGhpcy5lcnJvckluc3RhbmNlID0gbnVsbDsgfSwgZSB9KFQuU3Vic2NyaWJlciksIEtsID0geyB0aW1lb3V0OiBYbCB9OyB2YXIgJGwgPSB7IHRpbWVvdXQ6IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiB2b2lkIDAgPT09IGUgJiYgKGUgPSBWZS5hc3luYyksIEtsLnRpbWVvdXQodCwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRpbWVvdXQgPSAkbC50aW1lb3V0OyB2YXIgUWwgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIFpsID0gZnVuY3Rpb24gKHQsIGUsIHIpIHsgcmV0dXJuIHZvaWQgMCA9PT0gciAmJiAociA9IFZlLmFzeW5jKSwgZnVuY3Rpb24gKG4pIHsgdmFyIGkgPSBoci5pc0RhdGUodCksIG8gPSBpID8gK3QgLSByLm5vdygpIDogTWF0aC5hYnModCk7IHJldHVybiBuLmxpZnQobmV3IHRwKG8sIGksIGUsIHIpKSB9IH0sIHRwID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUsIHIsIG4pIHsgdGhpcy53YWl0Rm9yID0gdCwgdGhpcy5hYnNvbHV0ZVRpbWVvdXQgPSBlLCB0aGlzLndpdGhPYnNlcnZhYmxlID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBlcCh0LCB0aGlzLmFic29sdXRlVGltZW91dCwgdGhpcy53YWl0Rm9yLCB0aGlzLndpdGhPYnNlcnZhYmxlLCB0aGlzLnNjaGVkdWxlcikpIH0sIHQgfSgpLCBlcCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbiwgaSwgbykgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuYWJzb2x1dGVUaW1lb3V0ID0gciwgdGhpcy53YWl0Rm9yID0gbiwgdGhpcy53aXRoT2JzZXJ2YWJsZSA9IGksIHRoaXMuc2NoZWR1bGVyID0gbywgdGhpcy5hY3Rpb24gPSBudWxsLCB0aGlzLnNjaGVkdWxlVGltZW91dCgpOyB9IHJldHVybiBRbChlLCB0KSwgZS5kaXNwYXRjaFRpbWVvdXQgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHQud2l0aE9ic2VydmFibGU7IHQuX3Vuc3Vic2NyaWJlQW5kUmVjeWNsZSgpLCB0LmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdCh0LCBlKSk7IH0sIGUucHJvdG90eXBlLnNjaGVkdWxlVGltZW91dCA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmFjdGlvbjsgdCA/IHRoaXMuYWN0aW9uID0gdC5zY2hlZHVsZSh0aGlzLCB0aGlzLndhaXRGb3IpIDogdGhpcy5hZGQodGhpcy5hY3Rpb24gPSB0aGlzLnNjaGVkdWxlci5zY2hlZHVsZShlLmRpc3BhdGNoVGltZW91dCwgdGhpcy53YWl0Rm9yLCB0aGlzKSk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5hYnNvbHV0ZVRpbWVvdXQgfHwgdGhpcy5zY2hlZHVsZVRpbWVvdXQoKSwgdC5wcm90b3R5cGUuX25leHQuY2FsbCh0aGlzLCBlKTsgfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmFjdGlvbiA9IG51bGwsIHRoaXMuc2NoZWR1bGVyID0gbnVsbCwgdGhpcy53aXRoT2JzZXJ2YWJsZSA9IG51bGw7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBycCA9IHsgdGltZW91dFdpdGg6IFpsIH07IHZhciBucCA9IHsgdGltZW91dFdpdGg6IGZ1bmN0aW9uICh0LCBlLCByKSB7IHJldHVybiB2b2lkIDAgPT09IHIgJiYgKHIgPSBWZS5hc3luYyksIHJwLnRpbWVvdXRXaXRoKHQsIGUsIHIpKHRoaXMpIH0gfTsgTi5PYnNlcnZhYmxlLnByb3RvdHlwZS50aW1lb3V0V2l0aCA9IG5wLnRpbWVvdXRXaXRoOyB2YXIgaXAgPSBmdW5jdGlvbiAodCkgeyByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gVmUuYXN5bmMpLCBOci5tYXAoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBuZXcgb3AoZSwgdC5ub3coKSkgfSkpIH0sIG9wID0gZnVuY3Rpb24gKHQsIGUpIHsgdGhpcy52YWx1ZSA9IHQsIHRoaXMudGltZXN0YW1wID0gZTsgfSwgc3AgPSB7IHRpbWVzdGFtcDogaXAsIFRpbWVzdGFtcDogb3AgfTsgdmFyIGNwID0geyB0aW1lc3RhbXA6IGZ1bmN0aW9uICh0KSB7IHJldHVybiB2b2lkIDAgPT09IHQgJiYgKHQgPSBWZS5hc3luYyksIHNwLnRpbWVzdGFtcCh0KSh0aGlzKSB9IH07IGZ1bmN0aW9uIHVwKHQsIGUsIHIpIHsgcmV0dXJuIDAgPT09IHIgPyBbZV0gOiAodC5wdXNoKGUpLCB0KSB9IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUudGltZXN0YW1wID0gY3AudGltZXN0YW1wOyB2YXIgYXAgPSB7IHRvQXJyYXk6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIEdjLnJlZHVjZSh1cCwgW10pIH0gfTsgdmFyIGhwID0geyB0b0FycmF5OiBmdW5jdGlvbiAoKSB7IHJldHVybiBhcC50b0FycmF5KCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnRvQXJyYXkgPSBocC50b0FycmF5OyB2YXIgbHAgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIHBwID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IGZwKHQpKSB9IH0sIGZwID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy53aW5kb3dCb3VuZGFyaWVzID0gdDsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHZhciByID0gbmV3IGJwKHQpLCBuID0gZS5zdWJzY3JpYmUocik7IHJldHVybiBuLmNsb3NlZCB8fCByLmFkZChidC5zdWJzY3JpYmVUb1Jlc3VsdChyLCB0aGlzLndpbmRvd0JvdW5kYXJpZXMpKSwgbiB9LCB0IH0oKSwgYnAgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUpIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLndpbmRvdyA9IG5ldyB6LlN1YmplY3QsIGUubmV4dCh0aGlzLndpbmRvdyk7IH0gcmV0dXJuIGxwKGUsIHQpLCBlLnByb3RvdHlwZS5ub3RpZnlOZXh0ID0gZnVuY3Rpb24gKHQsIGUsIHIsIG4sIGkpIHsgdGhpcy5vcGVuV2luZG93KCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUVycm9yID0gZnVuY3Rpb24gKHQsIGUpIHsgdGhpcy5fZXJyb3IodCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5fY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyB0aGlzLndpbmRvdy5uZXh0KHQpOyB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB0aGlzLndpbmRvdy5lcnJvcih0KSwgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUuX2NvbXBsZXRlID0gZnVuY3Rpb24gKCkgeyB0aGlzLndpbmRvdy5jb21wbGV0ZSgpLCB0aGlzLmRlc3RpbmF0aW9uLmNvbXBsZXRlKCk7IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy53aW5kb3cgPSBudWxsOyB9LCBlLnByb3RvdHlwZS5vcGVuV2luZG93ID0gZnVuY3Rpb24gKCkgeyB2YXIgdCA9IHRoaXMud2luZG93OyB0ICYmIHQuY29tcGxldGUoKTsgdmFyIGUgPSB0aGlzLmRlc3RpbmF0aW9uLCByID0gdGhpcy53aW5kb3cgPSBuZXcgei5TdWJqZWN0OyBlLm5leHQocik7IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBkcCA9IHsgd2luZG93OiBwcCB9OyB2YXIgeXAgPSB7IHdpbmRvdzogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGRwLndpbmRvdyh0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUud2luZG93ID0geXAud2luZG93OyB2YXIgdnAgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIG1wID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCBmdW5jdGlvbiAocikgeyByZXR1cm4gci5saWZ0KG5ldyB3cCh0LCBlKSkgfSB9LCB3cCA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gdCh0LCBlKSB7IHRoaXMud2luZG93U2l6ZSA9IHQsIHRoaXMuc3RhcnRXaW5kb3dFdmVyeSA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IF9wKHQsIHRoaXMud2luZG93U2l6ZSwgdGhpcy5zdGFydFdpbmRvd0V2ZXJ5KSkgfSwgdCB9KCksIF9wID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHQuY2FsbCh0aGlzLCBlKSwgdGhpcy5kZXN0aW5hdGlvbiA9IGUsIHRoaXMud2luZG93U2l6ZSA9IHIsIHRoaXMuc3RhcnRXaW5kb3dFdmVyeSA9IG4sIHRoaXMud2luZG93cyA9IFtuZXcgei5TdWJqZWN0XSwgdGhpcy5jb3VudCA9IDAsIGUubmV4dCh0aGlzLndpbmRvd3NbMF0pOyB9IHJldHVybiB2cChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyBmb3IgKHZhciBlID0gdGhpcy5zdGFydFdpbmRvd0V2ZXJ5ID4gMCA/IHRoaXMuc3RhcnRXaW5kb3dFdmVyeSA6IHRoaXMud2luZG93U2l6ZSwgciA9IHRoaXMuZGVzdGluYXRpb24sIG4gPSB0aGlzLndpbmRvd1NpemUsIGkgPSB0aGlzLndpbmRvd3MsIG8gPSBpLmxlbmd0aCwgcyA9IDA7IHMgPCBvICYmICF0aGlzLmNsb3NlZDsgcysrKWlbc10ubmV4dCh0KTsgdmFyIGMgPSB0aGlzLmNvdW50IC0gbiArIDE7IGlmIChjID49IDAgJiYgYyAlIGUgPT0gMCAmJiAhdGhpcy5jbG9zZWQgJiYgaS5zaGlmdCgpLmNvbXBsZXRlKCksICsrdGhpcy5jb3VudCAlIGUgPT0gMCAmJiAhdGhpcy5jbG9zZWQpIHsgdmFyIHUgPSBuZXcgei5TdWJqZWN0OyBpLnB1c2godSksIHIubmV4dCh1KTsgfSB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IHRoaXMud2luZG93czsgaWYgKGUpIGZvciAoOyBlLmxlbmd0aCA+IDAgJiYgIXRoaXMuY2xvc2VkOyllLnNoaWZ0KCkuZXJyb3IodCk7IHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLndpbmRvd3M7IGlmICh0KSBmb3IgKDsgdC5sZW5ndGggPiAwICYmICF0aGlzLmNsb3NlZDspdC5zaGlmdCgpLmNvbXBsZXRlKCk7IHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlID0gZnVuY3Rpb24gKCkgeyB0aGlzLmNvdW50ID0gMCwgdGhpcy53aW5kb3dzID0gbnVsbDsgfSwgZSB9KFQuU3Vic2NyaWJlciksIHhwID0geyB3aW5kb3dDb3VudDogbXAgfTsgdmFyIE9wID0geyB3aW5kb3dDb3VudDogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIHZvaWQgMCA9PT0gZSAmJiAoZSA9IDApLCB4cC53aW5kb3dDb3VudCh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUud2luZG93Q291bnQgPSBPcC53aW5kb3dDb3VudDsgdmFyIFNwID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH07IHZhciBncCA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gVmUuYXN5bmMsIHIgPSBudWxsLCBuID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZOyByZXR1cm4gdHQuaXNTY2hlZHVsZXIoYXJndW1lbnRzWzNdKSAmJiAoZSA9IGFyZ3VtZW50c1szXSksIHR0LmlzU2NoZWR1bGVyKGFyZ3VtZW50c1syXSkgPyBlID0gYXJndW1lbnRzWzJdIDogamUuaXNOdW1lcmljKGFyZ3VtZW50c1syXSkgJiYgKG4gPSBhcmd1bWVudHNbMl0pLCB0dC5pc1NjaGVkdWxlcihhcmd1bWVudHNbMV0pID8gZSA9IGFyZ3VtZW50c1sxXSA6IGplLmlzTnVtZXJpYyhhcmd1bWVudHNbMV0pICYmIChyID0gYXJndW1lbnRzWzFdKSwgZnVuY3Rpb24gKGkpIHsgcmV0dXJuIGkubGlmdChuZXcgVHAodCwgciwgbiwgZSkpIH0gfSwgVHAgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQodCwgZSwgciwgbikgeyB0aGlzLndpbmRvd1RpbWVTcGFuID0gdCwgdGhpcy53aW5kb3dDcmVhdGlvbkludGVydmFsID0gZSwgdGhpcy5tYXhXaW5kb3dTaXplID0gciwgdGhpcy5zY2hlZHVsZXIgPSBuOyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyBFcCh0LCB0aGlzLndpbmRvd1RpbWVTcGFuLCB0aGlzLndpbmRvd0NyZWF0aW9uSW50ZXJ2YWwsIHRoaXMubWF4V2luZG93U2l6ZSwgdGhpcy5zY2hlZHVsZXIpKSB9LCB0IH0oKSwganAgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKCkgeyB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRoaXMuX251bWJlck9mTmV4dGVkVmFsdWVzID0gMDsgfSByZXR1cm4gU3AoZSwgdCksIGUucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9udW1iZXJPZk5leHRlZFZhbHVlcysrLCB0LnByb3RvdHlwZS5uZXh0LmNhbGwodGhpcywgZSk7IH0sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwgIm51bWJlck9mTmV4dGVkVmFsdWVzIiwgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX251bWJlck9mTmV4dGVkVmFsdWVzIH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pLCBlIH0oei5TdWJqZWN0KSwgRXAgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4sIGksIG8pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLmRlc3RpbmF0aW9uID0gZSwgdGhpcy53aW5kb3dUaW1lU3BhbiA9IHIsIHRoaXMud2luZG93Q3JlYXRpb25JbnRlcnZhbCA9IG4sIHRoaXMubWF4V2luZG93U2l6ZSA9IGksIHRoaXMuc2NoZWR1bGVyID0gbywgdGhpcy53aW5kb3dzID0gW107IHZhciBzID0gdGhpcy5vcGVuV2luZG93KCk7IGlmIChudWxsICE9PSBuICYmIG4gPj0gMCkgeyB2YXIgYyA9IHsgc3Vic2NyaWJlcjogdGhpcywgd2luZG93OiBzLCBjb250ZXh0OiBudWxsIH0sIHUgPSB7IHdpbmRvd1RpbWVTcGFuOiByLCB3aW5kb3dDcmVhdGlvbkludGVydmFsOiBuLCBzdWJzY3JpYmVyOiB0aGlzLCBzY2hlZHVsZXI6IG8gfTsgdGhpcy5hZGQoby5zY2hlZHVsZShDcCwgciwgYykpLCB0aGlzLmFkZChvLnNjaGVkdWxlKEFwLCBuLCB1KSk7IH0gZWxzZSB7IHZhciBhID0geyBzdWJzY3JpYmVyOiB0aGlzLCB3aW5kb3c6IHMsIHdpbmRvd1RpbWVTcGFuOiByIH07IHRoaXMuYWRkKG8uc2NoZWR1bGUoSXAsIHIsIGEpKTsgfSB9IHJldHVybiBTcChlLCB0KSwgZS5wcm90b3R5cGUuX25leHQgPSBmdW5jdGlvbiAodCkgeyBmb3IgKHZhciBlID0gdGhpcy53aW5kb3dzLCByID0gZS5sZW5ndGgsIG4gPSAwOyBuIDwgcjsgbisrKSB7IHZhciBpID0gZVtuXTsgaS5jbG9zZWQgfHwgKGkubmV4dCh0KSwgaS5udW1iZXJPZk5leHRlZFZhbHVlcyA+PSB0aGlzLm1heFdpbmRvd1NpemUgJiYgdGhpcy5jbG9zZVdpbmRvdyhpKSk7IH0gfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgZm9yICh2YXIgZSA9IHRoaXMud2luZG93czsgZS5sZW5ndGggPiAwOyllLnNoaWZ0KCkuZXJyb3IodCk7IHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCA9IHRoaXMud2luZG93czsgdC5sZW5ndGggPiAwOykgeyB2YXIgZSA9IHQuc2hpZnQoKTsgZS5jbG9zZWQgfHwgZS5jb21wbGV0ZSgpOyB9IHRoaXMuZGVzdGluYXRpb24uY29tcGxldGUoKTsgfSwgZS5wcm90b3R5cGUub3BlbldpbmRvdyA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSBuZXcganA7IHJldHVybiB0aGlzLndpbmRvd3MucHVzaCh0KSwgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KHQpLCB0IH0sIGUucHJvdG90eXBlLmNsb3NlV2luZG93ID0gZnVuY3Rpb24gKHQpIHsgdC5jb21wbGV0ZSgpOyB2YXIgZSA9IHRoaXMud2luZG93czsgZS5zcGxpY2UoZS5pbmRleE9mKHQpLCAxKTsgfSwgZSB9KFQuU3Vic2NyaWJlcik7IGZ1bmN0aW9uIElwKHQpIHsgdmFyIGUgPSB0LnN1YnNjcmliZXIsIHIgPSB0LndpbmRvd1RpbWVTcGFuLCBuID0gdC53aW5kb3c7IG4gJiYgZS5jbG9zZVdpbmRvdyhuKSwgdC53aW5kb3cgPSBlLm9wZW5XaW5kb3coKSwgdGhpcy5zY2hlZHVsZSh0LCByKTsgfSBmdW5jdGlvbiBBcCh0KSB7IHZhciBlID0gdC53aW5kb3dUaW1lU3BhbiwgciA9IHQuc3Vic2NyaWJlciwgbiA9IHQuc2NoZWR1bGVyLCBpID0gdC53aW5kb3dDcmVhdGlvbkludGVydmFsLCBvID0gci5vcGVuV2luZG93KCksIHMgPSB0aGlzLCBjID0geyBhY3Rpb246IHMsIHN1YnNjcmlwdGlvbjogbnVsbCB9LCB1ID0geyBzdWJzY3JpYmVyOiByLCB3aW5kb3c6IG8sIGNvbnRleHQ6IGMgfTsgYy5zdWJzY3JpcHRpb24gPSBuLnNjaGVkdWxlKENwLCBlLCB1KSwgcy5hZGQoYy5zdWJzY3JpcHRpb24pLCBzLnNjaGVkdWxlKHQsIGkpOyB9IGZ1bmN0aW9uIENwKHQpIHsgdmFyIGUgPSB0LnN1YnNjcmliZXIsIHIgPSB0LndpbmRvdywgbiA9IHQuY29udGV4dDsgbiAmJiBuLmFjdGlvbiAmJiBuLnN1YnNjcmlwdGlvbiAmJiBuLmFjdGlvbi5yZW1vdmUobi5zdWJzY3JpcHRpb24pLCBlLmNsb3NlV2luZG93KHIpOyB9IHZhciBOcCA9IHsgd2luZG93VGltZTogZ3AgfTsgdmFyIFBwID0geyB3aW5kb3dUaW1lOiBmdW5jdGlvbiAodCkgeyB2YXIgZSA9IFZlLmFzeW5jLCByID0gbnVsbCwgbiA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsgcmV0dXJuIHR0LmlzU2NoZWR1bGVyKGFyZ3VtZW50c1szXSkgJiYgKGUgPSBhcmd1bWVudHNbM10pLCB0dC5pc1NjaGVkdWxlcihhcmd1bWVudHNbMl0pID8gZSA9IGFyZ3VtZW50c1syXSA6IGplLmlzTnVtZXJpYyhhcmd1bWVudHNbMl0pICYmIChuID0gYXJndW1lbnRzWzJdKSwgdHQuaXNTY2hlZHVsZXIoYXJndW1lbnRzWzFdKSA/IGUgPSBhcmd1bWVudHNbMV0gOiBqZS5pc051bWVyaWMoYXJndW1lbnRzWzFdKSAmJiAociA9IGFyZ3VtZW50c1sxXSksIE5wLndpbmRvd1RpbWUodCwgciwgbiwgZSkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLndpbmRvd1RpbWUgPSBQcC53aW5kb3dUaW1lOyB2YXIga3AgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIFZwID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGZ1bmN0aW9uIChyKSB7IHJldHVybiByLmxpZnQobmV3IEZwKHQsIGUpKSB9IH0sIEZwID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5vcGVuaW5ncyA9IHQsIHRoaXMuY2xvc2luZ1NlbGVjdG9yID0gZTsgfSByZXR1cm4gdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICh0LCBlKSB7IHJldHVybiBlLnN1YnNjcmliZShuZXcgUnAodCwgdGhpcy5vcGVuaW5ncywgdGhpcy5jbG9zaW5nU2VsZWN0b3IpKSB9LCB0IH0oKSwgUnAgPSBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIsIG4pIHsgdC5jYWxsKHRoaXMsIGUpLCB0aGlzLm9wZW5pbmdzID0gciwgdGhpcy5jbG9zaW5nU2VsZWN0b3IgPSBuLCB0aGlzLmNvbnRleHRzID0gW10sIHRoaXMuYWRkKHRoaXMub3BlblN1YnNjcmlwdGlvbiA9IGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHIsIHIpKTsgfSByZXR1cm4ga3AoZSwgdCksIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLmNvbnRleHRzOyBpZiAoZSkgZm9yICh2YXIgciA9IGUubGVuZ3RoLCBuID0gMDsgbiA8IHI7IG4rKyllW25dLndpbmRvdy5uZXh0KHQpOyB9LCBlLnByb3RvdHlwZS5fZXJyb3IgPSBmdW5jdGlvbiAoZSkgeyB2YXIgciA9IHRoaXMuY29udGV4dHM7IGlmICh0aGlzLmNvbnRleHRzID0gbnVsbCwgcikgZm9yICh2YXIgbiA9IHIubGVuZ3RoLCBpID0gLTE7ICsraSA8IG47KSB7IHZhciBvID0gcltpXTsgby53aW5kb3cuZXJyb3IoZSksIG8uc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7IH0gdC5wcm90b3R5cGUuX2Vycm9yLmNhbGwodGhpcywgZSk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdmFyIGUgPSB0aGlzLmNvbnRleHRzOyBpZiAodGhpcy5jb250ZXh0cyA9IG51bGwsIGUpIGZvciAodmFyIHIgPSBlLmxlbmd0aCwgbiA9IC0xOyArK24gPCByOykgeyB2YXIgaSA9IGVbbl07IGkud2luZG93LmNvbXBsZXRlKCksIGkuc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7IH0gdC5wcm90b3R5cGUuX2NvbXBsZXRlLmNhbGwodGhpcyk7IH0sIGUucHJvdG90eXBlLl91bnN1YnNjcmliZSA9IGZ1bmN0aW9uICgpIHsgdmFyIHQgPSB0aGlzLmNvbnRleHRzOyBpZiAodGhpcy5jb250ZXh0cyA9IG51bGwsIHQpIGZvciAodmFyIGUgPSB0Lmxlbmd0aCwgciA9IC0xOyArK3IgPCBlOykgeyB2YXIgbiA9IHRbcl07IG4ud2luZG93LnVuc3Vic2NyaWJlKCksIG4uc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7IH0gfSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IGlmICh0ID09PSB0aGlzLm9wZW5pbmdzKSB7IHZhciBvID0gdGhpcy5jbG9zaW5nU2VsZWN0b3IsIHMgPSBmLnRyeUNhdGNoKG8pKGUpOyBpZiAocyA9PT0gbC5lcnJvck9iamVjdCkgcmV0dXJuIHRoaXMuZXJyb3IobC5lcnJvck9iamVjdC5lKTsgdmFyIGMgPSBuZXcgei5TdWJqZWN0LCB1ID0gbmV3IHYuU3Vic2NyaXB0aW9uLCBhID0geyB3aW5kb3c6IGMsIHN1YnNjcmlwdGlvbjogdSB9OyB0aGlzLmNvbnRleHRzLnB1c2goYSk7IHZhciBoID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgcywgYSk7IGguY2xvc2VkID8gdGhpcy5jbG9zZVdpbmRvdyh0aGlzLmNvbnRleHRzLmxlbmd0aCAtIDEpIDogKGguY29udGV4dCA9IGEsIHUuYWRkKGgpKSwgdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGMpOyB9IGVsc2UgdGhpcy5jbG9zZVdpbmRvdyh0aGlzLmNvbnRleHRzLmluZGV4T2YodCkpOyB9LCBlLnByb3RvdHlwZS5ub3RpZnlFcnJvciA9IGZ1bmN0aW9uICh0KSB7IHRoaXMuZXJyb3IodCk7IH0sIGUucHJvdG90eXBlLm5vdGlmeUNvbXBsZXRlID0gZnVuY3Rpb24gKHQpIHsgdCAhPT0gdGhpcy5vcGVuU3Vic2NyaXB0aW9uICYmIHRoaXMuY2xvc2VXaW5kb3codGhpcy5jb250ZXh0cy5pbmRleE9mKHQuY29udGV4dCkpOyB9LCBlLnByb3RvdHlwZS5jbG9zZVdpbmRvdyA9IGZ1bmN0aW9uICh0KSB7IGlmICgtMSAhPT0gdCkgeyB2YXIgZSA9IHRoaXMuY29udGV4dHMsIHIgPSBlW3RdLCBuID0gci53aW5kb3csIGkgPSByLnN1YnNjcmlwdGlvbjsgZS5zcGxpY2UodCwgMSksIG4uY29tcGxldGUoKSwgaS51bnN1YnNjcmliZSgpOyB9IH0sIGUgfSh1dC5PdXRlclN1YnNjcmliZXIpLCBNcCA9IHsgd2luZG93VG9nZ2xlOiBWcCB9OyB2YXIgV3AgPSB7IHdpbmRvd1RvZ2dsZTogZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIE1wLndpbmRvd1RvZ2dsZSh0LCBlKSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUud2luZG93VG9nZ2xlID0gV3Aud2luZG93VG9nZ2xlOyB2YXIgcXAgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIExwID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IFVwKHQpKSB9IH0sIFVwID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQpIHsgdGhpcy5jbG9zaW5nU2VsZWN0b3IgPSB0OyB9IHJldHVybiB0LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHQsIGUpIHsgcmV0dXJuIGUuc3Vic2NyaWJlKG5ldyB6cCh0LCB0aGlzLmNsb3NpbmdTZWxlY3RvcikpIH0sIHQgfSgpLCB6cCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMuZGVzdGluYXRpb24gPSBlLCB0aGlzLmNsb3NpbmdTZWxlY3RvciA9IHIsIHRoaXMub3BlbldpbmRvdygpOyB9IHJldHVybiBxcChlLCB0KSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMub3BlbldpbmRvdyhpKTsgfSwgZS5wcm90b3R5cGUubm90aWZ5RXJyb3IgPSBmdW5jdGlvbiAodCwgZSkgeyB0aGlzLl9lcnJvcih0KTsgfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAodCkgeyB0aGlzLm9wZW5XaW5kb3codCk7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgdGhpcy53aW5kb3cubmV4dCh0KTsgfSwgZS5wcm90b3R5cGUuX2Vycm9yID0gZnVuY3Rpb24gKHQpIHsgdGhpcy53aW5kb3cuZXJyb3IodCksIHRoaXMuZGVzdGluYXRpb24uZXJyb3IodCksIHRoaXMudW5zdWJzY3JpYmVDbG9zaW5nTm90aWZpY2F0aW9uKCk7IH0sIGUucHJvdG90eXBlLl9jb21wbGV0ZSA9IGZ1bmN0aW9uICgpIHsgdGhpcy53aW5kb3cuY29tcGxldGUoKSwgdGhpcy5kZXN0aW5hdGlvbi5jb21wbGV0ZSgpLCB0aGlzLnVuc3Vic2NyaWJlQ2xvc2luZ05vdGlmaWNhdGlvbigpOyB9LCBlLnByb3RvdHlwZS51bnN1YnNjcmliZUNsb3NpbmdOb3RpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7IHRoaXMuY2xvc2luZ05vdGlmaWNhdGlvbiAmJiB0aGlzLmNsb3NpbmdOb3RpZmljYXRpb24udW5zdWJzY3JpYmUoKTsgfSwgZS5wcm90b3R5cGUub3BlbldpbmRvdyA9IGZ1bmN0aW9uICh0KSB7IHZvaWQgMCA9PT0gdCAmJiAodCA9IG51bGwpLCB0ICYmICh0aGlzLnJlbW92ZSh0KSwgdC51bnN1YnNjcmliZSgpKTsgdmFyIGUgPSB0aGlzLndpbmRvdzsgZSAmJiBlLmNvbXBsZXRlKCk7IHZhciByID0gdGhpcy53aW5kb3cgPSBuZXcgei5TdWJqZWN0OyB0aGlzLmRlc3RpbmF0aW9uLm5leHQocik7IHZhciBuID0gZi50cnlDYXRjaCh0aGlzLmNsb3NpbmdTZWxlY3RvcikoKTsgaWYgKG4gPT09IGwuZXJyb3JPYmplY3QpIHsgdmFyIGkgPSBsLmVycm9yT2JqZWN0LmU7IHRoaXMuZGVzdGluYXRpb24uZXJyb3IoaSksIHRoaXMud2luZG93LmVycm9yKGkpOyB9IGVsc2UgdGhpcy5hZGQodGhpcy5jbG9zaW5nTm90aWZpY2F0aW9uID0gYnQuc3Vic2NyaWJlVG9SZXN1bHQodGhpcywgbikpOyB9LCBlIH0odXQuT3V0ZXJTdWJzY3JpYmVyKSwgQnAgPSB7IHdpbmRvd1doZW46IExwIH07IHZhciBEcCA9IHsgd2luZG93V2hlbjogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIEJwLndpbmRvd1doZW4odCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLndpbmRvd1doZW4gPSBEcC53aW5kb3dXaGVuOyB2YXIgWXAgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfTsgdmFyIEhwID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgdmFyIHI7ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHRbdC5sZW5ndGggLSAxXSAmJiAociA9IHQucG9wKCkpOyB2YXIgbiA9IHQ7IHJldHVybiBlLmxpZnQobmV3IFhwKG4sIHIpKSB9IH0sIFhwID0gZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiB0KHQsIGUpIHsgdGhpcy5vYnNlcnZhYmxlcyA9IHQsIHRoaXMucHJvamVjdCA9IGU7IH0gcmV0dXJuIHQucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gZS5zdWJzY3JpYmUobmV3IEdwKHQsIHRoaXMub2JzZXJ2YWJsZXMsIHRoaXMucHJvamVjdCkpIH0sIHQgfSgpLCBHcCA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgciwgbikgeyB0LmNhbGwodGhpcywgZSksIHRoaXMub2JzZXJ2YWJsZXMgPSByLCB0aGlzLnByb2plY3QgPSBuLCB0aGlzLnRvUmVzcG9uZCA9IFtdOyB2YXIgaSA9IHIubGVuZ3RoOyB0aGlzLnZhbHVlcyA9IG5ldyBBcnJheShpKTsgZm9yICh2YXIgbyA9IDA7IG8gPCBpOyBvKyspdGhpcy50b1Jlc3BvbmQucHVzaChvKTsgZm9yIChvID0gMDsgbyA8IGk7IG8rKykgeyB2YXIgcyA9IHJbb107IHRoaXMuYWRkKGJ0LnN1YnNjcmliZVRvUmVzdWx0KHRoaXMsIHMsIHMsIG8pKTsgfSB9IHJldHVybiBZcChlLCB0KSwgZS5wcm90b3R5cGUubm90aWZ5TmV4dCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBpKSB7IHRoaXMudmFsdWVzW3JdID0gZTsgdmFyIG8gPSB0aGlzLnRvUmVzcG9uZDsgaWYgKG8ubGVuZ3RoID4gMCkgeyB2YXIgcyA9IG8uaW5kZXhPZihyKTsgLTEgIT09IHMgJiYgby5zcGxpY2UocywgMSk7IH0gfSwgZS5wcm90b3R5cGUubm90aWZ5Q29tcGxldGUgPSBmdW5jdGlvbiAoKSB7IH0sIGUucHJvdG90eXBlLl9uZXh0ID0gZnVuY3Rpb24gKHQpIHsgaWYgKDAgPT09IHRoaXMudG9SZXNwb25kLmxlbmd0aCkgeyB2YXIgZSA9IFt0XS5jb25jYXQodGhpcy52YWx1ZXMpOyB0aGlzLnByb2plY3QgPyB0aGlzLl90cnlQcm9qZWN0KGUpIDogdGhpcy5kZXN0aW5hdGlvbi5uZXh0KGUpOyB9IH0sIGUucHJvdG90eXBlLl90cnlQcm9qZWN0ID0gZnVuY3Rpb24gKHQpIHsgdmFyIGU7IHRyeSB7IGUgPSB0aGlzLnByb2plY3QuYXBwbHkodGhpcywgdCk7IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHZvaWQgdGhpcy5kZXN0aW5hdGlvbi5lcnJvcih0KSB9IHRoaXMuZGVzdGluYXRpb24ubmV4dChlKTsgfSwgZSB9KHV0Lk91dGVyU3Vic2NyaWJlciksIEpwID0geyB3aXRoTGF0ZXN0RnJvbTogSHAgfTsgdmFyIEtwID0geyB3aXRoTGF0ZXN0RnJvbTogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gSnAud2l0aExhdGVzdEZyb20uYXBwbHkodm9pZCAwLCB0KSh0aGlzKSB9IH07IE4uT2JzZXJ2YWJsZS5wcm90b3R5cGUud2l0aExhdGVzdEZyb20gPSBLcC53aXRoTGF0ZXN0RnJvbTsgdmFyICRwID0geyB6aXBQcm90bzogZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gW10sIGUgPSAwOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKXRbZSAtIDBdID0gYXJndW1lbnRzW2VdOyByZXR1cm4gZ3IuemlwLmFwcGx5KHZvaWQgMCwgdCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnppcCA9ICRwLnppcFByb3RvOyB2YXIgUXAgPSB7IHppcEFsbDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmxpZnQobmV3IGdyLlppcE9wZXJhdG9yKHQpKSB9IH0gfTsgdmFyIFpwID0geyB6aXBBbGw6IGZ1bmN0aW9uICh0KSB7IHJldHVybiBRcC56aXBBbGwodCkodGhpcykgfSB9OyBOLk9ic2VydmFibGUucHJvdG90eXBlLnppcEFsbCA9IFpwLnppcEFsbDsgdmFyIHRmID0geyBTdWJzY3JpcHRpb25Mb2c6IGZ1bmN0aW9uICh0LCBlKSB7IHZvaWQgMCA9PT0gZSAmJiAoZSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSksIHRoaXMuc3Vic2NyaWJlZEZyYW1lID0gdCwgdGhpcy51bnN1YnNjcmliZWRGcmFtZSA9IGU7IH0gfSwgZWYgPSB7IFN1YnNjcmlwdGlvbkxvZ2dhYmxlOiBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIHQoKSB7IHRoaXMuc3Vic2NyaXB0aW9ucyA9IFtdOyB9IHJldHVybiB0LnByb3RvdHlwZS5sb2dTdWJzY3JpYmVkRnJhbWUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChuZXcgdGYuU3Vic2NyaXB0aW9uTG9nKHRoaXMuc2NoZWR1bGVyLm5vdygpKSksIHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggLSAxIH0sIHQucHJvdG90eXBlLmxvZ1Vuc3Vic2NyaWJlZEZyYW1lID0gZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLnN1YnNjcmlwdGlvbnMsIHIgPSBlW3RdOyBlW3RdID0gbmV3IHRmLlN1YnNjcmlwdGlvbkxvZyhyLnN1YnNjcmliZWRGcmFtZSwgdGhpcy5zY2hlZHVsZXIubm93KCkpOyB9LCB0IH0oKSB9OyB2YXIgcmYgPSB7IGFwcGx5TWl4aW5zOiBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByID0gMCwgbiA9IGUubGVuZ3RoOyByIDwgbjsgcisrKWZvciAodmFyIGkgPSBlW3JdLCBvID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaS5wcm90b3R5cGUpLCBzID0gMCwgYyA9IG8ubGVuZ3RoOyBzIDwgYzsgcysrKSB7IHZhciB1ID0gb1tzXTsgdC5wcm90b3R5cGVbdV0gPSBpLnByb3RvdHlwZVt1XTsgfSB9IH0sIG5mID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIG9mID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHQuY2FsbCh0aGlzLCAoZnVuY3Rpb24gKHQpIHsgdmFyIGUgPSB0aGlzLCByID0gZS5sb2dTdWJzY3JpYmVkRnJhbWUoKTsgcmV0dXJuIHQuYWRkKG5ldyB2LlN1YnNjcmlwdGlvbigoZnVuY3Rpb24gKCkgeyBlLmxvZ1Vuc3Vic2NyaWJlZEZyYW1lKHIpOyB9KSkpLCBlLnNjaGVkdWxlTWVzc2FnZXModCksIHQgfSkpLCB0aGlzLm1lc3NhZ2VzID0gZSwgdGhpcy5zdWJzY3JpcHRpb25zID0gW10sIHRoaXMuc2NoZWR1bGVyID0gcjsgfSByZXR1cm4gbmYoZSwgdCksIGUucHJvdG90eXBlLnNjaGVkdWxlTWVzc2FnZXMgPSBmdW5jdGlvbiAodCkgeyBmb3IgKHZhciBlID0gdGhpcy5tZXNzYWdlcy5sZW5ndGgsIHIgPSAwOyByIDwgZTsgcisrKSB7IHZhciBuID0gdGhpcy5tZXNzYWdlc1tyXTsgdC5hZGQodGhpcy5zY2hlZHVsZXIuc2NoZWR1bGUoKGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdC5tZXNzYWdlLCByID0gdC5zdWJzY3JpYmVyOyBlLm5vdGlmaWNhdGlvbi5vYnNlcnZlKHIpOyB9KSwgbi5mcmFtZSwgeyBtZXNzYWdlOiBuLCBzdWJzY3JpYmVyOiB0IH0pKTsgfSB9LCBlIH0oTi5PYnNlcnZhYmxlKSwgc2YgPSBvZjsgcmYuYXBwbHlNaXhpbnMob2YsIFtlZi5TdWJzY3JpcHRpb25Mb2dnYWJsZV0pOyB2YXIgY2YgPSB7IENvbGRPYnNlcnZhYmxlOiBzZiB9LCB1ZiA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCBhZiA9IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoZSwgcikgeyB0LmNhbGwodGhpcyksIHRoaXMubWVzc2FnZXMgPSBlLCB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXSwgdGhpcy5zY2hlZHVsZXIgPSByOyB9IHJldHVybiB1ZihlLCB0KSwgZS5wcm90b3R5cGUuX3N1YnNjcmliZSA9IGZ1bmN0aW9uIChlKSB7IHZhciByID0gdGhpcywgbiA9IHIubG9nU3Vic2NyaWJlZEZyYW1lKCk7IHJldHVybiBlLmFkZChuZXcgdi5TdWJzY3JpcHRpb24oKGZ1bmN0aW9uICgpIHsgci5sb2dVbnN1YnNjcmliZWRGcmFtZShuKTsgfSkpKSwgdC5wcm90b3R5cGUuX3N1YnNjcmliZS5jYWxsKHRoaXMsIGUpIH0sIGUucHJvdG90eXBlLnNldHVwID0gZnVuY3Rpb24gKCkgeyBmb3IgKHZhciB0ID0gdGhpcywgZSA9IHQubWVzc2FnZXMubGVuZ3RoLCByID0gMDsgciA8IGU7IHIrKykhZnVuY3Rpb24gKCkgeyB2YXIgZSA9IHQubWVzc2FnZXNbcl07IHQuc2NoZWR1bGVyLnNjaGVkdWxlKChmdW5jdGlvbiAoKSB7IGUubm90aWZpY2F0aW9uLm9ic2VydmUodCk7IH0pLCBlLmZyYW1lKTsgfSgpOyB9LCBlIH0oei5TdWJqZWN0KSwgaGYgPSBhZjsgcmYuYXBwbHlNaXhpbnMoYWYsIFtlZi5TdWJzY3JpcHRpb25Mb2dnYWJsZV0pOyB2YXIgbGYgPSB7IEhvdE9ic2VydmFibGU6IGhmIH0sIHBmID0gdCAmJiB0Ll9fZXh0ZW5kcyB8fCBmdW5jdGlvbiAodCwgZSkgeyBmb3IgKHZhciByIGluIGUpIGUuaGFzT3duUHJvcGVydHkocikgJiYgKHRbcl0gPSBlW3JdKTsgZnVuY3Rpb24gbigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IHQ7IH0gdC5wcm90b3R5cGUgPSBudWxsID09PSBlID8gT2JqZWN0LmNyZWF0ZShlKSA6IChuLnByb3RvdHlwZSA9IGUucHJvdG90eXBlLCBuZXcgbik7IH0sIGZmID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByKSB7IHZhciBuID0gdGhpczsgdm9pZCAwID09PSBlICYmIChlID0gYmYpLCB2b2lkIDAgPT09IHIgJiYgKHIgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCB0LmNhbGwodGhpcywgZSwgKGZ1bmN0aW9uICgpIHsgcmV0dXJuIG4uZnJhbWUgfSkpLCB0aGlzLm1heEZyYW1lcyA9IHIsIHRoaXMuZnJhbWUgPSAwLCB0aGlzLmluZGV4ID0gLTE7IH0gcmV0dXJuIHBmKGUsIHQpLCBlLnByb3RvdHlwZS5mbHVzaCA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgdCwgZSwgciA9IHRoaXMuYWN0aW9ucywgbiA9IHRoaXMubWF4RnJhbWVzOyAoZSA9IHIuc2hpZnQoKSkgJiYgKHRoaXMuZnJhbWUgPSBlLmRlbGF5KSA8PSBuICYmICEodCA9IGUuZXhlY3V0ZShlLnN0YXRlLCBlLmRlbGF5KSk7KTsgaWYgKHQpIHsgZm9yICg7IGUgPSByLnNoaWZ0KCk7KWUudW5zdWJzY3JpYmUoKTsgdGhyb3cgdCB9IH0sIGUuZnJhbWVUaW1lRmFjdG9yID0gMTAsIGUgfShrZS5Bc3luY1NjaGVkdWxlciksIGJmID0gZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlLCByLCBuKSB7IHZvaWQgMCA9PT0gbiAmJiAobiA9IGUuaW5kZXggKz0gMSksIHQuY2FsbCh0aGlzLCBlLCByKSwgdGhpcy5zY2hlZHVsZXIgPSBlLCB0aGlzLndvcmsgPSByLCB0aGlzLmluZGV4ID0gbiwgdGhpcy5hY3RpdmUgPSAhMCwgdGhpcy5pbmRleCA9IGUuaW5kZXggPSBuOyB9IHJldHVybiBwZihlLCB0KSwgZS5wcm90b3R5cGUuc2NoZWR1bGUgPSBmdW5jdGlvbiAociwgbikgeyBpZiAodm9pZCAwID09PSBuICYmIChuID0gMCksICF0aGlzLmlkKSByZXR1cm4gdC5wcm90b3R5cGUuc2NoZWR1bGUuY2FsbCh0aGlzLCByLCBuKTsgdGhpcy5hY3RpdmUgPSAhMTsgdmFyIGkgPSBuZXcgZSh0aGlzLnNjaGVkdWxlciwgdGhpcy53b3JrKTsgcmV0dXJuIHRoaXMuYWRkKGkpLCBpLnNjaGVkdWxlKHIsIG4pIH0sIGUucHJvdG90eXBlLnJlcXVlc3RBc3luY0lkID0gZnVuY3Rpb24gKHQsIHIsIG4pIHsgdm9pZCAwID09PSBuICYmIChuID0gMCksIHRoaXMuZGVsYXkgPSB0LmZyYW1lICsgbjsgdmFyIGkgPSB0LmFjdGlvbnM7IHJldHVybiBpLnB1c2godGhpcyksIGkuc29ydChlLnNvcnRBY3Rpb25zKSwgITAgfSwgZS5wcm90b3R5cGUucmVjeWNsZUFzeW5jSWQgPSBmdW5jdGlvbiAodCwgZSwgcikgeyB9LCBlLnByb3RvdHlwZS5fZXhlY3V0ZSA9IGZ1bmN0aW9uIChlLCByKSB7IGlmICghMCA9PT0gdGhpcy5hY3RpdmUpIHJldHVybiB0LnByb3RvdHlwZS5fZXhlY3V0ZS5jYWxsKHRoaXMsIGUsIHIpIH0sIGUuc29ydEFjdGlvbnMgPSBmdW5jdGlvbiAodCwgZSkgeyByZXR1cm4gdC5kZWxheSA9PT0gZS5kZWxheSA/IHQuaW5kZXggPT09IGUuaW5kZXggPyAwIDogdC5pbmRleCA+IGUuaW5kZXggPyAxIDogLTEgOiB0LmRlbGF5ID4gZS5kZWxheSA/IDEgOiAtMSB9LCBlIH0oQ2UuQXN5bmNBY3Rpb24pLCBkZiA9IHsgVmlydHVhbFRpbWVTY2hlZHVsZXI6IGZmLCBWaXJ0dWFsQWN0aW9uOiBiZiB9LCB5ZiA9IHQgJiYgdC5fX2V4dGVuZHMgfHwgZnVuY3Rpb24gKHQsIGUpIHsgZm9yICh2YXIgciBpbiBlKSBlLmhhc093blByb3BlcnR5KHIpICYmICh0W3JdID0gZVtyXSk7IGZ1bmN0aW9uIG4oKSB7IHRoaXMuY29uc3RydWN0b3IgPSB0OyB9IHQucHJvdG90eXBlID0gbnVsbCA9PT0gZSA/IE9iamVjdC5jcmVhdGUoZSkgOiAobi5wcm90b3R5cGUgPSBlLnByb3RvdHlwZSwgbmV3IG4pOyB9LCB2ZiA9IHsgVGVzdFNjaGVkdWxlcjogZnVuY3Rpb24gKHQpIHsgZnVuY3Rpb24gZShlKSB7IHQuY2FsbCh0aGlzLCBkZi5WaXJ0dWFsQWN0aW9uLCA3NTApLCB0aGlzLmFzc2VydERlZXBFcXVhbCA9IGUsIHRoaXMuaG90T2JzZXJ2YWJsZXMgPSBbXSwgdGhpcy5jb2xkT2JzZXJ2YWJsZXMgPSBbXSwgdGhpcy5mbHVzaFRlc3RzID0gW107IH0gcmV0dXJuIHlmKGUsIHQpLCBlLnByb3RvdHlwZS5jcmVhdGVUaW1lID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB0LmluZGV4T2YoInwiKTsgaWYgKC0xID09PSByKSB0aHJvdyBuZXcgRXJyb3IoJ21hcmJsZSBkaWFncmFtIGZvciB0aW1lIHNob3VsZCBoYXZlIGEgY29tcGxldGlvbiBtYXJrZXIgInwiJyk7IHJldHVybiByICogZS5mcmFtZVRpbWVGYWN0b3IgfSwgZS5wcm90b3R5cGUuY3JlYXRlQ29sZE9ic2VydmFibGUgPSBmdW5jdGlvbiAodCwgciwgbikgeyBpZiAoLTEgIT09IHQuaW5kZXhPZigiXiIpKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbGQgb2JzZXJ2YWJsZSBjYW5ub3QgaGF2ZSBzdWJzY3JpcHRpb24gb2Zmc2V0ICJeIicpOyBpZiAoLTEgIT09IHQuaW5kZXhPZigiISIpKSB0aHJvdyBuZXcgRXJyb3IoJ2NvbGQgb2JzZXJ2YWJsZSBjYW5ub3QgaGF2ZSB1bnN1YnNjcmlwdGlvbiBtYXJrZXIgIiEiJyk7IHZhciBpID0gZS5wYXJzZU1hcmJsZXModCwgciwgbiksIG8gPSBuZXcgY2YuQ29sZE9ic2VydmFibGUoaSwgdGhpcyk7IHJldHVybiB0aGlzLmNvbGRPYnNlcnZhYmxlcy5wdXNoKG8pLCBvIH0sIGUucHJvdG90eXBlLmNyZWF0ZUhvdE9ic2VydmFibGUgPSBmdW5jdGlvbiAodCwgciwgbikgeyBpZiAoLTEgIT09IHQuaW5kZXhPZigiISIpKSB0aHJvdyBuZXcgRXJyb3IoJ2hvdCBvYnNlcnZhYmxlIGNhbm5vdCBoYXZlIHVuc3Vic2NyaXB0aW9uIG1hcmtlciAiISInKTsgdmFyIGkgPSBlLnBhcnNlTWFyYmxlcyh0LCByLCBuKSwgbyA9IG5ldyBsZi5Ib3RPYnNlcnZhYmxlKGksIHRoaXMpOyByZXR1cm4gdGhpcy5ob3RPYnNlcnZhYmxlcy5wdXNoKG8pLCBvIH0sIGUucHJvdG90eXBlLm1hdGVyaWFsaXplSW5uZXJPYnNlcnZhYmxlID0gZnVuY3Rpb24gKHQsIGUpIHsgdmFyIHIgPSB0aGlzLCBuID0gW107IHJldHVybiB0LnN1YnNjcmliZSgoZnVuY3Rpb24gKHQpIHsgbi5wdXNoKHsgZnJhbWU6IHIuZnJhbWUgLSBlLCBub3RpZmljYXRpb246IE10Lk5vdGlmaWNhdGlvbi5jcmVhdGVOZXh0KHQpIH0pOyB9KSwgKGZ1bmN0aW9uICh0KSB7IG4ucHVzaCh7IGZyYW1lOiByLmZyYW1lIC0gZSwgbm90aWZpY2F0aW9uOiBNdC5Ob3RpZmljYXRpb24uY3JlYXRlRXJyb3IodCkgfSk7IH0pLCAoZnVuY3Rpb24gKCkgeyBuLnB1c2goeyBmcmFtZTogci5mcmFtZSAtIGUsIG5vdGlmaWNhdGlvbjogTXQuTm90aWZpY2F0aW9uLmNyZWF0ZUNvbXBsZXRlKCkgfSk7IH0pKSwgbiB9LCBlLnByb3RvdHlwZS5leHBlY3RPYnNlcnZhYmxlID0gZnVuY3Rpb24gKHQsIHIpIHsgdmFyIG4gPSB0aGlzOyB2b2lkIDAgPT09IHIgJiYgKHIgPSBudWxsKTsgdmFyIGksIG8gPSBbXSwgcyA9IHsgYWN0dWFsOiBvLCByZWFkeTogITEgfSwgYyA9IGUucGFyc2VNYXJibGVzQXNTdWJzY3JpcHRpb25zKHIpLnVuc3Vic2NyaWJlZEZyYW1lOyByZXR1cm4gdGhpcy5zY2hlZHVsZSgoZnVuY3Rpb24gKCkgeyBpID0gdC5zdWJzY3JpYmUoKGZ1bmN0aW9uICh0KSB7IHZhciBlID0gdDsgdCBpbnN0YW5jZW9mIE4uT2JzZXJ2YWJsZSAmJiAoZSA9IG4ubWF0ZXJpYWxpemVJbm5lck9ic2VydmFibGUoZSwgbi5mcmFtZSkpLCBvLnB1c2goeyBmcmFtZTogbi5mcmFtZSwgbm90aWZpY2F0aW9uOiBNdC5Ob3RpZmljYXRpb24uY3JlYXRlTmV4dChlKSB9KTsgfSksIChmdW5jdGlvbiAodCkgeyBvLnB1c2goeyBmcmFtZTogbi5mcmFtZSwgbm90aWZpY2F0aW9uOiBNdC5Ob3RpZmljYXRpb24uY3JlYXRlRXJyb3IodCkgfSk7IH0pLCAoZnVuY3Rpb24gKCkgeyBvLnB1c2goeyBmcmFtZTogbi5mcmFtZSwgbm90aWZpY2F0aW9uOiBNdC5Ob3RpZmljYXRpb24uY3JlYXRlQ29tcGxldGUoKSB9KTsgfSkpOyB9KSwgMCksIGMgIT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSAmJiB0aGlzLnNjaGVkdWxlKChmdW5jdGlvbiAoKSB7IHJldHVybiBpLnVuc3Vic2NyaWJlKCkgfSksIGMpLCB0aGlzLmZsdXNoVGVzdHMucHVzaChzKSwgeyB0b0JlOiBmdW5jdGlvbiAodCwgciwgbikgeyBzLnJlYWR5ID0gITAsIHMuZXhwZWN0ZWQgPSBlLnBhcnNlTWFyYmxlcyh0LCByLCBuLCAhMCk7IH0gfSB9LCBlLnByb3RvdHlwZS5leHBlY3RTdWJzY3JpcHRpb25zID0gZnVuY3Rpb24gKHQpIHsgdmFyIHIgPSB7IGFjdHVhbDogdCwgcmVhZHk6ICExIH07IHJldHVybiB0aGlzLmZsdXNoVGVzdHMucHVzaChyKSwgeyB0b0JlOiBmdW5jdGlvbiAodCkgeyB2YXIgbiA9ICJzdHJpbmciID09IHR5cGVvZiB0ID8gW3RdIDogdDsgci5yZWFkeSA9ICEwLCByLmV4cGVjdGVkID0gbi5tYXAoKGZ1bmN0aW9uICh0KSB7IHJldHVybiBlLnBhcnNlTWFyYmxlc0FzU3Vic2NyaXB0aW9ucyh0KSB9KSk7IH0gfSB9LCBlLnByb3RvdHlwZS5mbHVzaCA9IGZ1bmN0aW9uICgpIHsgZm9yICh2YXIgZSA9IHRoaXMuaG90T2JzZXJ2YWJsZXM7IGUubGVuZ3RoID4gMDspZS5zaGlmdCgpLnNldHVwKCk7IHQucHJvdG90eXBlLmZsdXNoLmNhbGwodGhpcyk7IGZvciAodmFyIHIgPSB0aGlzLmZsdXNoVGVzdHMuZmlsdGVyKChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5yZWFkeSB9KSk7IHIubGVuZ3RoID4gMDspIHsgdmFyIG4gPSByLnNoaWZ0KCk7IHRoaXMuYXNzZXJ0RGVlcEVxdWFsKG4uYWN0dWFsLCBuLmV4cGVjdGVkKTsgfSB9LCBlLnBhcnNlTWFyYmxlc0FzU3Vic2NyaXB0aW9ucyA9IGZ1bmN0aW9uICh0KSB7IGlmICgic3RyaW5nIiAhPSB0eXBlb2YgdCkgcmV0dXJuIG5ldyB0Zi5TdWJzY3JpcHRpb25Mb2coTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTsgZm9yICh2YXIgZSA9IHQubGVuZ3RoLCByID0gLTEsIG4gPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIGkgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFksIG8gPSAwOyBvIDwgZTsgbysrKSB7IHZhciBzID0gbyAqIHRoaXMuZnJhbWVUaW1lRmFjdG9yLCBjID0gdFtvXTsgc3dpdGNoIChjKSB7IGNhc2UgIi0iOiBjYXNlICIgIjogYnJlYWs7IGNhc2UgIigiOiByID0gczsgYnJlYWs7IGNhc2UgIikiOiByID0gLTE7IGJyZWFrOyBjYXNlICJeIjogaWYgKG4gIT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSkgdGhyb3cgbmV3IEVycm9yKCJmb3VuZCBhIHNlY29uZCBzdWJzY3JpcHRpb24gcG9pbnQgJ14nIGluIGEgc3Vic2NyaXB0aW9uIG1hcmJsZSBkaWFncmFtLiBUaGVyZSBjYW4gb25seSBiZSBvbmUuIik7IG4gPSByID4gLTEgPyByIDogczsgYnJlYWs7IGNhc2UgIiEiOiBpZiAoaSAhPT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSB0aHJvdyBuZXcgRXJyb3IoImZvdW5kIGEgc2Vjb25kIHN1YnNjcmlwdGlvbiBwb2ludCAnXicgaW4gYSBzdWJzY3JpcHRpb24gbWFyYmxlIGRpYWdyYW0uIFRoZXJlIGNhbiBvbmx5IGJlIG9uZS4iKTsgaSA9IHIgPiAtMSA/IHIgOiBzOyBicmVhazsgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCJ0aGVyZSBjYW4gb25seSBiZSAnXicgYW5kICchJyBtYXJrZXJzIGluIGEgc3Vic2NyaXB0aW9uIG1hcmJsZSBkaWFncmFtLiBGb3VuZCBpbnN0ZWFkICciICsgYyArICInLiIpIH0gfSByZXR1cm4gaSA8IDAgPyBuZXcgdGYuU3Vic2NyaXB0aW9uTG9nKG4pIDogbmV3IHRmLlN1YnNjcmlwdGlvbkxvZyhuLCBpKSB9LCBlLnBhcnNlTWFyYmxlcyA9IGZ1bmN0aW9uICh0LCBlLCByLCBuKSB7IGlmICh2b2lkIDAgPT09IG4gJiYgKG4gPSAhMSksIC0xICE9PSB0LmluZGV4T2YoIiEiKSkgdGhyb3cgbmV3IEVycm9yKCdjb252ZW50aW9uYWwgbWFyYmxlIGRpYWdyYW1zIGNhbm5vdCBoYXZlIHRoZSB1bnN1YnNjcmlwdGlvbiBtYXJrZXIgIiEiJyk7IGZvciAodmFyIGkgPSB0Lmxlbmd0aCwgbyA9IFtdLCBzID0gdC5pbmRleE9mKCJeIiksIGMgPSAtMSA9PT0gcyA/IDAgOiBzICogLXRoaXMuZnJhbWVUaW1lRmFjdG9yLCB1ID0gIm9iamVjdCIgIT0gdHlwZW9mIGUgPyBmdW5jdGlvbiAodCkgeyByZXR1cm4gdCB9IDogZnVuY3Rpb24gKHQpIHsgcmV0dXJuIG4gJiYgZVt0XSBpbnN0YW5jZW9mIGNmLkNvbGRPYnNlcnZhYmxlID8gZVt0XS5tZXNzYWdlcyA6IGVbdF0gfSwgYSA9IC0xLCBoID0gMDsgaCA8IGk7IGgrKykgeyB2YXIgbCA9IGggKiB0aGlzLmZyYW1lVGltZUZhY3RvciArIGMsIHAgPSB2b2lkIDAsIGYgPSB0W2hdOyBzd2l0Y2ggKGYpIHsgY2FzZSAiLSI6IGNhc2UgIiAiOiBicmVhazsgY2FzZSAiKCI6IGEgPSBsOyBicmVhazsgY2FzZSAiKSI6IGEgPSAtMTsgYnJlYWs7IGNhc2UgInwiOiBwID0gTXQuTm90aWZpY2F0aW9uLmNyZWF0ZUNvbXBsZXRlKCk7IGJyZWFrOyBjYXNlICJeIjogYnJlYWs7IGNhc2UgIiMiOiBwID0gTXQuTm90aWZpY2F0aW9uLmNyZWF0ZUVycm9yKHIgfHwgImVycm9yIik7IGJyZWFrOyBkZWZhdWx0OiBwID0gTXQuTm90aWZpY2F0aW9uLmNyZWF0ZU5leHQodShmKSk7IH1wICYmIG8ucHVzaCh7IGZyYW1lOiBhID4gLTEgPyBhIDogbCwgbm90aWZpY2F0aW9uOiBwIH0pOyB9IHJldHVybiBvIH0sIGUgfShkZi5WaXJ0dWFsVGltZVNjaGVkdWxlcikgfSwgbWYgPSBmdW5jdGlvbiAodCkgeyB0LnJlcXVlc3RBbmltYXRpb25GcmFtZSA/ICh0aGlzLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gdC5jYW5jZWxBbmltYXRpb25GcmFtZS5iaW5kKHQpLCB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lLmJpbmQodCkpIDogdC5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyAodGhpcy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IHQubW96Q2FuY2VsQW5pbWF0aW9uRnJhbWUuYmluZCh0KSwgdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB0Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZS5iaW5kKHQpKSA6IHQud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gKHRoaXMuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSB0LndlYmtpdENhbmNlbEFuaW1hdGlvbkZyYW1lLmJpbmQodCksIHRoaXMucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gdC53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUuYmluZCh0KSkgOiB0Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gKHRoaXMuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSB0Lm1zQ2FuY2VsQW5pbWF0aW9uRnJhbWUuYmluZCh0KSwgdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB0Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lLmJpbmQodCkpIDogdC5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gKHRoaXMuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSB0Lm9DYW5jZWxBbmltYXRpb25GcmFtZS5iaW5kKHQpLCB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHQub1JlcXVlc3RBbmltYXRpb25GcmFtZS5iaW5kKHQpKSA6ICh0aGlzLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gdC5jbGVhclRpbWVvdXQuYmluZCh0KSwgdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gdC5zZXRUaW1lb3V0KGUsIDFlMyAvIDYwKSB9KTsgfSwgd2YgPSB7IFJlcXVlc3RBbmltYXRpb25GcmFtZURlZmluaXRpb246IG1mLCBBbmltYXRpb25GcmFtZTogbmV3IG1mKHMucm9vdCkgfSwgX2YgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgeGYgPSB7IEFuaW1hdGlvbkZyYW1lQWN0aW9uOiBmdW5jdGlvbiAodCkgeyBmdW5jdGlvbiBlKGUsIHIpIHsgdC5jYWxsKHRoaXMsIGUsIHIpLCB0aGlzLnNjaGVkdWxlciA9IGUsIHRoaXMud29yayA9IHI7IH0gcmV0dXJuIF9mKGUsIHQpLCBlLnByb3RvdHlwZS5yZXF1ZXN0QXN5bmNJZCA9IGZ1bmN0aW9uIChlLCByLCBuKSB7IHJldHVybiB2b2lkIDAgPT09IG4gJiYgKG4gPSAwKSwgbnVsbCAhPT0gbiAmJiBuID4gMCA/IHQucHJvdG90eXBlLnJlcXVlc3RBc3luY0lkLmNhbGwodGhpcywgZSwgciwgbikgOiAoZS5hY3Rpb25zLnB1c2godGhpcyksIGUuc2NoZWR1bGVkIHx8IChlLnNjaGVkdWxlZCA9IHdmLkFuaW1hdGlvbkZyYW1lLnJlcXVlc3RBbmltYXRpb25GcmFtZShlLmZsdXNoLmJpbmQoZSwgbnVsbCkpKSkgfSwgZS5wcm90b3R5cGUucmVjeWNsZUFzeW5jSWQgPSBmdW5jdGlvbiAoZSwgciwgbikgeyBpZiAodm9pZCAwID09PSBuICYmIChuID0gMCksIG51bGwgIT09IG4gJiYgbiA+IDAgfHwgbnVsbCA9PT0gbiAmJiB0aGlzLmRlbGF5ID4gMCkgcmV0dXJuIHQucHJvdG90eXBlLnJlY3ljbGVBc3luY0lkLmNhbGwodGhpcywgZSwgciwgbik7IDAgPT09IGUuYWN0aW9ucy5sZW5ndGggJiYgKHdmLkFuaW1hdGlvbkZyYW1lLmNhbmNlbEFuaW1hdGlvbkZyYW1lKHIpLCBlLnNjaGVkdWxlZCA9IHZvaWQgMCk7IH0sIGUgfShDZS5Bc3luY0FjdGlvbikgfSwgT2YgPSB0ICYmIHQuX19leHRlbmRzIHx8IGZ1bmN0aW9uICh0LCBlKSB7IGZvciAodmFyIHIgaW4gZSkgZS5oYXNPd25Qcm9wZXJ0eShyKSAmJiAodFtyXSA9IGVbcl0pOyBmdW5jdGlvbiBuKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gdDsgfSB0LnByb3RvdHlwZSA9IG51bGwgPT09IGUgPyBPYmplY3QuY3JlYXRlKGUpIDogKG4ucHJvdG90eXBlID0gZS5wcm90b3R5cGUsIG5ldyBuKTsgfSwgU2YgPSB7IGFuaW1hdGlvbkZyYW1lOiBuZXcgKHsgQW5pbWF0aW9uRnJhbWVTY2hlZHVsZXI6IGZ1bmN0aW9uICh0KSB7IGZ1bmN0aW9uIGUoKSB7IHQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSByZXR1cm4gT2YoZSwgdCksIGUucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKHQpIHsgdGhpcy5hY3RpdmUgPSAhMCwgdGhpcy5zY2hlZHVsZWQgPSB2b2lkIDA7IHZhciBlLCByID0gdGhpcy5hY3Rpb25zLCBuID0gLTEsIGkgPSByLmxlbmd0aDsgdCA9IHQgfHwgci5zaGlmdCgpOyBkbyB7IGlmIChlID0gdC5leGVjdXRlKHQuc3RhdGUsIHQuZGVsYXkpKSBicmVhayB9IHdoaWxlICgrK24gPCBpICYmICh0ID0gci5zaGlmdCgpKSk7IGlmICh0aGlzLmFjdGl2ZSA9ICExLCBlKSB7IGZvciAoOyArK24gPCBpICYmICh0ID0gci5zaGlmdCgpKTspdC51bnN1YnNjcmliZSgpOyB0aHJvdyBlIH0gfSwgZSB9KGtlLkFzeW5jU2NoZWR1bGVyKSB9LkFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyKSh4Zi5BbmltYXRpb25GcmFtZUFjdGlvbikgfSwgZ2YgPSB7IGF1ZGl0OiB1Yy5hdWRpdCwgYXVkaXRUaW1lOiBoYy5hdWRpdFRpbWUsIGJ1ZmZlcjogU24uYnVmZmVyLCBidWZmZXJDb3VudDogQ24uYnVmZmVyQ291bnQsIGJ1ZmZlclRpbWU6IExuLmJ1ZmZlclRpbWUsIGJ1ZmZlclRvZ2dsZTogSG4uYnVmZmVyVG9nZ2xlLCBidWZmZXJXaGVuOiBRbi5idWZmZXJXaGVuLCBjYXRjaEVycm9yOiBpaS5jYXRjaEVycm9yLCBjb21iaW5lQWxsOiBzaS5jb21iaW5lQWxsLCBjb21iaW5lTGF0ZXN0OiB4dC5jb21iaW5lTGF0ZXN0LCBjb25jYXQ6IGFpLmNvbmNhdCwgY29uY2F0QWxsOiByZS5jb25jYXRBbGwsIGNvbmNhdE1hcDogcGkuY29uY2F0TWFwLCBjb25jYXRNYXBUbzogYmkuY29uY2F0TWFwVG8sIGNvdW50OiBfaS5jb3VudCwgZGVib3VuY2U6IFBpLmRlYm91bmNlLCBkZWJvdW5jZVRpbWU6IHFpLmRlYm91bmNlVGltZSwgZGVmYXVsdElmRW1wdHk6IFlpLmRlZmF1bHRJZkVtcHR5LCBkZWxheTogUWkuZGVsYXksIGRlbGF5V2hlbjogc28uZGVsYXlXaGVuLCBkZW1hdGVyaWFsaXplOiBqaS5kZW1hdGVyaWFsaXplLCBkaXN0aW5jdDogYm8uZGlzdGluY3QsIGRpc3RpbmN0VW50aWxDaGFuZ2VkOiB4by5kaXN0aW5jdFVudGlsQ2hhbmdlZCwgZGlzdGluY3RVbnRpbEtleUNoYW5nZWQ6IFNvLmRpc3RpbmN0VW50aWxLZXlDaGFuZ2VkLCBlbGVtZW50QXQ6IHJzLmVsZW1lbnRBdCwgZXZlcnk6IFNjLmV2ZXJ5LCBleGhhdXN0OiBGby5leGhhdXN0LCBleGhhdXN0TWFwOiBVby5leGhhdXN0TWFwLCBleHBhbmQ6IEdvLmV4cGFuZCwgZmlsdGVyOiB1cy5maWx0ZXIsIGZpbmFsaXplOiBicy5maW5hbGl6ZSwgZmluZDogeHMuZmluZCwgZmluZEluZGV4OiBTcy5maW5kSW5kZXgsIGZpcnN0OiBOcy5maXJzdCwgZ3JvdXBCeTogRHMuZ3JvdXBCeSwgaWdub3JlRWxlbWVudHM6IEtzLmlnbm9yZUVsZW1lbnRzLCBpc0VtcHR5OiByYy5pc0VtcHR5LCBsYXN0OiB5Yy5sYXN0LCBtYXA6IE5yLm1hcCwgbWFwVG86IENjLm1hcFRvLCBtYXRlcmlhbGl6ZTogUmMubWF0ZXJpYWxpemUsIG1heDogSmMubWF4LCBtZXJnZTogJGMubWVyZ2UsIG1lcmdlQWxsOiBlZS5tZXJnZUFsbCwgbWVyZ2VNYXA6IFp0Lm1lcmdlTWFwLCBmbGF0TWFwOiBadC5tZXJnZU1hcCwgbWVyZ2VNYXBUbzogc3UubWVyZ2VNYXBUbywgbWVyZ2VTY2FuOiBmdS5tZXJnZVNjYW4sIG1pbjogZHUubWluLCBtdWx0aWNhc3Q6IE51Lm11bHRpY2FzdCwgb2JzZXJ2ZU9uOiBEdC5vYnNlcnZlT24sIG9uRXJyb3JSZXN1bWVOZXh0OiAkZS5vbkVycm9yUmVzdW1lTmV4dCwgcGFpcndpc2U6IHF1LnBhaXJ3aXNlLCBwYXJ0aXRpb246IHp1LnBhcnRpdGlvbiwgcGx1Y2s6IFl1LnBsdWNrLCBwdWJsaXNoOiBYdS5wdWJsaXNoLCBwdWJsaXNoQmVoYXZpb3I6ICR1LnB1Ymxpc2hCZWhhdmlvciwgcHVibGlzaExhc3Q6IGVhLnB1Ymxpc2hMYXN0LCBwdWJsaXNoUmVwbGF5OiBadS5wdWJsaXNoUmVwbGF5LCByYWNlOiBuYS5yYWNlLCByZWR1Y2U6IEdjLnJlZHVjZSwgcmVwZWF0OiBoYS5yZXBlYXQsIHJlcGVhdFdoZW46IHlhLnJlcGVhdFdoZW4sIHJldHJ5OiBPYS5yZXRyeSwgcmV0cnlXaGVuOiBJYS5yZXRyeVdoZW4sIHJlZkNvdW50OiB4dS5yZWZDb3VudCwgc2FtcGxlOiBWYS5zYW1wbGUsIHNhbXBsZVRpbWU6IFVhLnNhbXBsZVRpbWUsIHNjYW46IHpjLnNjYW4sIHNlcXVlbmNlRXF1YWw6ICRhLnNlcXVlbmNlRXF1YWwsIHNoYXJlOiB0aC5zaGFyZSwgc2hhcmVSZXBsYXk6IHJoLnNoYXJlUmVwbGF5LCBzaW5nbGU6IHVoLnNpbmdsZSwgc2tpcDogYmguc2tpcCwgc2tpcExhc3Q6IF9oLnNraXBMYXN0LCBza2lwVW50aWw6IGpoLnNraXBVbnRpbCwgc2tpcFdoaWxlOiBQaC5za2lwV2hpbGUsIHN0YXJ0V2l0aDogVmguc3RhcnRXaXRoLCBzd2l0Y2hBbGw6IFpoLnN3aXRjaEFsbCwgc3dpdGNoTWFwOiBRaC5zd2l0Y2hNYXAsIHN3aXRjaE1hcFRvOiBzbC5zd2l0Y2hNYXBUbywgdGFrZTogcGwudGFrZSwgdGFrZUxhc3Q6IFhjLnRha2VMYXN0LCB0YWtlVW50aWw6IHdsLnRha2VVbnRpbCwgdGFrZVdoaWxlOiBUbC50YWtlV2hpbGUsIHRhcDogQW8udGFwLCB0aHJvdHRsZTogRWwudGhyb3R0bGUsIHRocm90dGxlVGltZTogVmwudGhyb3R0bGVUaW1lLCB0aW1lSW50ZXJ2YWw6IHpsLnRpbWVJbnRlcnZhbCwgdGltZW91dDogS2wudGltZW91dCwgdGltZW91dFdpdGg6IHJwLnRpbWVvdXRXaXRoLCB0aW1lc3RhbXA6IHNwLnRpbWVzdGFtcCwgdG9BcnJheTogYXAudG9BcnJheSwgd2luZG93OiBkcC53aW5kb3csIHdpbmRvd0NvdW50OiB4cC53aW5kb3dDb3VudCwgd2luZG93VGltZTogTnAud2luZG93VGltZSwgd2luZG93VG9nZ2xlOiBNcC53aW5kb3dUb2dnbGUsIHdpbmRvd1doZW46IEJwLndpbmRvd1doZW4sIHdpdGhMYXRlc3RGcm9tOiBKcC53aXRoTGF0ZXN0RnJvbSwgemlwOiBnci56aXAsIHppcEFsbDogUXAuemlwQWxsIH0sIFRmID0gei5TdWJqZWN0LCBqZiA9IHouQW5vbnltb3VzU3ViamVjdCwgRWYgPSBOLk9ic2VydmFibGUsIElmID0gdi5TdWJzY3JpcHRpb24sIEFmID0gVC5TdWJzY3JpYmVyLCBDZiA9IEQuQXN5bmNTdWJqZWN0LCBOZiA9IGZuLlJlcGxheVN1YmplY3QsIFBmID0gS3UuQmVoYXZpb3JTdWJqZWN0LCBrZiA9IEl1LkNvbm5lY3RhYmxlT2JzZXJ2YWJsZSwgVmYgPSBNdC5Ob3RpZmljYXRpb24sIEZmID0ganMuRW1wdHlFcnJvciwgUmYgPSAkby5Bcmd1bWVudE91dE9mUmFuZ2VFcnJvciwgTWYgPSBrLk9iamVjdFVuc3Vic2NyaWJlZEVycm9yLCBXZiA9IFlsLlRpbWVvdXRFcnJvciwgcWYgPSBkLlVuc3Vic2NyaXB0aW9uRXJyb3IsIExmID0gQmwuVGltZUludGVydmFsLCBVZiA9IHNwLlRpbWVzdGFtcCwgemYgPSB2Zi5UZXN0U2NoZWR1bGVyLCBCZiA9IGRmLlZpcnR1YWxUaW1lU2NoZWR1bGVyLCBEZiA9IG5uLkFqYXhSZXNwb25zZSwgWWYgPSBubi5BamF4RXJyb3IsIEhmID0gbm4uQWpheFRpbWVvdXRFcnJvciwgWGYgPSBDLnBpcGUsIEdmID0gZ2YsIEpmID0geyBhc2FwOiBVaC5hc2FwLCBxdWV1ZTogYW4ucXVldWUsIGFuaW1hdGlvbkZyYW1lOiBTZi5hbmltYXRpb25GcmFtZSwgYXN5bmM6IFZlLmFzeW5jIH0sIEtmID0geyByeFN1YnNjcmliZXI6IHcucnhTdWJzY3JpYmVyLCBvYnNlcnZhYmxlOiBFLm9ic2VydmFibGUsIGl0ZXJhdG9yOiBsdC5pdGVyYXRvciB9LCAkZiA9IHsgU3ViamVjdDogVGYsIEFub255bW91c1N1YmplY3Q6IGpmLCBPYnNlcnZhYmxlOiBFZiwgU3Vic2NyaXB0aW9uOiBJZiwgU3Vic2NyaWJlcjogQWYsIEFzeW5jU3ViamVjdDogQ2YsIFJlcGxheVN1YmplY3Q6IE5mLCBCZWhhdmlvclN1YmplY3Q6IFBmLCBDb25uZWN0YWJsZU9ic2VydmFibGU6IGtmLCBOb3RpZmljYXRpb246IFZmLCBFbXB0eUVycm9yOiBGZiwgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3I6IFJmLCBPYmplY3RVbnN1YnNjcmliZWRFcnJvcjogTWYsIFRpbWVvdXRFcnJvcjogV2YsIFVuc3Vic2NyaXB0aW9uRXJyb3I6IHFmLCBUaW1lSW50ZXJ2YWw6IExmLCBUaW1lc3RhbXA6IFVmLCBUZXN0U2NoZWR1bGVyOiB6ZiwgVmlydHVhbFRpbWVTY2hlZHVsZXI6IEJmLCBBamF4UmVzcG9uc2U6IERmLCBBamF4RXJyb3I6IFlmLCBBamF4VGltZW91dEVycm9yOiBIZiwgcGlwZTogWGYsIG9wZXJhdG9yczogR2YsIFNjaGVkdWxlcjogSmYsIFN5bWJvbDogS2YgfTsNCg0KZXhwb3J0IGRlZmF1bHQgJGY7DQpleHBvcnQgeyBZZiBhcyBBamF4RXJyb3IsIERmIGFzIEFqYXhSZXNwb25zZSwgSGYgYXMgQWpheFRpbWVvdXRFcnJvciwgamYgYXMgQW5vbnltb3VzU3ViamVjdCwgUmYgYXMgQXJndW1lbnRPdXRPZlJhbmdlRXJyb3IsIENmIGFzIEFzeW5jU3ViamVjdCwgUGYgYXMgQmVoYXZpb3JTdWJqZWN0LCBrZiBhcyBDb25uZWN0YWJsZU9ic2VydmFibGUsIEZmIGFzIEVtcHR5RXJyb3IsIFZmIGFzIE5vdGlmaWNhdGlvbiwgTWYgYXMgT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3IsIEVmIGFzIE9ic2VydmFibGUsIE5mIGFzIFJlcGxheVN1YmplY3QsIEpmIGFzIFNjaGVkdWxlciwgVGYgYXMgU3ViamVjdCwgQWYgYXMgU3Vic2NyaWJlciwgSWYgYXMgU3Vic2NyaXB0aW9uLCBLZiBhcyBTeW1ib2wsIHpmIGFzIFRlc3RTY2hlZHVsZXIsIExmIGFzIFRpbWVJbnRlcnZhbCwgV2YgYXMgVGltZW91dEVycm9yLCBVZiBhcyBUaW1lc3RhbXAsIHFmIGFzIFVuc3Vic2NyaXB0aW9uRXJyb3IsIEJmIGFzIFZpcnR1YWxUaW1lU2NoZWR1bGVyLCBHZiBhcyBvcGVyYXRvcnMsIFhmIGFzIHBpcGUgfTsNCg0KLy8jIHNvdXJjZVVSTD0vZW50cmllcy9yeC5qcw0K"
}